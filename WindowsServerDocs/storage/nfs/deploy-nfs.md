---
title: ネットワーク ファイル システムの展開
description: ネットワークファイルシステムを展開する方法について説明します。
ms.prod: windows-server-threshold
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage
ms.date: 07/09/2018
ms.localizationpriority: medium
ms.openlocfilehash: cc02f0a82b4143b80fc1107a63d234b117502d2d
ms.sourcegitcommit: 6f968368c12b9dd699c197afb3a3d13c2211f85b
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/26/2019
ms.locfileid: "68544650"
---
# <a name="deploy-network-file-system"></a>ネットワーク ファイル システムの展開

>適用対象:Windows Server 2016 では、Windows Server 2012 R2、Windows Server 2012

Network File System (NFS) は、Windows Server を実行しているコンピューターと UNIX オペレーティングシステムを実行しているコンピューター間で NFS プロトコルを使用してファイルを転送できるようにするファイル共有ソリューションを提供します。 このトピックでは、NFS を展開する手順について説明します。

## <a name="whats-new-in-network-file-system"></a>ネットワークファイルシステムの新機能

Windows Server 2012 での NFS の変更点は次のとおりです。

- **NFS バージョン4.1 のサポート**。 このプロトコルバージョンには、次の機能強化が含まれています。
  - ファイアウォールの移動が簡単で、アクセシビリティが向上しています。
  - は、rpcsec\_GSS プロトコルをサポートし、より強力なセキュリティを提供し、クライアントとサーバーがセキュリティをネゴシエートできるようにします。
  - UNIX と Windows ファイルのセマンティクスをサポートします。
  - は、クラスター化されたファイルサーバーの展開を活用します。
  - WAN を使いやすい複合プロシージャをサポートします。

- **Windows PowerShell 用の NFS モジュール**。 組み込みの NFS コマンドレットを使用すると、さまざまな操作を簡単に自動化できます。 コマンドレット名は、他の Windows PowerShell コマンドレットと一貫性があり ("Get" や "Set" などの動詞を使用)、Windows PowerShell に慣れているユーザーが新しいコマンドレットを使用する方法を簡単に理解できるようにします。
- **NFS 管理の改善**。 新しい一元化された UI ベースの管理コンソールにより、クラスター化されたファイルサーバーの管理に加えて、SMB および NFS の共有、クォータ、ファイルスクリーン、分類の構成と管理が簡単になります。
- **Id マッピングの機能強化**。 Id マッピングを構成するための新しい UI サポートとタスクベースの Windows PowerShell コマンドレット。これにより、管理者は id マッピングソースをすばやく構成し、ユーザーに対してマップされた個々の id を作成できます。 拡張機能により、管理者は NFS と SMB の両方でマルチプロトコルアクセスの共有を簡単に設定できるようになります。
- **クラスターリソースモデル**の再構築。 この機能強化により、Windows NFS と SMB プロトコルサーバーのクラスターリソースモデル間の一貫性が確保され、管理が簡単になります。 多くの共有がある NFS サーバーでは、リソースネットワークと、大量の NFS 共有を含むボリュームのフェールオーバーが必要な WMI 呼び出しの数が削減されます。
- **再開キーマネージャーとの統合**。 Resume Key Manager は、ファイルサーバーとファイルシステムの状態を追跡するコンポーネントであり、ファイルサーバーにデータを格納するクライアントやサーバーアプリケーションを中断することなく、Windows SMB および NFS プロトコルサーバーをフェールオーバーできるようにします。 この改善は、Windows Server 2012 を実行しているファイルサーバーの継続的可用性機能の重要なコンポーネントです。

## <a name="scenarios-for-using-network-file-system"></a>ネットワークファイルシステムを使用するシナリオ

NFS は、Windows ベースおよび UNIX ベースのオペレーティングシステムの混合環境をサポートしています。 次の展開シナリオは、NFS を使用して継続的に使用可能な Windows Server 2012 ファイルサーバーを展開する方法の例です。

### <a name="provision-file-shares-in-heterogeneous-environments"></a>異種環境でファイル共有をプロビジョニングする

このシナリオは、Windows とその他のオペレーティングシステム (UNIX や Linux ベースのクライアントコンピューターなど) の両方で構成される異種環境を持つ組織に適用されます。 このシナリオでは、SMB プロトコルと NFS プロトコルの両方で同じファイル共有に対してマルチプロトコルアクセスを提供できます。 通常、このシナリオで Windows ファイルサーバーを展開する場合は、Windows と UNIX ベースのコンピューターのユーザー間のコラボレーションを容易にする必要があります。 ファイル共有が構成されている場合は、SMB プロトコルと NFS プロトコルの両方で共有され、Windows ユーザーが SMB プロトコルを介してファイルにアクセスします。また、UNIX ベースのコンピューターのユーザーは、通常、NFS プロトコルを介してファイルにアクセスします。

このシナリオでは、有効な id マッピングソースの構成が必要です。 Windows Server 2012 では、次の id マッピングストアがサポートされています。

- マッピングファイル
- Active Directory ドメイン サービス (AD DS)
- Active Directory ライトウェイトディレクトリサービス (AD LDS) などの RFC 2307 準拠の LDAP ストア
- ユーザー名マッピング (UNM) サーバー

### <a name="provision-file-shares-in-unix-based-environments"></a>UNIX ベースの環境でファイル共有をプロビジョニングする

このシナリオでは、unix ベースのクライアントコンピューターの NFS ファイル共有へのアクセスを提供するために、Windows ファイルサーバーが主に UNIX ベースの環境に展開されます。 マップされていない UNIX ユーザーアクセス (UUUA) オプションが、Windows Server 2008 R2 の NFS 共有用に最初に実装され、Windows サーバーを使用して、UNIX から Windows へのアカウントマッピングを作成せずに NFS データを格納できるようになりました。 UUUA を使用すると、管理者はアカウントマッピングを構成することなく、NFS を迅速にプロビジョニングして展開することができます。 NFS が有効になっている場合、UUUA は、マップされていないユーザーを表すカスタムセキュリティ識別子 (Sid) を作成します。 マップされたユーザーアカウントは、標準の Windows セキュリティ識別子 (Sid) を使用し、マップされていないユーザーはカスタム NFS Sid を使用します。

## <a name="system-requirements"></a>システム要件

NFS サーバーは、任意のバージョンの Windows Server 2012 にインストールできます。 Nfs サーバーとクライアントの実装が、次のいずれかのプロトコル仕様に準拠している場合は、nfs サーバーまたは NFS クライアントを実行している UNIX ベースのコンピューターで NFS を使用できます。

1. NFS Version 4.1 プロトコル仕様 (RFC [5661](https://tools.ietf.org/html/rfc5661)で定義)
2. NFS Version 3 プロトコル仕様 (RFC [1813](https://tools.ietf.org/html/rfc1813)で定義)
3. NFS Version 2 プロトコル仕様 (RFC [1094](https://tools.ietf.org/html/rfc1094)で定義)

## <a name="deploy-nfs-infrastructure"></a>NFS インフラストラクチャを展開する

次のコンピューターを展開し、ローカルエリアネットワーク (LAN) 上に接続する必要があります。

- Windows Server 2012 を実行している1台以上のコンピューターで、次の2つの主要な NFS 用サービスコンポーネントをインストールします。NFS サーバーと NFS クライアント。 これらのコンポーネントは、同じコンピューターまたは別のコンピューターにインストールできます。
- NFS サーバーと NFS クライアントソフトウェアを実行する1台以上の UNIX ベースのコンピューター。 Nfs サーバーを実行している UNIX ベースのコンピューターは、nfs のファイル共有またはエクスポートをホストします。これは、NFS クライアントを使用するクライアントとして Windows Server 2012 を実行しているコンピューターによってアクセスされます。 必要に応じて、同じ UNIX ベースのコンピューターまたは別の UNIX ベースのコンピューターに、NFS サーバーとクライアントソフトウェアをインストールできます。
- Windows Server 2008 R2 の機能レベルで実行されているドメインコントローラー。 ドメインコントローラーは、Windows 環境のユーザー認証情報とマッピングを提供します。
- ドメインコントローラーが展開されていない場合は、ネットワーク情報サービス (NIS) サーバーを使用して UNIX 環境のユーザー認証情報を提供できます。 または、必要に応じて、ユーザー名マッピングサービスを実行しているコンピューターに保存されているパスワードファイルとグループファイルを使用することもできます。

### <a name="install-network-file-system-on-the-server-with-server-manager"></a>サーバーマネージャーを使用してサーバーにネットワークファイルシステムをインストールする

1. 役割と機能の追加ウィザードの [サーバーの役割] で、 **[ファイル サービスおよび記憶域サービス]** をクリックします (まだインストールされていない場合)。
2. **[ファイルサービスおよび ISCSI サービス]** で、[**ファイルサーバー**と**NFS サーバー**] を選択します。 **[機能の追加]** を選択して、選択した NFS 機能を含めます。
3. サーバーに NFS コンポーネントをインストールするには、 **[インストール]** を選択します。

### <a name="install-network-file-system-on-the-server-with-windows-powershell"></a>Windows PowerShell を使用してサーバーにネットワークファイルシステムをインストールする

1. Windows PowerShell を起動します。 タスク バーの PowerShell アイコンを右クリックし、 **[管理者として実行]** をクリックします。
2. 次の Windows PowerShell コマンドを実行します。

```PowerShell
Import-Module ServerManager
Add-WindowsFeature FS-NFS-Service
Import-Module NFS
```

## <a name="configure-nfs-authentication"></a>NFS 認証を構成する

NFS バージョン4.1 と NFS バージョン3.0 プロトコルを使用する場合、次の認証およびセキュリティオプションがあります。

- RPCSEC\_GSS
  - **Krb5**: では、ファイル共有へのアクセスを許可する前に、Kerberos version 5 プロトコルを使用してユーザーを認証します。
  - **Krb5i**: Kerberos version 5 プロトコルを使用して整合性チェック (チェックサム) による認証を行い、データが変更されていないことを確認します。
  - **Krb5p**Kerberos version 5 プロトコルを使用します。このプロトコルは、プライバシーの暗号化を使用して NFS トラフィックを認証します。
- 認証\_システム

また、[サーバー認証 (AUTH\_SYS)] を使用しないように選択することもできます。これにより、マップされていないユーザーアクセスを有効にすることができます。 マップされていないユーザーアクセスを使用する場合は、割り当てられていないユーザーアクセスを UID/GID (既定値) または匿名アクセスを許可するように指定できます。

NFS 認証を構成する手順については、次のセクションで説明します。

## <a name="create-an-nfs-file-share"></a>NFS ファイル共有を作成する

NFS ファイル共有を作成するには、サーバーマネージャーまたは Windows PowerShell NFS コマンドレットを使用します。

### <a name="create-an-nfs-file-share-with-server-manager"></a>サーバーマネージャーを使用して NFS ファイル共有を作成する

1. ローカルの Administrators グループのメンバーとしてサーバーにログオンします。
2. サーバー マネージャーが自動的に起動します。 自動的に開始されない場合は、 **[スタート]** を選択し、「 **servermanager**」と入力して、 **[サーバーマネージャー]** を選択します。
3. 左側で、 **[ファイルサービスおよび記憶域サービス]** を選択し、 **[共有]** を選択します。
4. **ファイル共有を作成する場合は、[新しい共有ウィザード**] を開始します。
5. **[プロファイルの選択]** ページで、[ **Nfs 共有–クイック**または**nfs 共有-詳細設定**] を選択し、 **[次へ]** を選択します。
6. **[共有の場所]** ページで、サーバーとボリュームを選択し、 **[次へ]** を選択します。
7. **[共有名]** ページで、新しい共有の名前を指定し、 **[次へ]** を選択します。
8. **[認証]** ページで、この共有に使用する認証方法を指定します。
9. **[共有のアクセス許可]** ページで、 **[追加]** を選択し、共有にアクセス許可を付与するホスト、クライアントグループ、またはネットグループを指定します。
10. **[アクセス許可]** で、ユーザーに割り当てるアクセス制御の種類を構成し、[ **OK]** を選択します。
11. **[確認]** ページで構成を確認し、 **[作成]** を選択して NFS ファイル共有を作成します。

### <a name="windows-powershell-equivalent-commands"></a>Windows PowerShell と同等のコマンド

次の Windows PowerShell コマンドレットでは、NFS ファイル共有を作成`nfs1`することもできます (ここ`C:\\shares\\nfsfolder`で、は共有の名前、はファイルパスです)。

```PowerShell
New-NfsShare -name nfs1 -Path C:\shares\nfsfolder
```

### <a name="known-issue"></a>既知の問題
NFS バージョン4.1 では、無効な文字を使用してファイル名を作成またはコピーすることができます。 Vi エディターを使用してファイルを開こうとすると、破損していると表示されます。 Vi からファイルを保存したり、名前を変更したり、移動したり、アクセス許可を変更したりすることはできません。 無効な文字を使用しないようにしてください。
