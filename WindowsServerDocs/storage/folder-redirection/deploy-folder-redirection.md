---
title: オフラインファイルでフォルダーリダイレクトを展開する
description: Windows Server を使用して、オフラインファイルで Windows クライアントコンピューターにフォルダーリダイレクトを展開する方法について説明します。
ms.prod: windows-server
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage
ms.date: 06/06/2019
ms.localizationpriority: medium
ms.openlocfilehash: 21172d9d3e6d91af691986bfd84b0e32049f3b88
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/27/2019
ms.locfileid: "71401964"
---
# <a name="deploy-folder-redirection-with-offline-files"></a>オフラインファイルでフォルダーリダイレクトを展開する

>適用対象:Windows 10、Windows 7、Windows 8、Windows 8.1、Windows Vista、Windows Server 2019、Windows Server 2016、windows server 2012、Windows Server 2012 R2、Windows Server 2008 R2、Windows Server (半期チャネル)

このトピックでは、Windows Server を使用して、オフラインファイルで Windows クライアントコンピューターにフォルダーリダイレクトを展開する方法について説明します。

このトピックに対する最近の変更の一覧については、「[変更履歴](#change-history)」を参照してください。

> [!IMPORTANT]
> [MS16](https://support.microsoft.com/help/3163622/ms16-072-security-update-for-group-policy-june-14-2016)で行われたセキュリティの変更により、手順 3 [. を更新しました。このトピックのフォルダーリダイレクト](#step-3-create-a-gpo-for-folder-redirection)用の GPO を作成して、Windows がフォルダーリダイレクトポリシーを適切に適用できるようにします (影響を受ける pc でリダイレクトされたフォルダーを元に戻すことはできません)。

## <a name="prerequisites"></a>前提条件

### <a name="hardware-requirements"></a>ハードウェア要件

フォルダーリダイレクトには、x64 ベースまたは x86 ベースのコンピューターが必要です。Windows® RT ではサポートされていません。

### <a name="software-requirements"></a>ソフトウェア要件

フォルダーリダイレクトには、次のソフトウェア要件があります。

- フォルダーリダイレクトを管理するには、Domain Administrators セキュリティグループ、Enterprise Administrators セキュリティグループ、またはグループポリシー Creator Owners セキュリティグループのメンバーとしてサインインする必要があります。
- クライアントコンピューターでは、Windows 10、Windows 8.1、windows 8、Windows 7、Windows Server 2019、Windows Server 2016、Windows Server (半期チャネル)、windows server 2012 R2、Windows Server 2012、Windows Server 2008 R2、または Windows Server 2008 を実行する必要があります。
- クライアント コンピューターは、管理している Active Directory ドメイン サービス (AD DS) に参加している必要があります。
- グループ ポリシー管理および Active Directory 管理センターがインストールされたコンピューターが使用できる必要があります。
- リダイレクトされたフォルダーをホストするには、ファイルサーバーが使用可能である必要があります。
    - ファイル共有で DFS 名前空間を使用している場合、ユーザーのさまざまなサーバーへの編集の競合を防ぐため、DFS フォルダー (リンク) のターゲットは 1 つである必要があります。
    - ファイル共有で DFS レプリケーションを使用して、コンテンツを別のサーバーにレプリケートする場合、ユーザーのさまざまなサーバーへの編集の競合を防ぐため、ユーザーはソース サーバーにのみアクセスできる必要があります。
    - クラスター化されたファイル共有を使用する場合は、フォルダーリダイレクトおよびオフラインファイルのパフォーマンスの問題を回避するために、ファイル共有の継続的な可用性を無効にします。 さらに、ユーザーが継続的に使用可能なファイル共有にアクセスできなくなると、オフラインファイルがオフライン3-6 モードに移行しないことがあります。これにより、オフラインファイルの Always Offline モードをまだ使用していないユーザーに不満が生じる可能性があります。

> [!NOTE]
> フォルダーリダイレクトの新機能には、追加のクライアントコンピューターと Active Directory スキーマの要件があります。 詳細については、「[プライマリコンピューターを展開](deploy-primary-computers.md)する」、「[フォルダーのオフラインファイルを無効](disable-offline-files-on-folders.md)にする」、「 [Always Offline モードを有効](enable-always-offline.md)にする」、および「[フォルダー移動を最適化する](enable-optimized-moving.md)」を参照してください

## <a name="step-1-create-a-folder-redirection-security-group"></a>手順 1:フォルダーリダイレクトセキュリティグループを作成する

フォルダーリダイレクトを使用して環境がまだセットアップされていない場合、最初の手順は、フォルダーリダイレクトポリシー設定を適用するすべてのユーザーを含むセキュリティグループを作成することです。

フォルダーリダイレクトのセキュリティグループを作成するには、次の手順を実行します。

1. Active Directory 管理センターがインストールされているコンピューターでサーバーマネージャーを開きます。
2. **[ツール]** メニューの **[Active Directory 管理センター]** を選択します。 Active Directory 管理センターが表示されます。
3. 適切なドメインまたは OU を右クリックし、 **[新規作成]** をクリックして、 **[グループ]** を選択します。
4. **[グループの作成]** ウィンドウの **[グループ]** で、次の設定を指定します。
    - **[グループ名]** に、セキュリティ グループの名前を入力します。たとえば、**フォルダーリダイレクトユーザー**。
    - **[グループのスコープ]** で、 **[セキュリティ]** を選択し、 **[グローバル]** を選択します。
5. **[メンバー]** セクションで、 **[追加]** を選択します。 [ユーザー、連絡先、コンピューター、サービス アカウントまたはグループの選択] ダイアログ ボックスが表示されます。
6. フォルダーリダイレクトを展開するユーザーまたはグループの名前を入力し、[ **Ok]** を選択してから、もう一度 **[ok]** を選択します。

## <a name="step-2-create-a-file-share-for-redirected-folders"></a>手順 2:リダイレクトされたフォルダーのファイル共有を作成する

リダイレクトされたフォルダー用のファイル共有がまだない場合は、次の手順を実行して、Windows Server 2012 を実行しているサーバーにファイル共有を作成します。

> [!NOTE]
> 別のバージョンの Windows Server を実行しているサーバーにファイル共有を作成した場合、一部の機能が異なっていたり、使用できなかったりすることがあります。

Windows Server 2019、Windows Server 2016、および Windows Server 2012 でファイル共有を作成するには、次の手順を実行します。

1. サーバーマネージャーナビゲーションウィンドウで、**ファイルサービスおよび記憶域サービス** を選択し、**共有** を選択して 共有 ページを表示します。
2. **[共有]** タイルで、 **[タスク]** を選択し、 **[新しい共有]** を選択します。 新しい共有ウィザードが表示されます。
3. **[プロファイルの選択]** ページで、 **[SMB 共有–簡易]** を選択します。 ファイルサーバーリソースマネージャーがインストールされていて、フォルダー管理プロパティを使用している場合は、代わりに **[SMB 共有-詳細設定]** を選択します。
4. **[共有の場所]** ページで、共有を作成するサーバーとボリュームを選択します。
5. **[共有名]** ページで、共有 **[名]** ボックスに共有の名前 ( **Users $** など) を入力します。
    >[!TIP]
    >共有を作成するときに、共有名の後```$```にを指定して共有を非表示にします。 これにより、共有がカジュアルブラウザーから非表示になります。
6. **その他の設定** ページで、継続的可用性を有効にする チェックボックスをオフにし、必要に応じて **アクセスベースの列挙を有効に**し、**データアクセスを暗号化**する チェックボックスをオンにします。
7. **[アクセス許可]** ページで、 **[アクセス許可のカスタマイズ]** を選択します。 [セキュリティの詳細設定] ダイアログ ボックスが表示されます。
8. **[継承を無効にする]** を選択し、継承された **[アクセス許可をこのオブジェクトの明示的なアクセス許可に変換]** を選択します。
9. 表1で説明したようにアクセス許可を設定し、図1に示されているように、一覧にないグループとアカウントのアクセス許可を削除し、手順1で作成したフォルダーリダイレクトユーザーグループに特別なアクセス許可を追加します。
    
    ![リダイレクトされたフォルダー共有のアクセス許可の設定](media/deploy-folder-redirection/setting-the-permissions-for-the-redirected-folders-share.png)
    
    **図 1**リダイレクトされたフォルダー共有のアクセス許可の設定
10. **[SMB 共有 - 高度]** プロファイルを選択した場合、 **[管理プロパティ]** ページで、 **[ユーザー ファイル]** フォルダーの使用法値を選択します。
11. **[SMB 共有 - 高度]** プロファイルを選択した場合、 **[クォータ]** ページで、オプションで共有のユーザーに適用するクォータを選択します。
12. **確認** ページで、作成 を選択し**ます。**

### <a name="required-permissions-for-the-file-share-hosting-redirected-folders"></a>リダイレクトされたフォルダーをホストするファイル共有に必要なアクセス許可

| ユーザー アカウント  | アクセス  | 対象  |
| --------- | --------- | --------- |
| ユーザー アカウント | アクセス | 対象 |
| System     | フル コントロール        |    このフォルダー、サブフォルダー、およびファイル     |
| 管理者     | フル コントロール       | このフォルダーのみ        |
| 作成者/所有者     |   フル コントロール      |   サブフォルダーとファイルのみ      |
| 共有にデータを配置する必要があるユーザーのセキュリティグループ (フォルダーリダイレクトユーザー)     |   フォルダーの一覧表示/データの読み取り *(高度なアクセス許可)* <br /><br />フォルダーの作成/データの追加 *(高度なアクセス許可)* <br /><br />属性の読み取り *(高度なアクセス許可)* <br /><br />拡張属性の読み取り *(高度なアクセス許可)* <br /><br />読み取りアクセス許可 *(高度なアクセス許可)*      |  このフォルダーのみ       |
| その他のグループおよびアカウント     |  なし (削除)       |         |

## <a name="step-3-create-a-gpo-for-folder-redirection"></a>手順 3:フォルダーリダイレクト用の GPO を作成する

フォルダーリダイレクトの設定用に GPO がまだ作成されていない場合は、次の手順に従って作成します。

フォルダーリダイレクト用の GPO を作成するには、次の手順を実行します。

1. グループ ポリシー管理がインストールされたコンピューターでサーバー マネージャーを開きます。
2. **[ツール]** メニューの **[グループポリシー管理]** を選択します。
3. フォルダーリダイレクトを設定するドメインまたは OU を右クリックし、[**このドメインに GPO を作成し、この**コンテナーにリンクする] を選択します。
4. **[新しい gpo]** ダイアログボックスで、gpo の名前 (たとえば、**フォルダーリダイレクト設定**) を入力し、[ **OK]** を選択します。
5. 新しく作成した GPO を右クリックし、 **[リンクの有効化]** チェックボックスをオフにします。 これにより、GPO の構成が完了するまで、それが適用されるのを防ぎます。
6. GPO を選択します。 **[スコープ]** タブの **[セキュリティフィルター処理]** セクションで、 **[Authenticated Users]** を選択し、 **[削除]** を選択して、GPO がすべてのユーザーに適用されないようにします。
7. **[セキュリティフィルター処理]** セクションで、 **[追加]** を選択します。
8. **[ユーザー、コンピューター、またはグループの選択**] ダイアログボックスで、手順1で作成したセキュリティグループの名前 (たとえば、「**フォルダーリダイレクトユーザー**」) を入力し、[ **OK]** を選択します。
9. **[委任]** タブを選択し、 **[追加]** を選択して「 **Authenticated Users**」と入力し、 **[ok]** をクリックしてから **[ok]** をもう一度選択して、既定の読み取りアクセス許可を受け入れます。
    
    この手順は[、MS16](https://support.microsoft.com/help/3163622/ms16-072-security-update-for-group-policy-june-14-2016)でセキュリティが変更されたために必要です。

> [!IMPORTANT]
> [MS16](https://support.microsoft.com/help/3163622/ms16-072-security-update-for-group-policy-june-14-2016)で行われたセキュリティの変更により、Authenticated users グループにフォルダーリダイレクト GPO への読み取りアクセス許可を委任する必要があります。そうしないと、gpo がユーザーに適用されない場合、または gpo が既に適用されている場合は、gpo が削除され、リダイレクトされます。フォルダーをローカル PC に戻します。 詳細については、「[グループポリシーセキュリティ更新プログラム MS16-072 の展開](https://blogs.technet.microsoft.com/askds/2016/06/22/deploying-group-policy-security-update-ms16-072-kb3163622/)」を参照してください。

## <a name="step-4-configure-folder-redirection-with-offline-files"></a>手順 4:オフラインファイルでフォルダーリダイレクトを構成する

フォルダーリダイレクト設定の GPO を作成した後、次の手順で説明するように、グループポリシー設定を編集してフォルダーリダイレクトを有効にし、構成します。

> [!NOTE]
> オフラインファイルは、Windows クライアントコンピューター上のリダイレクトフォルダーに対しては既定で有効になり、ユーザーが変更しない限り、Windows Server を実行しているコンピューターでは無効になります。 グループポリシーを使用してオフラインファイルを有効にするかどうかを制御するには、[**オフラインファイル機能の使用を許可または禁止**する] ポリシー設定を使用します。
> その他のオフラインファイルグループポリシー設定の一部については、「[オフラインファイルの高度な機能を有効にする](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn270369(v%3dws.11)>)」と「[オフラインファイル用のグループポリシーを構成](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc759721(v%3dws.10)>)する」を参照してください。

グループポリシーでフォルダーリダイレクトを構成する方法を次に示します。

1. グループポリシー管理 で、作成した GPO (たとえば、**フォルダーリダイレクト設定**) を右クリックし、**編集** を選択します。
2. グループポリシー管理エディター ウィンドウで、**ユーザーの構成**、**ポリシー**、**Windows の設定**、**フォルダーリダイレクト** の順に移動します。
3. リダイレクトするフォルダー ( **[ドキュメント]** など) を右クリックし、 **[プロパティ]** を選択します。
4. **[プロパティ]** ダイアログボックスの **[設定]** ボックスで、 **[基本-全員のフォルダーを同じ場所にリダイレクトする]** を選択します。

    > [!NOTE]
    > Windows XP または Windows Server 2003 を実行しているクライアントコンピュータにフォルダーリダイレクトを適用するには、 **[設定]** タブを選択し、[ **Windows 2000、windows 2000 サーバー、windows XP、および windows server 2003 オペレーティングサービスにリダイレクトポリシーを適用する] を選択します。システム**チェックボックス。

5. **[ターゲットフォルダーの場所]** セクションで、 **[ルートパスの下に各ユーザーのフォルダーを作成]** する を選択し、 **[ルートパス]** ボックスに、リダイレクトされたフォルダーを格納するファイル共有へのパスを入力します。次に例を示します。  **\\ \\fs1.corp.contoso.com\\users $**
6. **[設定]** タブを選択し、 **[ポリシーの削除]** セクションで、必要に応じて、**ポリシーが削除されたときにフォルダーをローカルの userprofile の場所にリダイレクト**することを選択します (この設定は、フォルダーリダイレクトの動作を向上させるために役立ちます)。adminisitrators とユーザーの場合は予測できません。
7. **[OK]** を選択し、警告ダイアログボックスで **[はい]** を選択します。

## <a name="step-5-enable-the-folder-redirection-gpo"></a>手順 5:フォルダーリダイレクト GPO を有効にする

フォルダーリダイレクトグループポリシー設定の構成が完了したら、次の手順として、GPO を有効にし、影響を受けるユーザーに適用できるようにします。

> [!TIP]
> プライマリ コンピューターのサポートまたはその他のポリシー設定を実装する予定がある場合は、GPO を有効にする前に、ここでそれらを実行してください。 これにより、プライマリ コンピューターのサポートが有効にされる前に、ユーザー データがプライマリでないコンピューターにコピーされることを防ぎます。

フォルダーリダイレクト GPO を有効にするには、次の手順を実行します。

1. グループ ポリシーの管理を開きます。
2. 作成した GPO を右クリックし、[リンクの**有効化**] を選択します。 メニュー項目の横にチェックボックスが表示されます。

## <a name="step-6-test-folder-redirection"></a>手順 6:テストフォルダーのリダイレクト

フォルダーリダイレクトをテストするには、フォルダーリダイレクト用に構成されたユーザーアカウントを使用してコンピューターにサインインします。 次に、フォルダーとプロファイルがリダイレクトされることを確認します。

フォルダーリダイレクトをテストする方法を次に示します。

1. フォルダーリダイレクトを有効にしたユーザーアカウントを使用して、プライマリコンピューターにサインインします (プライマリコンピューターのサポートを有効にしている場合)。
2. ユーザーが以前にコンピューターにサインインしている場合、管理者特権でコマンド プロンプトを開き、次のコマンドを入力して、クライアント コンピューターに最新のグループ ポリシー設定が適用されるようにします。
    
    ```PowerShell
    gpupdate /force
    ```
3. エクスプローラーを開きます。
4. リダイレクトされたフォルダー (ドキュメントライブラリの マイドキュメント フォルダーなど) を右クリックし、**プロパティ** を選択します。
5. **[場所]** タブを選択し、パスにローカルパスではなく、指定したファイル共有が表示されていることを確認します。

## <a name="appendix-a-checklist-for-deploying-folder-redirection"></a>付録 A:フォルダーリダイレクトを展開するためのチェックリスト

| 状況           | 操作 |
| ---              | ---    |
| ☐<br>☐<br>☐    | 1. ドメインを準備する<br>-コンピューターをドメインに参加させる<br>-ユーザーアカウントを作成する |
| ☐<br><br><br>   | 2. フォルダーリダイレクトのセキュリティグループの作成<br>-グループ名:<br>属する |
| ☐<br><br>       | 3.リダイレクトされたフォルダーのファイル共有を作成する<br>-ファイル共有名: |
| ☐<br><br>       | 4。フォルダーリダイレクト用の GPO を作成する<br>-GPO 名: |
| ☐<br><br>☐<br>☐<br>☐<br>☐<br>☐ | 5。フォルダーリダイレクトとオフラインファイルポリシー設定の構成<br>-リダイレクトされたフォルダー:<br>-Windows 2000、Windows XP、および Windows Server 2003 のサポートは有効になっていますか?<br>-オフラインファイル有効になっていますか? (Windows クライアントコンピューターでは既定で有効)<br>-常時オフラインモードが有効になっていますか?<br>-バックグラウンドファイル同期が有効になっていますか?<br>-リダイレクトされたフォルダーの移動が最適化されましたか? |
| ☐<br><br>☐<br><br>☐<br>☐ | 6。Optionalプライマリコンピューターのサポートを有効にする<br>-コンピューターベースまたはユーザーベースの場合<br>-ユーザーのプライマリコンピューターを指定します<br>-ユーザーとプライマリコンピューターのマッピングの場所:<br>-(オプション) フォルダーリダイレクトに対してプライマリコンピューターのサポートを有効にします。<br>-(省略可能) 移動ユーザープロファイルのプライマリコンピューターのサポートを有効にします。 |
| ☐         | 7.フォルダーリダイレクト GPO を有効にする |
| ☐         | 8.テストフォルダーのリダイレクト |

## <a name="change-history"></a>変更履歴

次の表に、このトピックの最も重要な変更をいくつかまとめています。

| date | 説明 | Reason|
| --- | --- | --- |
| 2017年1月18日 | 手順 3. に[ステップを追加しました。フォルダーリダイレクト](#step-3-create-a-gpo-for-folder-redirection)用の GPO を作成して、認証されたユーザーに読み取りアクセス許可を委任します。これは、グループポリシーセキュリティ更新プログラムのために必要になりました。 | カスタマー フィードバック |

## <a name="more-information"></a>詳細情報

* [フォルダーリダイレクト、オフラインファイル、移動ユーザープロファイル](folder-redirection-rup-overview.md)
* [フォルダーリダイレクトと移動ユーザープロファイルのプライマリコンピューターを展開する](deploy-primary-computers.md)
* [高度なオフラインファイル機能を有効にする](enable-always-offline.md)
* [レプリケートされたユーザープロファイルデータに関するマイクロソフトのサポート声明](https://blogs.technet.microsoft.com/askds/2010/09/01/microsofts-support-statement-around-replicated-user-profile-data/)
* [DISM を使用したアプリのサイドロード](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-8.1-and-8/hh852635(v=win.10)>)
* [Windows ランタイムベースのアプリのパッケージ化、配置、およびクエリのトラブルシューティング](https://msdn.microsoft.com/library/windows/desktop/hh973484.aspx)