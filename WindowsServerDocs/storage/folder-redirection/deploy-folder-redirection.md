---
title: フォルダー リダイレクトとオフライン ファイルを展開するフォルダー リダイレクトとオフライン ファイルを展開する
description: Windows Server を使用して、Windows クライアント コンピューターにフォルダー リダイレクトとオフライン ファイルを展開する方法について説明します。
ms.prod: windows-server
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage
ms.date: 06/06/2019
ms.localizationpriority: medium
ms.openlocfilehash: fbdef69f62a76fcc8d01aa0319b2b0859fc4f7cd
ms.sourcegitcommit: 6973690a8705b24d09eb98f1713743d5e6079161
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/29/2020
ms.locfileid: "84211911"
---
# <a name="deploy-folder-redirection-with-offline-files"></a>フォルダー リダイレクトとオフライン ファイルを展開する

> 適用先:Windows 10、Windows 7、Windows 8、Windows 8.1、Windows Vista、Windows Server 2019、Windows Server 2016、Windows Server 2012、Windows Server 2012 R2、Windows Server 2008 R2、Windows Server (半期チャネル)

このトピックでは、Windows Server を使用して、Windows クライアント コンピューターにフォルダー リダイレクトとオフライン ファイルを展開する方法について説明します。

このトピックに最近加えられた変更の一覧については、「[変更履歴](#change-history)」を参照してください。

> [!IMPORTANT]
> [MS16-072](https://support.microsoft.com/help/3163622/ms16-072-security-update-for-group-policy-june-14-2016) で行われたセキュリティの変更により、このトピックの「[手順 3:フォルダー リダイレクトの GPO を作成する](#step-3-create-a-gpo-for-folder-redirection)」を更新し、Windows でフォルダー リダイレクト ポリシーを適切に適用できるように (また、影響を受ける PC でリダイレクトされたフォルダーが元に戻されないように) しました。

## <a name="prerequisites"></a>前提条件

### <a name="hardware-requirements"></a>ハードウェア要件

フォルダー リダイレクトには x64 ベースまたは x86 ベースのコンピューターが必要です。これは Windows&reg; RT ではサポートされていません。

### <a name="software-requirements"></a>ソフトウェア要件

フォルダー リダイレクトには次のソフトウェア要件があります。

- フォルダー リダイレクトを管理するには、Domain Administrators セキュリティ グループ、Enterprise Administrators セキュリティ グループ、または Group Policy Creator Owners セキュリティ グループのメンバーとしてサインインする必要があります。
- クライアント コンピューターで、Windows 10、Windows 8.1、Windows 8、Windows 7、Windows Server 2019、Windows Server 2016、Windows Server (半期チャネル)、Windows Server 2012 R2、Windows Server 2012、Windows Server 2008 R2、または Windows Server 2008 を実行している必要があります。
- クライアント コンピューターは、管理している Active Directory ドメイン サービス (AD DS) に参加している必要があります。
- グループ ポリシー管理および Active Directory 管理センターがインストールされたコンピューターが使用できる必要があります。
- リダイレクトされたフォルダーをホストするために、ファイル サーバーが使用できる必要があります。
    - ファイル共有で DFS 名前空間を使用している場合、ユーザーのさまざまなサーバーへの編集の競合を防ぐため、DFS フォルダー (リンク) のターゲットは 1 つである必要があります。
    - ファイル共有で DFS レプリケーションを使用して、コンテンツを別のサーバーにレプリケートする場合、ユーザーのさまざまなサーバーへの編集の競合を防ぐため、ユーザーはソース サーバーにのみアクセスできる必要があります。
    - クラスター化されたファイル共有を使用する場合は、フォルダー リダイレクトとオフライン ファイルのパフォーマンスの問題を回避するために、ファイル共有の継続的可用性を無効にします。 さらに、オフライン ファイルは、ユーザーが継続的に利用可能なファイル共有へのアクセスを失った後 3 - 6 分間、オフライン モードに移行できない可能性があります。これによって、オフライン ファイルの常時オフライン モードをまだ使用していないユーザーはストレスを感じる可能性があります。

> [!NOTE]
> フォルダー リダイレクトの一部の新機能には、クライアント コンピューターと Active Directory スキーマの追加の要件があります。 詳細については、[プライマリ コンピューターの展開](deploy-primary-computers.md)、[フォルダーでのオフライン ファイルの無効化](disable-offline-files-on-folders.md)、[常時オフライン モードの有効化](enable-always-offline.md)、および[フォルダー移動の最適化の有効化](enable-optimized-moving.md)に関する記事を参照してください。

## <a name="step-1-create-a-folder-redirection-security-group"></a>手順 1:フォルダー リダイレクトのセキュリティ グループを作成する

環境にフォルダー リダイレクトをまだ設定していない場合、最初の手順は、フォルダー リダイレクトのポリシー設定を適用するすべてのユーザーを含むセキュリティ グループを作成することです。

フォルダー リダイレクトのセキュリティ グループを作成する手順は次のとおりです。

1. Active Directory 管理センターがインストールされたコンピューターでサーバー マネージャーを開きます。
2. **[ツール]** メニューの **[Active Directory 管理センター]** を選択します。 Active Directory 管理センターが表示されます。
3. 適切なドメインまたは OU を右クリックし、 **[新規作成]** を選択して、 **[グループ]** を選択します。
4. **[グループの作成]** ウィンドウの **[グループ]** で、次の設定を指定します。
    - **[グループ名]** に、セキュリティ グループの名前を入力します。たとえば、**Folder Redirection Users**。
    - **[グループのスコープ]** で **[セキュリティ]** を選択し、 **[グローバル]** を選択します。
5. **[メンバー]** セクションの **[追加]** を選択します。 [ユーザー、連絡先、コンピューター、サービス アカウントまたはグループの選択] ダイアログ ボックスが表示されます。
6. フォルダー リダイレクトの展開先となるユーザーまたはグループの名前を入力して **[OK]** を選択し、もう一度 **[OK]** を選択します。

## <a name="step-2-create-a-file-share-for-redirected-folders"></a>手順 2:リダイレクトされたフォルダーのファイル共有を作成する

リダイレクトされたフォルダーのファイル共有がまだない場合は、次の手順を実行して、Windows Server 2012 を実行しているサーバー上にファイル共有を作成します。

> [!NOTE]
> 別のバージョンの Windows Server を実行しているサーバーにファイル共有を作成した場合、一部の機能が異なっていたり、使用できなかったりすることがあります。

Windows Server 2019、Windows Server 2016、および Windows Server 2012 でファイル共有を作成する手順は次のとおりです。

1. サーバー マネージャーのナビゲーション ウィンドウで **[ファイル サービスと記憶域サービス]** を選択し、 **[共有]** を選択して共有のページを表示します。
2. **[共有]** タイルで、 **[タスク]** を選択してから **[新しい共有]** を選択します。 新しい共有ウィザードが表示されます。
3. **[プロファイルの選択]** ページで、 **[SMB 共有 – 簡易]** を選択します。 ファイル サーバー リソース マネージャーをインストールしており、フォルダー管理プロパティを使用している場合は、代わりに **[SMB 共有 - 高度]** を選択します。
4. **[共有の場所]** ページで、共有を作成するサーバーとボリュームを選択します。
5. **[共有名]** ページで、 **[共有名]** ボックスに共有の名前 (例: **Users$** ) を入力します。
    >[!TIP]
    >共有を作成する場合、共有名の後ろに ```$``` を付けて共有を非表示にします。 これにより、共有が通常のブラウザーから非表示になります。
6. **[他の設定]** ページで、[継続的可用性を有効にする] チェック ボックスをオフにし (ある場合)、必要に応じて **[アクセスベースの列挙を有効にする]** および **[データ アクセスの暗号化]** チェック ボックスをオンにします。
7. **[アクセス許可]** ページで、 **[アクセス許可をカスタマイズする]** を選択します。 [セキュリティの詳細設定] ダイアログ ボックスが表示されます。
8. **[継承の無効化]** を選択し、 **[継承されたアクセス許可をこのオブジェクトの明示的なアクセス許可に変換します]** を選択します。
9. 表 1 で説明し、図 1 に示すように、アクセス許可を設定し、一覧にないグループとアカウントのアクセス許可を削除し、手順 1 で作成した Folder Redirection Users グループに特殊なアクセス許可を追加します。

    ![リダイレクトされたフォルダーの共有のアクセス許可の設定](media/deploy-folder-redirection/setting-the-permissions-for-the-redirected-folders-share.png)

    **図 1** リダイレクトされたフォルダーの共有のアクセス許可の設定
10. **[SMB 共有 - 高度]** プロファイルを選択した場合、 **[管理プロパティ]** ページで、 **[ユーザー ファイル]** フォルダーの使用法値を選択します。
11. **[SMB 共有 - 高度]** プロファイルを選択した場合、 **[クォータ]** ページで、オプションで共有のユーザーに適用するクォータを選択します。
12. **[確認]** ページで、 **[作成]** を選択します。

### <a name="required-permissions-for-the-file-share-hosting-redirected-folders"></a>リダイレクトされたフォルダーをホストするファイル共有に必要なアクセス許可

| ユーザー アカウント  | アクセス権  | 適用対象  |
| --------- | --------- | --------- |
| System     | フル コントロール        |    このフォルダー、サブフォルダー、およびファイル     |
| Administrators     | フル コントロール       | このフォルダーのみ        |
| 作成者/所有者     |   フル コントロール      |   サブフォルダーとファイルのみ      |
| 共有にデータを置く必要があるユーザーのセキュリティ グループ (Folder Redirection Users)     |   フォルダーの一覧表示/データの読み取り *(高度なアクセス許可)* <p>フォルダーの作成/データの追加 *(高度なアクセス許可)* <p>属性の読み取り *(高度なアクセス許可)* <p>拡張属性の読み取り *(高度なアクセス許可)* <p>アクセス許可の読み取り *(高度なアクセス許可)*      |  このフォルダーのみ       |
| その他のグループおよびアカウント     |  なし (削除)       |         |

## <a name="step-3-create-a-gpo-for-folder-redirection"></a>手順 3:フォルダー リダイレクトの GPO を作成する

フォルダー リダイレクト設定の GPO をまだ作成していない場合は、次の手順に従って作成します。

フォルダー リダイレクトの GPO を作成する手順は次のとおりです。

1. グループ ポリシー管理がインストールされたコンピューターでサーバー マネージャーを開きます。
2. **[ツール]** メニューの **[グループ ポリシー管理]** を選択します。
3. フォルダー リダイレクトを設定するドメインまたは OU を右クリックし、 **[このドメインに GPO を作成し、このコンテナーにリンクする]** を選択します。
4. **[新しい GPO]** ダイアログ ボックスで、GPO の名前 (例: **Folder Redirection Settings**) を入力し、 **[OK]** を選択します。
5. 新しく作成した GPO を右クリックし、 **[リンクの有効化]** チェックボックスをオフにします。 これにより、GPO の構成が完了するまで、それが適用されるのを防ぎます。
6. GPO を選択します。 **[スコープ]** タブの **[セキュリティ フィルター]** セクションで、 **[Authenticated Users]** を選択した後に **[削除]** を選択して、GPO がすべてのユーザーに適用されないようにします。
7. **[セキュリティ フィルター処理]** セクションで **[追加]** を選択します。
8. **[ユーザー、コンピューター、またはグループの選択]** ダイアログ ボックスで、手順 1 で作成したセキュリティ グループの名前 (例: **Folder Redirection Users**) を入力して、 **[OK]** を選択します。
9. **[委任]** タブを選択して **[追加]** を選択し、「**Authenticated Users**」と入力して **[OK]** を選択します。もう一度 **[OK]** を選択して、既定の読み取りアクセス許可を受け入れます。

    この手順が必要なのは、[MS16-072](https://support.microsoft.com/help/3163622/ms16-072-security-update-for-group-policy-june-14-2016) でセキュリティが変更されたためです。

> [!IMPORTANT]
> [MS16-072](https://support.microsoft.com/help/3163622/ms16-072-security-update-for-group-policy-june-14-2016) で行われたセキュリティの変更により、フォルダー リダイレクト GPO への委任された読み取りアクセス許可を Authenticated Users グループに付与することが必要になりました。これを行わないと、GPO がユーザーに適用されません。または、GPO が既に適用されている場合はそれが削除され、フォルダーがローカル PC にリダイレクトされます。 詳細については、「[グループ ポリシーのセキュリティの更新 MS16-072 の展開](https://techcommunity.microsoft.com/t5/ask-the-directory-services-team/deploying-group-policy-security-update-ms16-072-kb3163622/ba-p/400434)」を参照してください。

## <a name="step-4-configure-folder-redirection-with-offline-files"></a>手順 4:フォルダー リダイレクトとオフライン ファイルを構成する

フォルダー リダイレクト設定の GPO を作成した後、次の手順で説明するように、グループ ポリシー設定を編集し、フォルダー リダイレクトを有効にして構成します。

> [!NOTE]
> ユーザーが変更しない限り、オフライン ファイルは Windows クライアント コンピューター上のリダイレクトされたフォルダーに対しては既定で有効になり、Windows Server を実行しているコンピューターでは無効になります。 グループ ポリシーを使用してオフライン ファイルを有効にするかどうかを制御するには、 **[オフライン ファイルの機能の使用を許可または禁止する]** ポリシー設定を使用します。
> その他のオフライン ファイル グループ ポリシー設定の詳細については、「[オフライン ファイルの高度な機能を有効にする](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn270369(v%3dws.11)>)」および「[オフライン ファイルのグループ ポリシーの構成](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc759721(v%3dws.10)>)」を参照してください。

グループ ポリシーでフォルダー リダイレクトを構成する手順は次のとおりです。

1. グループ ポリシーの管理で、作成した GPO (例: **Folder Redirection Settings**) を右クリックし、 **[編集]** を選択します。
2. [グループ ポリシー管理エディター] ウィンドウで、 **[ユーザーの構成]** 、 **[ポリシー]** 、 **[Windows の設定]** 、 **[フォルダー リダイレクト]** に移動します。
3. リダイレクトするフォルダー (例: **ドキュメント**) を右クリックし、 **[プロパティ]** を選択します。
4. **[プロパティ]** ダイアログ ボックスの **[設定]** ボックスで、 **[基本 - 全員のフォルダーを同じ場所にリダイレクトする]** を選択します。

    > [!NOTE]
    > Windows XP または Windows Server 2003 を実行しているクライアント コンピューターにフォルダー リダイレクトを適用するには、 **[設定]** タブを選択し、 **[Windows 2000、Windows 2000 Server、Windows XP、および Windows Server 2003 オペレーティング システムへのリダイレクト ポリシーも適用]** チェックボックスを オンにします。

5. **[対象のフォルダーの場所]** セクションで、 **[ルート パスの下に各ユーザーのフォルダーを作成する]** を選択し、 **[ルート パス]** ボックスに、リダイレクトされたフォルダーを格納するファイル共有へのパスを入力します (例: **\\\\fs1.corp.contoso.com\\users$** )。
6. **[設定]** タブを選択し、 **[ポリシーの削除]** セクションで、必要に応じて **[ポリシーが削除されたとき、フォルダーをローカルのユーザー プロファイルにリダイレクトする]** を選択します (この設定により、管理者とユーザーはフォルダー リダイレクトの動作を予測しやすくなります)。
7. **[OK]** を選択し、警告ダイアログ ボックスで **[はい]** を選択します。

## <a name="step-5-enable-the-folder-redirection-gpo"></a>手順 5:フォルダー リダイレクトの GPO を有効にする

フォルダー リダイレクトのグループ ポリシー設定の構成が完了したら、次の手順として、GPO を有効にし、それを影響を受けるユーザーに適用できるようにします。

> [!TIP]
> プライマリ コンピューターのサポートまたはその他のポリシー設定を実装する予定がある場合は、GPO を有効にする前に、ここでそれらを実行してください。 これにより、プライマリ コンピューターのサポートが有効にされる前に、ユーザー データがプライマリでないコンピューターにコピーされることを防ぎます。

フォルダー リダイレクトの GPO を有効にする手順は次のとおりです。

1. グループ ポリシーの管理を開きます。
2. 作成した GPO を右クリックし、 **[リンクの有効化]** を選択します。 このメニュー項目の横にチェック ボックスが表示されます。

## <a name="step-6-test-folder-redirection"></a>手順 6:フォルダー リダイレクトをテストする

フォルダー リダイレクトをテストするには、フォルダー リダイレクト用に構成されたユーザー アカウントを使用してコンピューターにサインインします。 次に、フォルダーとプロファイルがリダイレクトされることを確認します。

フォルダー リダイレクトをテストする手順は次のとおりです。

1. フォルダー リダイレクトを有効にしているユーザー アカウントでプライマリ コンピューターにサインインします (プライマリ コンピューターのサポートを有効にしている場合)。
2. ユーザーが以前にコンピューターにサインインしている場合、管理者特権でコマンド プロンプトを開き、次のコマンドを入力して、クライアント コンピューターに最新のグループ ポリシー設定が適用されるようにします。

    ```PowerShell
    gpupdate /force
    ```
3. エクスプローラーを開きます。
4. リダイレクトされたフォルダー (ドキュメント ライブラリの [マイ ドキュメント] フォルダーなど) を右クリックし、 **[プロパティ]** を選択します。
5. **[場所]** タブを選択し、パスにローカル パスではなく、自分が指定したファイル共有が表示されていることを確認します。

## <a name="appendix-a-checklist-for-deploying-folder-redirection"></a>付録 A:フォルダー リダイレクトを展開するためのチェックリスト

| 状態           | 操作 |
| ---              | ---    |
| ☐<br>☐<br>☐    | 1.ドメインを準備する<br>- コンピューターをドメインに参加させる<br>- ユーザー アカウントを作成する |
| ☐<br><br><br>   | 2.フォルダー リダイレクト用のセキュリティ グループを作成する<br>- グループ名:<br>- メンバー: |
| ☐<br><br>       | 3.リダイレクトされたフォルダーのファイル共有を作成する<br>- ファイル共有名: |
| ☐<br><br>       | 4.フォルダー リダイレクトの GPO を作成する<br>- GPO 名: |
| ☐<br><br>☐<br>☐<br>☐<br>☐<br>☐ | 5.フォルダー リダイレクトとオフライン ファイルのポリシー設定を構成する<br>- リダイレクトされたフォルダー:<br>- Windows 2000、Windows XP、および Windows Server 2003 のサポートは有効になっていますか?<br>- オフライン ファイルは有効になっていますか? (Windows クライアント コンピューターでは既定で有効になっています)<br>- 常時オフライン モードは有効になっていますか?<br>- バックグラウンドのファイル同期は有効になっていますか?<br>- リダイレクトされたフォルダーの移動の最適化は有効になっていますか? |
| ☐<br><br>☐<br><br>☐<br>☐ | 6.(オプション) プライマリ コンピューターのサポートを有効にする<br>- コンピューター ベースかユーザー ベースか<br>- ユーザーのプライマリ コンピューターを指定する<br>- ユーザーとプライマリ コンピューターの場所のマッピング:<br>- (オプション) フォルダー リダイレクトに対してプライマリ コンピューターのサポートを有効にする<br>- (オプション) 移動ユーザー プロファイルに対してプライマリ コンピューターのサポートを有効にする |
| ☐         | 7.フォルダー リダイレクトの GPO を有効にする |
| ☐         | 8.フォルダー リダイレクトをテストする |

## <a name="change-history"></a>変更履歴

次の表に、このトピックの最も重要な変更をいくつかまとめています。

| 日付 | 説明 | 原因|
| --- | --- | --- |
| 2017 年 1 月 18 日 | 「[手順 3:フォルダー リダイレクトの GPO を作成する](#step-3-create-a-gpo-for-folder-redirection)」に、Authenticated Users に読み取りアクセス許可を委任する手順を追加しました。これは、グループ ポリシーのセキュリティが更新されたために必要になりました。 | カスタマー フィードバック |

## <a name="more-information"></a>説明を見る

* [フォルダー リダイレクト、オフライン ファイル、移動ユーザー プロファイル](folder-redirection-rup-overview.md)
* [フォルダー リダイレクトと移動ユーザー プロファイル用のプライマリ コンピューターを展開する](deploy-primary-computers.md)
* [オフライン ファイルの高度な機能を有効にする](enable-always-offline.md)
* [レプリケートされたユーザー プロファイル データに関する Microsoft のサポート表明](https://docs.microsoft.com/archive/blogs/askds/microsofts-support-statement-around-replicated-user-profile-data)
* [DISM を使用したアプリのサイドローディング](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-8.1-and-8/hh852635(v=win.10)>)
* [Windows ランタイムベース アプリのパッケージ化、展開、クエリのトラブルシューティング](https://docs.microsoft.com/windows/win32/appxpkg/troubleshooting)
