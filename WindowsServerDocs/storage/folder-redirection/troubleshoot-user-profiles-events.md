---
title: イベントを使用したユーザー プロファイルのトラブルシューティング
description: イベントとトレース ログを使用してユーザー プロファイルのロードとアンロードに関する問題をトラブルシューティングする方法。
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.date: 04/05/2018
ms.localizationpriority: medium
ms.openlocfilehash: e6417fc6453499387fbf721ef31121e07eccdfdd
ms.sourcegitcommit: dfa48f77b751dbc34409aced628eb2f17c912f08
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/07/2020
ms.locfileid: "87957630"
---
# <a name="troubleshoot-user-profiles-with-events"></a>イベントを使用したユーザー プロファイルのトラブルシューティング

>適用先:Windows 10、Windows 8、Windows 8.1、Windows Server 2019、Windows Server 2016、Windows Server 2012 R2、Windows Server 2012、Windows Server (半期チャネル)。

このトピックでは、イベントとトレース ログを使用して、ユーザー プロファイルのロードとアンロードに関する問題をトラブルシューティングする方法について説明します。 以降のセクションでは、ユーザー プロファイル情報を記録する 3 つのイベント ログの使用方法について説明します。

## <a name="step-1-checking-events-in-the-application-log"></a>手順 1:アプリケーション ログのイベントの確認

ユーザー プロファイル (移動ユーザー プロファイルを含む) のロードとアンロードに関する問題のトラブルシューティングの最初の手順は、イベント ビューアーを使用して、ユーザー プロファイル サービスがアプリケーション ログに記録する警告イベントとエラー イベントを確認することです。

アプリケーション ログ内のユーザー プロファイル サービス イベントを表示する方法を次に示します。

1. イベント ビューアーを開始します。 これを行うには、 **[コントロール パネル]** を開き、 **[システムとセキュリティ]** を選択し、次に、 **[管理ツール]** セクションで **[イベント ログの表示]** を選択します。 [イベント ビューアー] ウィンドウが開きます。
2. コンソール ツリーで、まず **[Windows ログ]** に移動し、次に **[Application]** をクリックします。
3. [操作] ペインで **[現在のログをフィルター]** をクリックします。 [現在のログをフィルター] ダイアログ ボックスが表示されます。
4. **[イベント ソース]** ボックスで、 **[User Profiles Service]** チェックボックスをオンにし、 **[OK]** を選択します。
5. イベントの一覧を確認します。エラー イベントに特に注意してください。
6. 注目すべきイベントが見つかったら、[イベント ログ オンライン ヘルプ] リンクを選択して、追加情報とトラブルシューティング手順を表示します。
7. さらにトラブルシューティングを行うには、注目すべきイベントの日付と時刻を確認し、(手順 2. で説明されているように) 操作ログを確認して、エラー イベントまたは警告イベントの時刻の前後にユーザー プロファイル サービスが何を行っていたかについて、詳細を表示します。

>[!NOTE]
>ユーザー プロファイル サービスのイベント 1530「レジストリ ファイルは他のアプリケーションまたはサービスで使用されています。」は無視しても問題ありません。

## <a name="step-2-view-the-operational-log-for-the-user-profile-service"></a>手順 2:ユーザー プロファイル サービスの操作ログを表示する

アプリケーション ログのみを使用して問題を解決できない場合は、次の手順に従って、操作ログのユーザー プロファイル サービス イベントを表示します。 このログは、サービスの一部の内部動作を示しており、プロファイルのロードまたはアンロード プロセスで問題が発生している箇所を特定するのに役立てることができます。

Windows アプリケーション ログとユーザー プロファイル サービスの操作ログは、Windows のすべてのインストールで両方とも既定で有効になっています。

ユーザー プロファイル サービスの操作ログを表示する方法を次に示します。

1. イベント ビューアーのコンソール ツリーで、 **[アプリケーションとサービス ログ]** に移動し、 **[Microsoft]** 、 **[Windows]** 、 **[User Profile Service]** 、 **[Operational]** の順に選択します。
2. アプリケーション ログに記録されたエラー イベントまたは警告イベントの時刻の前後に発生したイベントを確認します。

## <a name="step-3-enable-and-view-analytic-and-debug-logs"></a>手順 3:分析ログとデバッグ ログを有効にして表示する

操作ログに示されているよりも詳細な情報が必要な場合は、影響を受けるコンピューターで分析ログとデバッグ ログを有効にすることができます。 このレベルのログ記録は非常に詳細であるため、問題のトラブルシューティングを行う場合を除き、無効にする必要があります。

分析ログとデバッグ ログを有効にして表示する方法を次に示します。

1. イベント ビューアーの **[操作]** ペインで、 **[表示]** を選択し、 **[分析およびデバッグ ログの表示]** を選択します。
2. **[アプリケーションとサービス ログ]** に移動し、 **[Microsoft]** 、 **[Windows]** 、 **[User Profile Service]** 、 **[Diagnostic]** の順に選択します。
3. **[ログの有効化]** を選択し、 **[OK]** を選択します。 これにより診断ログが有効になり、ログ記録が開始されます。
4. さらに詳しい情報が必要な場合は、「[手順 4:トレースを作成およびデコードする](#step-4-creating-and-decoding-a-trace)」 を参照して、トレース ログを作成する方法について調べてください。
5. 問題のトラブルシューティングが完了したら、 **[Diagnostic]** ログに移動して **[ログの無効化]** を選択し、 **[表示]** を選択して **[分析およびデバッグ ログの表示]** チェック ボックスをオフにし、分析およびデバッグ ログを非表示にします。

## <a name="step-4-creating-and-decoding-a-trace"></a>手順 4:トレースを作成およびデコードする

イベントを使用して問題を解決できない場合は、問題の再現中にトレース ログ (ETL ファイル) を作成し、Microsoft シンボル サーバーからパブリック シンボルを使用してデコードできます。 トレース ログは、ユーザー プロファイル サービスが実行している内容に関する非常に具体的な情報を提供し、エラーが発生した場所を特定するのに役立てることができます。

ETL トレースを使用する場合の最善の方法は、まずできるだけ小さいログを取得することです。 ログがデコードされたら、ログからエラーを検索します。

ここでは、ユーザー プロファイル サービスのトレースを作成してデコードする方法について説明します。

1. ローカル Administrators グループのメンバーであるアカウントを使用して、問題が発生しているコンピューターにサインオンします。
2. 管理者特権でのコマンド プロンプトで、次のコマンドを入力します。ここで、 *\<Path\>* は前に作成したローカル フォルダーへのパス (例: C:\\logs) です。

    ```PowerShell
    logman create trace -n RUP -o <Path>\RUP.etl -ets
    logman update RUP -p {eb7428f5-ab1f-4322-a4cc-1f1a9b2c5e98} 0x7FFFFFFF 0x7 -ets
    ```
3. スタート画面で、ユーザー名を選択し、 **[アカウントの切り替え]** を選択します。管理者からログオフしないように注意してください。 リモート デスクトップを使用している場合は、管理者セッションを閉じて、ユーザー セッションを確立します。
4. 問題を再現します。 問題を再現する手順は、通常、問題が発生しているユーザーとしてサインオンするか、そのユーザーをサインオフするか、またはその両方を行うことです。
5. 問題を再現した後、ローカル管理者としてもう一度サインオンします。
6. 管理者特権のコマンド プロンプトで、次のコマンドを実行して、ログを ETL ファイルに保存します。

    ```PowerShell
    logman stop -n RUP -ets
    ```
7. 次のコマンドを入力して、現在のディレクトリ (ホーム フォルダーまたは %WINDIR%\\System32 フォルダー) 内のユーザーが判読できるファイルに ETL ファイルをエクスポートします。

    ```PowerShell
    Tracerpt <path>\RUP.etl
    ```
8. **Summary.txt** ファイルおよび **Dumpfile.xml** ファイルを開きます (Microsoft Excel でこれらを開くと、ログ全体が見やすくなります)。 **fail** または **failed** を含むイベントを探します。イベント名が **Unknown** の行は無視してかまいません。

## <a name="more-information"></a>説明を見る

* [移動ユーザー プロファイルを展開する](deploy-roaming-user-profiles.md)