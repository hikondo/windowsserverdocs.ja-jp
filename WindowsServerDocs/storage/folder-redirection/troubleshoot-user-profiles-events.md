---
title: イベントを使用したユーザープロファイルのトラブルシューティング
description: イベントとトレースログを使用してユーザープロファイルの読み込みとアンロードに関する問題をトラブルシューティングする方法。
ms.prod: windows-server
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage
ms.date: 04/05/2018
ms.localizationpriority: medium
ms.openlocfilehash: 9e927a77627e786015a928d798aafee13a2cc34b
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/27/2019
ms.locfileid: "71394381"
---
# <a name="troubleshoot-user-profiles-with-events"></a>イベントを使用したユーザープロファイルのトラブルシューティング

>適用対象: Windows 10、windows 8、Windows 8.1、Windows Server 2019、Windows Server 2016、Windows Server 2012 R2、Windows Server 2012、および Windows Server (半期チャネル)。

このトピックでは、イベントとトレースログを使用して、ユーザープロファイルの読み込みとアンロードに関する問題をトラブルシューティングする方法について説明します。 次のセクションでは、ユーザープロファイル情報を記録する3つのイベントログの使用方法について説明します。

## <a name="step-1-checking-events-in-the-application-log"></a>手順 1: アプリケーションログのイベントを確認する

ユーザープロファイルの読み込みとアンロードに関する問題のトラブルシューティングの最初の手順 (移動ユーザープロファイルを含む) は、イベントビューアーを使用して、ユーザープロファイルサービスがアプリケーションログに記録する警告イベントとエラーイベントを確認することです。

次に、ユーザープロファイルサービスのイベントをアプリケーションログに表示する方法を示します。

1. イベントビューアーを開始します。 これを行うには、開く**コントロール パネルの**を選択します**システムとセキュリティ**、、**管理ツール**セクションで、 **のイベントログを表示**. [イベントビューアー] ウィンドウが開きます。
2. コンソールツリーで、最初に **[Windows ログ]** 、 **[アプリケーション]** の順に移動します。
3. 操作 ウィンドウで、**現在のログをフィルター** を選択します。 [現在のログをフィルター] ダイアログボックスが表示されます。
4. **[イベントソース]** ボックスで、 **[ユーザープロファイルサービス]** チェックボックスをオンにし、[ **OK]** を選択します。
5. イベントの一覧を確認します。エラーイベントに特に注意してください。
6. 注目すべきイベントが見つかったら、[イベントログのオンラインヘルプ] リンクを選択して、追加情報とトラブルシューティング手順を表示します。
7. さらにトラブルシューティングを行うには、注目すべきイベントの日付と時刻を確認し、(手順 2. で説明されているように) 操作ログを確認して、ユーザープロファイルサービスがエラーイベントまたは警告イベントの時刻に何を行っていたかの詳細を表示します。

>[!NOTE]
>ユーザープロファイルサービスのイベント1530は無視しても問題ありません。 "Windows によって、レジストリファイルが他のアプリケーションまたはサービスによって使用されていることが検出されました。"

## <a name="step-2-view-the-operational-log-for-the-user-profile-service"></a>手順 2: ユーザープロファイルサービスの操作ログを表示する

アプリケーションログのみを使用して問題を解決できない場合は、次の手順に従って、操作ログのユーザープロファイルサービスイベントを表示します。 このログは、サービスの内部的な動作をいくつか示しており、プロファイルの読み込みまたはアンロードプロセスで問題が発生している場所を特定するのに役立ちます。

Windows のすべてのインストールで、Windows アプリケーションログとユーザープロファイルサービスの操作ログの両方が既定で有効になっています。

ユーザープロファイルサービスの操作ログを表示する方法を次に示します。

1. イベントビューアーコンソールツリーで、 **[アプリケーションとサービスログ]** 、 **[Microsoft]** 、 **[Windows]** 、 **[ユーザープロファイルサービス]** の順に移動し、 **[操作]** をクリックします。
2. アプリケーションログに記録されたエラーイベントまたは警告イベントの時刻の前後に発生したイベントを確認します。

## <a name="step-3-enable-and-view-analytic-and-debug-logs"></a>手順 3: 分析ログとデバッグログを有効にして表示する

操作ログに示されるよりも詳細な情報が必要な場合は、影響を受けるコンピューターで分析ログとデバッグログを有効にすることができます。 このレベルのログ記録ははるかに詳細であり、問題のトラブルシューティングを行う場合を除いて無効にする必要があります。

分析ログとデバッグログを有効にして表示する方法を次に示します。

1. イベントビューアーの **[操作]** ウィンドウで **[表示]** を選択し、 **[分析およびデバッグログの表示]** を選択します。
2. **[アプリケーションとサービスログ]** 、 **[Microsoft]** 、 **[Windows**]、 **[ユーザープロファイルサービス]** の順に移動し、 **[診断]** をクリックします。
3. **[ログの有効化]** を選択し、[**はい]** を選択します。 これにより、ログ記録が開始される診断ログが有効になります。
4. さらに詳しい情報が必要な場合は、「[手順 4: トレースの作成とデコード](#step-4-creating-and-decoding-a-trace)」を参照して、トレースログを作成する方法の詳細を確認してください。
5. 問題のトラブルシューティングが完了したら、**診断**ログに移動し、 **[ログを無効]** にする を選択します。次に、 **[表示]** を選択し、 **[分析およびデバッグログの表示]** チェックボックスをオフにして、分析ログとデバッグログを非表示にします。

## <a name="step-4-creating-and-decoding-a-trace"></a>手順 4: トレースの作成とデコード

イベントを使用して問題を解決できない場合は、問題の再現中にトレースログ (ETL ファイル) を作成し、Microsoft シンボルサーバーからパブリックシンボルを使用してデコードできます。 トレースログは、ユーザープロファイルサービスが実行している内容に関する非常に具体的な情報を提供し、エラーが発生した場所を特定するのに役立ちます。

ETL トレースを使用する場合の最適な方法は、まず、可能な限り最小のログを取得することです。 ログがデコードされたら、ログでエラーを検索します。

ここでは、ユーザープロファイルサービスのトレースを作成およびデコードする方法について説明します。

1. ローカルの Administrators グループのメンバーであるアカウントを使用して、ユーザーに問題が発生しているコンピューターにサインオンします。
2. 管理者特権でのコマンドプロンプトから次のコマンドを入力します。ここで *\<Path\>* は、前に作成したローカルフォルダーのパスです (例: C:\\logs)。
        
    ```PowerShell
    logman create trace -n RUP -o <Path>\RUP.etl -ets
    logman update RUP -p {eb7428f5-ab1f-4322-a4cc-1f1a9b2c5e98} 0x7FFFFFFF 0x7 -ets
    ```
3. スタート画面でユーザー名を選択し、 **[アカウントの切り替え]** を選択します。管理者がログオフしないように注意してください。 リモートデスクトップを使用している場合は、管理者セッションを閉じて、ユーザーセッションを確立します。
4. 問題を再現します。 問題を再現する手順は、通常、問題が発生しているユーザーとしてサインオンするか、ユーザーにサインオンするか、またはその両方を行うことです。
5. 問題を再現した後、ローカル管理者としてもう一度サインオンします。
6. 管理者特権でのコマンドプロンプトから次のコマンドを実行して、ログを ETL ファイルに保存します。
  
    ```PowerShell
    logman stop -n RUP -ets
    ```
7. 次のコマンドを入力して、現在のディレクトリ (ホームフォルダーまたは% WINDIR%\\System32 フォルダー) 内のユーザーが判読できるファイルに ETL ファイルをエクスポートします。
    
    ```PowerShell
    Tracerpt <path>\RUP.etl
    ```
8. **Summary.txt**ファイルと**ダンプファイル**ファイルを開きます (Microsoft Excel で開いて、ログの完全な詳細を簡単に表示できます)。 **Fail**または failed を含むイベントを検索**し**ます。**不明な**イベント名を含む行は無視してかまいません。

## <a name="more-information"></a>詳細情報

* [移動ユーザー プロファイルを展開する](deploy-roaming-user-profiles.md)