---
title: Minroot
description: ホスト CPU リソース制御の構成
keywords: Windows 10, Hyper-V
author: allenma
ms.date: 12/15/2017
ms.topic: article
ms.prod: windows-10-hyperv
ms.service: windows-10-hyperv
ms.assetid: ''
ms.openlocfilehash: 92de899a39aed05e2f598fcb3aae3fbae3f1cb67
ms.sourcegitcommit: f6490192d686f0a1e0c2ebe471f98e30105c0844
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/10/2019
ms.locfileid: "70872037"
---
# <a name="hyper-v-host-cpu-resource-management"></a>Hyper-v ホスト CPU リソース管理

Windows Server 2016 以降で導入された hyper-v ホスト CPU リソース制御により、Hyper-v 管理者は、"ルート"、"管理パーティション"、および "ゲスト Vm" の間で、ホストサーバーの CPU リソースの管理と割り当てをより適切に行うことができます。 管理者は、これらのコントロールを使用して、ホストシステムのプロセッサのサブセットをルートパーティションに専用にすることができます。 これにより、ゲスト仮想マシンで実行されているワークロードを、システムプロセッサの別々のサブセットで実行することにより、Hyper-v ホストで実行された作業を分離できます。

Hyper-v ホストのハードウェアの詳細については、「 [Windows 10 hyper-v のシステム要件](https://docs.microsoft.com/virtualization/hyper-v-on-windows/reference/hyper-v-requirements)」を参照してください。

## <a name="background"></a>背景情報

Hyper-v ホストの CPU リソースの制御を設定する前に、Hyper-v アーキテクチャの基本を確認すると便利です。  
一般的な概要については、「 [Hyper-v アーキテクチャ](https://docs.microsoft.com/windows-server/administration/performance-tuning/role/hyper-v-server/architecture)」セクションを参照してください。
この記事の重要な概念は次のとおりです。

* Hyper-v は、ハイパーバイザーの制御下で、コンピューティングリソースが割り当てられ共有される仮想マシンパーティションを作成して管理します。  パーティションは、すべてのゲスト仮想マシン間、およびゲスト Vm とルートパーティションの間に強力な分離境界を提供します。

* ルートパーティション自体は仮想マシンパーティションですが、一意のプロパティと、ゲスト仮想マシンよりもはるかに高い特権があります。  ルートパーティションは、すべてのゲスト仮想マシンを制御し、ゲストの仮想デバイスのサポートを提供し、ゲスト仮想マシンのすべてのデバイス i/o を管理する管理サービスを提供します。  ホストパーティションでは、アプリケーションのワークロードを実行しないことを強くお勧めします。

* ルートパーティションの各仮想プロセッサ (VP) は、1:1 を基になる論理プロセッサ (LP) にマップされます。  ホスト VP は常に同じ基になる LP で実行されます。ルートパーティションの VPs は移行されません。  

* 既定では、ホスト VPs を実行する LPs でも、ゲスト VPs を実行できます。

* ゲスト副社長は、使用可能な任意の論理プロセッサ上で実行するようにハイパーバイザーによってスケジュールされる場合があります。  ハイパーバイザースケジューラは、テンポラルキャッシュの局所性、NUMA トポロジ、およびゲスト VP をスケジュールする際のその他の多くの要因を考慮する必要がありますが、最終的には、どのホスト LP でも VP をスケジュールすることができます。

## <a name="the-minimum-root-or-minroot-configuration"></a>最小ルートまたは "Minroot" 構成

Hyper-v の初期バージョンには、パーティションごとに 64 VPs のアーキテクチャの上限がありました。  これは、ルートパーティションとゲストパーティションの両方に適用されます。  64を超える論理プロセッサを搭載したシステムがハイエンドサーバーに登場したため、Hyper-v は、最大 320 LPs を備えたホストをサポートする1つのポイントで、これらの大規模なシステムをサポートするために、ホストのスケール制限も進化しました。  ただし、その時点でパーティション数の 64 VP を破ると、いくつかの課題が生じ、パーティションごとに 64 VPs を超えることをサポートするという複雑な問題が発生しました。  これに対処するために、Hyper-v では、ルートパーティションに与えられた VPs の数が、基になるコンピューターに多数の論理プロセッサがある場合でも、64に制限されています。  ハイパーバイザーは、ゲスト VPs を実行するために使用可能なすべての LPs を引き続き使用しますが、ルートパーティションは64に人為的に制限されています。  この構成は、"最小ルート" または "minroot" 構成と呼ばれていました。  パフォーマンステストでは、64 LPs を超える大規模なシステムであっても、多数のゲスト Vm とゲスト VPs に十分なサポートを提供するために、ルートが64ルート VPs を超える必要がないことが確認されました。実際には、64ルート VPs よりもはるかに少ない場合が多い(ゲスト Vm の数とサイズ、実行されている特定のワークロードなど) によって異なります。

現在、この "minroot" の概念は引き続き使用されています。  実際、Windows Server 2016 Hyper-v がホスト LPs から 512 LPs に対する最大のアーキテクチャサポート上限を引き上げた場合でも、ルートパーティションは最大320の LPs に制限されます。

## <a name="using-minroot-to-constrain-and-isolate-host-compute-resources"></a>Minroot を使用したホストコンピューティングリソースの制限と分離
Windows Server 2016 Hyper-v では、既定のしきい値である 320 LPs が使用されていますが、minroot 構成は非常に大規模なサーバーシステムでのみ使用されます。  ただし、この機能は Hyper-v ホスト管理者がはるかに低いしきい値に構成できます。これにより、ルートパーティションで使用できるホスト CPU リソースの量が大幅に制限されます。  使用するルート LPs の特定の数は、ホストに割り当てられている Vm とワークロードの最大要求をサポートするために、慎重に選択する必要があります。  ただし、ホスト側の LPs の数に適切な値を決定するには、実稼働ワークロードを慎重に評価して監視し、広範な展開の前に非運用環境で検証します。

## <a name="enabling-and-configuring-minroot"></a>Minroot の有効化と構成

Minroot 構成は、ハイパーバイザー BCD エントリを介して制御されます。 Minroot を有効にするには、コマンドプロンプトで管理者特権を使用します。

```
    bcdedit /set hypervisorrootproc n
```
ここで、n はルート VPs の数です。 

システムを再起動する必要があります。また、OS ブートの有効期間中、新しいルートプロセッサの数が保持されます。  Minroot 構成は、実行時に動的に変更することはできません。

複数の NUMA ノードがある場合、各ノードは`n/NumaNodeCount`プロセッサを取得します。

複数の NUMA ノードがある場合は、VM のトポロジが、対応する VM の NUMA ノード VPs を実行するために各 NUMA ノードに十分な空き LPs (つまり、ルート VPs のない LPs) があることを確認する必要があります。

## <a name="verifying-the-minroot-configuration"></a>Minroot 構成を検証しています

次に示すように、タスクマネージャーを使用してホストの minroot 構成を確認できます。

![](./media/minroot-taskman.png)

Minroot がアクティブになると、タスクマネージャーには、システム内の論理プロセッサの合計数に加えて、ホストに現在割り当てられている論理プロセッサの数が表示されます。
 
