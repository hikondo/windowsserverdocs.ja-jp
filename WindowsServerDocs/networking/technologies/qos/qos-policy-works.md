---
title: QoS ポリシーのしくみ
description: このトピックでは、サービスの品質 (QoS) ポリシーの概要について説明します。これにより、グループポリシーを使用して、Windows Server 2016 の特定のアプリケーションとサービスのネットワークトラフィック帯域幅に優先順位を付けることができます。
ms.prod: windows-server
ms.technology: networking
ms.topic: article
ms.assetid: 25097cb8-b9b1-41c9-b3c7-3610a032e0d8
manager: brianlic
ms.author: lizross
author: eross-msft
ms.openlocfilehash: 65d2635744e7d49e45d8f878be9a5e734dea9e6d
ms.sourcegitcommit: da7b9bce1eba369bcd156639276f6899714e279f
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/26/2020
ms.locfileid: "80315403"
---
# <a name="how-qos-policy-works"></a>QoS ポリシーのしくみ

>適用対象: Windows Server (半期チャネル)、Windows Server 2016

QoS 用に更新されたユーザーまたはコンピューターの構成グループポリシー設定を取得または取得するときに、次の処理が行われます。

1. グループポリシーエンジンは Active Directory からユーザーまたはコンピューターの構成グループポリシーの設定を取得します。

2. グループポリシーエンジンは、qos ポリシーが変更されたことを QoS クライアント側拡張に通知します。

3. Qos クライアント側拡張機能は、qos 検査モジュールに QoS ポリシーイベント通知を送信します。

4. QoS 検査モジュールは、ユーザーまたはコンピュータの QoS ポリシーを取得し、それらを格納します。

TCP 接続または UDP トラフィック\) \(新しいトランスポート層エンドポイントが作成されると、次の処理が行われます。

1. TCP/IP スタックのトランスポート層コンポーネントは、QoS 検査モジュールに通知します。

2. QoS 検査モジュールは、トランスポート層のエンドポイントのパラメーターを、保存されている QoS ポリシーと比較します。

3. 一致するものが見つかった場合、QoS 検査モジュールは、帯域幅を指定して、DSCP 値を含むデータ構造と、一致する QoS ポリシーのトラフィック調整設定を作成します。 トランスポート層のエンドポイントのパラメーターと一致する QoS ポリシーが複数ある場合は、最も具体的な QoS ポリシーが使用されます。

4. ペーサーはフローを格納し、フローに対応するフロー番号を QoS 検査モジュールに返します。

5. QoS 検査モジュールは、トランスポート層にフロー番号を返します。

6. トランスポート層では、トランスポート層のエンドポイントにフロー番号が格納されます。

フロー番号でマークされたトランスポート層エンドポイントに対応するパケットが送信されると、次の処理が行われます。

1. トランスポート層は、内部的にフロー番号を使用してパケットをマークします。

2. ネットワーク層は、パケットのフロー番号に対応する DSCP 値に対して、ペーサーのクエリを行います。

3. を指定すると、DSCP 値がネットワーク層に返されます。

4. ネットワーク層は、IPv4 TOS フィールドまたは IPv6 トラフィッククラスのフィールドを、ペーサーによって指定された DSCP 値に変更します。 IPv4 パケットの場合は、最終的な IPv4 ヘッダーのチェックサムを計算します。

5. ネットワークレイヤーによって、パケットがフレームレイヤーに渡されます。

6. パケットはフロー番号でマークされているため、フレームレイヤーは NDIS 6.x を介してパケットをペーサーに渡します。

7. ペーサーはパケットのフロー番号を使用してパケットを調整する必要があるかどうかを判断し、その場合はパケットが送信されるようにスケジュールします。

8. 帯域\) 幅の調整が行われていない場合、または \(スケジュールに従ってトラフィックの調整が行われている場合は、適切なネットワークアダプターを経由した送信のためにトラフィックの\) 調整が行われている場合は、そのパケットを直ちに \(します。

これらのポリシーベースの QoS プロセスには、次のような利点があります。

- QoS ポリシーが適用されるかどうかを判断するためのトラフィックの検査は、パケット単位ではなく、トランスポート層のエンドポイントごとに実行されます。

- QoS ポリシーに一致しないトラフィックは、パフォーマンスに影響しません。

- アプリケーションを変更して、DSCP ベースの差別化されたサービスまたはトラフィックの調整を利用する必要はありません。

- QoS ポリシーは、IPsec で保護されたトラフィックに適用できます。

このガイドの次のトピックについては、「 [QoS ポリシーのアーキテクチャ](qos-policy-architecture.md)」を参照してください。

このガイドの最初のトピックについては、「[サービスの品質 (QoS) ポリシー](qos-policy-top.md)」を参照してください。
