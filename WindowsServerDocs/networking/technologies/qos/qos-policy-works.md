---
title: QoS ポリシーのしくみ
description: このトピックでは、サービスの品質 (QoS) ポリシーの概要について説明します。これにより、グループポリシーを使用して、Windows Server 2016 の特定のアプリケーションとサービスのネットワークトラフィック帯域幅に優先順位を付けることができます。
ms.topic: article
ms.assetid: 25097cb8-b9b1-41c9-b3c7-3610a032e0d8
manager: brianlic
ms.author: lizross
author: eross-msft
ms.openlocfilehash: fe91bba99000be307ed011cb5636dc49d65c389a
ms.sourcegitcommit: dfa48f77b751dbc34409aced628eb2f17c912f08
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/07/2020
ms.locfileid: "87942532"
---
# <a name="how-qos-policy-works"></a>QoS ポリシーのしくみ

>適用先:Windows Server (半期チャネル)、Windows Server 2016

QoS 用に更新されたユーザーまたはコンピューターの構成グループポリシー設定を取得または取得するときに、次の処理が行われます。

1. グループポリシーエンジンは Active Directory からユーザーまたはコンピューターの構成グループポリシーの設定を取得します。

2. グループポリシーエンジンは、qos ポリシーが変更されたことを QoS クライアント側拡張に通知します。

3. Qos クライアント側拡張機能は、qos 検査モジュールに QoS ポリシーイベント通知を送信します。

4. QoS 検査モジュールは、ユーザーまたはコンピュータの QoS ポリシーを取得し、それらを格納します。

新しいトランスポート層エンドポイントの \( TCP 接続または UDP トラフィック \) が作成されると、次の処理が行われます。

1. TCP/IP スタックのトランスポート層コンポーネントは、QoS 検査モジュールに通知します。

2. QoS 検査モジュールは、トランスポート層のエンドポイントのパラメーターを、保存されている QoS ポリシーと比較します。

3. 一致するものが見つかった場合、QoS 検査モジュールは Pacer.sys に接続してフローを作成します。これには、DSCP 値を含むデータ構造と、一致する QoS ポリシーのトラフィック調整設定が含まれます。 トランスポート層のエンドポイントのパラメーターと一致する QoS ポリシーが複数ある場合は、最も具体的な QoS ポリシーが使用されます。

4. Pacer.sys はフローを格納し、フローに対応するフロー番号を QoS 検査モジュールに返します。

5. QoS 検査モジュールは、トランスポート層にフロー番号を返します。

6. トランスポート層では、トランスポート層のエンドポイントにフロー番号が格納されます。

フロー番号でマークされたトランスポート層エンドポイントに対応するパケットが送信されると、次の処理が行われます。

1. トランスポート層は、内部的にフロー番号を使用してパケットをマークします。

2. ネットワーク層は、パケットのフロー番号に対応する DSCP 値の Pacer.sys を照会します。

3. Pacer.sys によって、DSCP 値がネットワーク層に返されます。

4. ネットワーク層は、IPv4 TOS フィールドまたは IPv6 トラフィッククラスのフィールドを Pacer.sys によって指定された DSCP 値に変更し、IPv4 パケットの場合は最終的な IPv4 ヘッダーチェックサムを計算します。

5. ネットワークレイヤーによって、パケットがフレームレイヤーに渡されます。

6. パケットはフロー番号でマークされているため、フレームレイヤーは NDIS 6.x を通じて Pacer.sys するようにパケットを渡します。

7. Pacer.sys はパケットのフロー番号を使用してパケットを調整する必要があるかどうかを判断し、その場合はパケットが送信されるようにスケジュールします。

8. \( \) \( \) 適切なネットワークアダプター経由で送信するために、トラフィックの調整が行われていない場合、または NDIS 6.x へのトラフィックの調整がある場合は、すぐにパケットをハンド Pacer.sys します。

これらのポリシーベースの QoS プロセスには、次のような利点があります。

- QoS ポリシーが適用されるかどうかを判断するためのトラフィックの検査は、パケット単位ではなく、トランスポート層のエンドポイントごとに実行されます。

- QoS ポリシーに一致しないトラフィックは、パフォーマンスに影響しません。

- アプリケーションを変更して、DSCP ベースの差別化されたサービスまたはトラフィックの調整を利用する必要はありません。

- QoS ポリシーは、IPsec で保護されたトラフィックに適用できます。

このガイドの次のトピックについては、「 [QoS ポリシーのアーキテクチャ](qos-policy-architecture.md)」を参照してください。

このガイドの最初のトピックについては、「[サービスの品質 (QoS) ポリシー](qos-policy-top.md)」を参照してください。
