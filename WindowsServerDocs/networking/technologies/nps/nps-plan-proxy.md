---
title: NPS を RADIUS プロキシとして計画する
description: このトピックでは、Windows Server 2016 でのネットワークポリシーサーバーの RADIUS プロキシ展開の計画について説明します。
manager: brianlic
ms.prod: windows-server
ms.technology: networking
ms.topic: article
ms.assetid: ca77d64a-065b-4bf2-8252-3e75f71b7734
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 29a48275dfd56cbf223e0fca0c9c276f35a675cc
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/27/2019
ms.locfileid: "71396016"
---
# <a name="plan-nps-as-a-radius-proxy"></a>NPS を RADIUS プロキシとして計画する

>適用対象: Windows Server (半期チャネル)、Windows Server 2016

RADIUS\) プロキシ \(リモート認証ダイヤルインユーザーサービスとしてネットワークポリシーサーバー (NPS) を展開する場合、NPS は RADIUS クライアントからの接続要求 (ネットワークアクセスサーバーやその他の RADIUS プロキシなど) を受信し、これらの接続要求を NPS または他の RADIUS サーバーを実行しているサーバーに転送します。 これらの計画ガイドラインを使用して、RADIUS の展開を簡略化できます。

これらの計画ガイドラインには、NPS を RADIUS サーバーとして展開する状況は含まれません。 NPS を RADIUS サーバーとして展開すると、NPS はローカルドメインおよびローカルドメインを信頼するドメインに対する接続要求に対して認証、承認、およびアカウンティングを実行します。

NPS を RADIUS プロキシとしてネットワークに展開する前に、次のガイドラインを使用して展開を計画します。

- NPS 構成を計画します。

- RADIUS クライアントを計画します。

- リモート RADIUS サーバーグループを計画します。

- メッセージ転送の属性操作規則を計画します。

- 接続要求ポリシーを計画します。

- NPS アカウンティングを計画します。

## <a name="plan-nps-configuration"></a>NPS 構成を計画する

Nps を RADIUS プロキシとして使用する場合、nps は接続要求を NPS または他の RADIUS サーバーに転送して処理します。 このため、NPS プロキシのドメインメンバーシップは関係ありません。 プロキシは、ユーザーアカウントのダイヤルインプロパティにアクセスする必要がないため、Active Directory Domain Services \(AD DS\) に登録する必要はありません。 また、プロキシは接続要求に対して承認を実行しないため、NPS プロキシでネットワークポリシーを構成する必要はありません。 NPS プロキシは、ドメインメンバーでもかまいません。また、ドメインメンバーシップのないスタンドアロンサーバーでもかまいません。

RADIUS プロトコルを使用して、RADIUS クライアント (ネットワークアクセスサーバーとも呼ばれます) と通信するように NPS を構成する必要があります。 また、NPS によってイベントログに記録されるイベントの種類を構成したり、サーバーの説明を入力したりすることができます。

### <a name="key-steps"></a>主要手順

NPS プロキシ構成の計画中に、次の手順を使用できます。

- Radius クライアントから radius メッセージを受信し、radius メッセージをリモート RADIUS サーバーグループのメンバーに送信するために NPS プロキシが使用する RADIUS ポートを決定します。 Radius 認証メッセージの場合は1812および1645、RADIUS アカウンティングメッセージの場合は UDP ポート1813および1646の既定のユーザーデータグラムプロトコル (UDP) ポートが使用されます。

- NPS プロキシに複数のネットワークアダプターが構成されている場合は、RADIUS トラフィックを許可するアダプターを特定します。

- NPS でイベントログに記録するイベントの種類を決定します。 拒否された接続要求、成功した接続要求、またはその両方をログに記録できます。

- 複数の NPS プロキシを展開するかどうかを判断します。 フォールトトレランスを提供するには、少なくとも2つの NPS プロキシを使用します。 1つの NPS プロキシをプライマリ RADIUS プロキシとして使用し、もう一方をバックアップとして使用します。 各 RADIUS クライアントは、両方の NPS プロキシで構成されます。 プライマリ NPS プロキシが使用できなくなると、RADIUS クライアントは、代替 NPS プロキシにアクセス要求メッセージを送信します。

- 1つの NPS プロキシ構成を他の NPS プロキシにコピーして管理オーバーヘッドを節約し、サーバーを正しく構成しないようにするためのスクリプトを計画します。 NPS には、別の NPS プロキシにインポートするために、NPS プロキシ構成のすべてまたは一部をコピーできる Netsh コマンドが用意されています。 コマンドは Netsh プロンプトで手動で実行できます。 ただし、コマンドシーケンスをスクリプトとして保存した場合、プロキシの構成を変更する場合は、後でスクリプトを実行することができます。

## <a name="plan-radius-clients"></a>RADIUS クライアントを計画する

RADIUS クライアントは、ワイヤレスアクセスポイント、仮想プライベートネットワーク \(VPN\) サーバー、802.1 X 対応スイッチ、およびダイヤルアップサーバーなどのネットワークアクセスサーバーです。 Radius サーバーに接続要求メッセージを転送する RADIUS プロキシは、radius クライアントでもあります。 NPS では、RADIUS プロトコルに準拠しているすべてのネットワークアクセスサーバーと RADIUS プロキシがサポートされています。詳細については、「RFC 2865、リモート認証ダイヤルインユーザーサービス \(RADIUS\)」、RFC 2866、「RADIUS アカウンティング」を参照してください。

また、ワイヤレスアクセスポイントとスイッチの両方が、802.1 X 認証に対応している必要があります。 拡張認証プロトコル (EAP) または保護された拡張認証プロトコル (PEAP) を展開する場合は、アクセスポイントとスイッチが EAP の使用をサポートしている必要があります。

ワイヤレスアクセスポイントの PPP 接続の基本的な相互運用性をテストするには、パスワード認証プロトコル (PAP) を使用するようにアクセスポイントとアクセスクライアントを構成します。 ネットワークアクセスに使用する予定のプロトコルをテストするまで、追加の PPP ベースの認証プロトコル (PEAP など) を使用します。

### <a name="key-steps"></a>主要手順

RADIUS クライアントの計画中に、次の手順を実行できます。

- NPS で構成する必要があるベンダー固有の属性 (Vsa) を文書化します。 Nas で Vsa が必要な場合は、NPS でネットワークポリシーを構成するときに、後で使用するために VSA 情報をログに記録します。

- すべてのデバイスの構成を簡略化するために、RADIUS クライアントと NPS プロキシの IP アドレスを文書化します。 RADIUS クライアントを展開するときは、radius プロトコルを使用するように構成する必要があります。 NPS プロキシの IP アドレスを認証サーバーとして入力します。 また、RADIUS クライアントと通信するように NPS を構成する場合は、RADIUS クライアントの IP アドレスを NPS スナップインに入力する必要があります。

- RADIUS クライアントと NPS スナップインで、構成用の共有シークレットを作成します。 NPS で RADIUS クライアントを構成するときに NPS スナップインにも入力する、共有シークレット (パスワード) を使用して RADIUS クライアントを構成する必要があります。

## <a name="plan-remote-radius-server-groups"></a>リモート RADIUS サーバーグループを計画する

NPS プロキシでリモート RADIUS サーバーグループを構成すると、ネットワークアクセスサーバーおよび NPS プロキシまたはその他の RADIUS プロキシから受信する一部またはすべての接続要求メッセージを送信する場所を NPS プロキシに指示することになります。

NPS を RADIUS プロキシとして使用して、接続要求を1つまたは複数のリモート RADIUS サーバーグループに転送できます。また、各グループに1つまたは複数の RADIUS サーバーを含めることができます。 NPS プロキシで複数のグループにメッセージを転送する場合は、グループごとに1つの接続要求ポリシーを構成します。 接続要求ポリシーには、ポリシーに指定されているリモート RADIUS サーバーグループに送信するメッセージを NPS プロキシに通知する、属性操作ルールなどの追加情報が含まれています。

リモート RADIUS サーバーグループは、nps の Netsh コマンドを使用して構成できます。そのためには、NPS スナップインの [リモート RADIUS サーバーグループ] の下でグループを直接構成するか、新しい接続要求ポリシーウィザードを実行します。

### <a name="key-steps"></a>主要手順

リモート RADIUS サーバーグループの計画中に、次の手順を使用できます。

- NPS プロキシが接続要求を転送する RADIUS サーバーが含まれているドメインを特定します。 これらのドメインには、展開する RADIUS クライアントを介してネットワークに接続するユーザーのユーザーアカウントが含まれています。

- RADIUS がまだ展開されていないドメインに新しい RADIUS サーバーを追加する必要があるかどうかを判断します。

- リモート RADIUS サーバーグループに追加する RADIUS サーバーの IP アドレスを文書化します。

- 作成する必要があるリモート RADIUS サーバーグループの数を決定します。 場合によっては、ドメインごとに1つのリモート RADIUS サーバーグループを作成し、そのドメインの RADIUS サーバーをグループに追加することをお勧めします。 ただし、1つのドメインに大量のリソースがある場合があります。たとえば、ドメイン内のユーザーアカウントを持つ多数のユーザー、多数のドメインコントローラー、および多数の RADIUS サーバーがあります。 または、ドメインが地理的に広い領域をカバーしている場合、ネットワークアクセスサーバーと RADIUS サーバーを互いに離れた場所に配置することがあります。 このような場合や、場合によっては、ドメインごとに複数のリモート RADIUS サーバーグループを作成できます。

- NPS プロキシおよびリモート RADIUS サーバーで構成用の共有シークレットを作成します。

## <a name="plan-attribute-manipulation-rules-for-message-forwarding"></a>メッセージ転送の属性操作規則を計画する

接続要求ポリシーで構成されている属性の操作規則を使用すると、特定のリモート RADIUS サーバーグループに転送するアクセス要求メッセージを識別できます。

属性の操作規則を使用せずに、すべての接続要求を1つのリモート RADIUS サーバーグループに転送するように NPS を構成できます。

ただし、接続要求を転送する場所が複数ある場合は、場所ごとに接続要求ポリシーを作成し、メッセージの転送先のリモート RADIUS サーバーグループを使用してポリシーを構成する必要があります。属性の操作ルールを使用して、どのメッセージを転送するかを NPS に指示します。

次の属性に対して規則を作成できます。

- "ステーション ID" と呼ばれます。 ネットワークアクセスサーバー (NAS) の電話番号。 この属性の値は文字列です。 パターンマッチング構文を使用すると、区分コードを指定できます。

- コーリングステーション ID。 呼び出し元によって使用される電話番号。 この属性の値は文字列です。 パターンマッチング構文を使用すると、区分コードを指定できます。

- ユーザー名。 アクセスクライアントによって提供され、RADIUS のアクセス要求メッセージに NAS によって含まれているユーザー名。 この属性の値は、通常、領域名とユーザーアカウント名を含む文字列です。

接続要求のユーザー名の領域名を正しく置換または変換するには、適切な接続要求ポリシーのユーザー名属性の属性操作規則を構成する必要があります。

### <a name="key-steps"></a>主要手順

属性の操作規則の計画中に、次の手順を使用できます。

- メッセージを RADIUS サーバーに転送するための論理パスがあることを確認するために、プロキシ経由でのリモート RADIUS サーバーへのメッセージのルーティングを計画します。

- 各接続要求ポリシーに使用する1つまたは複数の属性を決定します。

- 各接続要求ポリシーに使用する属性の操作規則を文書化し、メッセージの転送先となるリモート RADIUS サーバーグループに規則を一致させます。

## <a name="plan-connection-request-policies"></a>接続要求ポリシーを計画する

NPS が RADIUS サーバーとして使用されている場合、既定の接続要求ポリシーが構成されます。 追加の接続要求ポリシーを使用して、より具体的な条件を定義したり、リモート RADIUS サーバーグループに転送するメッセージを NPS に指示する属性操作規則を作成したり、高度な属性を指定したりすることができます。 新しい接続要求ポリシーウィザードを使用して、共通またはカスタムの接続要求ポリシーを作成します。

### <a name="key-steps"></a>主要手順

接続要求ポリシーの計画時には、次の手順を使用できます。

- RADIUS プロキシとしてのみ機能する NPS を実行する各サーバーで、既定の接続要求ポリシーを削除します。

- 各ポリシーに必要な追加の条件と設定を計画し、この情報を、ポリシーに対して計画されているリモート RADIUS サーバーグループと属性の操作規則と組み合わせます。

- 共通の接続要求ポリシーをすべての NPS プロキシに配布するように計画を設計します。 1つの NPS 上の複数の NPS プロキシに共通のポリシーを作成し、NPS の Netsh コマンドを使用して、接続要求ポリシーとサーバー構成を他のすべてのプロキシにインポートします。

## <a name="plan-nps-accounting"></a>NPS アカウンティングを計画する

NPS を RADIUS プロキシとして構成する場合、NPS 形式のログファイル、データベースと互換性のある形式のログファイル、または NPS SQL Server ログを使用して RADIUS アカウンティングを実行するように構成できます。

また、これらのログ形式のいずれかを使用して、アカウンティングを実行するリモート RADIUS サーバーグループにアカウンティングメッセージを転送することもできます。

### <a name="key-steps"></a>主要手順

NPS アカウンティングの計画では、次の手順を使用できます。

- NPS プロキシでアカウンティングサービスを実行するか、アカウンティングメッセージをリモート RADIUS サーバーグループに転送するかを決定します。

- アカウンティングメッセージを他のサーバーに転送する予定がある場合は、ローカルの NPS プロキシアカウンティングを無効にすることを計画します。

- アカウンティングメッセージを他のサーバーに転送する予定の場合は、接続要求ポリシーの構成手順を計画します。 NPS プロキシのローカルアカウンティングを無効にした場合は、そのプロキシで構成する各接続要求ポリシーでアカウンティングメッセージ転送が有効になり、適切に構成されている必要があります。

- 使用するログの形式を決定します。 IAS 形式のログファイル、データベースと互換性のある形式のログファイル、または NPS SQL Server ログ記録です。

NPS の負荷分散を RADIUS プロキシとして構成するには、「 [Nps プロキシサーバーの負荷分散](nps-manage-proxy-lb.md)」を参照してください。

