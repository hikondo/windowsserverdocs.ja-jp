---
title: NPS を RADIUS サーバーとして計画する
description: このトピックでは、Windows Server 2016 でのネットワークポリシーサーバーの RADIUS サーバー展開計画について説明します。
manager: brianlic
ms.topic: article
ms.assetid: 2900dd2c-0f70-4f8d-9650-ed83d51d509a
ms.author: lizross
author: eross-msft
ms.openlocfilehash: 73e85d9582e447466115ce30047a3968a8f457d8
ms.sourcegitcommit: dfa48f77b751dbc34409aced628eb2f17c912f08
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/07/2020
ms.locfileid: "87952007"
---
# <a name="plan-nps-as-a-radius-server"></a>NPS を RADIUS サーバーとして計画する

>適用先:Windows Server (半期チャネル)、Windows Server 2016

ネットワークポリシーサーバー \( nps を \) リモート認証ダイヤルインユーザーサービス (RADIUS) サーバーとして展開すると、nps はローカルドメインおよびローカルドメインを信頼するドメインに対する接続要求に対して認証、承認、およびアカウンティングを実行します。 これらの計画ガイドラインを使用して、RADIUS の展開を簡略化できます。

これらの計画ガイドラインには、NPS を RADIUS プロキシとして展開する状況は含まれません。 Nps を RADIUS プロキシとして展開すると、nps は、NPS を実行しているサーバー、またはリモートドメイン、信頼されていないドメイン、またはその両方の RADIUS サーバーに接続要求を転送します。

NPS を RADIUS サーバーとしてネットワークに展開する前に、次のガイドラインを使用して展開を計画します。

- NPS 構成を計画します。

- RADIUS クライアントを計画します。

- 認証方法の使用を計画します。

- ネットワークポリシーを計画します。

- NPS アカウンティングを計画します。

## <a name="plan-nps-configuration"></a>NPS 構成を計画する

NPS がメンバーとなっているドメインを決める必要があります。 複数ドメイン環境では、NPS は、メンバーとなっているドメイン内のユーザーアカウント、および NPS のローカルドメインを信頼するすべてのドメイン内のユーザーアカウントの資格情報を認証できます。 承認プロセス中に NPS がユーザーアカウントのダイヤルインプロパティを読み取ることができるようにするには、NPS のコンピューターアカウントを、各ドメインの RAS および NPSs グループに追加する必要があります。

NPS のドメインメンバーシップを決定したら、RADIUS プロトコルを使用して、RADIUS クライアント (ネットワークアクセスサーバーとも呼ばれます) と通信するようにサーバーを構成する必要があります。 また、NPS によってイベントログに記録されるイベントの種類を構成したり、サーバーの説明を入力したりすることができます。

### <a name="key-steps"></a>主要手順

NPS 構成の計画では、次の手順を使用できます。

- Radius クライアントから RADIUS メッセージを受信するために NPS が使用する RADIUS ポートを決定します。 既定のポートは、RADIUS 認証メッセージの場合は UDP ポート1812および1645、RADIUS アカウンティングメッセージの場合はポート1813および1646です。

- NPS に複数のネットワークアダプターが構成されている場合は、RADIUS トラフィックを許可するアダプターを特定します。

- NPS でイベントログに記録するイベントの種類を決定します。 拒否された認証要求、成功した認証要求、または両方の種類の要求をログに記録できます。

- 複数の NPS を展開するかどうかを判断します。 RADIUS ベースの認証とアカウンティングにフォールトトレランスを提供するには、少なくとも2つの NPSs を使用します。 1つの NPS をプライマリ RADIUS サーバーとして使用し、もう一方をバックアップとして使用します。 各 RADIUS クライアントは、両方の NPSs で構成されます。 プライマリ NPS が使用できなくなった場合、RADIUS クライアントは、代替 NPS にアクセス要求メッセージを送信します。

- 1つの NPS 構成を他の NPSs にコピーするスクリプトを計画して、管理オーバーヘッドを節約し、サーバーの不適切な構成を防ぐことができます。 NPS には、nps 構成のすべてまたは一部をコピーして別の NPS にインポートできるようにする Netsh コマンドが用意されています。 コマンドは Netsh プロンプトで手動で実行できます。 ただし、コマンドシーケンスをスクリプトとして保存する場合は、サーバー構成を変更する場合は、後でスクリプトを実行することができます。

## <a name="plan-radius-clients"></a>RADIUS クライアントを計画する

RADIUS クライアントは、ワイヤレスアクセスポイント、仮想プライベートネットワーク (VPN) サーバー、802.1 X 対応スイッチ、およびダイヤルアップサーバーなどのネットワークアクセスサーバーです。 Radius サーバーに接続要求メッセージを転送する RADIUS プロキシは、radius クライアントでもあります。 NPS は、RFC 2865、「リモート認証ダイヤルインユーザーサービス (RADIUS)」、RFC 2866、「RADIUS アカウンティング」で説明されているように、RADIUS プロトコルに準拠しているすべてのネットワークアクセスサーバーと RADIUS プロキシをサポートします。

>[!IMPORTANT]
>クライアントコンピューターなどのアクセスクライアントは、RADIUS クライアントではありません。 Radius クライアントは、radius プロトコルをサポートするネットワークアクセスサーバーとプロキシサーバーのみです。

また、ワイヤレスアクセスポイントとスイッチの両方が、802.1 X 認証に対応している必要があります。 拡張認証プロトコル \( eap \) または保護された拡張認証プロトコル PEAP を展開する場合は \( \) 、アクセスポイントとスイッチが EAP の使用をサポートしている必要があります。

ワイヤレスアクセスポイントの PPP 接続の基本的な相互運用性をテストするには、パスワード認証プロトコル (PAP) を使用するようにアクセスポイントとアクセスクライアントを構成します。 ネットワークアクセスに使用する予定のプロトコルをテストするまで、追加の PPP ベースの認証プロトコル (PEAP など) を使用します。

### <a name="key-steps"></a>主要手順

RADIUS クライアントの計画中に、次の手順を実行できます。

- NPS で構成する必要があるベンダー固有の属性 (Vsa) を文書化します。 ネットワークアクセスサーバーが Vsa を必要とする場合は、NPS でネットワークポリシーを構成するときに、VSA 情報をログに記録しておきます。

- すべてのデバイスの構成を簡略化するために、RADIUS クライアントと NPS の IP アドレスを文書化します。 RADIUS クライアントを展開するときは、radius プロトコルを使用するように構成し、NPS IP アドレスを認証サーバーとして入力する必要があります。 また、RADIUS クライアントと通信するように NPS を構成する場合は、RADIUS クライアントの IP アドレスを NPS スナップインに入力する必要があります。

- RADIUS クライアントと NPS スナップインで、構成用の共有シークレットを作成します。 NPS で RADIUS クライアントを構成するときに NPS スナップインにも入力する、共有シークレット (パスワード) を使用して RADIUS クライアントを構成する必要があります。

## <a name="plan-the-use-of-authentication-methods"></a>認証方法の使用を計画する

NPS は、パスワードベースの認証方法と証明書ベースの認証方法の両方をサポートしています。 ただし、すべてのネットワークアクセスサーバーが同じ認証方法をサポートするわけではありません。 場合によっては、ネットワークアクセスの種類に基づいて別の認証方法を展開する必要があります。

たとえば、組織のワイヤレスアクセスと VPN アクセスの両方を展開しますが、アクセスの種類ごとに EAP-TLS を使用します。 VPN 接続の場合は eap-tls (トランスポート層セキュリティ (EAP-TLS) を使用した eap による強力なセキュリティ、802.1 X ワイヤレス接続の場合は PEAP-TLS v2) を使用します。

PEAP と Microsoft チャレンジハンドシェイク認証プロトコル version 2 (PEAP-TLS v2) には、特にポータブルコンピューターや他のワイヤレスデバイスで使用するように設計された、高速再接続という機能が用意されています。 高速再接続を使用すると、ワイヤレスクライアントは、新しいアクセスポイントに関連付けられるたびに再認証されることなく、同じネットワーク上のワイヤレスアクセスポイント間を移動できます。 これにより、ワイヤレスユーザーのエクスペリエンスが向上し、資格情報を再入力することなくアクセスポイント間を移動できます。
高速再接続と PEAP-TLS v2 が提供するセキュリティにより、PEAP ms-chap v2 はワイヤレス接続の認証方法として論理的に選択されます。

VPN 接続の場合、EAP-TLS は証明書ベースの認証方法であり、インターネットを介して自宅またはモバイルコンピューターから組織の VPN サーバーに送信される場合でも、ネットワークトラフィックを保護する強力なセキュリティを提供します。

### <a name="certificate-based-authentication-methods"></a>証明書ベースの認証方法

証明書ベースの認証方法には、強力なセキュリティを提供するという利点があります。また、パスワードベースの認証方法よりも展開が難しくなるという欠点があります。

PEAP-TLS v2 と EAP-TLS はどちらも証明書ベースの認証方法ですが、これらの認証方法にはさまざまな違いがあります。

### <a name="eap-tls"></a>EAP-TLS

EAP-TLS では、クライアントとサーバーの両方の認証に証明書が使用されるため、組織に公開キー基盤 (PKI) を展開する必要があります。 PKI の展開は複雑であり、NPS を RADIUS サーバーとして使用する計画とは無関係の計画フェーズが必要です。

EAP-TLS では、NPS は証明機関 CA からサーバー証明書を登録し、証明書 \( \) はローカルコンピューターの証明書ストアに保存されます。 認証プロセス中、サーバー認証は、NPS がアクセスクライアントにサーバー証明書を送信するときに実行され、アクセスクライアントにその id を証明します。 アクセスクライアントは、さまざまな証明書のプロパティを調べて、証明書が有効であり、サーバー認証時の使用に適しているかどうかを確認します。 サーバー証明書がサーバー証明書の最小要件を満たし、アクセスクライアントが信頼する CA によって発行されている場合、NPS はクライアントによって正常に認証されます。

同様に、クライアント認証は、クライアントが nps にクライアント証明書を送信して NPS に id を証明するときに、認証プロセス中に発生します。 NPS は証明書を調べます。クライアント証明書が最小クライアント証明書の要件を満たし、NPS が信頼する CA によって発行されている場合、アクセスクライアントは NPS によって正常に認証されます。

サーバー証明書が NPS の証明書ストアに格納されている必要がありますが、クライアントまたはユーザーの証明書は、クライアント上の証明書ストアまたはスマートカードに格納することができます。

この認証プロセスを成功させるには、すべてのコンピューターが、ローカルコンピューターと現在のユーザーの信頼されたルート証明機関の証明書ストアに組織の CA 証明書を持っている必要があります。

### <a name="peap-ms-chap-v2"></a>PEAP-MS-CHAP v2

PEAP-TLS v2 は、サーバー認証に証明書を使用し、ユーザー認証にパスワードベースの資格情報を使用します。 証明書はサーバー認証にのみ使用されるため、PEAP ms-chap v2 を使用するために PKI を展開する必要はありません。 PEAP ms-chap v2 を展開するときに、次の2つの方法のいずれかで NPS のサーバー証明書を取得できます。

- Active Directory 証明書サービス (AD CS) をインストールし、NPSs に証明書を自動登録することができます。 この方法を使用する場合は、NPS に発行された証明書を信頼するように、ネットワークに接続するクライアントコンピューターに CA 証明書を登録する必要もあります。

- VeriSign などのパブリック CA からサーバー証明書を購入できます。 この方法を使用する場合は、クライアントコンピューターによって既に信頼されている CA を選択してください。 クライアントコンピューターが CA を信頼しているかどうかを判断するには、クライアントコンピューターで証明書 Microsoft 管理コンソール (MMC) スナップインを開き、ローカルコンピューターと現在のユーザーの信頼されたルート証明機関ストアを表示します。 これらの証明書ストアに CA の証明書がある場合、クライアントコンピューターは CA を信頼し、CA によって発行されたすべての証明書を信頼します。

PEAP-TLS v2 を使用した認証プロセスでは、NPS がサーバー証明書をクライアントコンピューターに送信するときに、サーバー認証が行われます。 アクセスクライアントは、さまざまな証明書のプロパティを調べて、証明書が有効であり、サーバー認証時の使用に適しているかどうかを確認します。 サーバー証明書がサーバー証明書の最小要件を満たし、アクセスクライアントが信頼する CA によって発行されている場合、NPS はクライアントによって正常に認証されます。

ユーザー認証は、ユーザーがネットワークに接続しようとしたときに、パスワードベースの資格情報を入力してログオンしようとすると発生します。 NPS は資格情報を受信し、認証と承認を行います。 ユーザーの認証と承認が成功し、クライアントコンピューターが NPS を正常に認証した場合は、接続要求が付与されます。

### <a name="key-steps"></a>主要手順

認証方法の使用を計画する際には、次の手順を使用できます。

- 提供する予定のネットワークアクセスの種類 (ワイヤレス、VPN、802.1 X 対応スイッチ、ダイヤルアップアクセスなど) を特定します。

- アクセスの種類ごとに使用する認証方法を決定します。 強力なセキュリティを提供する証明書ベースの認証方法を使用することをお勧めします。ただし、PKI を展開するのは実用的ではない可能性があります。そのため、他の認証方法では、ネットワークに必要なもののバランスをさらに高めることができます。

- EAP-TLS を展開する場合は、PKI の展開を計画します。 これには、サーバー証明書とクライアントコンピューターの証明書に使用する証明書テンプレートの計画が含まれます。 また、ドメインメンバーまたはドメイン以外のコンピューターに証明書を登録する方法や、スマートカードを使用するかどうかを決定する方法についても説明します。

- PEAP-TLS v2 を展開する場合は、NPSs にサーバー証明書を発行するために AD CS をインストールするかどうか、または VeriSign などのパブリック CA からサーバー証明書を購入するかどうかを決定します。

### <a name="plan-network-policies"></a>ネットワークポリシーを計画する

ネットワークポリシーは、RADIUS クライアントから受信した接続要求が承認されているかどうかを判断するために NPS によって使用されます。 また、NPS はユーザーアカウントのダイヤルインプロパティを使用して、承認の決定を行います。

ネットワークポリシーは、NPS スナップインに表示される順序で処理されるため、最も制限の厳しいポリシーをポリシーの一覧に最初に配置するように計画します。 NPS は、接続要求ごとに、ポリシーの条件と接続要求のプロパティを照合しようとします。 NPS は、一致するものが見つかるまで、各ネットワークポリシーを順番に検証します。 一致するものが見つからない場合、接続要求は拒否されます。

### <a name="key-steps"></a>主要手順

ネットワークポリシーの計画時には、次の手順を使用できます。

- 最も限定的なものから最も制限の緩いものまで、ネットワークポリシーの優先 NPS 処理順序を決定します。

- ポリシーの状態を確認します。 ポリシーの状態には、有効または無効の値を指定できます。 ポリシーが有効になっている場合、NPS は承認の実行中にポリシーを評価します。 ポリシーが有効になっていない場合、ポリシーは評価されません。

- ポリシーの種類を決定します。 ポリシーの条件が接続要求と一致する場合、またはポリシーの条件が接続要求と一致する場合にアクセスを拒否するようにポリシーが設計されているかどうかを判断する必要があります。 たとえば、Windows グループのメンバーへのワイヤレスアクセスを明示的に拒否する場合は、グループ、ワイヤレス接続方法、およびポリシーの種類の設定 [アクセス拒否] を指定するネットワークポリシーを作成できます。

- ポリシーの基になっているグループのメンバーであるユーザーアカウントのダイヤルインプロパティを NPS が無視するかどうかを決定します。 この設定が有効になっていない場合、ユーザーアカウントのダイヤルインプロパティは、ネットワークポリシーで構成されている設定を上書きします。 たとえば、ユーザーへのアクセスを許可するネットワークポリシーが構成されていて、そのユーザーのユーザーアカウントのダイヤルインプロパティが [アクセスを拒否する] に設定されている場合、そのユーザーはアクセスを拒否されます。 ただし、[ユーザーアカウントのダイヤルインプロパティを無視する] ポリシーの種類を有効にすると、同じユーザーにネットワークへのアクセスが許可されます。

- ポリシーでポリシーソース設定が使用されているかどうかを確認します。 この設定を使用すると、すべてのアクセス要求のソースを簡単に指定できます。 使用可能なソースは、ターミナルサービスゲートウェイ (TS ゲートウェイ)、リモートアクセスサーバー (VPN またはダイヤルアップ)、DHCP サーバー、ワイヤレスアクセスポイント、および正常性登録機関サーバーです。 または、ベンダー固有のソースを指定することもできます。

- ネットワークポリシーを適用するために、一致する必要がある条件を決定します。

- ネットワークポリシーの条件が接続要求と一致した場合に適用される設定を決定します。

- 既定のネットワークポリシーを使用するか、変更するか、または削除するかを決定します。

## <a name="plan-nps-accounting"></a>NPS アカウンティングを計画する

NPS では、ユーザー認証やアカウンティング要求などの RADIUS アカウンティングデータを、IAS 形式、データベース互換形式、Microsoft SQL Server ログ記録という3つの形式でログに記録できます。

IAS 形式とデータベース互換形式では、ローカル NPS 上のログファイルがテキストファイル形式で作成されます。

SQL Server ログ記録を使用すると、SQL Server 2000 または SQL Server 2005 XML 準拠のデータベースにログを記録し、RADIUS アカウンティングを拡張して、リレーショナルデータベースへのログ記録の利点を活用することができます。

### <a name="key-steps"></a>主要手順

NPS アカウンティングの計画では、次の手順を使用できます。

- NPS アカウンティングデータをログファイルに保存するか、SQL Server データベースに格納するかを決定します。

### <a name="nps-accounting-using-local-log-files"></a>ローカルログファイルを使用した NPS アカウンティング

ログファイルでのユーザー認証およびアカウンティング要求の記録は、主に接続分析と課金の目的で使用されます。また、セキュリティ調査ツールとしても役立ち、攻撃後に悪意のあるユーザーのアクティビティを追跡する方法を提供します。

### <a name="key-steps"></a>主要手順

ローカルログファイルを使用した NPS アカウンティングの計画では、次の手順を使用できます。

- NPS ログファイルに使用するテキストファイル形式を決定します。

- ログに記録する情報の種類を選択します。 アカウンティング要求、認証要求、および定期的な状態をログに記録できます。

- ログファイルを保存するハードディスクの場所を決定します。

- ログファイルのバックアップソリューションを設計します。 ログファイルを保存するハードディスクの場所は、データを簡単にバックアップできる場所である必要があります。 また、ログファイルが格納されているフォルダーのアクセス制御リスト (ACL) を構成することによって、ハードディスクの場所を保護する必要があります。

- 新しいログファイルを作成する頻度を決定します。 ファイルサイズに基づいてログファイルを作成する場合は、新しいログファイルが NPS によって作成されるまでに許容される最大ファイルサイズを決定します。

- ハードディスクの容量が不足している場合に、NPS で古いログファイルを削除するかどうかを決定します。

- アカウンティングデータを表示し、レポートを生成するために使用するアプリケーションを決定します。

### <a name="nps-sql-server-logging"></a>NPS SQL Server ログ記録

NPS SQL Server ログは、セッション状態情報、レポートの作成とデータ分析の目的、およびアカウンティングデータの管理を一元化および簡素化するために使用されます。

NPS には、SQL Server ログ記録を使用して、1つ以上のネットワークアクセスサーバーから受信したユーザー認証とアカウンティング要求を、Microsoft SQL Server デスクトップエンジン MSDE 2000 を実行しているコンピューター上のデータソース、 \( \) または SQL Server 2000 より後の任意のバージョンの SQL Server を記録する機能が用意されています。

アカウンティングデータは、XML 形式の NPS からデータベース内のストアドプロシージャに渡されます。これにより、構造化照会言語の \( SQL と xml SQLXML の両方がサポートされ \) \( \) ます。 XML 準拠の SQL Server データベースでユーザー認証およびアカウンティング要求を記録することで、複数の NPSs で1つのデータソースを使用できるようになります。

### <a name="key-steps"></a>主要手順

Nps SQL Server のログ記録を使用した NPS アカウンティングの計画中に、次の手順を実行できます。

- 自分または組織の別のメンバーが2000または SQL Server 2005 リレーショナルデータベースの開発環境を SQL Server かどうかを判断し、これらの製品を使用して SQL Server データベースを作成、変更、管理、管理する方法を理解します。

- SQL Server が NPS またはリモートコンピューターのどちらにインストールされているかを判断します。

- NPS アカウンティングデータを含む受信 XML ファイルを処理するために SQL Server データベースで使用するストアドプロシージャを設計します。

- SQL Server データベースのレプリケーション構造とフローを設計します。

- アカウンティングデータを表示し、レポートを生成するために使用するアプリケーションを決定します。

- すべてのアカウンティング要求でクラス属性を送信するネットワークアクセスサーバーの使用を計画します。 Class 属性は、アクセス許可メッセージの RADIUS クライアントに送信されます。これは、アカウンティング要求メッセージを認証セッションと関連付ける場合に便利です。 クラス属性がアカウンティング要求メッセージのネットワークアクセスサーバーによって送信された場合は、アカウンティングレコードと認証レコードを照合するために使用できます。 一意のシリアル番号、サービスの再起動時刻、およびサーバーアドレスの属性の組み合わせは、サーバーが受け入れる認証ごとに一意の id である必要があります。

- 中間アカウンティングをサポートするネットワークアクセスサーバーの使用を計画します。

- アカウンティングオンおよびアカウンティングオフのメッセージを送信するネットワークアクセスサーバーの使用を計画します。

- アカウンティングデータの格納と転送をサポートするネットワークアクセスサーバーの使用を計画します。 ネットワークアクセスサーバーが NPS と通信できない場合、この機能をサポートするネットワークアクセスサーバーは、アカウンティングデータを格納できます。 NPS が使用可能になると、ネットワークアクセスサーバーは、格納されているレコードを NPS に転送します。これにより、この機能を提供しないネットワークアクセスサーバーでの信頼性が向上します。

- ネットワークポリシーでは、常に Acct-中間間隔属性を構成することを計画してください。 Acct-中間間隔属性では、ネットワークアクセスサーバーが送信する各中間更新の間隔を秒単位で設定します。 RFC 2869 によれば、Acct-中間間隔属性の値は、60秒または1分未満にすることはできません。また、600秒または10分未満にすることはできません。 詳細については、RFC 2869 の「RADIUS Extensions」を参照してください。

- NPSs で、定期的な状態のログ記録が有効になっていることを確認します。

