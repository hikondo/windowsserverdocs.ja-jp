---
title: 接続要求処理
description: このトピックでは、Windows Server 2016 でのネットワークポリシーサーバー接続要求の処理の概要について説明します。
manager: brianlic
ms.prod: windows-server
ms.technology: networking
ms.topic: article
ms.assetid: 849d661a-42c1-4f93-b669-6009d52aad39
ms.author: lizross
author: eross-msft
ms.openlocfilehash: 311003201f96c5f566077867b09fee0a325ed011
ms.sourcegitcommit: da7b9bce1eba369bcd156639276f6899714e279f
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/26/2020
ms.locfileid: "80316197"
---
# <a name="connection-request-processing"></a>接続要求処理

>適用対象: Windows Server (半期チャネル)、Windows Server 2016

このトピックでは、Windows Server 2016 のネットワークポリシーサーバーでの接続要求の処理について説明します。

>[!NOTE]
>このトピックに加えて、次の接続要求処理のドキュメントも参照してください。
> - [接続要求ポリシー](nps-crp-crpolicies.md)
> - [領域名](nps-crp-realm-names.md)
> - [リモート RADIUS サーバーグループ](nps-crp-rrsg.md)

接続要求の処理を使用すると、ローカルコンピューターまたはリモート RADIUS サーバーグループのメンバーであるリモート RADIUS サーバーで、接続要求の認証を実行する場所を指定できます。 

ネットワークポリシーサーバー (NPS) を実行しているローカルサーバーで接続要求の認証を実行する場合は、追加の構成なしで、既定の接続要求ポリシーを使用できます。 既定のポリシーに基づき、NPS では、ローカル ドメインと信頼されているドメイン内にアカウントがあるユーザーおよびコンピューターを認証します。

接続要求をリモート NPS または他の RADIUS サーバーに転送する場合は、リモート RADIUS サーバーグループを作成し、そのリモート RADIUS サーバーグループに要求を転送する接続要求ポリシーを構成します。 この構成では、NPS での認証の要求を任意の RADIUS サーバーに転送でき、信頼されているドメインにアカウントがあるユーザーを認証できます。

次の図に、ネットワーク アクセス サーバーから RADIUS プロキシにアクセス要求メッセージが転送され、リモート RADIUS サーバー グループ内の RADIUS サーバーに渡る経路を示します。 RADIUS プロキシ上では、ネットワーク アクセス サーバーは RADIUS クライアントとして構成され、各 RADIUS サーバー上で RADIUS プロキシが RADIUS クライアントとして構成されます。


![NPS 接続要求の処理](../../media/Nps-Connection-Request-Processing/Nps-Connection-Request-Processing.jpg)


>[!NOTE]
>NPS で使用するネットワークアクセスサーバーは、802.1 X ワイヤレスアクセスポイントと認証スイッチ、VPN またはダイヤルアップサーバーとして構成されているリモートアクセスを実行しているサーバーなど、RADIUS プロトコルに準拠しているゲートウェイデバイスにすることができます。その他の RADIUS 互換デバイス。

一部の認証要求をローカルで処理し、その他の要求はリモート RADIUS サーバー グループに転送するように NPS を構成する場合、1 種類以上の接続要求ポリシーを構成します。

認証要求を処理する NPS または RADIUS サーバーグループを指定する接続要求ポリシーを構成するには、「接続要求ポリシー」を参照してください。

認証要求の転送先となる NPS または他の RADIUS サーバーを指定するには、「リモート RADIUS サーバーグループ」を参照してください。

## <a name="nps-as-a-radius-server-connection-request-processing"></a>RADIUS サーバー接続要求の処理としての NPS

NPS を RADIUS サーバーとして使用する場合、RADIUS メッセージは、次の方法でネットワークアクセス接続の認証、承認、およびアカウンティングを提供します。

1. ダイヤルアップ ネットワーク アクセス サーバー、VPN サーバー、およびワイヤレス アクセス ポイントなどのアクセス サーバーは、接続要求をアクセス クライアントから受信します。 

2. アクセスサーバーは、RADIUS を認証、承認、およびアカウンティングプロトコルとして使用するように構成されており、アクセス要求メッセージを作成して NPS に送信します。 

3. NPS は、アクセス要求メッセージを評価します。 

4. 必要に応じて、NPS はアクセスチャレンジメッセージをアクセスサーバーに送信します。 アクセスサーバーがチャレンジを処理し、更新されたアクセス要求を NPS に送信します。 

5. ユーザー資格情報が確認され、そのユーザー アカウントのダイヤルイン プロパティが、ドメイン コントローラーへのセキュリティで保護された接続を使用して取得されます。 

6. 接続要求は、ユーザー アカウントのダイヤルイン プロパティとネットワーク ポリシーとの両面で承認されます。 

7. 接続試行が認証され、承認されている場合、NPS はアクセス許可メッセージをアクセスサーバーに送信します。 接続試行が認証されていないか、承認されていない場合、NPS はアクセス拒否メッセージをアクセスサーバーに送信します。 

8. アクセスサーバーは、アクセスクライアントとの接続プロセスを完了し、メッセージがログに記録される NPS にアカウンティング要求メッセージを送信します。 

9. NPS は、アカウンティング応答をアクセスサーバーに送信します。 

>[!NOTE]
>また、アクセス サーバーは、アクセス クライアント接続が閉じられた場合と、アクセス サーバーが開始および停止した場合、接続が確立されるまでの時間にアカウンティング要求メッセージを送信します。

## <a name="nps-as-a-radius-proxy-connection-request-processing"></a>RADIUS プロキシ接続要求の処理としての NPS

RADIUS クライアントと RADIUS サーバー間の RADIUS プロキシとして NPS を使用すると、ネットワーク接続試行時の RADIUS メッセージは次のように転送されます。

1. ダイヤルアップ ネットワーク アクセス サーバー、仮想プライベート ネットワーク (VPN) サーバー、ワイヤレス アクセス ポイントなどのアクセス サーバーは、接続要求をアクセス クライアントから受信します。

2. 認証、承認、およびアカウンティングプロトコルとして RADIUS を使用するように構成されたアクセスサーバーは、アクセス要求メッセージを作成し、NPS RADIUS プロキシとして使用されている NPS に送信します。

3. NPS RADIUS プロキシはアクセス要求メッセージを受信し、ローカルに構成されている接続要求ポリシーを基にアクセス要求メッセージの転送先を特定します。

4. NPS RADIUS プロキシは、アクセス要求メッセージを適切な RADIUS サーバーに転送します。

5. RADIUS サーバーは、アクセス要求メッセージを評価します。

6. 必要に応じて、RADIUS サーバーはアクセス チャレンジ メッセージを NPS RADIUS プロキシに送信し、NPS RADIUS プロキシによりこのメッセージがアクセス サーバーに転送されます。 アクセス サーバーはアクセス クライアントに対してチャレンジを処理し、更新されたアクセス要求を NPS RADIUS プロキシに送信し、NPS RADIUS プロキシによりこのメッセージが RADIUS サーバーに転送されます。

7. RADIUS サーバーが、接続試行を認証および承認します。

8. 接続試行が認証および承認された場合、RADIUS サーバーはアクセス許可メッセージを NPS RADIUS プロキシに送信し、NPS RADIUS プロキシによりこのメッセージがアクセス サーバーに転送されます。 接続試行が認証も承認もされなかった場合、RADIUS サーバーはアクセス拒否メッセージを NPS RADIUS プロキシに送信し、NPS RADIUS プロキシによりこのメッセージがアクセス サーバーに転送されます。

9. アクセス サーバーはアクセス クライアントとの接続処理を完了し、NPS RADIUS プロキシに対してアカウンティング要求メッセージを送信します。 NPS RADIUS プロキシが、アカウンティング データを記録し、メッセージを RADIUS サーバーに転送します。

10. RADIUS サーバーはアカウンティング応答を NPS RADIUS プロキシに送信し、NPS RADIUS プロキシによりこのメッセージがアクセス サーバーに転送されます。

NPS の詳細については、「[ネットワークポリシーサーバー (nps)](nps-top.md)」を参照してください。
