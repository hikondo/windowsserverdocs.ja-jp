---
title: 接続要求ポリシー
description: このトピックでは、Windows Server 2016 のネットワークポリシーサーバー接続要求ポリシーの概要について説明します。
manager: brianlic
ms.prod: windows-server
ms.technology: networking
ms.topic: article
ms.assetid: 4ec45e0c-6b37-4dfb-8158-5f40677b0157
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 0b373e496567f414657b380bad952baefcbe4b18
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/27/2019
ms.locfileid: "71396371"
---
# <a name="connection-request-policies"></a>接続要求ポリシー

>適用対象: Windows Server (半期チャネル)、Windows Server 2016

このトピックでは、NPS 接続要求ポリシーを使用して、NPS を RADIUS サーバー、RADIUS プロキシ、またはその両方として構成する方法について説明します。

>[!NOTE]
>このトピックに加えて、次の接続要求ポリシーのドキュメントも参照してください。
> - [接続要求ポリシーの構成](nps-crp-configure.md)
> - [リモート RADIUS サーバーグループを構成する](nps-crp-rrsg-configure.md)

接続要求ポリシーは、ネットワーク管理者が接続要求の認証と承認を実行するリモート認証ダイヤルインユーザーサービス (RADIUS) サーバーを指定できるようにするための条件と設定のセットです。ネットワークポリシーサーバー (NPS) を実行しているサーバーは、RADIUS クライアントから受信します。 接続要求ポリシーを構成して、RADIUS アカウンティングに使用する RADIUS サーバーを指定できます。

RADIUS クライアントから送信された一部の RADIUS 要求メッセージをローカルで処理し (NPS を RADIUS サーバーとして使用)、他の種類のメッセージを別の RADIUS サーバー (NPS を RADIUS プロキシとして使用) に転送するように、接続要求ポリシーを作成することができます。

接続要求ポリシーを使用すると、次のような要因に基づいて NPS を RADIUS サーバーとして、または RADIUS プロキシとして使用できます。 

- 曜日の時刻と曜日
- 接続要求の領域名
- 要求されている接続の種類
- RADIUS クライアントの IP アドレス

RADIUS アクセス要求メッセージが NPS によって処理または転送されるのは、受信メッセージの設定が NPS で構成されている接続要求ポリシーの少なくとも1つと一致した場合のみです。 

ポリシー設定が一致し、ポリシーによって NPS がメッセージを処理する必要がある場合、NPS は RADIUS サーバーとして機能し、接続要求の認証と承認を行います。 ポリシー設定が一致し、ポリシーによって NPS がメッセージを転送する必要がある場合、NPS は RADIUS プロキシとして機能し、接続要求をリモート RADIUS サーバーに転送して処理します。

着信 RADIUS アクセス要求メッセージの設定が接続要求ポリシーの少なくとも1つと一致しない場合、アクセス拒否メッセージが RADIUS クライアントに送信され、ネットワークに接続しようとしているユーザーまたはコンピューターがアクセスを拒否されます。

## <a name="configuration-examples"></a>構成の例

次の構成例は、接続要求ポリシーを使用する方法を示しています。

### <a name="nps-as-a-radius-server"></a>RADIUS サーバーとしての NPS

構成されている唯一のポリシーは、既定の接続要求ポリシーです。 この例では、NPS が RADIUS サーバーとして構成されており、すべての接続要求がローカルの NPS によって処理されます。 NPS は、NPS ドメインのドメインおよび信頼される側のドメインにアカウントがあるユーザーを認証および承認できます。


### <a name="nps-as-a-radius-proxy"></a>RADIUS プロキシとしての NPS

既定の接続要求ポリシーは削除され、2つの異なるドメインに要求を転送するために2つの新しい接続要求ポリシーが作成されます。 この例では、NPS は RADIUS プロキシとして構成されています。 NPS は、ローカルサーバー上の接続要求を処理しません。 代わりに、リモート RADIUS サーバーグループのメンバーとして構成されている NPS または他の RADIUS サーバーに接続要求を転送します。


### <a name="nps-as-both-radius-server-and-radius-proxy"></a>RADIUS サーバーと RADIUS プロキシの両方としての NPS

既定の接続要求ポリシーに加えて、接続要求を NPS または信頼されていないドメインの他の RADIUS サーバーに転送する新しい接続要求ポリシーが作成されます。 この例では、ポリシーの順序付きリストにプロキシポリシーが最初に表示されます。 接続要求がプロキシポリシーに一致する場合、接続要求は、リモート RADIUS サーバーグループの RADIUS サーバーに転送されます。 接続要求がプロキシポリシーと一致しないが、既定の接続要求ポリシーに一致する場合、NPS はローカルサーバー上で接続要求を処理します。 接続要求がどちらのポリシーとも一致しない場合は、破棄されます。

### <a name="nps-as-radius-server-with-remote-accounting-servers"></a>リモートアカウンティングサーバーを使用する RADIUS サーバーとしての NPS

この例では、ローカル NPS がアカウンティングを実行するように構成されておらず、既定の接続要求ポリシーが変更されて、RADIUS アカウンティングメッセージが NPS またはリモート RADIUS サーバーグループ内の他の RADIUS サーバーに転送されるようになっています。 アカウンティングメッセージは転送されますが、認証と承認のメッセージは転送されず、ローカルの NPS はローカルドメインとすべての信頼されたドメインに対してこれらの機能を実行します。


### <a name="nps-with-remote-radius-to-windows-user-mapping"></a>リモート RADIUS から Windows へのユーザーマッピングを使用する NPS

この例では、NPS は、認証要求をリモート RADIUS サーバーに転送することにより、RADIUS サーバーと RADIUS プロキシの両方として機能し、承認のためにローカルの Windows ユーザーアカウントを使用します。 この構成は、接続要求ポリシーの条件として、リモート RADIUS から Windows ユーザーマッピング属性を構成することによって実装されます。 また、リモート RADIUS サーバーによって認証が実行されるリモートユーザーアカウントと同じ名前のユーザーアカウントをローカルに作成する必要があります。

## <a name="connection-request-policy-conditions"></a>接続要求ポリシーの条件

接続要求ポリシーの条件は、受信 RADIUS アクセス要求メッセージの属性と比較される1つまたは複数の RADIUS 属性です。 複数の条件がある場合、NPS によってポリシーが適用されるようにするには、接続要求メッセージと接続要求ポリシーのすべての条件が一致している必要があります。


接続要求ポリシーで構成できる、使用可能な条件属性を次に示します。

### <a name="connection-properties-attribute-group"></a>接続プロパティの属性グループ

接続プロパティの属性グループには、次の属性が含まれています。

- **フレームプロトコル**。 受信パケットのフレームの種類を指定するために使用されます。 例として、Point-to-Point プロトコル (PPP)、シリアル回線インターネットプロトコル (SLIP)、フレームリレー、および x.25 があります。
- **サービスの種類**。 要求されるサービスの種類を指定するために使用されます。 例としては、フレーム (PPP 接続など) やログイン (Telnet 接続など) などがあります。 RADIUS サービスの種類の詳細については、RFC 2865 の「リモート認証ダイヤルインユーザーサービス (RADIUS)」を参照してください。
- **トンネルの種類**。 要求元クライアントによって作成されるトンネルの種類を指定するために使用されます。 トンネルの種類には、Point-to-point トンネリングプロトコル (PPTP) とレイヤー2トンネリングプロトコル (L2TP) があります。

### <a name="day-and-time-restrictions-attribute-group"></a>日付と時刻の制限属性グループ 

[日付と時刻の制限] 属性グループには、[日付と時刻の制限] 属性が含まれています。 この属性を使用すると、接続試行の曜日と時刻を指定できます。 日付と時刻は、NPS の日付と時刻を基準としています。

### <a name="gateway-attribute-group"></a>ゲートウェイ属性グループ

ゲートウェイ属性グループには、次の属性が含まれています。

- **ステーション ID と呼ば**れます。 ネットワークアクセスサーバーの電話番号を指定するために使用します。 この属性は文字列です。 パターンマッチング構文を使用すると、区分コードを指定できます。
- **NAS 識別子**。 ネットワークアクセスサーバーの名前を指定するために使用します。 この属性は文字列です。 パターンマッチング構文を使用して、NAS 識別子を指定できます。
- **NAS IPv4 アドレス**。 ネットワークアクセスサーバー (RADIUS クライアント) のインターネットプロトコルバージョン 4 (IPv4) アドレスを指定するために使用します。 この属性は文字列です。 パターンマッチング構文を使用して、IP ネットワークを指定できます。
- **NAS IPv6 アドレス**。 ネットワークアクセスサーバー (RADIUS クライアント) のインターネットプロトコルバージョン 6 (IPv6) アドレスを指定するために使用します。 この属性は文字列です。 パターンマッチング構文を使用して、IP ネットワークを指定できます。
- **NAS ポートの種類**。 アクセスクライアントが使用するメディアの種類を指定するために使用します。 例として、アナログ電話回線 (async)、Integrated Services Digital Network (ISDN)、トンネルまたは仮想プライベートネットワーク (Vpn)、IEEE 802.11 ワイヤレス、およびイーサネットスイッチがあります。

### <a name="machine-identity-attribute-group"></a>コンピューター Id 属性グループ

コンピューター Id 属性グループには、マシン Id 属性が含まれています。 この属性を使用すると、ポリシーでクライアントを識別する方法を指定できます。

### <a name="radius-client-properties-attribute-group"></a>RADIUS クライアントのプロパティの属性グループ

RADIUS クライアントのプロパティの属性グループには、次の属性が含まれています。

- **呼び出し元ステーション ID**。 呼び出し元 (アクセスクライアント) によって使用される電話番号を指定するために使用されます。 この属性は文字列です。 パターンマッチング構文を使用すると、区分コードを指定できます。  802.1 x 認証では、MAC アドレスは通常、設定され、クライアントと照合できます。  このフィールドは、通常、接続要求ポリシーが [資格情報を検証せずにユーザーを承認する] に構成されている場合に、Mac アドレスのバイパスシナリオに使用されます。  
- **クライアントのフレンドリ名**。 認証を要求している RADIUS クライアントコンピューターの名前を指定するために使用します。 この属性は文字列です。 パターンマッチング構文を使用して、クライアント名を指定できます。
- **クライアントの IPv4 アドレス**。 ネットワークアクセスサーバー (RADIUS クライアント) の IPv4 アドレスを指定するために使用します。 この属性は文字列です。 パターンマッチング構文を使用して、IP ネットワークを指定できます。
- **クライアントの IPv6 アドレス**。 ネットワークアクセスサーバー (RADIUS クライアント) の IPv6 アドレスを指定するために使用します。 この属性は文字列です。 パターンマッチング構文を使用して、IP ネットワークを指定できます。
- **クライアントベンダー**。 認証を要求しているネットワークアクセスサーバーのベンダーを指定するために使用されます。 ルーティングとリモートアクセスサービスを実行しているコンピューターは、Microsoft NAS の製造元です。 この属性を使用して、さまざまな NAS 製造元に個別のポリシーを構成できます。 この属性は文字列です。 パターンマッチング構文を使用できます。

### <a name="user-name-attribute-group"></a>ユーザー名属性グループ

User Name 属性グループには、ユーザー名属性が含まれています。 この属性を使用すると、RADIUS メッセージのアクセスクライアントによって指定されたユーザー名と一致する必要があるユーザー名またはユーザー名の一部を指定できます。 この属性は、通常、領域名とユーザーアカウント名を含む文字列です。 パターンマッチング構文を使用すると、ユーザー名を指定できます。

## <a name="connection-request-policy-settings"></a>接続要求ポリシーの設定

接続要求ポリシーの設定は、受信 RADIUS メッセージに適用される一連のプロパティです。 設定は、次のプロパティグループで構成されます。

- 認証
- アカウンティング
- 属性の操作
- 転送要求
- 詳細

以下のセクションでは、これらの設定についてさらに詳しく説明します。

### <a name="authentication"></a>認証

この設定を使用すると、すべてのネットワークポリシーで構成されている認証設定を上書きできます。また、ネットワークへの接続に必要な認証方法と種類を指定することもできます。

>[!IMPORTANT]
>ネットワークポリシーで構成する認証方法よりも安全性が低い接続要求ポリシーで認証方法を構成すると、ネットワークポリシーで構成するより安全な認証方法が上書きされます。 たとえば、次のようになります。保護された拡張認証プロトコルの使用を必要とするネットワークポリシーが1つある場合は、Microsoft チャレンジハンドシェイク認証プロトコルバージョン 2 \(PEAP-MS-CHAP v2\)ます。これは、セキュリティで保護されたワイヤレスのパスワードベースの認証方法であり、認証されていないアクセスを許可するための接続要求ポリシーも構成します。 この例では、ネットワークに接続しているすべてのクライアントに認証されていないアクセスが許可されています。

### <a name="accounting"></a>アカウンティング

この設定を使用すると、リモート radius サーバーグループがアカウンティングを実行するように、リモート RADIUS サーバーグループ内の NPS または他の RADIUS サーバーにアカウンティング情報を転送するように接続要求ポリシーを構成できます。

>[!NOTE]
>複数の RADIUS サーバーがあり、1つの中央 RADIUS アカウンティングデータベースに格納されているすべてのサーバーについてアカウンティング情報が必要な場合は、各 RADIUS サーバーのポリシーで [接続要求ポリシーアカウンティング] 設定を使用して、次の場所からアカウンティングデータを転送できます。すべてのサーバーを1つの NPS またはその他の RADIUS サーバーに、アカウンティングサーバーとして指定します。

接続要求ポリシーのアカウンティング設定は、ローカル NPS のアカウンティング構成とは関係なく機能します。 言い換えると、RADIUS アカウンティング情報をローカルファイルまたは Microsoft SQL Server データベースに記録するようにローカル NPS を構成した場合、アカウンティングメッセージをリモート RADIUS に転送するように接続要求ポリシーを構成するかどうかに関係なく、この処理が行われます。サーバーグループ。

アカウンティング情報をローカルではなくリモートでログに記録する場合は、アカウンティングデータをリモート RADIUS サーバーグループに転送するように接続要求ポリシーのアカウンティングを構成すると同時に、アカウンティングを実行しないようにローカル NPS を構成する必要があります。

### <a name="attribute-manipulation"></a>属性の操作

次のいずれかの属性のテキスト文字列を操作する検索と置換の規則のセットを構成できます。

- ユーザー名
- 被呼端末 ID
- 呼び出し元ステーション ID

検索と置換の規則の処理は、前のいずれかの属性に対して行われてから、RADIUS メッセージが認証およびアカウンティングの設定の対象になります。 属性の操作規則は、1つの属性にのみ適用されます。 属性ごとに属性の操作規則を構成することはできません。 また、操作できる属性の一覧は静的リストです。操作に使用できる属性の一覧にを追加することはできません。

>[!NOTE]
>MS-CHAP v2 認証プロトコルを使用している場合、接続要求ポリシーを使用して RADIUS メッセージを転送すると、ユーザー名属性を操作できません。 唯一の例外は、円記号 (\) 文字が使用されていて、操作が左側の情報にのみ影響する場合です。 円記号 (\) は、通常、ドメイン名 (円記号の左側の情報) と、ドメイン内のユーザーアカウント名 (円記号の右側の情報) を示すために使用されます。 この場合、ドメイン名を変更または置き換える属性の操作規則のみが許可されます。

ユーザー名属性で領域名を操作する方法の例については、「 [NPS での正規表現の使用](nps-crp-reg-expressions.md)」トピックの「ユーザー名属性の領域名を操作する例」を参照してください。

### <a name="forwarding-request"></a>転送要求

RADIUS アクセス要求メッセージに使用される次の転送要求オプションを設定できます。

- **このサーバーで要求を認証**します。 この設定を使用すると、NPS は Windows NT 4.0 ドメイン、Active Directory、またはローカルのセキュリティアカウントマネージャー (SAM) のユーザーアカウントデータベースを使用して接続要求を認証します。 この設定では、nps で構成されている一致するネットワークポリシーを、ユーザーアカウントのダイヤルインプロパティと共に NPS が接続要求を承認するために使用することも指定します。 この場合、NPS は RADIUS サーバーとして実行するように構成されています。

- **次のリモート RADIUS サーバーグループに要求を転送**します。 この設定を使用すると、NPS は、指定したリモート RADIUS サーバーグループに接続要求を転送します。 NPS がアクセス要求メッセージに対応する有効なアクセス許可メッセージを受信すると、接続試行は認証および承認されたと見なされます。 この場合、NPS は RADIUS プロキシとして機能します。

- **資格情報を検証せずにユーザーを受け入れ**ます。 この設定を使用すると、NPS はネットワークに接続しようとしているユーザーの id を検証しません。また、NPS は、ユーザーまたはコンピューターがネットワークに接続する権限を持っているかどうかを検証しません。 NPS が認証されていないアクセスを許可して接続要求を受信するように構成されている場合、NPS は直ちに RADIUS クライアントにアクセス許可メッセージを送信し、ユーザーまたはコンピューターにネットワークアクセスが許可されます。 この設定は、ユーザーの資格情報が認証される前にアクセスクライアントがトンネリングされるいくつかの種類の強制トンネリングに使用されます。

>[!NOTE]
>この認証オプションは、アクセスクライアントの認証プロトコルが MS-CHAP v2 または拡張認証プロトコル-トランスポート層セキュリティ (EAP-TLS) である場合には使用できません。どちらも相互認証を提供します。 相互認証では、アクセスクライアントは、それが認証サーバー (NPS) への有効なアクセスクライアントであることを証明し、認証サーバーがアクセスクライアントに対して有効な認証サーバーであることを証明します。 この認証オプションを使用すると、アクセス許可メッセージが返されます。 ただし、認証サーバーはアクセスクライアントに検証を提供しないため、相互認証は失敗します。

正規表現を使用して、指定された領域名を持つ RADIUS メッセージをリモート RADIUS サーバーグループに転送するルーティング規則を作成する方法の例については、「 [NPS の正規表現を使用](nps-crp-reg-expressions.md)する」の「プロキシサーバーによる radius メッセージ転送の例」を参照してください。

### <a name="advanced"></a>詳細

詳細プロパティを設定して、次のような一連の RADIUS 属性を指定できます。

- NPS が RADIUS 認証またはアカウンティングサーバーとして使用されている場合に、RADIUS 応答メッセージに追加されます。 ネットワークポリシーと接続要求ポリシーの両方で属性が指定されている場合、RADIUS 応答メッセージで送信される属性は、2つの属性セットを組み合わせたものになります。
- NPS が RADIUS 認証またはアカウンティングプロキシとして使用されている場合に、RADIUS メッセージに追加されます。 転送されるメッセージに属性が既に存在する場合は、接続要求ポリシーで指定された属性の値に置き換えられます。 

さらに、 **[詳細設定**] カテゴリの [接続要求ポリシーの**設定**] タブで構成できる属性には、特殊な機能が用意されています。 たとえば、2つのユーザーアカウントデータベース間での接続要求の認証と承認を分割する場合は、[**リモート RADIUS] を [Windows ユーザーマッピング**] に設定できます。

**REMOTE radius To Windows ユーザーマッピング**属性では、リモート radius サーバーによって認証されたユーザーに対して windows 認証が行われることを指定します。 つまり、リモート RADIUS サーバーは、リモートユーザーアカウントデータベース内のユーザーアカウントに対して認証を実行しますが、ローカルの NPS はローカルユーザーアカウントデータベースのユーザーアカウントに対して接続要求を承認します。 これは、訪問者がネットワークにアクセスできるようにする場合に便利です。

たとえば、パートナー組織の訪問者は、パートナー組織の RADIUS サーバーで認証を行い、組織の Windows ユーザーアカウントを使用して、ネットワーク上のゲストローカルエリアネットワーク (LAN) にアクセスできます。

特別な機能を提供するその他の属性は次のとおりです。

- **IPFilter とミリ**秒を待機します。 これらの属性は、ルーティングとリモートアクセス VPN の展開でネットワークアクセス検疫制御 (NAQC) を展開するときに使用されます。
- **Passport-ユーザーマッピング-UPN-サフィックス**。 この属性を使用すると、Windows Live™ ID ユーザーアカウントの資格情報で接続要求を認証できます。
- **トンネルタグ**。 この属性は、仮想ローカルエリアネットワーク (Vlan) を展開するときに、NAS によって接続が割り当てられる VLAN ID 番号を指定します。

## <a name="default-connection-request-policy"></a>既定の接続要求ポリシー

NPS をインストールすると、既定の接続要求ポリシーが作成されます。 このポリシーの構成は次のとおりです。

- 認証が構成されていません。
- アカウンティングは、アカウンティング情報をリモート RADIUS サーバーグループに転送するように構成されていません。
- 属性に、接続要求をリモート RADIUS サーバーグループに転送する属性操作ルールが構成されていません。
- 転送要求は、接続要求がローカルの NPS で認証および承認されるように構成されます。
- 詳細属性が構成されていません。

既定の接続要求ポリシーでは、NPS が RADIUS サーバーとして使用されます。 RADIUS プロキシとして機能するように NPS を実行するサーバーを構成するには、リモート RADIUS サーバーグループも構成する必要があります。 新しい接続要求ポリシーウィザードを使用して新しい接続要求ポリシーを作成するときに、新しいリモート RADIUS サーバーグループを作成できます。 既定の接続要求ポリシーを削除するか、既定の接続要求ポリシーが NPS によって最後に処理されたポリシーであることを確認するには、順序付けられたポリシーの一覧の最後に配置します。

>[!NOTE]
>NPS とリモートアクセスサービスが同じコンピューターにインストールされていて、リモートアクセスサービスが Windows 認証とアカウンティング用に構成されている場合は、リモートアクセスの認証およびアカウンティング要求を RADIUS サーバーに転送することができます. これは、リモートアクセス認証とアカウンティング要求が、リモート RADIUS サーバーグループに転送するように構成されている接続要求ポリシーと一致した場合に発生する可能性があります。
