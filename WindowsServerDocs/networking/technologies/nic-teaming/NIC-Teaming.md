---
title: NIC チーミング
description: このトピックでは、Windows Server 2016 でのネットワークインターフェイスカード (NIC) チーミングの概要について説明します。 NIC チーミングを使用すると、1つまたは32の物理イーサネットネットワークアダプターを、1つまたは複数のソフトウェアベースの仮想ネットワークアダプターにグループ化することができます。 これらの仮想ネットワーク アダプターでは、高速なパフォーマンスとネットワーク アダプターに障害が発生した場合のフォールト トレランスを提供します。
manager: dougkim
ms.topic: article
ms.assetid: abded6f3-5708-4e35-9a9e-890e81924fec
ms.author: lizross
author: eross-msft
ms.date: 09/10/2018
ms.openlocfilehash: d7c7a8482c1c2648558bb53462285a72ea5dd6d9
ms.sourcegitcommit: dfa48f77b751dbc34409aced628eb2f17c912f08
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/07/2020
ms.locfileid: "87952251"
---
# <a name="nic-teaming"></a>NIC チーミング

>適用先:Windows Server (半期チャネル)、Windows Server 2016

このトピックでは、Windows Server 2016 でのネットワークインターフェイスカード (NIC) チーミングの概要について説明します。 NIC チーミングを使用すると、1つまたは32の物理イーサネットネットワークアダプターを、1つまたは複数のソフトウェアベースの仮想ネットワークアダプターにグループ化することができます。 これらの仮想ネットワーク アダプターでは、高速なパフォーマンスとネットワーク アダプターに障害が発生した場合のフォールト トレランスを提供します。

> [!IMPORTANT]
> NIC チームメンバーネットワークアダプターは、同じ物理ホストコンピューターにインストールする必要があります。

> [!TIP]
> 1つのネットワークアダプターのみを含む NIC チームは、負荷分散とフェールオーバーを提供できません。 ただし、1つのネットワークアダプターでは、仮想ローカルエリアネットワーク (Vlan) も使用しているときに、ネットワークトラフィックを分離するために NIC チーミングを使用できます。

NIC チームにネットワークアダプターを構成すると、NIC チーミングソリューションの共通コアに接続され、1つまたは複数の仮想アダプター (チーム Nic [tNICs] またはチームインターフェイスとも呼ばれます) がオペレーティングシステムに提示されます。

Windows Server 2016 ではチームあたり最大32のチームインターフェイスがサポートされているため、Nic 間の送信トラフィック (負荷) を分散するさまざまなアルゴリズムがあります。  次の図は、複数の tNICs を持つ NIC チームを示しています。

![複数の tNICs を持つ NIC チーム](../../media/NIC-Teaming/nict_overview.jpg)

また、チーム化された Nic を同じスイッチまたは異なるスイッチに接続することもできます。 Nic を別々 のスイッチに接続する場合、同じサブネットに両方のスイッチを引き起こすことがあります。

## <a name="availability"></a>可用性
NIC チーミングは、Windows Server 2016 のすべてのバージョンで使用できます。 次のようなさまざまなツールを使用して、クライアントオペレーティングシステムを実行しているコンピューターから NIC チーミングを管理できます。
*    Windows PowerShell コマンドレット
*    リモート デスクトップ
*    リモート サーバー管理ツール

## <a name="supported-and-unsupported-nics"></a>サポートされている Nic とサポート非対象の Nic
Windows Server 2016 の NIC チームで、Windows ハードウェア認定およびロゴテスト (WHQL テスト) に合格したイーサネット NIC を使用できます。

NIC チームに次の Nic を配置することはできません。

-   Hyper-v 仮想ネットワークアダプターは、ホストパーティションの Nic として公開されている hyper-v 仮想スイッチポートです。

    > [!IMPORTANT]
    > チーム内のホストパーティション (vNICs) に公開されている Hyper-v 仮想 Nic は配置しないでください。 ホストパーティション内の vNICs のチーミングは、どの構成でもサポートされていません。 ネットワーク障害が発生した場合、チーム vNICs を試行すると、通信が完全に失われる可能性があります。

-   カーネルデバッグネットワークアダプター (KDNIC)。

-   ネットワークブートに使用される Nic。

-   インターネットプロトコル over Infiniband (IPoIB) Nic など、イーサネット以外のテクノロジ (WWAN、WLAN/Wi-fi、Bluetooth、Infiniband など) を使用する Nic。

## <a name="compatibility"></a>互換性
NIC チーミングは、Windows Server 2016 のすべてのネットワークテクノロジと互換性がありますが、次の例外があります。

-   **シングルルート i/o 仮想化 (sr-iov)**。 SR-IOV の場合、データはネットワークスタック (仮想化の場合はホストオペレーティングシステム) を介して渡されることなく、NIC に直接配信されます。 そのため、NIC チームはデータを検査したり、チーム内の別のパスにデータをリダイレクトしたりすることはできません。

-   **ネイティブホストのサービス品質 (QoS)**。 ネイティブまたはホストシステムで QoS ポリシーを設定し、それらのポリシーが最小帯域幅制限を呼び出す場合、NIC チームの全体的なスループットは、帯域幅ポリシーが設定されていなくても小さくなります。

-   **TCP Chimney**。 Tcp chimney は、nic チーミングではサポートされていません。これは、TCP Chimney によってネットワークスタック全体が NIC に直接オフロードされるためです。

-   **802.1 x 認証**。 一部のスイッチでは、同じポートでの 802.1 X 認証と NIC チーミングの両方の構成が許可されていないため、NIC チーミングで 802.1 X 認証を使用しないでください。

Hyper-v ホスト上で実行される仮想マシン (Vm) 内で NIC チーミングを使用する方法については、「[ホストコンピューターまたは vm に新しい Nic チームを作成](Create-a-New-NIC-Team-on-a-Host-Computer-or-VM.md)する」を参照してください。

## <a name="virtual-machine-queues-vmqs"></a>仮想マシンキュー (VMQs)

VMQs は、各 VM のキューを割り当てる NIC 機能です。  Hyper-v が有効になっている場合また、VMQ を有効にする必要があります。 Windows Server 2016 では、VMQs は、同じ機能を提供するために、Vports に割り当てられた単一のキューで NIC スイッチ vPorts を使用します。

スイッチ構成モードと負荷分散アルゴリズムに応じて、NIC チーミングは、チーム内の任意のアダプター (最小キューモード) またはすべてのチームメンバー間で使用できるキューの総数 (キューの合計モード) のうち、使用可能なキューとサポートされるキューの数を表示します。

チームがスイッチに依存しないチーミングモードで、負荷分散を Hyper-v ポートモードまたは動的モードに設定している場合、報告されるキューの数は、チームメンバーが使用できるすべてのキューの合計 (キューの合計モード) になります。 それ以外の場合、報告されるキューの数は、チームのどのメンバーでもサポートされているキューの最小数 (最小キューモード) になります。

理由は次のとおりです。

-   スイッチに依存しないチームが Hyper-v ポートモードまたは動的モードである場合、Hyper-v スイッチポート (VM) の受信トラフィックは常に同じチームメンバーに到着します。 ホストは、特定の VM のトラフィックを受信するメンバーを予測/制御できます。これにより、NIC チーミングは、特定のチームメンバーに割り当てられる VMQ キューをより詳しく把握できます。 Hyper-v スイッチを使用している NIC チーミングは、正確に1つのチームメンバーで VM の VMQ を設定し、受信トラフィックがそのキューに到達することを認識します。

-   チームがスイッチ依存モード (静的なチーミングまたは LACP チーミング) になっている場合、チームが接続されているスイッチによって、受信トラフィックの分散が制御されます。 ホストの NIC チーミングソフトウェアは、VM の受信トラフィックを取得するチームメンバーを予測することはできません。また、スイッチがすべてのチームメンバーに対して VM のトラフィックを分散している可能性があります。 Hyper-v スイッチを使用している NIC チーミングソフトウェアの結果として、1つのチームメンバーだけでなく、すべてのチームメンバーで VM のキューがプログラムされます。

-   チームがスイッチに依存しないモードで、アドレスハッシュの負荷分散を使用する場合、受信トラフィックは常に1つの NIC (プライマリチームメンバー) に送信され、そのすべてが1つのチームメンバーに送られます。 他のチームメンバーは受信トラフィックを処理しないため、プライマリメンバーと同じキューを使用してプログラムを作成します。これにより、プライマリメンバーに障害が発生した場合に、他のチームメンバーを使用して受信トラフィックを取得できるようになり、キューが既に配置されます。

- ほとんどの Nic には、Receive Side Scaling (RSS) または VMQ のいずれかに使用されるキューがありますが、同時には使用されません。 一部の VMQ 設定は RSS キューの設定として表示されますが、現在使用されている機能に応じて RSS と VMQ の両方が使用する汎用キューの設定です。 各 NIC の詳細プロパティには、* RssBaseProcNumber と MaxRssProcessors の値が含ま \* れます。 次に、システムパフォーマンスを向上させる VMQ 設定をいくつか示します。

-   各 NIC は、* RssBaseProcNumber を2以上の偶数に設定するのが理想的です。 最初の物理プロセッサである Core 0 (論理プロセッサ0および 1) は、通常、ほとんどのシステム処理を実行するので、ネットワーク処理はこの物理プロセッサから離れている必要があります。 コンピューターのアーキテクチャによっては、物理プロセッサごとに2つの論理プロセッサが搭載されていないため、このようなコンピューターでは、ベースプロセッサが1以上である必要があります。 "インダウト" の場合は、ホストが物理プロセッサアーキテクチャごとに2つの論理プロセッサを使用していると仮定します。

-   チームがキューの合計モードである場合、チームメンバーのプロセッサは重複しないようにする必要があります。 たとえば、2つの 10 Gbps Nic のチームを持つ4コアホスト (8 個の論理プロセッサ) では、2の基本プロセッサを使用して4コアを使用するように最初のホストを設定できます。2つ目は、基本プロセッサ6を使用し、2コアを使用するように設定されています。

-   チームが最小キューモードである場合は、チームメンバーによって使用されるプロセッサセットが同一である必要があります。


## <a name="hyper-v-network-virtualization-hnv"></a>Hyper-V ネットワーク仮想化 (HNV)
NIC チーミングは、Hyper-v ネットワーク仮想化 (HNV) と完全に互換性があります。  HNV 管理システムは、nic チーミングが HNV トラフィックを最適化する方法で負荷を分散できるように、NIC チーミングドライバーに情報を提供します。

## <a name="live-migration"></a>ライブ マイグレーション
Vm の NIC チーミングはライブマイグレーションには影響しません。 VM で NIC チーミングを構成するかどうかにライブマイグレーションても、同じ規則が適用されます。


## <a name="virtual-local-area-networks-vlans"></a>仮想ローカルエリアネットワーク (Vlan)
NIC チーミングを使用する場合、複数のチームインターフェイスを作成すると、ホストは同時に異なる Vlan に接続できます。
次のガイドラインを使用して環境を構成します。

- NIC チーミングを有効にする前に、チーミングホストに接続されている物理スイッチポートでトランク (無作為検出) モードを使用するように構成します。 物理スイッチは、トラフィックを変更せずに、すべてのトラフィックをフィルター処理のためにホストに渡す必要があります。

- NIC の詳細プロパティの設定を使用して、Nic に VLAN フィルターを構成しないでください。 NIC チーミングソフトウェアまたは Hyper-v 仮想スイッチ (存在する場合) を使用して、VLAN フィルター処理を実行します。

### <a name="use-vlans-with-nic-teaming-in-a-vm"></a>VM で NIC チーミングを使用して Vlan を使用する
チームが Hyper-v 仮想スイッチに接続する場合、すべての VLAN 分離は、NIC チーミングではなく Hyper-v 仮想スイッチで実行する必要があります。

次のガイドラインを使用して、NIC チームで構成された VM で Vlan を使用することを計画します。

-    VM で複数の Vlan をサポートする場合は、Hyper-v 仮想スイッチ上の複数のポートを使用して VM を構成し、各ポートを VLAN に関連付ける方法をお勧めします。 VM でこれらのポートをチームにしないでください。これにより、ネットワーク通信の問題が発生します。

-    VM に複数の SR-IOV 仮想機能 (VFs) がある場合は、VM でそれらをチーミングする前に、それらが同じ VLAN 上にあることを確認してください。 さまざまな VFs を異なる Vlan に構成し、そのためにネットワーク通信の問題が発生するように構成することは簡単です。


### <a name="manage-network-interfaces-and-vlans"></a>ネットワークインターフェイスと Vlan の管理
ゲストオペレーティングシステムに複数の VLAN を公開する必要がある場合は、イーサネットインターフェイスの名前を変更して、インターフェイスに割り当てられている VLAN を明確にすることを検討してください。 たとえば、**イーサネット**インターフェイスを vlan 12 に、**イーサネット 2**インターフェイスを vlan 48 に関連付ける場合は、インターフェイスのイーサネットの名前を**EthernetVLAN12**に、もう一方を**EthernetVLAN48**に変更します。

Windows PowerShell コマンドの**名前変更 NetAdapter**を使用するか、次の手順を実行して、インターフェイスの名前を変更します。

1.  サーバーマネージャーの [名前を変更するネットワークアダプターの**プロパティ**] で、ネットワークアダプター名の右側にあるリンクをクリックします。

2.  名前を変更するネットワークアダプターを右クリックし、[名前の**変更**] を選択します。

3.  ネットワークアダプターの新しい名前を入力し、enter キーを押します。


## <a name="virtual-machines-vms"></a>仮想マシン (VM)

VM で NIC チーミングを使用する場合は、VM の仮想ネットワークアダプターを外部 Hyper-v 仮想スイッチにのみ接続する必要があります。 これにより、1つの仮想スイッチに接続されている物理ネットワークアダプターの1つが故障したり、切断されたりした場合でも、VM はネットワーク接続を維持できます。 内部またはプライベートの Hyper-v 仮想スイッチに接続されている仮想ネットワークアダプターは、チーム内にある場合、スイッチに接続できません。また、VM のネットワークに障害が発生します。

Windows Server 2016 の NIC チーミングでは、Vm に2つのメンバーを持つチームがサポートされています。 大規模なチームを作成できますが、大規模なチームはサポートされていません。 すべてのチームメンバーは、別の外部 Hyper-v 仮想スイッチに接続する必要があります。また、チーミングを許可するように VM のネットワークインターフェイスを構成する必要があります。


VM で NIC チームを構成する場合は、_スイッチに依存_しない**チーミングモード**と、_アドレスハッシュ_の**負荷分散モード**を選択する必要があります。


## <a name="sr-iov-capable-network-adapters"></a>Sr-iov 対応のネットワークアダプター
または Hyper-v ホストの下にある NIC チームは、Hyper-v スイッチを経由しないため、SR-IOV トラフィックを保護できません。  オプションを使用して、VM の NIC チーミング、外部の 2 つの HYPER-V 仮想スイッチを構成すると、それぞれ独自の SR IOV 対応 NIC に接続

![SR IOV 対応のネットワーク アダプターと NIC チーミング](../../media/NIC-Teaming-in-Virtual-Machines--VMs-/nict_in_vm.jpg)

各 VM は、SR-IOV Nic の1つまたは両方からの仮想機能 (VF) を持つことができます。また、NIC 切断が発生した場合は、プライマリ VF からバックアップアダプター (VF) にフェールオーバーします。 代わりに、VM には、NIC ドライバーと非 VF vmNIC が別の仮想スイッチに接続されているいずれかから VF 場合があります。 VF に関連付けられた NIC の接続が切断された場合、トラフィックには、接続を失うことがなく他のスイッチにフェールオーバーことができます。

VM 内の Nic 間のフェールオーバーによって、他の vmNIC の MAC アドレスを使用して送信されるトラフィックが発生する可能性があるため、NIC チーミングを使用して VM に関連付けられている各 Hyper-v 仮想スイッチポートは、チーミングを許可するように設定する必要があります。


## <a name="related-topics"></a>関連トピック

- [Nic チーミングの MAC アドレスの使用と管理](NIC-Teaming-MAC-Address-Use-and-Management.md): スイッチに依存しないモードで nic チームを構成し、ハッシュまたは動的な負荷分散のいずれかを行うと、チームは送信トラフィックでプライマリ NIC チームメンバーのメディアアクセス制御 (MAC) アドレスを使用します。 プライマリ NIC チームメンバーは、チームメンバーの初期セットからオペレーティングシステムによって選択されたネットワークアダプターです。

- [Nic チーミングの設定](nic-teaming-settings.md): このトピックでは、チーミングや負荷分散のモードなど、nic チームのプロパティの概要を説明します。 また、スタンバイアダプターの設定とプライマリチームインターフェイスのプロパティについても詳しく説明します。 NIC チームに少なくとも2つのネットワークアダプターがある場合は、フォールトトレランスのためにスタンバイアダプターを指定する必要はありません。

- [ホストコンピューターまたは vm に新しい Nic チームを作成](Create-a-New-NIC-Team-on-a-Host-Computer-or-VM.md)する: このトピックでは、Windows Server 2016 を実行しているホストコンピューターまたは hyper-v 仮想マシン (VM) に新しい nic チームを作成します。

- [Nic チーミングのトラブルシューティング](Troubleshooting-NIC-Teaming.md): このトピックでは、ハードウェア、物理スイッチのセキュリティ、Windows PowerShell を使用したネットワークアダプターの無効化または有効化など、nic チーミングのトラブルシューティングを行う方法について説明します。

