---
title: RAS ゲートウェイの展開アーキテクチャ
description: このトピックでは、Windows Server 2016 の RAS ゲートウェイのクラウドサービスプロバイダー (CSP) の展開について説明します。これには、RAS ゲートウェイプール、リフレクターのルーティング、個々のテナントに対する複数のゲートウェイのデプロイが含まれます。
manager: brianlic
ms.custom: na
ms.prod: windows-server
ms.reviewer: na
ms.suite: na
ms.technology: networking-sdn
ms.tgt_pltfrm: na
ms.topic: get-started-article
ms.assetid: d46e4e91-ece0-41da-a812-af8ab153edc4
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 7b3bd47052e482b562e84d5c44b928c0744b223c
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/27/2019
ms.locfileid: "71405918"
---
# <a name="ras-gateway-deployment-architecture"></a>RAS ゲートウェイの展開アーキテクチャ

>適用対象:Windows Server (半期チャネル)、Windows Server 2016

このトピックでは、ras ゲートウェイプール、リフレクターのルーティング、個々のテナント用の複数のゲートウェイの展開など、RAS ゲートウェイのクラウドサービスプロバイダー (CSP) の展開について説明します。  
  
以下のセクションでは、これらの機能をゲートウェイ展開の設計に使用する方法を理解できるように、RAS ゲートウェイの新機能の概要を説明します。  
  
また、新しいテナントの追加、同期とデータプレーンのルーティング、ゲートウェイとルートリフレクターのフェールオーバーなどのプロセスに関する情報など、デプロイの例も提供されています。  
  
このトピックは次のセクションで構成されます。  
  
-   [RAS ゲートウェイの新機能を使用して展開を設計する](#bkmk_new)  
  
-   [配置例](#bkmk_example)  
  
-   [新しいテナントと顧客アドレス (CA) 空間 EBGP ピアリングの追加](#bkmk_tenant)  
  
-   [ルートの同期とデータプレーンのルーティング](#bkmk_route)  
  
-   [ネットワークコントローラーと RAS ゲートウェイの応答、およびルートリフレクターのフェールオーバー](#bkmk_failover)  
  
-   [RAS ゲートウェイの新機能を使用する利点](#bkmk_advantages)  
  
## <a name="bkmk_new"></a>RAS ゲートウェイの新機能を使用して展開を設計する  
RAS ゲートウェイには、データセンターにゲートウェイインフラストラクチャを展開する方法を変更して改善する、複数の新機能が含まれています。  
  
### <a name="bgp-route-reflector"></a>BGP ルートリフレクター  
Border Gateway Protocol (BGP) ルートリフレクター機能が RAS ゲートウェイに含まれるようになりました。これは、通常、ルーター間のルート同期に必要な BGP 完全メッシュトポロジの代替手段となります。 完全メッシュ同期では、すべての BGP ルーターがルーティングトポロジ内の他のすべてのルーターと接続する必要があります。 ただし、ルートリフレクターを使用する場合、ルートリフレクターは、BGP ルートリフレクタークライアントと呼ばれる他のすべてのルーターと接続する唯一のルーターです。これにより、ルートの同期が簡素化され、ネットワークトラフィックが減少します。 ルートリフレクターは、すべてのルートを学習し、最適なルートを計算し、その BGP クライアントに最適なルートを再分配します。  
  
詳細については、「 [RAS ゲートウェイの新機能](../../../sdn/technologies/network-function-virtualization/What-s-New-in-RAS-Gateway.md)」を参照してください。  
  
### <a name="bkmk_pools"></a>ゲートウェイプール  
Windows Server 2016 では、さまざまな種類のゲートウェイプールを多数作成できます。 ゲートウェイプールには、RAS ゲートウェイのインスタンスが多数含まれており、物理ネットワークと仮想ネットワークの間でネットワークトラフィックをルーティングします。  
  
詳細については、「RAS ゲートウェイと[Ras ゲートウェイの高可用性](../../../sdn/technologies/network-function-virtualization/RAS-Gateway-High-Availability.md)の[新機能](../../../sdn/technologies/network-function-virtualization/What-s-New-in-RAS-Gateway.md)」を参照してください。  
  
### <a name="bkmk_gps"></a>ゲートウェイプールのスケーラビリティ  
プール内のゲートウェイ Vm を追加または削除することで、ゲートウェイプールを簡単にスケールアップまたはスケールダウンできます。 ゲートウェイを削除または追加しても、プールによって提供されるサービスは中断されません。 また、ゲートウェイのプール全体を追加および削除することもできます。  
  
詳細については、「RAS ゲートウェイと[Ras ゲートウェイの高可用性](../../../sdn/technologies/network-function-virtualization/RAS-Gateway-High-Availability.md)の[新機能](../../../sdn/technologies/network-function-virtualization/What-s-New-in-RAS-Gateway.md)」を参照してください。  
  
### <a name="bkmk_m"></a>M + N ゲートウェイプールの冗長性  
すべてのゲートウェイプールは M + N 冗長です。 これは、"m" 個のアクティブなゲートウェイ Vm が、"N" 個のスタンバイゲートウェイ Vm によってバックアップされることを意味します。 M + N 冗長性を使用すると、RAS ゲートウェイを展開するときに必要な信頼性レベルを柔軟に決定できます。  
  
詳細については、「RAS ゲートウェイと[Ras ゲートウェイの高可用性](../../../sdn/technologies/network-function-virtualization/RAS-Gateway-High-Availability.md)の[新機能](../../../sdn/technologies/network-function-virtualization/What-s-New-in-RAS-Gateway.md)」を参照してください。  
  
## <a name="bkmk_example"></a>配置例  
次の図は、2つのテナント (Contoso と Woodgrove) と Fabrikam CSP データセンター間で構成されたサイト間 VPN 接続を介した eBGP ピアリングの例を示しています。  
  
![サイト間 VPN 経由の eBGP ピアリング](../../../media/RAS-Gateway-Deployment-Architecture/ras_gateway_architecture.png)  
  
この例では、Contoso は追加のゲートウェイ帯域幅を必要としており、ゲートウェイインフラストラクチャの設計上、GW2 ではなく GW3 上の Contoso ロサンゼルスサイトを終了するように決定します。 このため、異なるサイトからの Contoso VPN 接続は、2つの異なるゲートウェイの CSP データセンターで終了します。  
  
これらのゲートウェイ (GW2 と GW3) はどちらも、CSP が Contoso と Woodgrove のテナントをインフラストラクチャに追加したときにネットワークコントローラーによって構成された最初の RAS ゲートウェイでした。 このため、これらの2つのゲートウェイは、これらの対応する顧客 (またはテナント) のルートリフレクターとして構成されます。 GW2 は Contoso Route リフレクターで、GW3 は Woodgrove Route リフレクターであり、Contoso ロサンゼルスの本社サイトとの VPN 接続用の CSP RAS ゲートウェイの終了ポイントでもあります。  
  
> [!NOTE]  
> 1つの RAS ゲートウェイは、各テナントの帯域幅要件に応じて、最大100の異なるテナントについて、仮想ネットワークと物理ネットワークのトラフィックをルーティングできます。  
  
ルートリフレクターとして、GW2 は Contoso CA 空間ルートをネットワークコントローラーに送信し、GW3 は Woodgrove CA 空間ルートをネットワークコントローラーに送信します。  
  
ネットワークコントローラーは、Hyper-v ネットワーク仮想化ポリシーを Contoso および Woodgrove の仮想ネットワークにプッシュします。また、ras のポリシーと、ソフトウェアの負荷分散として構成されている Multiplexers ((MUXes) に対して、RAS ゲートウェイおよび負荷分散ポリシーをプッシュします。管理.  
  
## <a name="bkmk_tenant"></a>新しいテナントと顧客アドレス (CA) 空間 eBGP ピアリングの追加  
新しい顧客に署名し、データセンターに新しいテナントとして顧客を追加する場合、次のプロセスを使用できます。その多くは、ネットワークコントローラーと RAS ゲートウェイ eBGP ルーターによって自動的に実行されます。  
  
1.  テナントの要件に従って、新しい仮想ネットワークとワークロードをプロビジョニングします。  
  
2.  必要に応じて、リモートテナントのエンタープライズサイトと、データセンターの仮想ネットワークとの間のリモート接続を構成します。 テナントのサイト間 VPN 接続を展開すると、使用可能なゲートウェイプールから使用可能な RAS ゲートウェイ VM がネットワークコントローラーによって自動的に選択され、接続が構成されます。  
  
3.  新しいテナント用に RAS ゲートウェイ VM を構成するときに、ネットワークコントローラーは、RAS ゲートウェイを BGP ルーターとして構成し、テナントのルートリフレクターとして指定します。 これは、RAS ゲートウェイがゲートウェイとして機能する場合や、ゲートウェイやルートリフレクターとして他のテナントに対して機能する場合にも当てはまります。  
  
4.  静的に構成されたネットワークまたは動的 BGP ルーティングを使用するように CA スペースルーティングが構成されているかどうかに応じて、ネットワークコントローラーは、対応する静的ルート、BGP 近隣ノード、またはその両方を RAS ゲートウェイ VM とルートリフレクターに構成します。  
  
    > [!NOTE]  
    > -   ネットワークコントローラーが、テナントに対して RAS ゲートウェイとルートリフレクターを構成した後、同じテナントが新しいサイト間 VPN 接続を必要とする場合、ネットワークコントローラーは、この RAS ゲートウェイ VM で使用可能な容量を確認します。 元のゲートウェイが必要な容量を処理できる場合は、同じ RAS ゲートウェイ VM で新しいネットワーク接続も構成されます。 RAS ゲートウェイ VM が追加の容量を処理できない場合、ネットワークコントローラーは使用可能な新しい RAS ゲートウェイ VM を選択し、新しい接続を構成します。 テナントに関連付けられているこの新しい RAS ゲートウェイ VM は、元のテナント RAS ゲートウェイルートリフレクターのルートリフレクタークライアントになります。  
    > -   RAS ゲートウェイプールはソフトウェアロードバランサー (SLBs) の背後にあるため、テナントのサイト間 VPN アドレスは、仮想 IP アドレス (VIP) と呼ばれる単一のパブリック IP アドレスを使用します。これは、SLBs によってデータセンター内部 IP アドレスに変換されます。エンタープライズテナントのトラフィックをルーティングする RAS ゲートウェイ用の動的 IP アドレス (DIP)。 SLB によるこのパブリック IP アドレスのマッピングにより、エンタープライズサイトと CSP RAS ゲートウェイおよびルートリフレクターの間でサイト間 VPN トンネルが正しく確立されます。  
    >   
    >     SLB、Vip、Dip の詳細については、「[ソフトウェア負荷&#40;分散&#41; slb for SDN](../../../sdn/technologies/network-function-virtualization/Software-Load-Balancing--SLB--for-SDN.md)」を参照してください。  
  
5.  エンタープライズサイト間のサイト間 VPN トンネルが新しいテナントに対して確立されると、トンネルに関連付けられている静的ルートは、トンネルのエンタープライズと CSP の両方の側で自動的にプロビジョニングされます.  
  
6.  CA スペース BGP ルーティングを使用すると、エンタープライズサイトと CSP RAS ゲートウェイルートリフレクター間の eBGP ピアリングも確立されます。  
  
## <a name="bkmk_route"></a>ルートの同期とデータプレーンのルーティング  
エンタープライズサイトと CSP RAS ゲートウェイルートリフレクターの間に eBGP ピアリングが確立されると、ルートリフレクターは動的な BGP ルーティングを使用してすべてのエンタープライズルートを学習します。 ルートリフレクターは、すべてのルートリフレクタークライアント間でこれらのルートを同期して、すべてが同じルートセットで構成されるようにします。  
  
また、ルートリフレクターは、ルート同期を使用して、これらの統合ルートをネットワークコントローラーに更新します。 その後、ネットワークコントローラーは、ルートを Hyper-v ネットワーク仮想化ポリシーに変換し、エンドツーエンドのデータパスルーティングが確実にプロビジョニングされるようにファブリックネットワークを構成します。 このプロセスにより、テナントのエンタープライズサイトからテナントの仮想ネットワークにアクセスできるようになります。  
  
データプレーンルーティングでは、必要なルートがすべての参加している RAS ゲートウェイ Vm で利用できるようになるため、RAS ゲートウェイ Vm にアクセスするパケットは、テナントの仮想ネットワークに直接ルーティングされます。  
  
同様に、Hyper-v ネットワーク仮想化ポリシーが適用されている場合、テナント仮想ネットワークは、パケットを (ルートリフレクターについて認識する必要なく) 直接 RAS ゲートウェイ Vm にルーティングしてから、サイト間 VPN トンネルを介してエンタープライズサイトにルーティングします.  
  
さらに。 テナント仮想ネットワークからリモートテナントエンタープライズサイトへのトラフィックの返送は、Direct Server Return (DSR) と呼ばれるプロセスである SLBs をバイパスします。  
  
## <a name="bkmk_failover"></a>ネットワークコントローラーと RAS ゲートウェイの応答、およびルートリフレクターのフェールオーバー  
次の2つのフェールオーバーシナリオが考えられます。1つは RAS ゲートウェイルートリフレクタークライアント、もう1つは RAS ゲートウェイルートリフレクター用、もう1つはネットワークコントローラーがいずれかの構成で Vm のフェールオーバーを処理する方法に関する情報を含みます。  
  
### <a name="vm-failure-of-a-ras-gateway-bgp-route-reflector-client"></a>RAS ゲートウェイの BGP ルートリフレクタークライアントの VM エラー  
ネットワークコントローラーは、RAS ゲートウェイルートリフレクタークライアントで障害が発生した場合に、次の操作を実行します。  
  
> [!NOTE]  
> RAS ゲートウェイがテナントの BGP インフラストラクチャのルートリフレクターでない場合は、テナントの BGP インフラストラクチャ内のルートリフレクタークライアントになります。  
  
-   ネットワークコントローラーは、使用可能なスタンバイ RAS ゲートウェイ VM を選択し、障害が発生した RAS ゲートウェイ VM の構成を使用して新しい RAS ゲートウェイ vm をプロビジョニングします。  
  
-   ネットワークコントローラーは、対応する SLB 構成を更新して、テナントサイトから障害が発生した RAS ゲートウェイへのサイト間 VPN トンネルが、新しい RAS ゲートウェイで正しく確立されるようにします。  
  
-   ネットワークコントローラーは、新しいゲートウェイで BGP ルートリフレクタークライアントを構成します。  
  
-   ネットワークコントローラーは、新しい RAS ゲートウェイの BGP ルートリフレクタークライアントをアクティブとして構成します。 RAS ゲートウェイは、ルーティング情報を共有し、対応するエンタープライズサイトで eBGP ピアリングを有効にするために、テナントのルートリフレクターとのピアリングを直ちに開始します。  
  
### <a name="vm-failure-for-a-ras-gateway-bgp-route-reflector"></a>RAS ゲートウェイの BGP ルートリフレクターの VM エラー  
ネットワークコントローラーは、RAS ゲートウェイの BGP ルートリフレクターに障害が発生すると、次の操作を実行します。  
  
-   ネットワークコントローラーは、使用可能なスタンバイ RAS ゲートウェイ VM を選択し、障害が発生した RAS ゲートウェイ VM の構成を使用して新しい RAS ゲートウェイ vm をプロビジョニングします。  
  
-   ネットワークコントローラーは、新しい RAS ゲートウェイ VM でルートリフレクターを構成し、障害が発生した VM によって使用されていたのと同じ IP アドレスを新しい VM に割り当てます。これにより、VM の障害が発生した場合でもルートの整合性が提供されます。  
  
-   ネットワークコントローラーは、対応する SLB 構成を更新して、テナントサイトから障害が発生した RAS ゲートウェイへのサイト間 VPN トンネルが、新しい RAS ゲートウェイで正しく確立されるようにします。  
  
-   ネットワークコントローラーは、新しい RAS ゲートウェイの BGP ルートリフレクター VM をアクティブとして構成します。  
  
-   ルートリフレクターがすぐにアクティブになります。 エンタープライズへのサイト間 VPN トンネルが確立され、ルートリフレクターは eBGP ピアリングを使用して、エンタープライズサイトルーターとルートを交換します。  
  
-   BGP ルートを選択した後、RAS ゲートウェイの BGP ルートリフレクターは、データセンター内のテナントルートリフレクタークライアントを更新し、ネットワークコントローラーとのルートを同期して、エンドツーエンドのデータパスをテナントトラフィックに使用できるようにします。  
  
## <a name="bkmk_advantages"></a>RAS ゲートウェイの新機能を使用する利点  
RAS ゲートウェイの展開を設計するときに、これらの新しい RAS ゲートウェイ機能を使用する利点をいくつか次に示します。  
  
**RAS ゲートウェイのスケーラビリティ**  
  
Ras ゲートウェイプールに必要な数の RAS ゲートウェイ Vm を追加できるため、ras ゲートウェイの展開を簡単に拡張して、パフォーマンスと容量を最適化することができます。 プールに Vm を追加すると、任意の種類 (IKEv2、L3、GRE) のサイト間 VPN 接続を使用して、これらの RAS ゲートウェイを構成できます。これにより、ダウンタイムなしで容量のボトルネックが解消されます。  
  
**エンタープライズサイトゲートウェイの管理の簡素化**  
  
テナントに複数のエンタープライズサイトがある場合、テナントは、1つのリモートサイト間 VPN IP アドレスと1つのリモート近隣 IP アドレス (CSP datacenter RAS ゲートウェイ BGP Route リフレクター VIP) を持つすべてのサイトを、そのテナントに対して構成できます。 これにより、テナントのゲートウェイ管理が簡単になります。  
  
**ゲートウェイエラーの迅速な修復**  
  
高速フェールオーバー応答を実現するには、エッジルートと制御ルーターの間の BGP Keepalive パラメーターの時間を短い時間間隔 (10 秒以下) に構成できます。 この短いキープアライブ間隔では、RAS ゲートウェイの BGP エッジルーターで障害が発生すると、エラーがすぐに検出され、ネットワークコントローラーは前のセクションで説明した手順に従います。 この利点により、双方向転送検出 (BFD) プロトコルなど、個別の障害検出プロトコルの必要性が軽減される可能性があります。  
  
 
  


