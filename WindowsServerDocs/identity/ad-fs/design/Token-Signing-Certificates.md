---
ms.assetid: 98c5ef45-2bcb-4f87-86c8-5ac6c16a6097
title: トークン署名証明書
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adfs
ms.openlocfilehash: 24b095827ad074dbe249a9d4decd8edeecbb3603
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/08/2020
ms.locfileid: "80858785"
---
# <a name="token-signing-certificates"></a>トークン署名証明書

フェデレーションサーバーでは、フェデレーションリソースへの不正アクセスを試みるために攻撃者がセキュリティトークンを変更または偽造するのを防ぐために、トークン\-署名証明書が必要です。 トークン\-署名証明書で使用されるプライベート\/公開キーの組み合わせは、フェデレーションパートナーシップの最も重要な検証メカニズムです。これらのキーは、有効なパートナーフェデレーションサーバーによってセキュリティトークンが発行されたこと、および転送中にトークンが変更されていないことを確認するためです。  
  
## <a name="token-signing-certificate-requirements"></a>トークン\-署名証明書の要件  
AD FS を使用するには、署名証明書\-署名証明書が次の要件を満たしている必要があります。  
  
-   トークン\-署名証明書がセキュリティトークンに正常に署名するには、署名証明書\-署名証明書に秘密キーが含まれている必要があります。  
  
-   AD FS サービスアカウントは、ローカルコンピューターの個人用ストアにある署名証明書の秘密キー\-トークンにアクセスできる必要があります。 この処理は、セットアップによって行われます。 また、の AD FS 管理スナップ\-を使用して、後でトークン\-署名証明書を変更した場合にこのアクセスを確認することもできます。  
  
> [!NOTE]  
> これは、PKI\) ベストプラクティス \(、複数の目的で秘密キーを共有しないことをお勧めします。 このため、署名証明書\-トークンとしてフェデレーションサーバーにインストールしたサービス通信証明書は使用しないでください。  
  
## <a name="how-token-signing-certificates-are-used-across-partners"></a>トークン\-署名証明書をパートナー間で使用する方法  
すべてのトークン\-署名証明書には、セキュリティトークン\) 秘密キーによって \(にデジタル署名するために使用される暗号化秘密キーと公開キーが含まれています。 後で、パートナーフェデレーションサーバーによって受信された後、これらのキーは、暗号化されたセキュリティトークンの公開キー\) を通じて、信頼性の \(を検証します。  
  
各セキュリティ トークンにはアカウント パートナーによってデジタル署名が付加されるため、リソース パートナーはセキュリティ トークンが実際にアカウント パートナーによって発行され、変更されていないことを確認できます。 デジタル署名は、署名証明書\-、パートナーのトークンの公開キー部分によって検証されます。 署名が検証されると、リソースフェデレーションサーバーはその組織に対して独自のセキュリティトークンを生成し、それ自体のトークン\-署名証明書を使用してセキュリティトークンに署名します。  
  
フェデレーションパートナー環境では、トークン\-署名証明書が CA によって発行されている場合は、次のことを確認してください。  
  
1.  証明書失効リスト \(証明書の\) Crl は、証明書利用者とフェデレーションサーバーを信頼する Web サーバーにアクセスできます。  
  
2.  ルート CA 証明書は、フェデレーションサーバーを信頼する証明書利用者と Web サーバーによって信頼されています。  
  
リソースパートナーの Web サーバーは、トークン\-署名証明書の公開キーを使用して、セキュリティトークンがリソースフェデレーションサーバーによって署名されていることを確認します。 その後、Web サーバーがクライアントに適切にアクセスできるようになります。  
  
## <a name="deployment-considerations-for-token-signing-certificates"></a>トークン\-署名証明書の展開に関する考慮事項  
新しい AD FS インストールで最初のフェデレーションサーバーを展開する場合は、署名証明書\-のトークンを取得して、そのフェデレーションサーバーのローカルコンピューターの個人証明書ストアにインストールする必要があります。 トークン\-署名証明書を取得するには、エンタープライズ CA またはパブリック CA から証明書を要求するか、自己\-署名された証明書を作成します。  
  
AD FS ファームをデプロイすると、サーバーファームの作成方法に応じて、トークン\-署名証明書が異なる方法でインストールされます。  
  
デプロイの証明書\-署名証明書を取得するときに考慮できるサーバーファームオプションは2つあります。  
  
-   1つのトークン\-署名証明書の秘密キーは、ファーム内のすべてのフェデレーションサーバー間で共有されます。  
  
    フェデレーションサーバーファーム環境では、すべてのフェデレーションサーバーが \(を共有するか、同じトークン\-署名証明書\) 再利用することをお勧めします。 発行された証明書がエクスポート可能としてマークされている限り、フェデレーションサーバーの CA から証明書\-署名証明書を1つのトークンにインストールし、秘密キーをエクスポートすることができます。  
  
    次の図に示すように、1つのトークン\-署名証明書の秘密キーは、ファーム内のすべてのフェデレーションサーバーに共有できます。 このオプションは、次の [一意のトークン\-署名証明書] オプションと比較して、パブリック CA から署名証明書\-トークンを取得する予定がある場合にコストを削減します。  
  
![トークン署名](media/adfs2_fedserver_certstory_3.gif)  
  
-   ファーム内の各フェデレーションサーバーの署名証明書\-一意のトークンがあります。  
  
    ファーム全体で一意の証明書を複数使用する場合、ファーム内の各サーバーは独自の一意の秘密キーを使用してトークンに署名します。  
  
    次の図に示すように、ファーム内の1つのフェデレーションサーバーごとに、署名証明書\-別のトークンを取得できます。 このオプションは、パブリック CA から証明書\-署名するトークンを取得する場合に、よりコストが高くなります。  
  
![トークン署名](media/adfs2_fedserver_certstory_4.gif)  
  
Microsoft 証明書サービスをエンタープライズ CA として使用する場合の証明書のインストールの詳細については、「iis [7.0: iis 7.0 でドメインサーバー証明書を作成](https://go.microsoft.com/fwlink/?LinkId=108548)する」を参照してください。  
  
パブリック CA から証明書をインストールする方法の詳細については、「 [IIS 7.0: 要求のインターネットサーバー証明書](https://go.microsoft.com/fwlink/?LinkId=108549)」を参照してください。  
  
自己\-署名入り証明書のインストールの詳細については、「 [iis 7.0: iis 7.0 で自己\-署名付きサーバー証明書を作成する](https://go.microsoft.com/fwlink/?LinkID=108271)」を参照してください。  
  
## <a name="see-also"></a>参照
[Windows Server 2012 での AD FS 設計ガイド](AD-FS-Design-Guide-in-Windows-Server-2012.md)
