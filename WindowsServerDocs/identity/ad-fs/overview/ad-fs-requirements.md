---
ms.assetid: 28f4a518-1341-4a10-8a4e-5f84625b314b
title: AD FS 2016 の要件
description: Active Directory フェデレーション サービス (AD FS) をインストールするための要件。
author: billmath
ms.author: billmath
manager: mtillman
ms.date: 03/06/2018
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adfs
ms.openlocfilehash: a2f4c9ac05e72083fab3e3a926dbdd2876214a7b
ms.sourcegitcommit: 3a3d62f938322849f81ee9ec01186b3e7ab90fe0
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2020
ms.locfileid: "77517537"
---
# <a name="ad-fs-requirements"></a>AD FS の要件



AD FS をデプロイするための要件を次に示します。  
  
-   5\. コマンド プロンプトで、「[ipconfig /all](ad-fs-requirements.md#BKMK_1)」と入力して Enter キーを押します。  
  
-   [ハードウェア要件](ad-fs-requirements.md#BKMK_2)  
  
-   [プロキシの要件](ad-fs-requirements.md#BKMK_3)  
  
-   [AD DS の要件](ad-fs-requirements.md#BKMK_4)  
  
-   [構成データベースの要件](ad-fs-requirements.md#BKMK_5)  
  
-   [ブラウザーの要件](ad-fs-requirements.md#BKMK_6)  

-   [ネットワーク要件](ad-fs-requirements.md#BKMK_7)  
  
-   [アクセス許可の要件](ad-fs-requirements.md#BKMK_13)  
  
## <a name="certificate-requirements"></a><a name="BKMK_1"></a>証明書の要件  
  
### <a name="ssl-certificates"></a>SSL 証明書

各 AD FS および Web アプリケーション プロキシ サーバーには、フェデレーション サービスへの HTTPS 要求を処理する SSL 証明書があります。  Web アプリケーション プロキシには、発行されたアプリケーションへの要求を処理するための追加の SSL 証明書をインストールすることができます。

**推奨事項:** すべての AD FS フェデレーション サーバーと Web アプリケーション プロキシに同じ SSL 証明書を使用します。 

**要件:**

フェデレーション サーバーの SSL 証明書は、次の要件を満たしている必要があります。
- 証明書が公的に信頼されています (運用環境のデプロイの場合)
- 証明書にサーバー認証の拡張キー使用法 (EKU) の値が含まれています
- サブジェクトまたはサブジェクトの別名 (SAN) に "fs.contoso.com" などのフェデレーション サービス名が証明書に含まれています
- ポート 443 でのユーザー証明書認証の場合、証明書に SAN の "certauth.fs.contoso.com" などの "certauth.\<federation service name\>" が含まれています
- デバイスの登録、または Windows 10 より前のクライアントを使用したオンプレミス リソースへの先進認証の場合、SAN には、組織で使用されている各 UPN サフィックスの "enterpriseregistration.\<upn suffix\>" が含まれている必要があります。

Web アプリケーション プロキシの SSL 証明書は、次の要件を満たしている必要があります
- プロキシを使用して Windows 統合認証を使用する AD FS 要求をプロキシする場合、プロキシ SSL 証明書はフェデレーション サーバーの SSL 証明書と同じである (同じキーを使用している) 必要があります
- AD FS プロパティ "ExtendedProtectionTokenCheck" が有効な場合 (AD FS の既定の設定)、プロキシ SSL 証明書はフェデレーション サーバーの SSL 証明書と同じである (同じキーを使用している) 必要があります
- それ以外の場合、プロキシ SSL 証明書の要件は、フェデレーション サーバーの SSL 証明書の要件と同じです

### <a name="service-communication-certificate"></a>サービス通信証明書
この証明書は、Azure AD や Office 365 を含むほとんどの AD FS シナリオでは必要ありません。 既定で、AD FS では、初期の構成時に提供される SSL 証明書がサービス通信証明書として構成されます。

**推奨事項:**
- SSL に使用するものと同じ証明書を使用します。  

### <a name="token-signing-certificate"></a>トークン署名証明書
この証明書は、証明書利用者に発行されたトークンに署名するために使用されるため、証明書利用者アプリケーションでは、証明書とそれに関連付けられたキーを既知で信頼できるものとして認識する必要があります。 有効期限が切れたときなど、トークン署名証明書が変更されたときに、新しい証明書を構成すると、すべての証明書利用者を更新する必要があります。

**推奨事項:** AD FS の既定である、内部生成された自己署名トークン署名証明書を使用します。  

**要件:**
- 組織で、エンタープライズ PKI からの証明書をトークン署名に使用する必要がある場合、Install-AdfsFarm コマンドレットの SigningCertificateThumbprint パラメーターを使用してこれを行うことができます。
- 既定の内部生成された証明書を使用する場合、または外部登録された証明書を使用する場合のいずれでも、トークン署名証明書が変更されるときに、新しい証明書情報ですべての証明書利用者が更新されるようにする必要があります。  そうしないと、更新されていない証明書利用者へのログオンは失敗します。

### <a name="token-encryptingdecrypting-certificate"></a>トークン暗号化および暗号化解除証明書
この証明書は、AD FS に対して発行されたトークンを暗号化する要求プロバイダーによって使用されます。

**推奨事項:** AD FS の既定である、内部生成された自己署名トークン暗号化解除の証明書を使用します。  

**要件:**
- 組織で、エンタープライズ PKI からの証明書をトークン署名に使用する必要がある場合、Install-AdfsFarm コマンドレットの DecryptingCertificateThumbprint パラメーターを使用してこれを行うことができます。
- 既定の内部生成された証明書を使用する場合、または外部登録された証明書を使用する場合のいずれでも、トークン暗号化解除証明書が変更されるときに、新しい証明書情報ですべての要求プロバイダーが更新されるようにする必要があります。  そうしないと、更新されていない要求プロバイダーを使用したログオンは失敗します。
  
> [!CAUTION]  
> 証明書のうち、トークン署名やトークン暗号化解除および暗号化に使用されるものは、フェデレーション サービスの安定性を左右します。 独自のトークン署名と、トークン暗号化解除および暗号化を管理するお客様は、これらの証明書がバックアップされ、回復イベントの発生時に個別に使用できることを確認する必要があります。  

### <a name="user-certificates"></a>ユーザー証明書
- AD FS で x509 ユーザー証明書認証を使用する場合、すべてのユーザー証明書は、AD FS および Web アプリケーション プロキシ サーバーから信頼されているルート証明機関までチェーンする必要があります。

## <a name="hardware-requirements"></a><a name="BKMK_2"></a>ハードウェア要件  
AD FS および Web アプリケーション プロキシのハードウェア要件 (物理または仮想) は CPU に左右されいるため、処理能力に合わせてファームのサイズを調整する必要があります。  
- [AD FS 2016 容量計画スプレッドシート](http://adfsdocs.blob.core.windows.net/adfs/ADFSCapacity2016.xlsx)を使用して、必要な AD FS および Web アプリケーション プロキシ サーバーの数を決定します。

AD FS のメモリとディスクの要件はほとんど静的です。次の表を参照してください。


|**ハードウェア要件**|**最小要件**|**推奨要件**|
|----- | ----- |-----|
|RAM|2 GB|4 GB |
|ディスク領域|32 GB|100 GB |

**SQL Server のハードウェア要件**

AD FS 構成データベースに SQL Server を使用している場合は、SQL Server の最も基本的な推奨事項に従って SQL Server のサイズを変更します。  AD FS データベースのサイズは非常に小さく、AD FS によってデータベース インスタンスに大きな処理負荷がかかることはありません。  ただし、AD FS は認証時にデータベースに複数回接続するので、ネットワーク接続を堅牢にする必要があります。  残念ながら、AD FS 構成データベースの SQL Azure はサポートされていません。
  
## <a name="proxy-requirements"></a><a name="BKMK_3"></a>プロキシの要件  
  
-   エクストラネット アクセスの場合は、リモート アクセス サーバー ロールの一部である Web アプリケーション プロキシ ロール サービスをデプロイする必要があります。 

-   サード パーティのプロキシでは、AD FS プロキシとしてサポートされる [MS-ADFSPIP プロトコル](https://msdn.microsoft.com/library/dn392811.aspx)がサポートされている必要があります。  サード パーティ ベンダーの一覧については、[FAQ](AD-FS-FAQ.md) に関する記事を参照してください。

-   AD FS 2016 には、Windows Server 2016 上の Web アプリケーション プロキシ サーバーが必要です。  2016 ファームの動作レベルで実行されている AD FS 2016 ファームには、ダウンレベル プロキシを構成できません。
  
-   フェデレーション サーバーと Web アプリケーション プロキシのロール サービスを同じコンピューターにインストールすることはできません。  
  
## <a name="ad-ds-requirements"></a><a name="BKMK_4"></a>AD DS の要件  
**ドメイン コントローラーの要件**  
  
- AD FS には、Windows Server 2008 以降を実行しているドメイン コントローラーが必要です。

- Microsoft Passport for Work には、少なくとも 1 つの Windows Server 2016 ドメイン コントローラーが必要です。
  
> [!NOTE]  
> Windows Server 2003 ドメイン コントローラーを使用する環境のすべてのサポートが終了しました。 Microsoft サポートのライフサイクルの詳細については、[このページ](https://support.microsoft.com/lifecycle/search/default.aspx?sort=PN&alpha=Windows+Server+2003&Filter=FilterNO)を参照してください。  
  
**ドメインの機能レベルの要件**  
  
 - すべてのユーザー アカウント ドメインと AD FS サーバーが参加しているドメインは、Windows Server 2003 以降のドメインの機能レベルで動作している必要があります。  
  
 - クライアント証明書が AD DS のユーザーのアカウントに明示的にマップされている場合、その証明書の認証には Windows Server 2008 のドメイン機能レベル以上が必要です。  
  
**スキーマの要件**  
  
-   AD FS 2016 の新規インストールには、Active Directory 2016 スキーマ (最小バージョン 85) が必要です。

-   AD FS ファームの動作レベル (FBL) を 2016 レベルに上げるには、Active Directory 2016 スキーマ (最小バージョン 85) が必要です。  

  
**サービス アカウントの要件**  
  
-   任意の標準ドメイン アカウントを AD FS のサービス アカウントとして使用できます。 グループのマネージド サービス アカウントもサポートされています。 AD FS を構成するときに、実行時に必要なアクセス許可が自動的に追加されます。

-   AD サービス アカウントに必要な [ユーザー権利の割り当て] は、[サービスとしてログオン] です。

-   'NT Service\adfssrv' と 'NT Service\drs' に必要な [ユーザー権利の割り当て] は、[セキュリティ監査の生成] と [サービスとしてログオン] です。

-   グループのマネージド サービス アカウントには、Windows Server 2012 以降を実行しているドメイン コントローラーが少なくとも 1 つ必要です。  GMSA は、既定の 'CN=Managed Service Accounts' コンテナー以下に存在する必要があります。  

-   Kerberos 認証の場合、サービス プリンシパル名 '`HOST/<adfs\_service\_name>`' が AD FS サービス アカウントに登録されている必要があります。 既定では、新しい AD FS ファームを作成するときに AD FS によってこれが構成されます。  これが失敗すると (衝突やアクセス許可不足の場合など)、警告が表示され、手動で追加する必要があります。  
   
**ドメインの要件**  
  
-   すべての AD FS サーバーは、AD DS ドメインに参加している必要があります。  
  
-   ファーム内のすべての AD FS サーバーを同じドメインにデプロイする必要があります。  
   
**複数フォレストの要件**  
  
-   AD FS サーバーが参加しているドメインは、AD FS サービスに対して認証を行うユーザーを含むすべてのドメインまたはフォレストを信頼する必要があります。  

-   AD FS サービス アカウントがメンバーであるフォレストは、すべてのユーザー ログイン フォレストを信頼する必要があります。 
  
-   AD FS サービス アカウントには、AD FS サービスに対して認証を行うユーザーを含むすべてのドメインのユーザー属性を読み取るアクセス許可が必要です。  
  
## <a name="configuration-database-requirements"></a><a name="BKMK_5"></a>構成データベースの要件  
このセクションでは、Windows Internal Database (WID) または SQL Server をデータベースとしてそれぞれ使用する AD FS ファームの要件と制限について説明します。  
  
**WID**  
  
-   SAML 2.0 のアーティファクト解決プロファイルは、WID ファームではサポートされていません。    

-   トークン リプレイ検出は、WID ファームではサポートされていません (AD FS がフェデレーション プロバイダーとして機能し、外部要求プロバイダーからセキュリティ トークンを使用するシナリオでのみ、この機能が使用されます)。  
  
WID と SQL Server ファームでサポートされている AD FS サーバーの数の概要を次の表に示します。    
  
  
|| AD FS で構成された 1 から 100 個の証明書利用者 (RP) 信頼 | 構成された 100 個を超える RP 信頼  |
| --- |--- | --- |
|1 から 30 台の AD FS サーバー|WID でサポートされる|WID を使用してサポートされない - SQL Server が必要 |
|30 台を超える AD FS サーバー|WID を使用してサポートされない - SQL Server が必要|WID を使用してサポートされない - SQL Server が必要  
  
**SQL Server**  
  
- Windows Server 2016 の AD FS では、SQL Server 2008 以降のバージョンがサポートされています。

- SQL Server ファームでは、SAML アーティファクト解決とトークン リプレイ検出の両方がサポートされています。  
  
## <a name="browser-requirements"></a><a name="BKMK_6"></a>ブラウザーの要件  
ブラウザーまたはブラウザー コントロールを介して AD FS 認証を実行する場合、ブラウザーは次の要件を満たしている必要があります。  
  
- JavaScript を有効にする必要があります  
  
- シングル サインオンの場合、Cookie を許可するようにクライアント ブラウザーを構成する必要があります  
  
- Server Name Indication (\(SNI\)) をサポートする必要があります  
  
- ユーザー証明書とデバイス証明書の認証の場合、ブラウザーは SSL クライアント証明書認証をサポートする必要があります  

- Windows 統合認証を使用してシームレスにサインインするには、ローカル イントラネット ゾーンまたは信頼済みサイト ゾーンにフェデレーション サービス名 (https:\/\/fs.contoso.com など) を構成する必要があります。
  ## <a name="network-requirements"></a><a name="BKMK_7"></a>ネットワークの要件  
 
**ファイアウォールの要件**  
  
Web アプリケーション プロキシとフェデレーション サーバー ファームの間にあるファイアウォールと、クライアントと Web アプリケーション プロキシ間にあるファイアウォールの両方で、受信方向の TCP ポート 443 を有効にする必要があります。  
  
さらに、クライアント ユーザー証明書認証 \(X509 ユーザー証明書を使用した clientTLS 認証\) が必要で、ポート 443 の certauth エンドポイントが有効ではない場合、AD FS 2016 ではクライアントと Web アプリケーション プロキシ間のファイアウォールで、受信方向の TCP ポート 49443 を有効にする必要があります。 これは、Web アプリケーション プロキシとフェデレーション サーバー間のファイアウォールでは必要ありません。 

ハイブリッド ポートの要件の詳細については、[ハイブリッド ID のポートとプロトコル](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-ports)に関する記事を参照してください。 

詳細については、「[Active Directory フェデレーション サービス (AD FS) をセキュリティで保護するためのベストプラクティス](../deployment/Best-Practices-Securing-AD-FS.md)」を参照してください。
  
**DNS の要件**  
  
-   イントラネット アクセスの場合、社内ネットワーク \(イントラネット\) 内の AD FS サービスにアクセスするすべてのクライアントでは、AD FS サービス名を、AD FS サーバーのロード バランサーまたは AD FS サーバーに解決できる必要があります。  
  
-   エクストラネット アクセスの場合、社内ネットワークの外部 \(エクストラネットまたはインターネット\) から AD FS サービスにアクセスするすべてのクライアントでは、AD FS サービス名を、Web アプリケーション プロキシ サーバーのロード バランサーまたは Web アプリケーション プロキシ サーバーに解決できる必要があります。  
  
-   DMZ 内の各 Web アプリケーション プロキシ サーバーでは、AD FS サービス名を、AD FS サーバーのロード バランサーまたは AD FS サーバーに解決できる必要があります。 これを達成するには、DMZ ネットワーク内の代替 DNS サーバーを使用するか、HOSTS ファイルを使用してローカル サーバーの解決を変更します。  
  
-   Windows 統合認証では、フェデレーション サービス名に \(CNAME ではなく\) DNS A レコードを使用する必要があります。  

-   ポート 443 でのユーザー証明書認証の場合、フェデレーション サーバーまたは Web アプリケーション プロキシに解決するするように "certauth.\<federation service name\>" を DNS で構成する必要があります。

-   Windows 10 より前のクライアントを使用したデバイス登録またはオンプレミス リソースへの先進認証の場合、フェデレーション サーバーまたは Web アプリケーション プロキシに解決するように、組織で使用されている各 UPN サフィックスの "enterpriseregistration.\<upn suffix\>" を構成する必要があります。

**ロード バランサーの要件**
- ロード バランサーでは SSL を終了できません。 AD FS では、SSL を終了するときに中断する証明書認証を使用する複数のユース ケースがサポートされます。 ロード バランサーでの SSL の終了は、どのユース ケースでもサポートされていません。 
- SNI をサポートするロード バランサーを使用することをお勧めします。 そうでない場合は、回避策として、AD FS または Web アプリケーション プロキシ サーバーで 0.0.0.0 フォールバック バインディングを使用することをお勧めします。
- (HTTPS ではなく) HTTP 正常性プローブ エンドポイントを使用して、トラフィックのルーティングに対してロード バランサーの正常性チェックを実行することをお勧めします。 こうすることで、SNI に関連する問題が回避されます。 これらのプローブ エンドポイントへの応答は HTTP 200 OK であり、バックエンド サービスに依存せずにローカルで提供されます。 HTTP プローブには、パス '/adfs/probe' を使用して HTTP 経由でアクセスできます
    - http://&lt;Web アプリケーション プロキシ名&gt;/adfs/probe
    - http://&lt;ADFS サーバー名&gt;/adfs/probe
    - http://&lt;Web アプリケーション プロキシのIP アドレス&gt;/adfs/probe
    - http://&lt;ADFS の IP アドレス&gt;/adfs/probe
- 負荷分散の方法として DNS ラウンド ロビンを使用することはお勧めしません。 この種類の負荷分散を使用しても、正常性プローブを使用してロード バランサーからノードを自動的に削除することはできません。 
- ロード バランサー内の AD FS への認証トラフィックに IP ベースのセッション アフィニティまたは固定セッションを使用することはお勧めしません。 これにより、メール クライアントから Office 365 メール サービス (Exchange Online) に接続するためにレガシ認証プロトコルを使用している場合、特定のノードが過負荷になる可能性があります。 

## <a name="permissions-requirements"></a><a name="BKMK_13"></a>アクセス許可の要件  
AD FS のインストールと初期構成を実行する管理者には、AD FS サーバーに対するローカル管理者のアクセス許可が必要です。  ローカル管理者が Active Directory にオブジェクトを作成するアクセス許可を持っていない場合、まずドメイン管理者が必要な AD オブジェクトを作成し、次に AdminConfiguration パラメーターを使用して AD FS ファームを構成する必要があります。  
  
  

