---
ms.assetid: 28f4a518-1341-4a10-8a4e-5f84625b314b
title: AD FS 2016 の要件
description: Active Directory フェデレーションサービス (AD FS) をインストールするための要件。
author: billmath
ms.author: billmath
manager: mtillman
ms.date: 03/06/2018
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: c330b5f65b2862628fd23e288c95e81653da5c5b
ms.sourcegitcommit: 4fa147d552481d8279a5390f458a9f7788061977
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/23/2019
ms.locfileid: "70009080"
---
# <a name="ad-fs-requirements"></a>AD FS の要件



AD FS を展開するための要件を次に示します。  
  
-   5\. コマンド プロンプトで、「[ipconfig /all](ad-fs-requirements.md#BKMK_1)」と入力して Enter キーを押します。  
  
-   [ハードウェア要件](ad-fs-requirements.md#BKMK_2)  
  
-   [プロキシの要件](ad-fs-requirements.md#BKMK_3)  
  
-   [AD DS の要件](ad-fs-requirements.md#BKMK_4)  
  
-   [構成データベースの要件](ad-fs-requirements.md#BKMK_5)  
  
-   [ブラウザーの要件](ad-fs-requirements.md#BKMK_6)  

-   [ネットワーク要件](ad-fs-requirements.md#BKMK_7)  
  
-   [アクセス許可の要件](ad-fs-requirements.md#BKMK_13)  
  
## <a name="BKMK_1"></a>証明書の要件  
  
### <a name="ssl-certificates"></a>SSL 証明書

各 AD FS および Web アプリケーションプロキシサーバーには、フェデレーションサービスへの HTTPS 要求を処理するための SSL 証明書があります。  Web アプリケーションプロキシは、発行されたアプリケーションへの要求を処理するために、追加の SSL 証明書を持つことができます。

**おすすめ**すべての AD FS フェデレーションサーバーと Web アプリケーションプロキシに同じ SSL 証明書を使用します。 

**要件:**

フェデレーションサーバーの SSL 証明書は、次の要件を満たしている必要があります。
- 証明書は公的に信頼されている (運用環境のデプロイの場合)
- 証明書にサーバー認証の拡張キー使用法 (EKU) の値が含まれています
- 証明書には、サブジェクトまたはサブジェクトの別名 (SAN) に "fs.contoso.com" などのフェデレーションサービス名が含まれています。
- ポート443でのユーザー証明書認証の場合、証明書には "certauth" が含まれます。SAN 内の "certauth.fs.contoso.com" などのフェデレーションサービス名\> \<
- デバイスの登録または Windows 10 より前のクライアントを使用したオンプレミスのリソースへの先進認証の場合、SAN には "enterpriseregistration" が含まれている必要があります。組織内で使用されている各 upn サフィックスの upn サフィックス\>。 \<

Web アプリケーションプロキシの SSL 証明書は、次の要件を満たしている必要があります。
- プロキシを使用して Windows 統合認証を使用する AD FS 要求をプロキシする場合、プロキシ SSL 証明書はフェデレーションサーバーの SSL 証明書と同じである必要があります (同じキーを使用します)。
- AD FS プロパティ "ExtendedProtectionTokenCheck" が有効になっている場合 (AD FS の既定の設定)、プロキシ SSL 証明書はフェデレーションサーバーの SSL 証明書と同じである必要があります (同じキーを使用します)。
- それ以外の場合、プロキシ SSL 証明書の要件は、フェデレーションサーバーの SSL 証明書の要件と同じです。

### <a name="service-communication-certificate"></a>サービス通信証明書
この証明書は、Azure AD や Office 365 を含むほとんどの AD FS シナリオでは必要ありません。 既定では、AD FS は、初期構成時に提供される SSL 証明書をサービス通信証明書として構成します。

**おすすめ**
- SSL に使用するのと同じ証明書を使用します。  

### <a name="token-signing-certificate"></a>トークン署名証明書
この証明書は、発行されたトークンを証明書利用者に署名するために使用されます。そのため、証明書利用者アプリケーションは、証明書とそれに関連付けられているキーを認識して信頼されている トークン署名証明書が期限切れになったときや、新しい証明書を構成したときなどに変更された場合は、すべての証明書利用者を更新する必要があります。

**おすすめ**AD FS 既定の、内部生成された自己署名のトークン署名証明書を使用します。  

**要件:**
- 組織でトークン署名にエンタープライズ PKI の証明書を使用する必要がある場合は、AdfsFarm コマンドレットの SigningCertificateThumbprint パラメーターを使用してこれを行うことができます。
- 内部で生成された既定の証明書と外部に登録された証明書のどちらを使用する場合でも、トークン署名証明書を変更するときには、すべての証明書利用者が新しい証明書情報で更新されるようにする必要があります。  そうしないと、更新されていない証明書利用者へのログオンは失敗します。

### <a name="token-encryptingdecrypting-certificate"></a>トークンの暗号化/暗号化解除証明書
この証明書は、AD FS に対して発行されたトークンを暗号化する要求プロバイダーによって使用されます。

**おすすめ**AD FS 既定の、内部生成された自己署名トークン暗号化解除証明書を使用します。  

**要件:**
- 組織でトークン署名にエンタープライズ PKI の証明書を使用する必要がある場合は、AdfsFarm コマンドレットの DecryptingCertificateThumbprint パラメーターを使用してこれを行うことができます。
- 内部で生成された既定の証明書と外部に登録された証明書のどちらを使用する場合でも、トークン暗号化解除証明書を変更するときには、すべての要求プロバイダーが新しい証明書情報で更新されるようにする必要があります。  そうしないと、更新されていない要求プロバイダーを使用したログオンは失敗します。
  
> [!CAUTION]  
> トークン\-署名とトークン\-暗号化解除\/の暗号化に使用される証明書は、フェデレーションサービスの安定性を確保するために重要です。 独自のトークン\-署名 & トークン\-を管理し\/ているお客様は、証明書の暗号化を解除するため、これらの証明書がバックアップされ、復旧イベントの発生時に個別に使用できる必要があります。  

### <a name="user-certificates"></a>ユーザー証明書
- AD FS で x509 ユーザー証明書認証を使用する場合、すべてのユーザー証明書は、AD FS および Web アプリケーションプロキシサーバーによって信頼されているルート証明機関にチェーンする必要があります。

## <a name="BKMK_2"></a>ハードウェア要件  
AD FS および Web アプリケーションプロキシのハードウェア要件 (物理または仮想) は CPU 上でゲートされるので、処理能力のためにファームのサイズを変更する必要があります。  
- [AD FS 2016 容量計画スプレッドシート](http://adfsdocs.blob.core.windows.net/adfs/ADFSCapacity2016.xlsx)を使用して、必要な AD FS および Web アプリケーションプロキシサーバーの数を決定します。

AD FS のメモリとディスクの要件はかなり静的です。次の表を参照してください。


|**ハードウェア要件**|**最小要件**|**推奨要件**|
|----- | ----- |-----|
|RAM|2 GB|4 GB |
|ディスク領域|32 GB|100 GB |

**ハードウェア要件の SQL Server**

AD FS 構成データベースに SQL Server を使用している場合は、最も基本的な SQL Server の推奨事項に従って、SQL Server のサイズを変更します。  AD FS データベースのサイズは非常に小さく、AD FS によってデータベースインスタンスに大きな処理負荷がかかることはありません。  ただし AD FS は、認証時にデータベースに複数回接続するので、ネットワーク接続を堅牢にする必要があります。  残念ながら、AD FS 構成データベースの SQL Azure はサポートされていません。
  
## <a name="BKMK_3"></a>プロキシの要件  
  
-   エクストラネットアクセスの場合は、リモートアクセスサーバーの役割の Web \-アプリケーションプロキシ役割サービスの一部を展開する必要があります。 

-   サードパーティのプロキシでは、AD FS プロキシとしてサポートされるように、 [MS ADFSPIP プロトコル](https://msdn.microsoft.com/library/dn392811.aspx)をサポートする必要があります。  サードパーティベンダーの一覧については、 [FAQ](AD-FS-FAQ.md)を参照してください。

-   AD FS 2016 では、Windows Server 2016 上の Web アプリケーションプロキシサーバーが必要です。  2016ファームの動作レベルで実行されている AD FS 2016 ファームに対して、ダウンレベルプロキシを構成することはできません。
  
-   フェデレーションサーバーと Web アプリケーションプロキシの役割サービスを同じコンピューターにインストールすることはできません。  
  
## <a name="BKMK_4"></a>AD DS の要件  
**ドメインコントローラーの要件**  
  
- AD FS には、Windows Server 2008 以降を実行しているドメインコントローラーが必要です。

- Microsoft Passport for Work には、少なくとも1つの Windows Server 2016 ドメインコントローラーが必要です。
  
> [!NOTE]  
> Windows Server 2003 ドメインコントローラーを使用した環境のすべてのサポートが終了しました。 Microsoft サポートのライフサイクルの詳細については、[このページ](https://support.microsoft.com/lifecycle/search/default.aspx?sort=PN&alpha=Windows+Server+2003&Filter=FilterNO)を参照してください。  
  
**ドメインの\-機能レベルの要件**  
  
 - AD FS サーバーが参加しているすべてのユーザーアカウントドメインとドメインは、Windows Server 2003 以降のドメインの機能レベルで動作している必要があります。  
  
 - AD DS で証明書がユーザーのアカウントに明示的にマップされている場合、クライアント証明書の認証には、Windows Server 2008 ドメインの機能レベルが必要です。  
  
**スキーマの要件**  
  
-   AD FS 2016 の新規インストールでは、Active Directory 2016 スキーマ (最小バージョン 85) が必要です。

-   AD FS ファーム動作レベル (FBL) を2016レベルに上げるには、Active Directory 2016 スキーマ (最小バージョン 85) が必要です。  

  
**サービスアカウントの要件**  
  
-   標準ドメインアカウントは、AD FS のサービスアカウントとして使用できます。 グループの管理されたサービスアカウントもサポートされています。 AD FS を構成すると、実行時に必要なアクセス許可が自動的に追加されます。

-   AD サービスアカウントに必要なユーザー権利の割り当ては、"サービスとしてログオン" になります。

-   "NT Service\adfssrv" と "NT Service\ drs" に必要なユーザー権利の割り当ては、' セキュリティ監査の生成 ' と ' サービスとしてログオン ' ' です。

-   グループの管理されたサービスアカウントには、Windows Server 2012 以降を実行しているドメインコントローラーが少なくとも1つ必要です。  GMSA は、既定の ' CN = Managed Service Accounts ' コンテナーの下に存在する必要があります。  

-   Kerberos 認証では、サービスプリンシパル名 '`HOST/<adfs\_service\_name>`' が AD FS サービスアカウントに登録されている必要があります。 既定では、新しい AD FS ファームを作成するときに AD FS によって構成されます。  このエラーが発生した場合 (衝突の場合やアクセス許可が不十分な場合など)、警告が表示され、手動で追加する必要があります。  
   
**ドメインの要件**  
  
-   すべての AD FS サーバーは、AD DS ドメインに参加している必要があります。  
  
-   ファーム内のすべての AD FS サーバーを同じドメインに展開する必要があります。  
   
**複数フォレストの要件**  
  
-   AD FS サーバーが参加しているドメインは、AD FS サービスに対して認証を行うユーザーを含むすべてのドメインまたはフォレストを信頼する必要があります。  

-   AD FS サービスアカウントがメンバーであるフォレストは、すべてのユーザーログインフォレストを信頼する必要があります。 
  
-   AD FS サービスアカウントには、AD FS サービスに対して認証を行うユーザーを含むすべてのドメインのユーザー属性を読み取るためのアクセス許可が必要です。  
  
## <a name="BKMK_5"></a>構成データベースの要件  
このセクションでは、データベースとして Windows Internal Database (WID) または SQL Server を使用する AD FS ファームの要件と制限事項について説明します。  
  
**WID**  
  
-   SAML 2.0 のアーティファクト解決プロファイルは、WID ファームではサポートされていません。    

-   トークンリプレイ検出は、WID ファームではサポートされていません。 (この機能は、AD FS がフェデレーションプロバイダーとして機能し、外部要求プロバイダーからのセキュリティトークンを使用する場合にのみ使用されます)。  
  
次の表は、WID と SQL Server ファームでサポートされている AD FS サーバーの数の概要を示しています。    
  
  
|| AD FS で構成された 1-100 証明書利用者 (RP) 信頼 | 100を超える RP 信頼が構成されました  |
| --- |--- | --- |
|1-30 AD FS サーバー|WID がサポートされる|WID を使用してサポートされない-SQL Server が必要 |
|30を超える AD FS サーバー|WID を使用してサポートされない-SQL Server が必要|WID を使用してサポートされない-SQL Server が必要  
  
**SQL Server**  
  
- Windows Server 2016 の AD FS では、SQL Server 2008 以降のバージョンがサポートされています。

- SQL Server ファームでは、SAML アーティファクト解決とトークンリプレイ検出の両方がサポートされています。  
  
## <a name="BKMK_6"></a>ブラウザーの要件  
ブラウザーまたはブラウザーコントロールを使用して AD FS 認証を実行する場合は、ブラウザーが次の要件を満たしている必要があります。  
  
- JavaScript を有効にする必要があります  
  
- シングルサインオンの場合、クライアントブラウザーが cookie を許可するように構成されている必要があります。  
  
- Server Name Indication \(SNI\)がサポートされている必要があります  
  
- ユーザー証明書 & デバイス証明書認証の場合、ブラウザーは SSL クライアント証明書認証をサポートする必要があります。  

- Windows 統合認証を使用してシームレスにサインインするには、フェデレーションサービス名 (\/https:\/fs.contoso.com など) を、ローカルイントラネットゾーンまたは信頼済みサイトゾーンで構成する必要があります。
  ## <a name="BKMK_7"></a>ネットワーク要件  
 
**ファイアウォールの要件**  
  
Web アプリケーションプロキシとフェデレーションサーバーファームの間にあるファイアウォールと、クライアントと Web アプリケーションプロキシ間のファイアウォールの両方で、TCP ポート443が受信可能である必要があります。  
  
さらに、X509 ユーザー証明書\(\)を使用するクライアントユーザー証明書認証 clienttls 認証が必要であり、ポート443の certauth エンドポイントが有効になっていない場合、AD FS 2016 では TCP ポート49443が有効になっている必要があります。クライアントと Web アプリケーションプロキシの間のファイアウォールで受信します。 これは、Web アプリケーションプロキシとフェデレーションサーバー\)の間のファイアウォールでは必要ありません。 

ハイブリッドポートの要件の詳細については[、「ハイブリッド Id ポートとプロトコル](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-ports)」を参照してください。 

詳細については、「 [Active Directory フェデレーションサービス (AD FS) のセキュリティ保護に関するベストプラクティス](../deployment/Best-Practices-Securing-AD-FS.md)」を参照してください。
  
**DNS の要件**  
  
-   イントラネットにアクセスするには、社内ネットワーク\(イントラネット\)内の AD FS サービスにアクセスするすべてのクライアントが、AD FS サービス名を AD FS サーバーまたは AD FS サーバーのロードバランサーに解決できる必要があります。  
  
-   エクストラネットアクセスの場合、企業ネットワーク\(のエクストラネット\/インターネット\)の外部から AD FS サービスにアクセスするすべてのクライアントは、Web アプリケーションプロキシサーバーのロードバランサーに対して AD FS サービス名を解決できる必要があります。Web アプリケーションプロキシサーバー。  
  
-   DMZ 内の各 Web アプリケーションプロキシサーバーは、AD FS サーバーまたは AD FS サーバーのロードバランサーに AD FS サービス名を解決できる必要があります。 これは、DMZ ネットワーク内の代替 DNS サーバーを使用するか、HOSTS ファイルを使用してローカルサーバーの解決策を変更することによって実現できます。  
  
-   Windows 統合認証の場合、フェデレーションサービス名に CNAME \(\)ではない DNS a レコードを使用する必要があります。  

-   ポート443でのユーザー証明書の認証については、"certauth.フェデレーションサーバーまた\>は web アプリケーションプロキシに解決するには、フェデレーションサービス名 "が DNS で構成されている必要があります。 \<

-   デバイス登録の場合、または Windows 10 以前のクライアントを使用したオンプレミスのリソースに対する先進認証の場合は "enterpriseregistration。\<upnサフィックス\>"は、組織内で使用されている各 upn サフィックスに対して、フェデレーションサーバーまたは web アプリケーションプロキシを解決するように構成する必要があります。

**Load Balancer の要件**
- ロードバランサーは SSL を終了できません。 AD FS では、SSL を終了するときに中断する証明書認証を使用する複数のユースケースがサポートされます。 ロードバランサーでの SSL の終了は、どのユースケースでもサポートされていません。 
- SNI をサポートするロードバランサーを使用することをお勧めします。 そうでない場合は、AD FS/Web アプリケーションプロキシサーバーで0.0.0.0 フォールバックバインディングを使用して、回避策を提供する必要があります。
- HTTP (HTTPS ではない) 正常性プローブエンドポイントを使用して、トラフィックをルーティングするロードバランサーの正常性チェックを実行することをお勧めします。 これにより、SNI に関連する問題が回避されます。 これらのプローブエンドポイントへの応答は HTTP 200 OK であり、バックエンドサービスに依存せずにローカルに提供されます。 HTTP プローブには、パス '/adfs/probe ' を使用して HTTP 経由でアクセスできます。
    - http://&lt;Web アプリケーションプロキシ名&gt;/adfs/probe
    - http://&lt;ADFS サーバー名&gt;/adfs/probe
    - http://&lt;Web アプリケーションプロキシの IP&gt;アドレス/adfs/probe
    - http://&lt;ADFS IP アドレス&gt;/adfs/probe
- 負荷分散の方法として DNS ラウンドロビンを使用することはお勧めしません。 この種類の負荷分散を使用しても、正常性プローブを使用してロードバランサーからノードを自動的に削除する方法は提供されません。 
- ロードバランサー内の AD FS するために、IP ベースのセッションアフィニティまたは固定セッションを使用して認証トラフィックを使用することはお勧めしません。 これにより、メールクライアントが Office 365 メールサービス (Exchange Online) に接続するときに、レガシ認証プロトコルを使用して特定のノードが過負荷になることがあります。 

## <a name="BKMK_13"></a>アクセス許可の要件  
AD FS のインストールと初期構成を実行する管理者には、AD FS サーバーに対するローカル管理者のアクセス許可が必要です。  ローカル管理者が Active Directory にオブジェクトを作成するためのアクセス許可を持っていない場合は、まず、必要な AD オブジェクトを作成し、次に AdminConfiguration パラメーターを使用して AD FS ファームを構成する必要があります。  
  
  

