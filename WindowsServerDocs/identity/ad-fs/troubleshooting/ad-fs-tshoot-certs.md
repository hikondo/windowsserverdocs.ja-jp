---
title: AD FS のトラブルシューティング-証明書
description: このドキュメントでは、一般的な証明書の問題について説明します。
author: billmath
ms.author: billmath
manager: mtillman
ms.date: 02/21/2017
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adfs
ms.openlocfilehash: fdadbefc138562246c72f7707b303d966bff0989
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/27/2019
ms.locfileid: "71407191"
---
# <a name="ad-fs-troubleshooting---certificates"></a>AD FS のトラブルシューティング-証明書
AD FS は、正常に動作するために次の証明書を必要とします。  これらのいずれかが適切に設定されていないか、正しく構成されていない場合、問題が発生する可能性があります。  

## <a name="required-certificates"></a>必要な証明書
AD FS には、次の証明書が必要です。



- **フェデレーションの信頼**–これを行うには、相互に信頼されたインターネットルート証明機関 (CA) にチェーンされている証明書が、要求プロバイダーと証明書利用者フェデレーションサーバーの両方の信頼されたルートストアに存在している必要があります。クロス証明の設計は、各側がルート CA をパートナーと交換したか、または適切な場所にインポートされた自己署名証明書を使用して実装されています。
- **トークン署名**-各フェデレーションサービスコンピューターには、トークン署名証明書が必要です。  要求プロバイダーのトークン署名証明書は、証明書利用者のフェデレーションサーバーによって信頼されている必要があります。 証明書利用者のトークン署名証明書は、RP フェデレーションサーバーからトークンを受け取るすべてのアプリケーションによって信頼されている必要があります。
- **Secure Sockets Layer (ssl)** –フェデレーションサービスの ssl 証明書は、フェデレーションサーバープロキシコンピューターの信頼されたストアに存在し、信頼された証明機関 (CA) ストアへの有効なチェーンを持っている必要があります。
- **証明書失効リスト (crl)** – crl が公開されているすべての証明書について、証明書にアクセスする必要があるすべてのクライアントとサーバーに対して crl にアクセスできる必要があります。

上記のいずれかが正しく構成されていない場合、AD FS は機能しません。

## <a name="common-things-to-check-with-certificates"></a>証明書に関する一般的な確認事項
次に示すのは、証明書の問題を解決しようとしたときに発生する可能性があるものの一覧です。

- 証明書が信頼されていることを確認する
    - SSL 証明書がクライアントによって信頼されている必要がある
    - トークン署名証明書は、証明書利用者によって信頼されている必要があります。
- 信頼チェーンを確認する-チェーン内のすべての証明書が有効である必要があります。
- 証明書の有効期限を確認する
- 証明書失効リスト (CRL) のアクセシビリティを確認する
    - [CDP] フィールドに値が入力されていることを確認します。
    - 手動で CDP を参照する
- 証明書が失効していないことを確認する

## <a name="common-certificate-errors"></a>一般的な証明書のエラー
次の表は、一般的なエラーと考えられる原因の一覧です。

|イベント|原因|解決方法
|-----|-----|-----|
|イベント 249-証明書が証明書ストアに見つかりませんでした。 証明書のロールオーバーのシナリオでは、この証明書を使用してフェデレーションサービスが署名または復号化するときに、エラーが発生する可能性があります。|問題の証明書がローカル証明書ストアに存在しないか、サービスアカウントに証明書の秘密キーへのアクセス許可がありません。|AD FS サーバーの LocalMAchine\My ストアに証明書がインストールされていることを確認します。 AD FS サービスアカウントに、証明書の秘密キーへの読み取りアクセス権があることを確認します。|
|イベント 315-要求プロバイダー信頼署名証明書の証明書チェーンを構築しようとしたときにエラーが発生しました。|証明書が失効している。</br></br>証明書チェーンを検証できません。</br></br>証明書の有効期限が切れているか、まだ有効ではありません。|証明書が有効であり、失効していないことを確認してください。</br></br>CRL にアクセスできることを確認します。|
|イベント 316-証明書利用者信頼署名証明書の証明書チェーンを構築しようとしたときにエラーが発生しました。|証明書が失効している。</br></br>証明書チェーンを検証できません。</br></br>証明書の有効期限が切れているか、まだ有効ではありません。|証明書が有効であり、失効していないことを確認してください。</br></br>CRL にアクセスできることを確認します。|
|イベント 317-証明書利用者信頼の暗号化証明書の証明書チェーンを構築しようとしたときにエラーが発生しました。|証明書が失効している。</br></br>証明書チェーンを検証できません。</br></br>証明書の有効期限が切れているか、まだ有効ではありません。|証明書が有効であり、失効していないことを確認してください。</br></br>CRL にアクセスできることを確認します。|
|イベント 319-クライアント証明書の証明書チェーンの構築中にエラーが発生しました。|証明書が失効している。</br></br>証明書チェーンを検証できません。</br></br>証明書の有効期限が切れているか、まだ有効ではありません。|証明書が有効であり、失効していないことを確認してください。</br></br>CRL にアクセスできることを確認します。|
|イベント 360-証明書トランスポートエンドポイントに対する要求が行われましたが、要求にクライアント証明書が含まれていませんでした。|クライアント証明書を発行したルート CA は信頼されていません。</br></br>クライアント証明書の有効期限が切れています。</br></br>クライアント証明書は自己署名であり、信頼されていません。|クライアント証明書を発行したルート CA が、信頼されたルートストアに存在することを確認します。</br></br>クライアント証明書の有効期限が切れていないことを確認します。</br></br>クライアント証明書が自己署名されている場合は、信頼された証明書の一覧に追加されていることを確認するか、自己署名証明書を信頼された証明書に置き換えます。|
|イベント 374-要求プロバイダー信頼の暗号化証明書の証明書チェーンの構築中にエラーが発生しました。|証明書が失効している。</br></br>証明書チェーンを検証できません。</br></br>証明書の有効期限が切れているか、まだ有効ではありません。|証明書が有効であり、失効していないことを確認してください。</br></br>CRL にアクセスできることを確認します。|
|イベント 381-構成証明書の証明書チェーンを構築しようとしたときにエラーが発生しました。|AD FS サーバーで使用するように構成された証明書のいずれかが期限切れか、失効しています。|構成されたすべての証明書が失効しておらず、期限切れになっていないことを確認します。|
|イベント 385-AD FS AD FS 構成データベースの1つまたは複数の証明書を手動で更新する必要があることが検出されました。|AD FS サーバーで使用するように構成された証明書のいずれかの有効期限が切れているか、有効期限が近づいています。|期限切れまたは間もなく期限切れの証明書を交換で更新します。 (自己署名証明書を使用していて、証明書の自動ロールオーバーが有効になっている場合、自己解決が行われるため、このエラーは無視される可能性があります)。|
|イベント 387-フェデレーションサービスに指定された1つ以上の証明書が、AD FS Windows サービスで使用されているサービスアカウントにアクセスできなかったことを検出しました AD FS。|AD FS サービスアカウントに、1つまたは複数の構成済み証明書の秘密キーに対する読み取りアクセス許可がありません。|AD FS サービスアカウントに、構成されているすべての証明書の秘密キーに対する読み取りアクセス許可があることを確認します。|
|イベント 389-AD FS によって、証明書の有効期限が切れたか、間もなく期限切れになるため、1つ以上の信頼の証明書が手動で更新される必要があることが検出されました。|構成されたパートナーの証明書のいずれかの有効期限が切れているか、間もなく期限切れになります。 これは、要求プロバイダー信頼または証明書利用者信頼のいずれかに適用されます。|この信頼を手動で作成した場合は、証明書の構成を手動で更新してください。 フェデレーションメタデータを使用して信頼を作成した場合、パートナーが証明書を更新するとすぐに証明書が自動的に更新されます。|




## <a name="next-steps"></a>次の手順

- [AD FS のトラブルシューティング](ad-fs-tshoot-overview.md)
 