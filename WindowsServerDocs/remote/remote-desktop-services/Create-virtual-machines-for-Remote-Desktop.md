---
title: リモート デスクトップの仮想マシンを作成する
description: クラウドでリモート デスクトップ コンポーネントをホストする VM を作成します。
ms.prod: windows-server
ms.technology: remote-desktop-services
ms.author: elizapo
ms.date: 08/01/2016
ms.topic: article
ms.assetid: b0f62d6f-0915-44ca-afef-be44a922e20e
author: lizap
manager: dongill
ms.openlocfilehash: fa17c472e3311e4e34ac7b2176d0045886463274
ms.sourcegitcommit: 3a3d62f938322849f81ee9ec01186b3e7ab90fe0
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2020
ms.locfileid: "80818465"
---
# <a name="create-virtual-machines-for-remote-desktop"></a>リモート デスクトップの仮想マシンを作成する

>適用先:Windows Server (半期チャネル)、Windows Server 2019、Windows Server 2016

デスクトップ ホスティングの展開に必要な Windows Server 2016 の役割、サービス、および機能を実行するために使用するテナントの環境に仮想マシンを作成するには、次の手順を使用します。   
  
この基本的な展開の例では、最低 3 つの仮想マシンが作成されます。 1 つ目の仮想マシンは、リモート デスクトップ (RD) 接続ブローカー、ライセンス サーバーの役割サービス、および展開用のファイル共有をホストします。 2 つ目の仮想マシンは、RD ゲートウェイと Web アクセス役割サービスをホストします。  3 つ目の仮想マシンは、RD セッション ホスト役割サービスをホストします。 非常に小規模の展開では、AAD アプリ プロキシを使用して、展開からすべてのパブリック エンドポイントを排除して、1 つの VM 上にすべての役割サービスを組み合わせることによって VM コストを削減できます。 大規模な展開では、個々の仮想マシンにさまざまな役割サービスをインストールしてスケーリングを向上させることができます。  
  
このセクションでは、[Microsoft Azure Marketplace](https://azure.microsoft.com/marketplace/) 内の Windows Server イメージに基づいて、それぞれの役割用の仮想マシンを展開するための手順を示します。 カスタム イメージから仮想マシンを作成する必要がある場合は (PowerShell が必要)、[Resource Manager および PowerShell を使用した Windows VM の作成](https://azure.microsoft.com/documentation/articles/virtual-machines-windows-ps-create/)に関するページを参照してください。 その後、ここに戻り、ファイル共有用の Azure データ ディスクをアタッチし、展開用の外部 URL を入力します。  
  
1. RD 接続ブローカー、RD ライセンス サーバー、およびファイル サーバーをホストする [Windows 仮想マシンを作成](https://azure.microsoft.com/documentation/articles/virtual-machines-windows-hero-tutorial/)します。  
  
   便宜上、次の命名規則を使用しました。  
   - RD 接続ブローカー、ライセンス サーバー、およびファイル サーバー:   
       - VM:Contoso-Cb1  
       - 可用性セット:CbAvSet    
   - RD Web アクセス サーバーおよび RD ゲートウェイ サーバー:   
       - VM:Contoso-WebGw1  
       - 可用性セット:WebGwAvSet  
          
   - RD セッション ホスト:   
       - VM:Contoso-Sh1  
       - 可用性セット:ShAvSet  
          
   各 VM は同じリソース グループを使用します。  
2. ユーザー プロファイル ディスク (UPD) 共有のための Azure データ ディスクを作成してアタッチします。  
   1.  Azure portal で、 **[参照] > [リソース グループ]** をクリックし、展開用のリソース グループをクリックしてから、RD 接続ブローカーのために作成された VM をクリックします (例: Contoso-Cb1)。  
   2.  **[設定] > [ディスク] > [新しいディスクの接続]** をクリックします。  
   3.  名前と型の既定値をそのまま使用します。  
   4.  ユーザー プロファイル ディスクおよび証明書を含む、テナントの環境のネットワーク共有を保持するために十分な大きさのサイズ (GB) を入力します。 計画しているユーザーあたり 5 GB に概算できます。  
   5.  場所とキャッシュ ホストについては既定値をそのまま使用し、 **[OK]** をクリックします。  
3. 展開に外部からアクセスするために外部ロード バランサーを作成します。
   1. Azure portal で **[参照] > [ロード バランサー]** の順にクリックし、 **[追加]** をクリックします。
   2. **[名前]** を入力し、ロード バランサーの **[種類]** として **[パブリック]** を選択し、適切な **[サブスクリプション]** 、 **[リソース グループ]** 、および **[場所]** を選択します。
   3. **[パブリック IP アドレスの選択]** 、 **[新規作成]** の順に選択し、名前を入力して **[OK]** を選択します。
   4. **[作成]** を選択してロード バランサーを作成します。
4. 展開用の外部ロード バランサーを構成します
   1. Azure portal で、 **[参照] > [リソース グループ]** をクリックし、展開用のリソース グループをクリックしてから、展開用に作成されたロード バランサーをクリックします。
   2. トラフィックの送信先となるロード バランサーのバックエンド プールを追加します。
       1. **[バックエンド プール]** および **[追加]** を選択します。
       2. **[名前]** を入力し、 **[\+ 仮想マシンの追加]** を選択します。
       3. **[可用性セット]** および **[WebGwAvSet]** を選択します。
       4. **[仮想マシン]** 、 **[Contoso-WebGw1]** 、 **[選択]** 、 **[OK]** 、 **[OK]** の順に選択します。
   3. アクティブなマシンをロード バランサーが認識できるように、プローブを追加します。
       1. **[プローブ]** および **[追加]** を選択します。
       2. **[名前]** (HTTPS など) を入力し、 **[TCP]** を選択し、 **[ポート]** に 443 を入力して、 **[OK]** を選択します。
   4. 受信トラフィックのバランスを取る負荷分散規則を入力します。
      1. **[負荷分散規則]** および **[追加]** を選択します
      2. **[名前]** (HTTPS など) を入力し、 **[TCP]** を選択して、 **[ポート]** と **[バックエンド ポート]** の両方に 443 と入力します。
          - Windows 10 および Windows Server 2016 の展開では、 **[セッション永続化]** を **[なし]** のままにし、それ以外の場合は **[クライアント IP]** を選択します。
      3. **[OK]** を選択して、HTTPS 規則を受け入れます。
      4. **[追加]** を選択して、新しい規則を作成します。
      5. **[名前]** (UDP など) を入力し、 **[UDP]** を選択して、<strong>[ポート] と [**バックエンド ポート]</strong> の両方に 3391 と入力します。
          - Windows 10 および Windows Server 2016 の展開では、 **[セッション永続化]** を **[なし]** のままにし、それ以外の場合は **[クライアント IP]** を選択します。
      6. **[OK]** を選択して、UDP 規則を受け入れます。
   5. Contoso-WebGw1 に直接接続するための受信 NAT 規則を入力します
       1. **[受信 NAT 規則]** および **[追加]** を選択します。
       2. **[名前]** (RDP-Contoso-WebGw1 など) を入力し、サービスに **[Customm]\(カスタム\)** を選択し、プロトコルに **[TCP]** を選択して、 **[ポート]** に 14000 と入力します。
       3. **[仮想マシンの選択]** および Contoso-WebGw1 を選択します。
       4. ポート マッピングに対して **[Custom]\(カスタム\)** を選択し、 **[ターゲット ポート]** に 3389 と入力し、 **[OK]** を選択します。
5. 展開に外部アクセスできるように、展開の外部 URL および DNS 名を入力します。  
   1.  Azure portal で、 **[参照] > [リソース グループ]** をクリックし、展開用のリソース グループをクリックしてから、RD Web アクセスおよび RG ゲートウェイ用に作成されたパブリック IP アドレスをクリックします。  
   2.  **[構成]** をクリックし、DNS 名ラベル (contoso など) を入力し、 **[保存]** をクリックします。 この DNS 名ラベル (contoso.westus.cloudapp.azure.com) は、RD Web アクセスおよび RD ゲートウェイ サーバーへの接続に使用する DNS 名です。  

