---
title: 境界ゲートウェイ プロトコル (BGP)
description: このトピックを使用すると、BGP でサポートされている展開トポロジ、BGP の機能など、Windows Server 2016 の Border Gateway Protocol (BGP) について理解することができます。
manager: brianlic
ms.custom: na
ms.prod: windows-server
ms.reviewer: na
ms.suite: na
ms.technology: networking-ras
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 78cc2ce3-a48e-45db-b402-e480b493fab1
ms.author: pashort
author: shortpatti
ms.openlocfilehash: ae6fddce1564e44ad72a5630c6abb16cdb6735d1
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/27/2019
ms.locfileid: "71388983"
---
# <a name="border-gateway-protocol-bgp"></a>境界ゲートウェイ プロトコル (BGP)

>適用対象: Windows Server (半期チャネル)、Windows Server 2016

このトピックを使用すると、BGP でサポートされている展開トポロジ、BGP の特徴、機能など、境界ゲートウェイ プロトコル (BGP) について理解することができます。  
  
> [!NOTE]  
> このトピックに加えて、次の BGP のドキュメントも参照してください。  
>   
> -   [BGP Windows PowerShell コマンド リファレンス](../../remote-access/bgp/BGP-Windows-PowerShell-Command-Reference.md)  
  
このトピックは次のセクションで構成されます。  
  
-   [BGP でサポートされる展開トポロジ](#bkmk_top)  
  
-   [BGP の機能](#bkmk_features)  
  
Windows Server 2016 リモートアクセスサービスで構成されている場合は、マルチテナントモードの RAS\) ゲートウェイ \(、Border Gateway Protocol (BGP) を使用して、テナントの VM ネットワークとそのリモートサイト間のネットワークトラフィックのルーティングを管理できます。 シングルテナント RAS ゲートウェイ展開に BGP を使用することもできます。また、リモートアクセスをローカルエリアネットワーク \(LAN\) ルーターとして展開するときにも使用できます。  
  
BGP を使用するとルーター上で手動でルートを構成する必要性が減ります。それは、BGP が動的ルーティング プロトコルであり、サイト間 VPN 接続を使用して接続されているサイト間のルートが自動的に学習されるためです。  
  
BGP ルーティングを使用するには、**リモートアクセスサービス \(RAS\)** またはリモートアクセスサーバーの役割**サービスをインストール**する必要があります \(VM\)-使用するシステムの種類は、マルチテナント展開があるかどうかによって異なります。  
  
-   マルチテナント展開の場合は、1つまたは複数の Vm に RAS ゲートウェイをインストールすることをお勧めします。 複数の Vm を使用すると、高可用性が実現します。 RAS ゲートウェイは、複数のテナントからの複数の接続を処理することができ、Hyper-v ホストと、実際にゲートウェイとして構成されている VM で構成されます。 このゲートウェイは、テナントとクラウドサービスプロバイダー \(CSP\) サブネットルートを交換するためのマルチテナント BGP ルーターとして、サイト間 VPN 接続を使用して構成されます。  
  
-   シングルテナントエッジゲートウェイの展開または LAN ルーターの展開では、RAS ゲートウェイを物理コンピューターまたは VM のいずれかにインストールできます。  
  
> [!IMPORTANT]  
> RAS ゲートウェイをインストールするときに、 **Enable-remoteaccessroutingdomain** Windows PowerShell コマンドを使用し**て、各**テナントに対して BGP を有効にするかどうかを指定する必要があり**ます。** マルチテナント機能を使用せずに、BGP 対応 LAN ルーターとしてリモートアクセスをインストールするには、コマンド**install-RemoteAccess-VpnType RoutingOnly**を使用します。  
>   
> 次のコード例は、Contoso と Fabrikam の2つのテナントに対して、すべての RAS 機能 (ポイント対サイト VPN、サイト間 VPN、および BGP ルーティング) が有効になっているマルチテナント機能モードで RAS をインストールする方法を示しています。  
  
```  
$Contoso_RoutingDomain = "ContosoTenant"  
$Fabrikam_RoutingDomain = "FabrikamTenant"  
  
Install-RemoteAccess -MultiTenancy  
  
Enable-RemoteAccessRoutingDomain -Name $Contoso_RoutingDomain -Type All -PassThru  
Enable-RemoteAccessRoutingDomain -Name $Fabrikam_RoutingDomain -Type All -PassThru  
```  
  
## <a name="bkmk_top"></a>BGP でサポートされる展開トポロジ  
ここでは、エンタープライズ サイトがクラウド サービス プロバイダー (CSP) のデータセンターに接続されている、サポートされている展開トポロジを示します。  
  
どのシナリオでも、CSP ゲートウェイは Windows Server 2016 の RAS ゲートウェイです。 複数のテナントからの複数の接続を処理できる RAS ゲートウェイは、Hyper-v ホストと、実際にゲートウェイとして構成されている VM で構成されます。 このエッジ ゲートウェイは、エンタープライズおよび CSP サブネット ルートを交換するためのマルチテナントの BGP ルーターとして、サイト間 VPN 接続で構成されます。  
  
テナントは、サイト間 (S2S) VPN 接続を使用して、CSP データセンターのリソースに接続します。 さらに、エンタープライズ ゲートウェイと CSP ゲートウェイの間の動的なルーティング情報の交換のために BGP ルーティング プロトコルが展開されます。  
  
次の展開トポロジがサポートされます。  
  
-   [エンタープライズサイトのエッジにある BGP を使用した RAS VPN サイト対サイトゲートウェイ](#bkmk_top1)  
  
-   [エンタープライズサイトのエッジに BGP があるサードパーティのゲートウェイ](#bkmk_top2)  
  
-   [サードパーティ製のゲートウェイを使用する複数のエンタープライズサイト](#bkmk_top3)  
  
-   [BGP と VPN の別個の終了ポイント](#bkmk_top4)  
  
以降のセクションでは、サポートされているそれぞれの BGP トポロジに関する追加の情報を示します。  
  
### <a name="bkmk_top1"></a>エンタープライズサイトのエッジにある BGP を使用した RAS VPN サイト対サイトゲートウェイ  
このトポロジは、CSP に接続されているエンタープライズ サイトを表しています。 エンタープライズルーティングトポロジには、内部ルーター、CSP との VPN サイト間接続用に構成された Windows Server 2016 RAS ゲートウェイ、およびエッジファイアウォールデバイスが含まれています。 RAS ゲートウェイは、S2S VPN と BGP 接続を終了します。  
  
![RAS VPN サイト対サイトゲートウェイ](../../media/Border-Gateway-Protocol-BGP/bgp_01.jpg)  
  
両方のサイトは、別個の自律システム (AS) の BGP 対応ルーター間で情報を転送できる外部境界ゲートウェイ プロトコル (eBGP) を使用して接続されています。 そのためには、BGP プロトコルに不可欠なパラメーターである識別可能な自律システム番号 (ASN) をエンタープライズと CSP の両方が持っている必要があります。  
  
このシナリオでは、BGP は次のように動作します。  
  
-   エンタープライズ サイトのエッジ デバイスは、BGP を使用してクラウドでホストされている仮想化されたサブネット ルート (10.2.1.0/24) を学習します。 また、このデバイスは、オンプレミスのサブネットルート (10.1.1.0/24) を CSP RAS マルチテナントゲートウェイにアドバタイズします。  
  
-   顧客のエッジ ルーターは、次のいずれかの方法で、内部設置型の内部ルートを学習します。  
  
    -   エッジ デバイスは、内部ルーターで BGP を実行して、内部ルートを学習します (この例では、10.1.1.0/24)。 その一方で、エッジ デバイスから外部ルート (10.2.1.0/24 など) を学習した内部ルーターは、Open Shortest Path First (OSPF)、ルーティング情報プロトコル (RIP) などの内部ゲートウェイ プロトコル (IGP) を使用して、他の内部設置型のルーターに対してこれらのルートを配布する必要があります。  
  
    -   エッジ デバイスでは、静的ルートまたはインターフェイスを構成して、BGP を使用してアドバタイズするルートを選択できます。 さらに、エッジ デバイスは、IGP を使用して外部ルートを他の内部設置型ルーターに配布します。  
  
### <a name="bkmk_top2"></a>エンタープライズサイトのエッジに BGP があるサードパーティのゲートウェイ  
このトポロジは、サード パーティ製のエッジ ルーターを使用して CSP に接続するエンタープライズ サイトを表しています。 エッジ ルーターは、サイト間 VPN ゲートウェイとしても機能します。  
  
![エンタープライズ サイトのエッジに BGP が配置されたサード パーティのゲートウェイ](../../media/Border-Gateway-Protocol-BGP/bgp_02.jpg)  
  
エッジ ルーターは、次のいずれかの方法で、内部設置型の内部ルートを学習します。  
  
-   エッジ デバイスは、内部ルーターで BGP を実行して、内部ルートを学習します (このケースでは、10.1.1.0/24)。  
  
-   エッジ デバイスは、内部ゲートウェイ プロトコル (IGP) を実装し、内部ルーティングに直接参加します。  
  
### <a name="bkmk_top3"></a>CSP クラウドデータセンターに接続する複数のエンタープライズサイト  
このトポロジは、サード パーティ製のゲートウェイを使用して CSP に接続する複数のエンタープライズ サイトを表しています。 サード パーティ製のエッジ デバイスは、サイト間 VPN ゲートウェイと BGP ルーターとして機能します。  
  
![CSP クラウドデータセンターに接続する複数のエンタープライズサイト](../../media/Border-Gateway-Protocol-BGP/bgp_03.jpg)  
  
顧客のエッジ ルーターは、次のいずれかの方法で、内部設置型の内部ルートを学習します。  
  
-   エッジ デバイスは、内部ルーターで BGP を実行して、内部ルートを学習します (このケースでは、10.1.1.0/24)。  
  
-   エッジ デバイスは、内部ゲートウェイ プロトコル (IGP) を実装し、内部ルーティングに直接参加します。  
  
それぞれのエンタープライズ サイトは、直接 eBGP 接続を介して他のサイトからルートを学習します。  
  
それぞれのエンタープライズ サイトは、ホストされているネットワーク ルートを直接的に学習すると共に他のエンタープライズ サイトを使用して学習したうえで、ルートのコストに基づいて最適なルートを選択します。  
  
接続に失敗したため、エンタープライズサイト1の bgp ルーターがエンタープライズサイト2の BGP ルーターに接続できない場合、サイト1の BGP ルーターは、CSP BGP ルーターからエンタープライズサイト2ネットワークへのルートの学習を動的に開始し、トラフィックはシームレスに行われます。CSP の Windows Server BGP ルーターを介して、サイト1からサイト2に再ルーティングされます。  
  
### <a name="bkmk_top4"></a>BGP と VPN の別個の終了ポイント  
このトポロジは、2 つの異なるルーターを BGP のエンドポイントとサイト間 VPN のエンドポイントとして使用するエンタープライズを表しています。 サイト間 VPN は、Windows Server 2016 RAS ゲートウェイ上で終了し、BGP は内部ルーターで終了します。 Csp は、接続の CSP 側で、VPN と BGP の両方の接続を RAS ゲートウェイとして終了します。 この構成では、内部のサード パーティ製のルーター ハードウェアは、IGP への BGP ルートの再配布だけでなく、BGP への IGP ルートの再配布をサポートする必要があります。  
  
![BGP と VPN とで異なる終端点](../../media/Border-Gateway-Protocol-BGP/bgp_04.jpg)  
  
内部のルーターは、次のいずれかの方法で、エンタープライズのルートを学習します。  
  
-   BGP  
  
-   OSPF、RIP などの内部ゲートウェイ プロトコル (IGP)  
  
-   静的なルート構成  
  
エンタープライズ サイトで IGP を使用する場合、内部ルーターは、CSP の仮想ネットワークとローカル エンタープライズ サブネットの間のサブネット接続を維持するために、BGP ルートを IGP ルートに再配布すると共に、IGP ルートを BGP に再配布する必要があります。  
  
この展開では、エンタープライズ RAS ゲートウェイは CSP RAS ゲートウェイとのサイト間 VPN 接続を備えています。これにより、CSP ゲートウェイへのルートがエンタープライズ RAS ゲートウェイに提供されます。 次に、エンタープライズの内部ルーターは、iBGP とエンタープライズ RAS ゲートウェイを使用して、CSP ゲートウェイへのこのルートを学習します。 このため、エンタープライズ内部ルーターは、CSP RAS ゲートウェイの BGP ルーターとのピアリングセッションを確立できるようになります。  
  
この時点以降、エンタープライズ内部ルーターと CSP RAS ゲートウェイは、ルーティング情報を交換します。 エンタープライズ RAS BGP ルーターは、ネットワーク間でパケットを物理的にルーティングするために、CSP ルートとエンタープライズルートを学習します。  
  
## <a name="bkmk_features"></a>BGP の機能  
RAS ゲートウェイの BGP ルーターの機能を次に示します。  
  
**リモートアクセスの役割サービスとしての BGP ルーティング**。 リモートアクセスを BGP LAN ルーターとして使用する場合は、リモートアクセス**サービス (RAS)** の役割サービスをインストールせずに、リモートアクセスサーバーの役割の**ルーティング**役割サービスをインストールできるようになりました。  これにより、BGP ルーターのメモリフットプリントが減少し、動的 BGP ルーティングに必要なコンポーネントのみがインストールされます。 ルーティングの役割サービスは、BGP ルーター VM のみが必要であり、DirectAccess または VPN を使用する必要がない場合に便利です。 さらに、BGP を使用する LAN ルーターとしてリモートアクセスを使用すると、内部ネットワーク上で BGP の動的ルーティングの利点を利用できます。  
  
**BGP 統計情報 (メッセージ カウンター、ルート カウンター)** 。 BGP ルーターは、必要に応じて、 **Get-BgpStatistics** Windows PowerShell コマンドを使用したメッセージおよびルートの統計情報の表示をサポートします。  
  
**等コスト マルチ パス ルーティング (ECMP) のサポート**。 BGP ルーターは ECMP をサポートし、複数の等コスト ルートを BGP ルーティング テーブルおよびスタックに追加できます。 ECMP が有効な場合、BGP ルーターは、データ パケットを送信するためのルートをランダムに選択します。  
  
**HoldTime 構成**。 BGP ルーターは、ネットワーク要件に従った HoldTimer 値の構成をサポートします。 このタイマーは、サード パーティ製のデバイスとの相互運用性を実現するため、または BGP ピアリング セッション タイムアウトの特定の最大時間を保持するために、動的に変更できます。  
  
**内部 BGP と外部 BGP のサポート**。 BGP ルーターでは、iBGP ピアリングと eBGP ピアリングの両方がサポートされます。 これらのピアリングを構成するには、適切な ASN がローカルおよびリモートの BGP ルーターに割り当てられていることを確認する必要があります。 4 つの BGP 展開トポロジのすべてにおいて eBGP ピアリングが使用され、4 番目のトポロジでは iBGP ピアリングも使用されます。  
  
**サード パーティのソリューションとの相互運用**。 BGP ルーターは、最新の BGP バージョン 4 仕様に基づき、主要なサード パーティのほとんどの BGP ルーティング デバイスとの間の相互運用性がテストされています。 詳細については、Request for Comments (RFC) 4271 の [境界ゲートウェイ プロトコル 4 (BGP-4)](https://tools.ietf.org/html/rfc4271)に関するページを参照してください。  
  
**IPv4 と IPv6 のトランスポート ピアリングのサポート**。 BGP ルーターでは、IPv4 ピアリングと IPv6 ピアリングの両方がサポートされます。 ただし、BGP の識別子を BGP ルーターの IPv4 アドレスとして構成する必要があります。 すべての BGP ルーター展開トポロジにおいて、この 2 種類のピアリング (IPV4、IPv6) のどちらかを使用できます。  
  
**IPv4 と IPv6 のユニキャスト ルート学習およびアドバタイズ機能 (マルチプロトコル ネットワーク層到達可能性情報 [NLRI])** 。 セッションを確立するときに適切な機能が他の BGP ルーターにアナウンスされる場合、BGP ルーターは、どのトランスポートを使用するかに関係なく、IPv4 ルートと IPv6 ルートを交換できます。 IPv6 ルーティングを構成するには、IPv6Routing パラメーターを有効にしたうえで、ルーター レベルでローカルなグローバル IPv6 アドレスを構成する必要があります。  
  
**混合モードとパッシブ モードのピアリング**。 Bgp ピアリングセッションは混合モードで構成できます。この場合、bgp ルーターはイニシエーターとレスポンダーの両方、またはパッシブモードとして機能します。 bgp ルーターは、ピアリングを開始せず、着信要求に応答します。 混合モードは既定の設定であり、BGP ピアリングに推奨されます。 これは、デバッグや診断の目的でパッシブ モードを使用する場合を除いて当てはまります。 すべての BGP ルーター展開トポロジにおいて、障害イベントが発生した場合に備えて自動再起動を有効にするために混合モード ピアリングが必要になります。  
  
**ルート属性の書き直し機能**。 Next-Hop、MED、Local-Pref、Community の各 BGP ルーティング ポリシーを使用して、BGP ルーターの受信および送信ルート アドバタイズの次の属性を追加、変更、または削除できます。  
  
**ルート フィルター**。 BGP ルーターは、Prefix、ASN-Range、Community、Next-Hop などの複数のルート属性に基づく受信または送信ルート アドバタイズのフィルター処理をサポートしています。  
  
**ルートリフレクター (rr) および rr クライアント**。 BGP ルーターは、ルートリフレクターおよび RR クライアントとして機能できます。 これは、rr が RR クラスターを形成してネットワークを簡略化できる複雑なトポロジで役立ちます。  
  
**Route-Refresh のサポート**。 BGP ルーターは、Route-Refresh をサポートし、ピアリング時に既定でこの機能をアドバタイズします。 ルート更新メッセージを介してピアから要求されたときにルート更新の新しいセットを送信できるだけでなく、ルート更新を送信して、ピアのルーティングポリシーの変更などのイベントでルーティングテーブルを更新することもできます。 これにより、ピアリングを再起動しなくても、Windows Server 2016 の BGP ルーティングポリシーを変更または更新するシナリオが可能になります。  
  
**静的なルート構成のサポート**。 **Add-BgpCustomRoute** Windows PowerShell コマンドを使用して、BGP ルーター上で静的なルートまたはインターフェイスを構成できます。 構成する静的ルートにはプレフィックスまたはインターフェイスの名前を使用でき、ここからルートが選択されます。 ただし、解決可能な次ホップを持つルートのみが BGP ルーティング テーブルに追加され、ピアにアドバタイズされます。  
  
**トランジット ルーティングのサポート**。 BGP ルーターは、ibgp から iBGP への接続、iBGP から eBGP への接続、および ebgp から eBGP への接続への転送ルーティングをサポートしています。  
  
**フラップダンパーをルーティング**します。 Windows Server 2016 の BGP ルーティングにフラップダンパーをルーティングすると、ルートフラップダンパーがサポートされます。 たとえば、ルートが絶えずアドバタイズされて引き出され、ルーティングテーブルが不安定になっている場合は、BGP ルーターを構成して、ルートにダンパーの重みを割り当ててフラップを監視し、必要に応じてそれを抑制または非表示にすることができます。 これにより、安定したルーティングテーブルを維持し、BGP ルーターによる処理を減らすことができます。  
  
**ルートの集計**。 BGP ルーターにルートを集約することによって、集約ルートを構成し、より詳細なルート広告を概要または集約ルートに置き換えることができます。 その結果、ネットワーク上で送信されるルートアドバタイズメッセージの数が減ります。  
  
> [!NOTE]  
> System Center では、RAS ゲートウェイは Windows Server ゲートウェイと呼ばれます。  
  

  

