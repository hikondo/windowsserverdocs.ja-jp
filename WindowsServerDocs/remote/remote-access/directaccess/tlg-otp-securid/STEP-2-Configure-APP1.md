---
title: 手順 2. の構成
description: このトピックは、「テストラボガイド-OTP 認証を使用した DirectAccess のデモンストレーション」と「RSA SecurID for Windows Server 2016」に含まれています。
manager: brianlic
ms.prod: windows-server
ms.technology: networking-da
ms.topic: article
ms.assetid: 19a7a4a6-9a04-42ea-a5d0-ecb28a34dbaa
ms.author: lizross
author: eross-msft
ms.openlocfilehash: 03cddb638277f04a79cf4f41d6d2df308a1cf50e
ms.sourcegitcommit: d5e27c1f2f168a71ae272bebf8f50e1b3ccbcca3
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/23/2020
ms.locfileid: "86966144"
---
# <a name="step-2-configure-app1"></a>手順 2. の構成

>適用先:Windows Server (半期チャネル)、Windows Server 2016

次の手順を使用して、OTP のサポートに対して "すべて" を準備します。  
  
1. OTP 証明書要求に署名するために使用する証明書テンプレートを作成および展開する。 OTP 証明書要求に署名するために使用する証明書テンプレートを構成します。  
  
2. 企業 CA によって発行された OTP 証明書の証明書テンプレートを作成および展開する。 企業 CA によって発行された OTP 証明書の証明書テンプレートを構成します。  
  
> [!WARNING]  
> このテストラボガイドの設計には、Windows Server 2012 R2 または Windows Server 2012 を実行しているドメインコントローラー、証明機関 (CA) などのインフラストラクチャサーバーが含まれています。 このテストラボガイドを使用して、他のオペレーティングシステムを実行しているインフラストラクチャサーバーを構成することはできません。また、他のオペレーティングシステムを構成する手順については、このガイドでは説明しません。  
  
## <a name="to-create-and-deploy-a-certificate-template-used-to-sign-otp-certificate-requests"></a><a name="DAOTPRA"></a>OTP 証明書要求の署名に使用する証明書テンプレートを作成および展開するには  
  
1.  **Certtmpl**を実行し、enter キーを押します。  
  
2.  [証明書テンプレート] コンソールの [詳細] ウィンドウで、**コンピューター**テンプレートを右クリックし、[**テンプレートの複製**] をクリックします。  
  
3.  [**新しいテンプレートのプロパティ**] ダイアログボックスの [**互換性**] タブで、[**証明機関**] の一覧から目的のオペレーティングシステムを選択し、[**結果の変更**] ダイアログボックスで [ **OK**] をクリックします。 [**証明書の受信者**] の一覧で、目的のオペレーティングシステムを選択し、[**結果の変更**] ダイアログボックスで [ **OK**] をクリックします。  
  
4.  [**新しいテンプレートのプロパティ**] ダイアログボックスの [**全般**] タブをクリックします。  
  
5.  [**全般**] タブの [**テンプレートの表示名**] に「 **DAOTPRA**」と入力します。 **有効期間**を2日間に設定し、**更新期間**を1日に設定します。 **証明書テンプレート**の警告が表示されたら、[ **OK]** をクリックします。  
  
6.  **[セキュリティ]** タブをクリックし、**[追加]** をクリックします。  
  
7.  [**ユーザー、コンピューター、サービスアカウントまたはグループの選択**] ダイアログボックスで、[**オブジェクトの種類**] をクリックします。 [**オブジェクトの種類**] ダイアログボックスで、[**コンピューター**] を選択し、[ **OK**] をクリックします。 [**選択するオブジェクト名を入力してください**] ボックスに「 **EDGE1**」と入力し、[OK] をクリックします。 [**許可** **]** 列で、[**読み取り**]、[**登録**]、[**自動登録**] の各チェックボックスをオンにします。 [ **Authenticated Users**] をクリックし、[**許可**] 列の下の [**読み取り**] チェックボックスをオンにして、他のすべてのチェックボックスをオフにします。 [**ドメインコンピューター**] をクリックし、[**許可**] 列で [**登録**] をオフにします。 [ **Domain admins**と**Enterprise Admins** ] をクリックし、両方の [**許可**] 列の下にある [**フルコントロール**] をクリックします。 **[Apply]** をクリックします。  
  
8.  [**サブジェクト名**] タブをクリックし、[**この Active Directory の情報から構築**する] をクリックします。 [**サブジェクト名の形式**] ボックスの一覧で [ **dns 名**] を選択し、[ **dns 名**] ボックスがオンになっていることを確認して、[**適用**] をクリックします。  
  
9. [**拡張**] タブをクリックし、[**アプリケーションポリシー** ] を選択して、[**編集**] をクリックします。 既存のアプリケーションポリシーをすべて削除します。 [**追加**] をクリックし、[**アプリケーションポリシーの追加**] ダイアログボックスで [**新規**] をクリックし、[名前] フィールドに **「** **DA OTP RA** 」と入力し、[**オブジェクト識別子:** ] フィールドに**1.3.6.1.4.1.311.81.1.1**を入力して、[ **OK]** をクリックします。 [**アプリケーションポリシーの追加**] ダイアログボックスで、[ **OK]** をクリックします。 [**アプリケーションポリシー拡張の編集**] で、[ **OK]** をクリックします。 [**新しいテンプレートのプロパティ**] ダイアログボックスで、[ **OK]** をクリックします。  
  
## <a name="to-create-and-deploy-a-certificate-template-for-otp-certificates-issued-by-the-corporate-ca"></a><a name="DAOTPLogon"></a>企業 CA によって発行された OTP 証明書の証明書テンプレートを作成して展開するには  
  
1.  [証明書テンプレート] コンソールの [詳細] ウィンドウで、[**スマートカードログオン**] テンプレートを右クリックし、[**テンプレートの複製**] をクリックします。  
  
2.  [**新しいテンプレートのプロパティ**] ダイアログボックスの [**証明機関**] 一覧の [**互換性**] タブで、使用するオペレーティングシステムをクリックし、[**結果の変更**] ダイアログボックスで [ **OK**] をクリックします。 [**証明書の受信者**] 一覧で、使用するオペレーティングシステムを選択し、[**結果の変更**] ダイアログボックスで [ **OK**] をクリックします。  
  
3.  [**新しいテンプレートのプロパティ**] ダイアログボックスの [**全般**] タブをクリックします。  
  
4.  [**全般**] タブの [**テンプレートの表示名**] に「 **DAOTPLogon**」と入力します。 [**有効期間**] のドロップダウンリストで、[**時間**] をクリックし、[**証明書テンプレート**] ダイアログボックスで [ **OK**] をクリックし、時間数が1に設定されていることを確認します。 [**更新期間**] に「 **0**」と入力します。  
  
    > [!IMPORTANT]  
    > **Windows Server 2003 CA**。 証明機関 (CA) が Windows Server 2003 を実行しているコンピューター上にある場合は、証明書テンプレートを別のコンピューターで構成する必要があります。 Windows Server 2008 および Windows Vista より前のバージョンの Windows を実行している場合は、**有効期間**を時間単位で設定することはできないため、これが必要になります。 テンプレートの構成に使用するコンピューターに、Active Directory 証明書サービスサーバーの役割がインストールされていない場合、またはクライアントコンピューターの場合は、証明書テンプレートスナップインのインストールが必要になることがあります。 詳細については、「[証明書テンプレートスナップインをインストールする](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc732445(v=ws.11))」を参照してください。  
    >   
    > **Windows Server 2008 R2 CA**。 Windows Server 2008 R2 を実行している証明機関 (CA) を既に展開している場合は、証明書テンプレートの**更新期間**を1または2時間に設定し、**有効期間**を**更新期間**より長くする必要がありますが、4時間以内にする必要があります。 Windows Server 2008 R2 を実行している CA で、証明書テンプレートの**有効期間**を4時間より長く構成した場合、directaccess インストールウィザードで証明書テンプレートを検出できず、directaccess のインストールが失敗します。  
  
5.  [**セキュリティ**] タブをクリックし、[**許可**] 列で [ **Authenticated Users**] を選択し、[**読み取り**] および [**登録**] チェックボックスをオンにします。 **[OK]** をクリックします。 [ **Domain admins**と**Enterprise Admins**] をクリックし、両方の [**許可**] 列の下にある [**フルコントロール**] をクリックします。 **[Apply]** をクリックします。  
  
6.  [**サブジェクト名**] タブをクリックし、[**この Active Directory の情報から構築**する] をクリックします。 [**サブジェクト名の形式**] で、[**完全な識別名**を選択します] を選択し、[**ユーザープリンシパル名 (UPN)** ] ボックスがオンになっていることを確認して、[**適用**] をクリックします。  
  
7.  [**サーバー** ] タブをクリックし、[ **CA データベースに証明書と要求を保存**しない] チェックボックスをオンにし、[**発行された証明書に失効情報を含め**ない] チェックボックスをオフにして、[**新しいテンプレートのプロパティ**] ダイアログボックスで [**適用**] をクリックします。  
  
8.  [**発行の要件**] タブをクリックし、[この許可された**署名の数**] チェックボックスをオンにして、値を1に設定します。 [**署名に必要なポリシーの種類**] ボックスの一覧で、[**アプリケーションポリシー**] を選択し、[**アプリケーションポリシー** ] の一覧で [ **DA OTP RA**] を選択します。 [**新しいテンプレートのプロパティ**] ダイアログボックスで、[ **OK]** をクリックします。  
  
9. [**拡張**] タブをクリックし、[**アプリケーションポリシー** ] で [**編集**] をクリックします。 **クライアント認証**を削除し、 **smartcardlogon**を保持し、[ **OK]** を2回クリックします。  
  
10. 証明書テンプレート コンソールを閉じます。  
  
11. [**スタート**] 画面で、「**certsrv**」と入力し、enter キーを押します。  
  
12. [証明機関] コンソールツリーで、[ **corp-CA-1**] を展開し、[**証明書テンプレート**] をクリックします。 [**証明書**テンプレート] を右クリックし、[**新規作成**] をポイントして [**発行する証明書テンプレート**] をクリックします。  
  
13. 証明書テンプレートの一覧で、[ **DAOTPRA** and **DAOTPLogon**] をクリックし、[ **OK**] をクリックします。  
  
14. コンソールの詳細ウィンドウに、 **DAOTPRA**証明書テンプレートが表示されます。このテンプレートには、 **DA OTP RA**と**DAOTPLogon**証明書テンプレートが使用さ**れ、** **スマートカードログオン**が**意図**されています。  
  
15. サービスを再び開始します。  
  
16. 証明機関コンソールを閉じます。  
  
17. 管理者特権のコマンド プロンプトを開きます。 「 **CertUtil.exe-SetReg DBFlags + DBFLAGS_ENABLEVOLATILEREQUESTS**」と入力し、enter キーを押します。  
  
18. 次の手順のために、コマンドプロンプトウィンドウを開いたままにします。  
  
