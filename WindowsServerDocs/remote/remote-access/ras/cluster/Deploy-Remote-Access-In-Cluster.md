---
title: クラスターでのリモート アクセスの展開
description: このトピックは、「Windows Server 2016 のクラスターにリモートアクセスを展開する」の一部です。
manager: dougkim
ms.topic: article
ms.author: lizross
author: eross-msft
ms.openlocfilehash: c1d0a9490a2b2ef6efbd15f39ec95f1b482efd5e
ms.sourcegitcommit: dfa48f77b751dbc34409aced628eb2f17c912f08
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/07/2020
ms.locfileid: "87944172"
---
# <a name="deploy-remote-access-in-a-cluster"></a>クラスターでのリモート アクセスの展開

>適用先:Windows Server (半期チャネル)、Windows Server 2016

Windows Server 2016 および Windows Server 2012 では、DirectAccess とリモートアクセスサービス \( \) の RAS VPN が1つのリモートアクセスの役割に結合されます。 リモートアクセスは、さまざまなエンタープライズシナリオで展開できます。 この概要では、Windows ネットワーク負荷分散 \( NLB \) または \( F5 Big IP などの外部ロードバランサー elb を使用して負荷分散されたクラスターに複数のリモートアクセスサーバーを展開するエンタープライズシナリオの概要について説明し \) \- ます。

## <a name="scenario-description"></a><a name="BKMK_OVER"></a>シナリオの説明
クラスター展開では、複数のリモートアクセスサーバーを1つのユニットに収集します。これは、リモートアクセスクラスターの外部仮想 IP VIP アドレスを使用して、DirectAccess または VPN 経由で内部企業ネットワークに接続するリモートクライアントコンピューターの単一の接続ポイントとして機能し \( \) ます。  クラスターへのトラフィックは、Windows NLB を使用して、または F5 Big IP などの外部ロードバランサーを使用して負荷分散され \( \- \) ます。

## <a name="prerequisites"></a>前提条件
このシナリオの展開を開始する前に、重要な要件の一覧を確認してください。

-   Windows NLB による既定の負荷分散。

-   外部のロード バランサーがサポートされます。

-   ユニキャスト モードが NLB の既定であり推奨されるモードです。

-   DirectAccess 管理コンソールまたは Windows PowerShell コマンドレットを使用しないポリシーの変更はサポートされていません。

-   NLB または外部ロードバランサーが使用されている場合、IPHTTPS プレフィックスを59以外のものに変更することはできません \/ 。

-   負荷分散されるノードは、同じ IPv4 サブネット内にある必要があります。

-   ELB の展開では、管理が必要な場合、DirectAccess クライアントは Teredo を使用できません &nbsp; 。 エンドツーエンド通信には、IPHTTPS のみを使用でき \- \- ます。

-   すべて \/ の既知の NLB elb 修正プログラムがインストールされていることを確認します。

-   企業ネットワーク内での ISATAP はサポートしていません。 ISATAP を使用している場合は、これを削除し、ネイティブ IPv6 を使用する必要があります。

## <a name="in-this-scenario"></a>このシナリオの内容
クラスター展開シナリオには、いくつかの手順があります。

1.  [高度なオプションを使用して Always ON VPN サーバーを展開](../../vpn/always-on-vpn/deploy/always-on-vpn-adv-options.md)します。 クラスターの展開をセットアップする前に、詳細設定のある単一のリモートアクセスサーバーを展開する必要があります。

2.  [リモートアクセスクラスターの展開を計画](plan/Plan-a-Remote-Access-Cluster-Deployment.md)します。 単一サーバーの展開からクラスターを構築するには、クラスター展開用の証明書の準備など、いくつかの追加の手順が必要です。

3.  [リモートアクセスクラスターを構成](configure/Configure-a-Remote-Access-Cluster.md)します。 これは、Windows NLB または外部ロードバランサー用の単一サーバーの準備、クラスターに参加するための追加のサーバーの準備、負荷分散の有効化など、さまざまな構成手順で構成されています。

## <a name="practical-applications"></a><a name="BKMK_APP"></a>実際の適用例
複数のサーバーをサーバー クラスターにまとめると、次のことが実現されます。

-   スケーラビリティ。 1台のリモートアクセスサーバーでは、限られたレベルのサーバー信頼性と拡張性の高いパフォーマンスが提供されます。 2 台以上のサーバーのリソースを 1 つのクラスターにグループ化すると、対応可能なユーザー数とスループットの容量が増加します。

-   高可用性: クラスターは、always on アクセスの高可用性を提供 \- します。 クラスター内のサーバーで障害が発生しても、リモート ユーザーはクラスター内の別のサーバーを経由して企業ネットワークに引き続きアクセスすることができます。 クラスター内のすべてのサーバーは、同じクラスター仮想 IP VIP アドレスのセットを持ちますが、 \( \) サーバーごとに一意の専用 IP アドレスを維持します。

-   \-管理の容易さ \- 。 クラスターを使用すると、複数のサーバーを1つのエンティティとして管理できます。 クラスター サーバー全体で共有設定を簡単に設定できます。 リモートアクセスの設定は、クラスター内の任意のサーバーから管理することも、リモートサーバー管理ツール RSAT を使用してリモートで管理することもでき \( \) ます。 また、単一のリモート アクセス管理コンソールからクラスター全体を監視できます。

## <a name="roles-and-features-included-in-this-scenario"></a><a name="BKMK_NEW"></a>このシナリオに含まれている役割と機能
次の表に、このシナリオに必要な役割と機能を示します。

|ロール \/ 機能|このシナリオのサポート方法|
|---------|-----------------|
|リモート アクセスの役割|この役割をインストールまたはアンインストールするには、サーバー マネージャー コンソールを使用します。 これには、以前は Windows Server 2008 R2 の機能であった DirectAccess と、 \( \) 以前はネットワークポリシーとアクセスサービス NPAS サーバーの役割の役割サービスであったリモートアクセスサービス RRAS の両方が含まれてい \( \) ます。 リモート アクセスの役割は、次の 2 つのコンポーネントで構成されています。<p>-Always On VPN とルーティングとリモートアクセスサービス \( RRAS \) VPN-DIRECTACCESS と VPN は、リモートアクセス管理コンソールで一緒に管理されます。<br />-RRAS ルーティング-RRAS ルーティング機能は、従来のルーティングとリモートアクセスコンソールで管理されます。<p>依存関係は次のとおりです。<p>-インターネットインフォメーションサービス \( IIS \) Web サーバー-この機能は、ネットワークロケーションサーバーと既定の Web プローブを構成するために必要です。<br />-Windows Internal Database-リモートアクセスサーバーのローカルアカウンティングに使用されます。|
|リモート アクセス管理ツールの機能|この機能は、次のようにインストールされます。<p>-リモートアクセスの役割をインストールするときに、リモートアクセスサーバーに既定でインストールされ、リモート管理コンソールのユーザーインターフェイスをサポートします。<br />-必要に応じて、リモートアクセスサーバーの役割を実行していないサーバーにインストールできます。 この場合は、DirectAccess および VPN が実行されているリモート アクセス コンピューターのリモート管理に使用されます。<p>リモート アクセス管理ツールの機能は、次の要素で構成されています。<p>-リモートアクセス GUI およびコマンドラインツール<br />-Windows PowerShell 用リモートアクセスモジュール<p>次の要素と依存関係があります。<p>-グループポリシー管理コンソール<br />-RAS 接続マネージャー管理キット ( \( CMAK)\)<br />-Windows PowerShell 3.0<br />-グラフィカル管理ツールとインフラストラクチャ|
|ネットワーク負荷分散|この機能により、Windows NLB を使用してクラスターの負荷を分散します。|

## <a name="hardware-requirements"></a><a name="BKMK_HARD"></a>ハードウェア要件
このシナリオのハードウェア要件は次のとおりです。

-   少なくとも2台のコンピューターで、Windows Server 2012 のハードウェア要件を満たしている必要があります。

-   外部 Load Balancer シナリオでは、専用のハードウェアが必要です。 \( つまり、F5 BigIP です \) 。

-   このシナリオをテストするには、Always On VPN クライアントとして構成された Windows 10 を実行しているコンピューターが少なくとも1台必要です。

## <a name="software-requirements"></a><a name="BKMK_SOFT"></a>ソフトウェア要件
このシナリオには、さまざまな要件があります。

-   単一サーバーの展開のソフトウェア要件。 詳細について[は、「単一の DirectAccess サーバーを拡張設定で展開する](../../directaccess/single-server-advanced/Deploy-a-Single-DirectAccess-Server-with-Advanced-Settings.md)」を参照してください。 1つのリモートアクセス)。

-   単一サーバーのソフトウェア要件に加えて、クラスター固有の要件がいくつかあり \- ます。

    -   各クラスターサーバーで、IP \- HTTPS 証明書のサブジェクト名が ConnectTo アドレスと一致している必要があります。 クラスター展開では、クラスターサーバーでワイルドカードとワイルドカード以外の証明書の組み合わせをサポートしてい \- ます。

    -   ネットワーク ロケーション サーバーがリモート アクセス サーバーにインストールされている場合、各クラスター サーバーで、ネットワーク ロケーション サーバー証明書に同じサブジェクト名が含まれている必要があります。 また、ネットワーク ロケーション サーバーの証明書の名前は、DirectAccess の展開内のどのサーバーの名前とも一致していてはなりません。

    -   IP \- HTTPS およびネットワークロケーションサーバーの証明書は、単一サーバーに対して発行された証明書と同じ方法で発行する必要があります。 たとえば、1台のサーバーでパブリック証明機関の CA を使用する場合、 \( \) クラスター内のすべてのサーバーは、パブリック CA によって発行された証明書を持っている必要があります。 または、単一サーバーが IP HTTPS に自己署名証明書を使用している場合は \- \- 、クラスター内のすべてのサーバーが同様に実行する必要があります。

    -   サーバー クラスターの DirectAccess クライアント コンピューターに割り当てられている IPv6 プレフィックスは 59 ビットである必要があります。 VPN が有効な場合は、VPN プレフィックスも 59 ビットである必要があります。

## <a name="known-issues"></a><a name="KnownIssues"></a>既知の問題
クラスター構成シナリオには、次の既知の問題があります。

-   単一のネットワークアダプターを使用する IPv4 のみの展開で DirectAccess を構成し、 \- 既定の DNS64 の後に \( ": 3333::" を含む ipv6 アドレス \) がネットワークアダプターで自動的に構成された後、リモートアクセス管理コンソールを使用して負荷分散を有効にしようとすると、 \- ユーザーに対して IPv6 DIP を指定するように求められます。 IPv6 DIP を指定すると、**[コミット]** をクリックした後に "パラメーターが正しくありません" というエラーで構成が失敗します。

    この問題を解決するには、次の手順を実行します。

    1.  「[Back up and Restore Remote Access Configuration (リモート アクセスの構成のバックアップと復元)](https://gallery.technet.microsoft.com/Back-up-and-Restore-Remote-e157e6a6)」からバックアップおよび復元用のスクリプトをダウンロードします。

    2.  ダウンロードしたスクリプトのバックアップを使用して、リモートアクセス Gpo をバックアップ \-RemoteAccess.ps1

    3.  失敗した手順まで、負荷分散の有効化を試みます。 [負荷分散の有効化] ダイアログボックスで、詳細領域を展開し、 \- 詳細領域を右クリックして、[**スクリプトのコピー**] をクリックします。

    4.  メモ帳を開き、クリップボードの内容を貼り付けます。 例:

        ```
        Set-RemoteAccessLoadBalancer -InternetDedicatedIPAddress @('10.244.4.19 /255.255.255.0','fdc4:29bd:abde:3333::2/128') -InternetVirtualIPAddress @('fdc4:29bd:abde:3333::1/128', '10.244.4.21 /255.255.255.0') -ComputerName 'DA1.domain1.corp.contoso.com' -Verbose
        ```

    5.  開いているリモート アクセス ダイアログ ボックスをすべて閉じ、リモート アクセス管理コンソールを閉じます。

    6.  貼り付けたテキストを編集して、IPv6 アドレスを削除します。 例:

        ```
        Set-RemoteAccessLoadBalancer -InternetDedicatedIPAddress @('10.244.4.19 /255.255.255.0') -InternetVirtualIPAddress @('10.244.4.21 /255.255.255.0') -ComputerName 'DA1.domain1.corp.contoso.com' -Verbose
        ```

    7.  管理者特権の PowerShell ウィンドウで、前の手順のコマンドを実行します。

    8.  入力値が正しくないためにコマンドレットが実行されていない場合に失敗する場合は、 \( \) コマンド復元RemoteAccess.ps1 を実行 \- し、指示に従って元の構成の整合性が維持されていることを確認します。

    9. リモート アクセス管理コンソールを再び開くことができるようになります。
