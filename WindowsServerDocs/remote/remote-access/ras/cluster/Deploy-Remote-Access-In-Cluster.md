---
title: クラスターでのリモート アクセスの展開
description: このトピックは、「Windows Server 2016 のクラスターにリモートアクセスを展開する」の一部です。
manager: dougkim
ms.prod: windows-server
ms.technology: networking-ras
ms.topic: article
ms.author: lizross
author: eross-msft
ms.openlocfilehash: 7b9ab144c19b81d2229ea0618aebc9a94b9fdccf
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/08/2020
ms.locfileid: "80861465"
---
# <a name="deploy-remote-access-in-a-cluster"></a>クラスターでのリモート アクセスの展開

>適用対象: Windows Server (半期チャネル)、Windows Server 2016

Windows Server 2016 および Windows Server 2012 は、DirectAccess とリモートアクセスサービス \(RAS\) VPN を1つのリモートアクセスの役割に結合します。 リモートアクセスは、さまざまなエンタープライズシナリオで展開できます。 この概要では、Windows ネットワーク負荷分散 \(NLB\) を使用して負荷分散されたクラスターに複数のリモートアクセスサーバーを展開するエンタープライズシナリオの概要を説明します。または、\(ELB\)(たとえば、F5 Big\-IP など) の外部ロードバランサーを使用して負荷分散します。  

## <a name="scenario-description"></a><a name="BKMK_OVER"></a>シナリオの説明  
クラスター展開では、複数のリモートアクセスサーバーを1つのユニットに収集します。これは、リモートアクセスクラスターの外部仮想 IP \(VIP\) アドレスを使用して、DirectAccess または VPN 経由で内部企業ネットワークに接続するリモートクライアントコンピューターの単一の接続ポイントとして機能します。  クラスターへのトラフィックは、Windows NLB を使用して、または F5 Big\-IP\)などの外部ロードバランサー \(で負荷分散されます。  

## <a name="prerequisites"></a>前提条件  
このシナリオの展開を開始する前に、重要な要件の一覧を確認してください。  

-   Windows NLB による既定の負荷分散。  

-   外部のロード バランサーがサポートされます。  

-   ユニキャスト モードが NLB の既定であり推奨されるモードです。  

-   DirectAccess 管理コンソールまたは Windows PowerShell コマンドレットを使用しないポリシーの変更はサポートされていません。  

-   NLB または外部ロードバランサーが使用されている場合、IPHTTPS プレフィックスを \/59 以外のものに変更することはできません。  

-   負荷分散されるノードは、同じ IPv4 サブネット内にある必要があります。  

-   ELB の展開では、管理が必要な場合、DirectAccess クライアントは&nbsp;Teredo を使用できません。 エンド\-\-エンドコミュニケーションに使用できるのは、IPHTTPS だけです。  

-   すべての既知の NLB\/ELB 修正プログラムがインストールされていることを確認します。  

-   企業ネットワーク内での ISATAP はサポートしていません。 ISATAP を使用している場合は、これを削除し、ネイティブ IPv6 を使用する必要があります。  

## <a name="in-this-scenario"></a>このシナリオの内容  
クラスター展開シナリオには、いくつかの手順があります。  

1.  [高度なオプションを使用して Always ON VPN サーバーを展開](../../vpn/always-on-vpn/deploy/always-on-vpn-adv-options.md)します。 クラスターの展開をセットアップする前に、詳細設定のある単一のリモートアクセスサーバーを展開する必要があります。  

2.  [リモートアクセスクラスターの展開を計画](plan/Plan-a-Remote-Access-Cluster-Deployment.md)します。 単一サーバーの展開からクラスターを構築するには、クラスター展開用の証明書の準備など、いくつかの追加の手順が必要です。  

3.  [リモートアクセスクラスターを構成](configure/Configure-a-Remote-Access-Cluster.md)します。 これは、Windows NLB または外部ロードバランサー用の単一サーバーの準備、クラスターに参加するための追加のサーバーの準備、負荷分散の有効化など、さまざまな構成手順で構成されています。  

## <a name="practical-applications"></a><a name="BKMK_APP"></a>実用的なアプリケーション  
複数のサーバーをサーバー クラスターにまとめると、次のことが実現されます。  

-   スケーラビリティ。 1台のリモートアクセスサーバーでは、限られたレベルのサーバー信頼性と拡張性の高いパフォーマンスが提供されます。 2 台以上のサーバーのリソースを 1 つのクラスターにグループ化すると、対応可能なユーザー数とスループットの容量が増加します。  

-   高可用性 : クラスターは、常に\-アクセスに高可用性を提供します。 クラスター内のサーバーで障害が発生しても、リモート ユーザーはクラスター内の別のサーバーを経由して企業ネットワークに引き続きアクセスすることができます。 クラスター内のすべてのサーバーは、同じクラスター仮想 IP \(VIP\) アドレスのセットを持ち、サーバーごとに一意の専用 IP アドレスを維持します。  

-   \-管理の\-を簡単にします。 クラスターを使用すると、複数のサーバーを1つのエンティティとして管理できます。 クラスター サーバー全体で共有設定を簡単に設定できます。 リモートアクセスの設定は、クラスター内の任意のサーバーから管理することも、リモートサーバー管理ツール \(RSAT\)を使用してリモートで管理することもできます。 また、単一のリモート アクセス管理コンソールからクラスター全体を監視できます。  

## <a name="roles-and-features-included-in-this-scenario"></a><a name="BKMK_NEW"></a>このシナリオに含まれる役割と機能  
次の表に、このシナリオに必要な役割と機能を示します。  

|役割\/機能|このシナリオのサポート方法|  
|---------|-----------------|  
|リモート アクセスの役割|この役割をインストールまたはアンインストールするには、サーバー マネージャー コンソールを使用します。 これには、以前は Windows Server 2008 R2 の機能であった DirectAccess と、ルーティングとリモートアクセスサービス \(RRAS\)が含まれていました。これは、以前はネットワークポリシーとアクセスサービス \(NPAS\) サーバーロールの役割サービスです。 リモート アクセスの役割は、次の 2 つのコンポーネントで構成されています。<p>-Always On VPN およびルーティングとリモートアクセスサービス \(RRAS\) VPN-DirectAccess と VPN は、リモートアクセス管理コンソールで一緒に管理されます。<br />-RRAS ルーティング-RRAS ルーティング機能は、従来のルーティングとリモートアクセスコンソールで管理されます。<p>依存関係は次のとおりです。<p>-インターネットインフォメーションサービス \(IIS\) Web サーバー-この機能は、ネットワークロケーションサーバーと既定の web プローブを構成するために必要です。<br />-Windows Internal Database-リモートアクセスサーバーのローカルアカウンティングに使用されます。|  
|リモート アクセス管理ツールの機能|この機能は、次のようにインストールされます。<p>-リモートアクセスの役割をインストールするときに、リモートアクセスサーバーに既定でインストールされ、リモート管理コンソールのユーザーインターフェイスをサポートします。<br />-必要に応じて、リモートアクセスサーバーの役割を実行していないサーバーにインストールできます。 この場合は、DirectAccess および VPN が実行されているリモート アクセス コンピューターのリモート管理に使用されます。<p>リモート アクセス管理ツールの機能は、次の要素で構成されています。<p>-リモートアクセス GUI およびコマンドラインツール<br />-Windows PowerShell 用リモートアクセスモジュール<p>次の要素と依存関係があります。<p>-グループポリシー管理コンソール<br />-RAS 接続マネージャー管理キット \(CMAK\)<br />-Windows PowerShell 3.0<br />-グラフィカル管理ツールとインフラストラクチャ|  
|ネットワーク負荷分散|この機能により、Windows NLB を使用してクラスターの負荷を分散します。|  

## <a name="hardware-requirements"></a><a name="BKMK_HARD"></a>ハードウェア要件  
このシナリオのハードウェア要件は次のとおりです。  

-   少なくとも2台のコンピューターで、Windows Server 2012 のハードウェア要件を満たしている必要があります。  

-   外部 Load Balancer シナリオでは、専用のハードウェアが必要です。つまり、F5 BigIP\)\(ます。  

-   このシナリオをテストするには、Always On VPN クライアントとして構成された Windows 10 を実行しているコンピューターが少なくとも1台必要です。   

## <a name="software-requirements"></a><a name="BKMK_SOFT"></a>ソフトウェア要件  
このシナリオには、さまざまな要件があります。  

-   単一サーバーの展開のソフトウェア要件。 詳細について[は、「単一の DirectAccess サーバーを拡張設定で展開する](../../directaccess/single-server-advanced/Deploy-a-Single-DirectAccess-Server-with-Advanced-Settings.md)」を参照してください。 1つのリモートアクセス)。  

-   単一サーバーのソフトウェア要件に加えて、クラスター\-固有の要件がいくつかあります。  

    -   各クラスターサーバーで、IP\-の HTTPS 証明書のサブジェクト名が ConnectTo アドレスと一致している必要があります。 クラスター展開では、クラスターサーバー上でワイルドカードと非\-ワイルドカード証明書の組み合わせをサポートしています。  

    -   ネットワーク ロケーション サーバーがリモート アクセス サーバーにインストールされている場合、各クラスター サーバーで、ネットワーク ロケーション サーバー証明書に同じサブジェクト名が含まれている必要があります。 また、ネットワーク ロケーション サーバーの証明書の名前は、DirectAccess の展開内のどのサーバーの名前とも一致していてはなりません。  

    -   IP\-HTTPS およびネットワークロケーションサーバーの証明書は、単一サーバーに対して発行された証明書と同じ方法で発行する必要があります。 たとえば、1台のサーバーが公共の証明機関 \(CA\) 使用する場合、クラスター内のすべてのサーバーは、パブリック CA によって発行された証明書を持っている必要があります。 または、単一サーバーで、IP\-HTTPS に自己\-署名入り証明書を使用する場合は、クラスター内のすべてのサーバーが同様に実行する必要があります。  

    -   サーバー クラスターの DirectAccess クライアント コンピューターに割り当てられている IPv6 プレフィックスは 59 ビットである必要があります。 VPN が有効な場合は、VPN プレフィックスも 59 ビットである必要があります。  

## <a name="known-issues"></a><a name="KnownIssues"></a>既知の問題  
クラスター構成シナリオには、次の既知の問題があります。  

-   1つのネットワークアダプターを使用して IPv4\-のみの展開で DirectAccess を構成し、既定の DNS64 \(": 3333::\)" を含む IPv6 アドレスをネットワークアダプターに自動的に構成した後、リモートアクセス管理コンソールを使用して負荷\-分散を有効にしようとすると、ユーザーに IPv6 DIP の入力を求めるメッセージが表示されます。 IPv6 DIP を指定すると、 **[コミット]** をクリックした後に "パラメーターが正しくありません" というエラーで構成が失敗します。  

    この問題を解決するには、次の手順を実行します。  

    1.  「 [Back up and Restore Remote Access Configuration (リモート アクセスの構成のバックアップと復元)](https://gallery.technet.microsoft.com/Back-up-and-Restore-Remote-e157e6a6)」からバックアップおよび復元用のスクリプトをダウンロードします。  

    2.  ダウンロードしたスクリプトを使用してリモートアクセス Gpo をバックアップします。\-、RemoteAccess. ps1  

    3.  失敗した手順まで、負荷分散の有効化を試みます。 [負荷分散の有効化] ダイアログボックスで、詳細領域を展開し、詳細領域を右\-クリックして、 **[スクリプトのコピー]** をクリックします。  

    4.  メモ帳を開き、クリップボードの内容を貼り付けます。 例 :  

        ```  
        Set-RemoteAccessLoadBalancer -InternetDedicatedIPAddress @('10.244.4.19 /255.255.255.0','fdc4:29bd:abde:3333::2/128') -InternetVirtualIPAddress @('fdc4:29bd:abde:3333::1/128', '10.244.4.21 /255.255.255.0') -ComputerName 'DA1.domain1.corp.contoso.com' -Verbose  
        ```  

    5.  開いているリモート アクセス ダイアログ ボックスをすべて閉じ、リモート アクセス管理コンソールを閉じます。  

    6.  貼り付けたテキストを編集して、IPv6 アドレスを削除します。 例 :  

        ```  
        Set-RemoteAccessLoadBalancer -InternetDedicatedIPAddress @('10.244.4.19 /255.255.255.0') -InternetVirtualIPAddress @('10.244.4.21 /255.255.255.0') -ComputerName 'DA1.domain1.corp.contoso.com' -Verbose  
        ```  

    7.  管理者特権の PowerShell ウィンドウで、前の手順のコマンドを実行します。  

    8.  入力値\)が正しくないためにコマンドレットを \(実行中にエラーが発生した場合は、コマンド Restore\-RemoteAccess. ps1 を実行し、指示に従って元の構成の整合性が維持されているかどうかを確認します。  

    9. リモート アクセス管理コンソールを再び開くことができるようになります。  
