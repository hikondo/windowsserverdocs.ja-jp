---
title: 手順2マルチサイトインフラストラクチャを計画する
description: このトピックは、「Windows Server 2016 のマルチサイト展開に複数のリモートアクセスサーバーを展開する」の一部です。
manager: brianlic
ms.prod: windows-server
ms.technology: networking-ras
ms.topic: article
ms.assetid: 64c10107-cb03-41f3-92c6-ac249966f574
ms.author: lizross
author: eross-msft
ms.openlocfilehash: 61d4faafa91a685cad50b4f47aaad8efd9b9a500
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/08/2020
ms.locfileid: "80858345"
---
# <a name="step-2-plan-the-multisite-infrastructure"></a>手順2マルチサイトインフラストラクチャを計画する

>適用対象: Windows Server (半期チャネル)、Windows Server 2016

マルチサイトトポロジにリモートアクセスを展開するための次の手順は、マルチサイトインフラストラクチャの計画を完了することです。、Active Directory、セキュリティグループ、グループポリシーオブジェクトを含む。  
## <a name="21-plan-active-directory"></a><a name="bkmk_2_1_AD"></a>2.1 計画 Active Directory  
リモートアクセスのマルチサイト展開は、さまざまなトポロジで構成できます。  
  
-   **単一 Active Directory サイト、複数のエントリポイント**-このトポロジでは、サイト全体に高速イントラネットリンクを使用して組織全体に1つの Active Directory サイトを配置しますが、組織全体に複数のリモートアクセスサーバーを展開し、それぞれがエントリポイントとして機能します。 このトポロジの地理的な例としては、米国用の単一の Active Directory サイトがあり、東海岸と西海岸にエントリポイントがあります。  
  
    ![マルチサイトインフラストラクチャ](../../../../media/Step-2-Plan-the-Multisite-Infrastructure/RAMultisiteTopo1.png)  
  
-   **複数の Active Directory サイト、複数のエントリポイント**-このトポロジでは、各サイトのエントリポイントとしてリモートアクセスサーバーが展開されている2つ以上の Active Directory サイトがあります。 各リモートアクセスサーバーは、サイトの Active Directory ドメインコントローラーに関連付けられています。 このトポロジの地理的な例としては、米国用の Active Directory サイトと、各サイトの1つのエントリポイントを持つヨーロッパ用のサイトがあります。 複数の Active Directory サイトがある場合は、各サイトにエントリポイントが関連付けられている必要はありません。 また、一部の Active Directory サイトには、複数のエントリポイントを関連付けることができます。  
  
    ![マルチサイトトポロジ](../../../../media/Step-2-Plan-the-Multisite-Infrastructure/RAMultisiteTopo2.png)  
  
マルチサイトエントリポイントでは、単一のリモートアクセスサーバー、複数のリモートアクセスサーバー、またはリモートアクセスサーバークラスターを構成できます。   
  
### <a name="active-directory-best-practices-and-recommendations"></a>Active Directory のベストプラクティスと推奨事項  
マルチサイトシナリオでの Active Directory の展開については、次の推奨事項と制約事項に注意してください。  
  
1.  各 Active Directory サイトには、1つまたは複数のリモートアクセスサーバー、またはクライアントコンピューターのマルチサイトエントリポイントとして機能するサーバークラスターを含めることができます。 ただし、Active Directory サイトにエントリポイントを設定する必要はありません。  
  
2.  マルチサイトエントリポイントは、1つの Active Directory サイトにのみ関連付けることができます。 Windows 8 を実行するクライアントコンピューターは、特定のエントリポイントに接続するときに、そのエントリポイントに関連付けられている Active Directory サイトに属していると見なされます。  
  
3.  各 Active Directory サイトにドメインコントローラーを用意することをお勧めします。 ドメインコントローラーは読み取り専用にすることができます。  
  
4.  各 Active Directory サイトにドメインコントローラーが含まれている場合、エントリポイント内のサーバーの GPO は、エンドポイントに関連付けられている Active Directory サイト内のいずれかのドメインコントローラーによって管理されます。 そのサイトに書き込み可能なドメインコントローラーがない場合、サーバーの GPO は、エントリポイントで構成されている最初のリモートアクセスサーバーに最も近い書き込み可能なドメインコントローラー上で管理されます。 最も近いのは、リンクコストの計算によって決まります。 このシナリオでは、構成を変更した後、GPO を管理するドメインコントローラーとサーバーの Active Directory サイトの読み取り専用ドメインコントローラー間でレプリケートするときに遅延が発生する可能性があることに注意してください。  
  
5.  クライアント Gpo とオプションのアプリケーションサーバー Gpo は、プライマリドメインコントローラー (PDC) エミュレーターとして実行されているドメインコントローラー上で管理されます。 つまり、クライアント Gpo は、クライアントが接続するエントリポイントを含む Active Directory サイトで必ずしも管理されません。  
  
6.  Active Directory サイトのドメインコントローラにアクセスできない場合は、リモートアクセスサーバーがサイトの代替ドメインコントローラに接続されます (使用可能な場合)。 そうでない場合は、別のサイトのドメインコントローラーに接続して、更新された GPO を取得し、クライアントを認証します。 どちらの場合も、ドメインコントローラーが使用可能になるまで、リモートアクセス管理コンソールと PowerShell コマンドレットを使用して構成設定を取得または変更することはできません。 次の点に注意してください。  
  
    1.  PDC エミュレーターとして実行されているサーバーが使用できない場合は、Gpo が更新された使用可能なドメインコントローラーを PDC エミュレーターとして指定する必要があります。  
  
    2.  サーバー GPO を管理するドメインコントローラーが使用できない場合は、Set-daentrypointdc PowerShell コマンドレットを使用して、新しいドメインコントローラーをエントリポイントに関連付けます。 新しいドメインコントローラーは、コマンドレットを実行する前に、最新の Gpo を持っている必要があります。  
  
## <a name="22-plan-security-groups"></a><a name="bkmk_2_2_SG"></a>2.2 セキュリティグループを計画する  
詳細設定を使用して単一サーバーを展開する場合、DirectAccess 経由で内部ネットワークにアクセスするすべてのクライアントコンピューターがセキュリティグループに収集されます。 マルチサイト展開では、このセキュリティグループは Windows 8 クライアントコンピューターにのみ使用されます。 マルチサイト展開の場合、Windows 7 クライアントコンピューターは、マルチサイト展開のエントリポイントごとに個別のセキュリティグループに収集されます。 たとえば、グループ DA_Clients 内のすべてのクライアントコンピューターをグループ化していた場合、そのグループからすべての Windows 7 コンピューターを削除し、別のセキュリティグループに配置する必要があります。 たとえば、複数の Active Directory サイトの複数のエントリポイントトポロジでは、米国エントリポイント (DA_Clients_US) のセキュリティグループと、ヨーロッパエントリポイント (DA_Clients_Europe) のセキュリティグループを作成します。 米国に配置されているすべての Windows 7 クライアントコンピューターを DA_Clients_US グループに配置し、DA_Clients_Europe グループのヨーロッパに配置します。 Windows 7 クライアントコンピューターがない場合は、Windows 7 コンピューターのセキュリティグループを計画する必要はありません。  
  
必要なセキュリティグループは次のとおりです。  
  
-   すべての Windows 8 クライアントコンピューターに対して1つのセキュリティグループ。 各ドメインに対して、これらのクライアントに対して一意のセキュリティグループを作成することをお勧めします。  
  
-   各エントリポイントの Windows 7 クライアントコンピューターを含む一意のセキュリティグループ。 ドメインごとに一意のグループを作成することをお勧めします。 例: Domain1 \ DA_Clients_Europe;Domain2 \ DA_Clients_Europe;Domain1 \ DA_Clients_US;Domain2 \ DA_Clients_US。  
  
## <a name="23-plan-group-policy-objects"></a><a name="bkmk_2_3_GPO"></a>2.3 グループポリシーオブジェクトを計画する  
リモートアクセスの展開中に構成された DirectAccess 設定は、Gpo に収集されます。 シングルサーバー展開では、DirectAccess クライアント、リモートアクセスサーバー、および必要に応じてアプリケーションサーバー用の Gpo が既に使用されています。 マルチサイト展開では、次の Gpo が必要です。  
  
-   各エントリポイントのサーバー GPO。  
  
-   Windows 8 を実行するクライアントコンピューターを含む各ドメインの GPO。  
  
-   各エントリポイントと Windows 7 クライアントコンピューターを含む各ドメインの GPO。  
  
Gpo は次のように構成できます。  
  
-   **自動**-リモートアクセスによって gpo が自動的に作成されるように指定できます。 既定の名前は各 GPO に対して指定され、変更することができます。  
  
-   **手動**-Active Directory 管理者によって手動で作成された gpo を使用できます。  
  
> [!NOTE]  
> 特定の Gpo を使用するように DirectAccess を構成した後は、異なる Gpo を使用するように DirectAccess を構成することはできません。  
  
### <a name="231-automatically-created-gpos"></a>2.3.1 自動的に作成された Gpo  
自動的に作成された GPO を使用するときは、次の点に注意してください。  
  
-   自動的に作成された GPO は、次に示すように、場所とリンク先のパラメーターに基づいて適用されます。  
  
    -   サーバー GPO の場合、場所とリンクの両方のパラメーターは、リモートアクセスサーバーを含むドメインを指します。  
  
    -   クライアント Gpo の場合、リンク先は GPO が作成されたドメインのルートに設定されます。 GPO は、クライアントコンピューターを含むドメインごとに作成され、GPO は各ドメインのルートにリンクされます。 。  
  
-   自動的に作成された Gpo の場合、DirectAccess 設定を適用するには、リモートアクセスサーバーの管理者に次のアクセス許可が必要です。  
  
    -   必要なドメインの GPO 作成アクセス許可。  
  
    -   選択したすべてのクライアント ドメイン ルートのリンク アクセス許可。  
  
    -   DirectAccess がモバイルコンピューターのみで動作するように構成されている場合は、Gpo の WMI フィルターを作成するためのアクセス許可が必要です。  
  
    -   エントリポイント (サーバーの GPO ドメイン) に関連付けられているドメインのルートに対するリンクアクセス許可  
  
    -   リモート アクセス管理者が、必要なドメインごとに GPO 読み取りアクセス許可を持つことが推奨されます。 これにより、リモートアクセスで、マルチサイト展開用の Gpo を作成するときに、重複する名前の Gpo が存在しないことを確認できます。  
  
    -   エントリポイントに関連付けられているドメインに対するレプリケーションアクセス許可を Active Directory します。 これは、エントリポイントを最初に追加するときに、エントリポイントのサーバー GPO がそのエントリポイントに最も近いドメインコントローラー上に作成されるためです。 ただし、リンクの作成は PDC エミュレーターでのみサポートされているため、リンクを作成する前に PDC エミュレーターとして実行されているドメインコントローラーに GPO を作成したドメインコントローラーから GPO をレプリケートする必要があります。  
  
レプリケーションおよびリンクする Gpo に対する適切なアクセス許可が存在しない場合は、警告が発行されることに注意してください。 リモートアクセス操作は続行されますが、レプリケーションとリンクは行われません。 リンクの警告が発行された場合、アクセス許可が設定された後でも、リンクは自動的には作成されません。 代わりに、管理者がリンクを手動で作成する必要があります。  
  
### <a name="232-manually-created-gpos"></a>手動で作成した Gpo の2.3.2  
手動で作成された GPO を使用するときは、次の点に注意してください。  
  
-   次の Gpo は、マルチサイト展開用に手動で作成する必要があります。  
  
    -   **サーバー gpo**-エントリポイントが配置されているドメイン内の各エントリポイントのサーバー gpo。 この GPO は、エントリポイントの各リモートアクセスサーバーに適用されます。  
  
    -   **クライアント gpo (Windows 7)** : 各エントリポイントと、マルチサイト展開のエントリポイントに接続する Windows 7 クライアントコンピューターを含む各ドメインの gpo。 例: Domain1 \ DA_W7_Clients_GPO_Europe;Domain2 \ DA_W7_Clients_GPO_Europe;Domain1 \ DA_W7_Clients_GPO_US;Domain2 \ DA_W7_Clients_GPO_US。 Windows 7 クライアントコンピューターがエントリポイントに接続しない場合、Gpo は必要ありません。  
  
-   Windows 8 クライアントコンピューター用に追加の Gpo を作成する必要はありません。 単一のリモートアクセスサーバーを展開したときに、クライアントコンピューターを含む各ドメインの GPO が既に作成されています。 マルチサイト展開では、これらのクライアント Gpo は Windows 8 クライアントの Gpo として機能します。  
  
-   Gpo は、マルチサイト展開ウィザードの [コミット] ボタンをクリックする前に存在している必要があります。  
  
-   手動で作成された GPO を使用しているときは、GPO へのリンクがドメイン全体で検索されます。 GPO がドメイン内でリンクされていない場合は、ドメイン ルート内にリンクが自動的に作成されます。 リンクを作成するために必要なアクセス許可がない場合は、警告が表示されます。  
  
-   手動で作成した Gpo を使用して DirectAccess 設定を適用する場合、リモートアクセスサーバーの管理者は、手動で作成した Gpo に対して完全な GPO アクセス許可 (編集、削除、セキュリティの変更) を必要とします。  
  
レプリケーションおよびリンクする Gpo に対する適切なアクセス許可が存在しない場合は、警告が発行されることに注意してください。 リモートアクセス操作は続行されますが、レプリケーションとリンクは行われません。 リンクの警告が発行された場合、アクセス許可が設定された後でも、リンクは自動的には作成されません。 代わりに、管理者がリンクを手動で作成する必要があります。  
  
### <a name="233-managing-gpos-in-a-multi-domain-controller-environment"></a>2.3.3 マルチドメインコントローラー環境での Gpo の管理  
各 GPO は、次のように、特定のドメインコントローラーによって管理されます。  
  
-   サーバー GPO は、サーバーに関連付けられている Active Directory サイト内のいずれかのドメインコントローラーによって管理されます。または、そのサイトのドメインコントローラーが読み取り専用の場合は、エントリポイントの最初のサーバーに最も近い書き込み可能なドメインコントローラーによって管理されます。  
  
-   クライアント Gpo は、PDC エミュレーターとして実行されているドメインコントローラーによって管理されます。  
  
GPO 設定を手動で変更する場合は、次の点に注意してください。  
  
-   サーバー Gpo の場合、特定のエントリポイントに関連付けられているドメインコントローラーを特定するには、`Get-DAEntryPointDC -EntryPointName <name of entry point>`PowerShell コマンドレットを実行します。  
  
-   既定では、ネットワークの PowerShell コマンドレットまたはグループポリシー管理コンソールを使用して変更を行うと、PDC エミュレーターとして機能するドメインコントローラーが使用されます。  
  
-   エントリポイント (サーバー Gpo の場合) または PDC エミュレーター (クライアント Gpo の場合) に関連付けられているドメインコントローラーではないドメインコントローラーの設定を変更する場合は、次の点に注意してください。  
  
    1.  設定を変更する前に、ドメインコントローラーが最新の GPO を使用してレプリケートされていることを確認し、変更を行う前に[gpo 設定をバックアップ](https://go.microsoft.com/fwlink/?LinkID=257928)してください。 GPO が更新されていない場合、レプリケーション中にマージの競合が発生し、リモートアクセス構成が破損する可能性があります。  
  
    2.  設定を変更したら、Gpo に関連付けられているドメインコントローラーに変更がレプリケートされるまで待機する必要があります。 レプリケーションが完了するまで、リモートアクセス管理コンソールまたはリモートアクセス PowerShell コマンドレットを使用して、追加の変更を行うことはできません。 レプリケーションが完了する前に2つの異なるドメインコントローラーで GPO が編集されると、マージの競合が発生し、その結果、構成が破損する可能性があります。  
  
-   または、グループポリシー管理コンソールで **[ドメインコントローラーの変更]** ダイアログボックスを使用するか、 **Open netgpo**の PowerShell コマンドレットを使用して、既定の設定を変更することもできます。これにより、コンソールまたはネットワークコマンドレットを使用して行われた変更では、指定したドメインコントローラーが使用されます。  
  
    1.  これを行うには、グループポリシー管理コンソールで、ドメインまたはサイトコンテナーを右クリックし、 **[ドメインコントローラーの変更]** をクリックします。  
  
    2.  PowerShell でこれを行うには、Open NetGPO コマンドレットに DomainController パラメーターを指定します。 たとえば、europe-dc.corp.contoso.com という名前のドメインコントローラーを使用して、domain1 \ _Europe DA_Server_GPO という名前の GPO で Windows ファイアウォールのプライベートプロファイルとパブリックプロファイルを有効にするには、次の手順を実行します。  
  
        ```  
        $gpoSession = Open-NetGPO -PolicyStore "domain1\DA_Server_GPO _Europe" -DomainController "europe-dc.corp.contoso.com"  
        Set-NetFirewallProfile -GpoSession $gpoSession -Name @("Private","Public") -Enabled True  
        Save-NetGPO -GpoSession $gpoSession  
        ```  
  
#### <a name="modifying-domain-controller-association"></a>ドメインコントローラーの関連付けを変更しています  
マルチサイト展開で構成の一貫性を維持するためには、各 GPO が単一のドメイン コントローラーによって管理されるようにすることが重要です。 場合によっては、GPO に別のドメインコントローラーを割り当てることが必要になることがあります。  
  
-   **ドメインコントローラーの保守とダウンタイム**-gpo を管理するドメインコントローラーが使用できない場合は、別のドメインコントローラーで gpo を管理する必要がある場合があります。  
  
-   **構成配布の最適化**-ネットワークインフラストラクチャが変更された後、エントリポイントと同じ Active Directory サイトにあるドメインコントローラーのエントリポイントのサーバー GPO を管理する必要がある場合があります。   
  
## <a name="24-plan-dns"></a><a name="bkmk_2_4_DNS"></a>2.4 DNS を計画する  
マルチサイト展開の DNS を計画するときは、次の点に注意してください。  
  
1.  クライアントコンピューターは、リモートアクセスサーバーに接続するために ConnectTo アドレスを使用します。 デプロイ内の各エントリポイントには、別の ConnectTo アドレスが必要です。 各エントリポイントの ConnectTo アドレスは、パブリック DNS で使用できる必要があります。また、選択するアドレスは、ip-https 接続用に展開する ip-https 証明書のサブジェクト名と一致している必要があります。   
  
2.  また、リモートアクセスによって対称ルーティングが適用されます。そのため、マルチサイト展開が有効になっている場合、Teredo および IP-HTTPS クライアントのみが接続できます。 ネイティブ IPv6 クライアントが接続できるようにするには、ConnectTo アドレス (IP-HTTPS URL) が、リモートアクセスサーバー上の外部 (インターネットに接続された) IPv6 アドレスと IPv4 アドレスの両方に解決される必要があります。  
  
3.  リモート アクセスでは、DirectAccess クライアント コンピューターが内部ネットワークへの接続の検証に使用する既定の Web プローブが作成されます。 単一サーバーの構成中に、次の名前が DNS に登録されている必要があります。  
  
    1.  Directaccess-webprobehost-リモートアクセスサーバーの内部 IPv4 アドレス、または IPv6 専用環境の IPv6 アドレスに解決する必要があります。  
  
    2.  CorpConnectivityHost-IPv6 が企業ネットワークに展開されているかどうかに応じて、localhost (ループバック) アドレスに解決する必要があります (: 1 または 127.0.0.1)。  
  
    マルチサイト展開では、エントリポイントごとに Directaccess-webprobehost の追加の DNS エントリを作成する必要があります。 エントリポイントを追加すると、リモートアクセスはこの追加の Directaccess-webprobehost エントリを自動的に作成しようとします。 ただし、失敗した場合は警告が表示され、手動でエントリを作成する必要があります。  
  
    > [!NOTE]  
    > Dns の清掃が DNS インフラストラクチャで有効になっている場合は、リモートアクセスによって自動的に作成された DNS エントリの清掃を無効にすることをお勧めします。  
  

  



