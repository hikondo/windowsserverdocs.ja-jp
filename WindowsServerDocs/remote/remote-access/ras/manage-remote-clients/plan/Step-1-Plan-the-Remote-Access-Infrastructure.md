---
title: 手順1リモートアクセスインフラストラクチャを計画する
description: このトピックは、「Windows Server 2016 で DirectAccess クライアントをリモート管理する」ガイドの一部です。
manager: brianlic
ms.topic: article
ms.assetid: a1ce7af5-f3fe-4fc9-82e8-926800e37bc1
ms.author: lizross
author: eross-msft
ms.openlocfilehash: 88bc666b516d00b4c132b5b67ed702f071847fb0
ms.sourcegitcommit: 68444968565667f86ee0586ed4c43da4ab24aaed
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/07/2020
ms.locfileid: "87989754"
---
# <a name="step-1-plan-the-remote-access-infrastructure"></a>手順1リモートアクセスインフラストラクチャを計画する

>適用先:Windows Server (半期チャネル)、Windows Server 2016

> [!NOTE]
> Windows Server 2016 では、DirectAccess およびルーティングとリモートアクセスサービス (RRAS) が1つのリモートアクセスの役割に統合されています。

このトピックでは、DirectAccess クライアントのリモート管理用に単一のリモートアクセスサーバーをセットアップするために使用できるインフラストラクチャを計画する手順について説明します。 次の表に手順を示しますが、これらの計画タスクは特定の順序で行う必要はありません。

|タスク|説明|
|----|--------|
|[ネットワークトポロジとサーバー設定を計画する](#plan-network-topology-and-settings)|リモートアクセスサーバーの配置場所 (エッジまたはネットワークアドレス変換 (NAT) デバイスまたはファイアウォールの内側) を決定し、IP アドレス指定とルーティングを計画します。|
|[ファイアウォールの要件を計画する](#plan-firewall-requirements)|エッジ ファイアウォール経由のリモート アクセスの許可を計画します。|
|[証明書の要件を計画する](#plan-certificate-requirements)|クライアント認証に Kerberos プロトコルまたは証明書を使用するかどうかを決定し、web サイトの証明書を計画します。<br/><br/>IP-HTTPS は、IPv4 ネットワーク経由で IPv6 トラフィックをトンネリングするために DirectAccess クライアントによって使用される移行プロトコルです。 証明機関 (CA) によって発行された証明書を使用するか、リモートアクセスサーバーによって自動的に発行される自己署名証明書を使用して、サーバーの IP-HTTPS を認証するかどうかを決定します。|
|[DNS の要件を計画する](#plan-dns-requirements)|リモートアクセスサーバー、インフラストラクチャサーバー、ローカルの名前解決オプション、およびクライアント接続のために、ドメインネームシステム (DNS) の設定を計画します。|
|[ネットワークロケーションサーバーの構成を計画する](#plan-the-network-location-server-configuration)|組織内のネットワークロケーションサーバー web サイトの配置場所 (リモートアクセスサーバーまたは代替サーバー) を決定し、ネットワークロケーションサーバーがリモートアクセスサーバーに配置される場合は、証明書の要件を計画します。 **注:** ネットワークロケーションサーバーは、内部ネットワークに配置されているかどうかを判断するために、DirectAccess クライアントによって使用されます。|
|[管理サーバーの構成を計画する](#plan-management-servers-configuration)|リモート クライアント管理時に使用する管理サーバー (更新サーバーなど) を計画します。 **注:** 管理者は、インターネットを使用して、企業ネットワークの外部にある DirectAccess クライアントコンピューターをリモートで管理できます。|
|[Active Directory の要件を計画する](#plan-active-directory-requirements)|ドメインコントローラー、Active Directory の要件、クライアント認証、および複数のドメイン構造を計画します。|
|[グループポリシーオブジェクトの作成の計画](#plan-group-policy-object-creation)|組織で必要な Gpo と Gpo を作成および編集する方法を決定します。|

## <a name="plan-network-topology-and-settings"></a>ネットワークのトポロジと設定を計画する
ネットワークを計画するときは、ネットワークアダプタートポロジ、IP アドレス指定の設定、および ISATAP の要件を考慮する必要があります。

### <a name="plan-network-adapters-and-ip-addressing"></a>ネットワーク アダプターと IP アドレス指定を計画する

1.  使用するネットワークアダプタートポロジを特定します。 リモートアクセスは、次のトポロジのいずれかを使用して設定できます。

    -   2つのネットワークアダプターがある場合: リモートアクセスサーバーは、1つのネットワークアダプターがインターネットに接続され、もう一方が内部ネットワークに接続されているエッジにインストールされます。

    -   2つのネットワークアダプターがある場合: リモートアクセスサーバーは、NAT デバイス、ファイアウォール、またはルーターの背後に設置されます。1つのネットワークアダプターが境界ネットワークに接続され、もう1つのネットワークアダプターが内部ネットワークにインストールされます。

    -   ネットワークアダプターが1つの場合: リモートアクセスサーバーが NAT デバイスの内側にインストールされ、1つのネットワークアダプターが内部ネットワークに接続されます。

2.  IP アドレス指定要件を識別します。

    DirectAccess は、IPv6 と IPsec を組み合わせて、DirectAccess クライアント コンピューターと企業内部ネットワークとの間にセキュリティで保護された接続を確立します。 ただし、DirectAccess は、IPv6 インターネットへの接続または内部ネットワーク上でのネイティブ IPv6 サポートを必ずしも必要とはしません。 代わりに、IPv6 移行テクノロジを自動的に構成して使用し、IPv4 インターネット (6to4、Teredo、または IP-HTTPS) 経由および IPv4 専用イントラネット (NAT64 または ISATAP) 全体で IPv6 トラフィックをトンネリングします。 このような移行テクノロジの概要については、次のリソースを参照してください。

    -   [IPv6 移行テクノロジ](/previous-versions/bb726951(v=technet.10))

    -   [IP-HTTPS Tunneling Protocol Specification (IP-HTTPS トンネリング プロトコルの仕様)](/previous-versions/bb726951(v=technet.10))

3.  次の表に従って、必要なアダプターとアドレス指定を構成します。 1つのネットワークアダプターを使用して NAT デバイスの背後にある展開の場合は、[**内部ネットワークアダプター** ] 列のみを使用して IP アドレスを構成します。

    |説明|外部ネットワーク アダプター|<sup>上の</sup>内部ネットワークアダプター1|ルーティングの要件|
    |-|--------------|------------------------|------------|
    |IPv4 インターネットと IPv4 イントラネット|次を構成します。<br/><br/>-適切なサブネットマスクを持つ2つの静的な連続するパブリック IPv4 アドレス (Teredo のみに必要)。<br/>-インターネットファイアウォールまたはローカルインターネットサービスプロバイダー (ISP) ルーターのデフォルトゲートウェイ IPv4 アドレス。 **注:** リモートアクセスサーバーは、2つの連続するパブリック IPv4 アドレスを必要とします。これにより、Teredo サーバーとして機能し、Windows ベースの Teredo クライアントがリモートアクセスサーバーを使用して NAT デバイスの種類を検出できるようになります。|次を構成します。<br/><br/>適切なサブネット マスクを持つ IPv4 イントラネット アドレスが。<br/>-イントラネット名前空間の接続固有の DNS サフィックス。 DNS サーバーも、内部インターフェイスで構成する必要があります。 **注意:** イントラネット インターフェイスで、既定のゲートウェイを構成しません。|内部 IPv4 ネットワーク上のすべてのサブネットにアクセスするようにリモートアクセスサーバーを構成するには、次の手順を実行します。<br/><br/>イントラネット上のすべての場所の IPv4 アドレス空間を一覧表示します。<br/>- `route add -p` またはコマンドを使用し `netsh interface ipv4 add route` て、ipv4 アドレス空間を静的ルートとしてリモートアクセスサーバーの ipv4 ルーティングテーブルに追加します。|
    |IPv6 インターネットおよび IPv6 イントラネット|次を構成します。<br/><br/>-ISP によって提供される自動構成されたアドレス構成を使用します。<br/>-コマンドを使用し `route print` て、ISP ルーターを指す既定の ipv6 ルートが ipv6 ルーティングテーブルに存在することを確認します。<br/>-ISP ルーターとイントラネットルーターが RFC 4191 で説明されている既定のルーター基本設定を使用しているかどうか、およびローカルイントラネットルーターより高い既定の基本設定を使用しているかどうかを確認します。 どちらについても使用している場合は、既定のルートに他の構成は必要ありません。 ISP ルーターの高度な基本設定によって、リモート アクセス サーバーの既定の IPv6 アクティブ ルートが IPv6 インターネットを示すことが保証されます。<br/><br/>リモート アクセス サーバーは IPv6 ルーターであるため、ネィティブ IPv6 インフラストラクチャがある場合は、インターネット インターフェイスからイントラネット上のドメイン コントローラーに到達することもできます。 この場合は、リモートアクセスサーバーのインターネットインターフェイスの IPv6 アドレスに接続できないように、境界ネットワーク内のドメインコントローラーにパケットフィルターを追加します。|次を構成します。<br/><br/>既定の優先レベルを使用していない場合は、コマンドを使用してイントラネットインターフェイスを構成し `netsh interface ipv6 set InterfaceIndex ignoredefaultroutes=enabled` ます。 このコマンドにより、イントラネット ルーターをポイントする追加の既定のルートは IPv6 ルーティング テーブルに追加されなくなります。 イントラネットインターフェイスの InterfaceIndex は、コマンドの表示から取得でき `netsh interface show interface` ます。|IPv6 イントラネットがある場合、IPv6 のすべての場所に到達できるようにリモート アクセス サーバーを構成するには、次のようにします。<br/><br/>IPv6 アドレス空間は、イントラネット上のすべての場所を一覧表示します。<br/>-コマンドを使用し `netsh interface ipv6 add route` て、ipv6 アドレス空間を静的ルートとしてリモートアクセスサーバーの ipv6 ルーティングテーブルに追加します。|
    |IPv4 インターネットおよび IPv6 イントラネット|リモートアクセスサーバーは、IPv4 インターネット上の6to4 リレーへの Microsoft 6to4 アダプターインターフェイスを使用して、既定の IPv6 ルートトラフィックを転送します。 ネイティブ IPv6 が企業ネットワークに展開されていない場合は、次のコマンドを使用して、IPv4 インターネット上の Microsoft 6to4 リレーの IPv4 アドレス用にリモートアクセスサーバーを構成 `netsh interface ipv6 6to4 set relay name=<ipaddress> state=enabled` できます。|||

    > [!NOTE]
    > -   DirectAccess クライアントにパブリック IPv4 アドレスが割り当てられている場合は、6to4 リレーテクノロジを使用してイントラネットに接続します。 クライアントにプライベート IPv4 アドレスが割り当てられている場合は、Teredo が使用されます。 DirectAccess クライアントが 6to4 または Teredo を使用して DirectAccess サーバーに接続できない場合は、IP-HTTPS が使用されます。
    > -   Teredo を使用するには、外部ネットワーク アダプターで連続する 2 つの IP アドレスを構成する必要があります。
    > -   リモートアクセスサーバーにネットワークアダプターが1つしかない場合は、Teredo を使用できません。
    > -   ネイティブ IPv6 クライアント コンピューターは、ネイティブ IPv6 経由でリモート アクセス サーバーに接続できます。移行テクノロジを必要としません。

### <a name="plan-isatap-requirements"></a>ISATAP 要件を計画する
DirectAccess 管理サーバーがインターネット上にある DirectAccess クライアントに接続できるように、DirectAccessclients をリモート管理するには ISATAP が必要です。 ISATAP は、DirectAccess クライアントコンピューターによって開始される接続を、企業ネットワーク上の IPv4 リソースに対してサポートする必要はありません。 この目的には、NAT64/DNS64 が使用されます。 デプロイで ISATAP が必要な場合は、次の表を使用して要件を特定します。

|ISATAP 展開シナリオ|要件|
|---------------|--------|
|既存のネイティブ IPv6 イントラネット (ISATAP は不要)|既存のネイティブ IPv6 インフラストラクチャでは、リモートアクセスの展開時に組織のプレフィックスを指定します。リモートアクセスサーバーは、それ自体を ISATAP ルーターとして構成しません。 次の操作を行います。<br/><br/>1. イントラネットから DirectAccess クライアントにアクセスできるようにするには、既定のルートトラフィックがリモートアクセスサーバーに転送されるように、IPv6 ルーティングを変更する必要があります。 イントラネットの IPv6 アドレス空間が、1つの48ビット IPv6 アドレスプレフィックス以外のアドレスを使用している場合は、展開時に関連する組織の IPv6 プレフィックスを指定する必要があります。<br/>2. 現在 IPv6 インターネットに接続している場合は、既定のルートトラフィックをリモートアクセスサーバーに転送されるように構成してから、リモートアクセスサーバー上に適切な接続とルートを構成して、既定のルートトラフィックが IPv6 インターネットに接続されているデバイスに転送されるようにする必要があります。|
|既存の ISATAP 展開|既存の ISATAP インフラストラクチャがある場合は、展開時に組織の48ビットプレフィックスの入力を求められ、リモートアクセスサーバーは ISATAP ルーターとして構成されません。 イントラネットから DirectAccess クライアントにアクセスできるようにするには、既定のルートトラフィックがリモートアクセスサーバーに転送されるように、IPv6 ルーティングインフラストラクチャを変更する必要があります。 この変更は、イントラネットクライアントが既に既定のトラフィックを転送する必要のある既存の ISATAP ルーターで行う必要があります。|
|既存の IPv6 接続がありません|リモートアクセスのセットアップウィザードで、サーバーがネイティブまたは ISATAP ベースの IPv6 接続を使用していないことを検出すると、そのサーバーは、イントラネットの6to4 ベースの48ビットプレフィックスを自動的に派生させ、リモートアクセスサーバーを ISATAP ルーターとして構成して、イントラネット上の ISATAP ホストに IPv6 接続を提供します。 (6to4 ベースのプレフィックスは、サーバーにパブリックアドレスがある場合にのみ使用されます。それ以外の場合は、一意のローカルアドレス範囲からプレフィックスが自動的に生成されます)。<br/><br/>ISATAP を使用するには、次の手順を実行します。<br/><br/>1. isatap ベースの接続を有効にする各ドメインの ISATAP 名を DNS サーバーに登録します。これにより、ISATAP 名が内部 DNS サーバーによってリモートアクセスサーバーの内部 IPv4 アドレスに解決できるようになります。<br/>2. 既定では、Windows Server 2012、Windows Server 2008 R2、Windows Server 2008、または Windows Server 2003 を実行している DNS サーバーは、グローバルクエリブロックリストを使用して ISATAP 名の解決をブロックします。 ISATAP を有効にするには、ブロック一覧から ISATAP 名を削除する必要があります。 詳細については、「 [DNS グローバルクエリブロックリストからの ISATAP の削除](https://go.microsoft.com/fwlink/p/?LinkId=168593)」を参照してください。<br/><br/>ISATAP 名を解決できる Windows ベースの ISATAP ホストは、次のように、リモートアクセスサーバーでアドレスを自動的に構成します。<br/><br/>1. isatap トンネリングインターフェイスの ISATAP ベースの IPv6 アドレス<br/>2. イントラネット上の他の ISATAP ホストへの接続を提供する64ビットルート<br/>3. リモートアクセスサーバーを指す既定の IPv6 ルート。 既定のルートを使用すると、イントラネット ISATAP ホストが DirectAccess クライアントに到達できるようになります。<br/><br/>Windows ベースの ISATAP ホストが ISATAP ベースの IPv6 アドレスを取得すると、送信先が ISATAP ホストでもある場合、ISATAP でカプセル化されたトラフィックを使用して通信が開始されます。 ISATAP ではイントラネット全体に1つの64ビットのサブネットが使用されるため、通信はセグメント化された IPv4 モデルの通信から、IPv6 を使用した単一サブネット通信モデルになります。 これは、Active Directory サイトとサービスの構成に依存する一部の Active Directory Domain Services (AD DS) とアプリケーションの動作に影響する可能性があります。 たとえば、Active Directory サイトとサービススナップインを使用して、サイト、IPv4 ベースのサブネット、サイト内のサーバーに要求を転送するサイト間トランスポートを構成した場合、この構成は ISATAP ホストによって使用されません。<br/><br/><ol><li>ISATAP ホストのサイト内で転送するように Active Directory サイトとサービスを構成するには、IPv4 サブネットオブジェクトごとに、対応する IPv6 サブネットオブジェクトを構成する必要があります。このオブジェクトでは、サブネットの IPv6 アドレスプレフィックスが、IPv4 サブネットと同じ範囲の ISATAP ホストアドレスを表します。 たとえば、IPv4 サブネット 192.168.99.0/24 と64ビット ISATAP アドレスプレフィックス 2002: 836b: 1: 8000::/64 の場合、IPv6 サブネットオブジェクトの同等の IPv6 アドレスプレフィックスは、2002: 836b: 1: 8000: 0: 5efe: 192.168.99.0/120 になります。 任意の IPv4 プレフィックス長 (例では24に設定) では、対応する IPv6 プレフィックス長を数式 96 + IPv4PrefixLength から特定できます。</li><li>DirectAccess クライアントの IPv6 アドレスには、次のものを追加します。<br/><br/><ul><li>Teredo ベースの DirectAccess クライアントの場合: 2001: 0: WWXX: YYZZ::/64 の範囲の IPv6 サブネット。 WWXX: YYZZ は、リモートアクセスサーバーの最初のインターネットに接続された IPv4 アドレスのコロン16進数バージョンです。 .</li><li>IP-HTTPS ベースの DirectAccess クライアントの場合: WWXX: YYZZ: 8100::/56 という範囲の IPv6 サブネット。 WWXX: YYZZ は、リモートアクセスサーバーの最初のインターネットに接続された IPv4 アドレス (w.x.y.z) のコロン16進数バージョンを示します。 .</li><li>6to4 ベースの DirectAccess クライアントの場合: 2002 で始まる一連の6to4 ベースの IPv6 プレフィックス。インターネット割り当て番号機関 (IANA) と地域レジストリによって管理される地域のパブリック IPv4 アドレスプレフィックスを表します。 パブリック IPv4 アドレスプレフィックス YYZZ/n の6to4 ベースプレフィックスは、2002: WWXX:::/[16 + n] です。この場合、WWXX: YYZZ はコロン16進数バージョンの w.x.y.z. です。<br/><br/>        たとえば、7.0.0.0/8 の範囲は、北米用のインターネット番号 (ARIN) 用のアメリカンレジストリによって管理されます。 このパブリック IPv6 アドレス範囲に対応する6to4 ベースのプレフィックスは2002:700::/24 です。 IPv4 パブリックアドレス空間の詳細については、「 [IANA Ipv4 アドレス空間レジストリ](https://www.iana.org/assignments/ipv4-address-space/ipv4-address-space.xml)」を参照してください。 .</li></ul></li></ol>|

> [!IMPORTANT]
> DirectAccess サーバーの内部インターフェイスにパブリック IP アドレスがないことを確認します。 内部インターフェイスにパブリック IP アドレスがある場合、ISATAP 経由の接続に失敗する可能性があります。

### <a name="plan-firewall-requirements"></a>ファイアウォールの要件を計画する
エッジ ファイアウォールの背後に設置されたリモート アクセス サーバーが IPv4 インターネット上にあるときは、リモート アクセス トラフィックについて次の例外が必要になります。

-   IP-HTTPS の場合: 伝送制御プロトコル (TCP) 宛先ポート443、および TCP 発信元ポート443送信。

-   Teredo トラフィックの場合: ユーザーデータグラムプロトコル (UDP) 宛先ポート3544受信と、UDP 発信元ポート3544の送信。

-   6to4 トラフィックの場合: IP プロトコル41の受信と送信。

    > [!NOTE]
    > Teredo トラフィックと 6to4 トラフィックの場合、これらの例外は、リモート アクセス サーバー上のインターネットに接続された両方の連続するパブリック IPv4 アドレスに適用する必要があります。
    >
    > IP-HTTPS の場合、例外は、パブリック DNS サーバーに登録されているアドレスに適用する必要があります。

-   1つのネットワークアダプターでリモートアクセスを展開し、リモートアクセスサーバーにネットワークロケーションサーバーをインストールする場合は、TCP ポート62000を使用します。

    > [!NOTE]
    > この除外はリモートアクセスサーバー上にあり、以前の除外はエッジファイアウォール上にあります。

リモートアクセスサーバーが IPv6 インターネット上にある場合は、リモートアクセストラフィックに次の例外が必要です。

-   IP プロトコル 50

-   UDP 宛先ポート 500 の受信と、UDP 発信元ポート 500 の送信。

-   ICMPv6 トラフィックの受信と送信 (Teredo を使用している場合のみ)。

追加のファイアウォールを使用する場合は、次の内部ネットワークファイアウォール例外をリモートアクセストラフィックに適用します。

-   ISATAP の場合: プロトコル41の受信と送信

-   すべての IPv4/IPv6 トラフィック: TCP/UD

-   Teredo の場合: すべての IPv4/IPv6 トラフィックに対する ICMP

### <a name="plan-certificate-requirements"></a>証明書の要件を計画する
単一のリモートアクセスサーバーを展開するときに証明書を必要とするシナリオは3つあります。

-   **Ipsec 認証**: ipsec の証明書要件には、リモートアクセスサーバーとの ipsec 接続を確立するときに directaccess クライアントコンピューターによって使用されるコンピューター証明書と、directaccess クライアントとの ipsec 接続を確立するためにリモートアクセスサーバーによって使用されるコンピューター証明書が含まれます。

    Windows Server 2012 の DirectAccess の場合、これらの IPsec 証明書の使用は必須ではありません。 代わりに、リモートアクセスサーバーは、証明書を要求することなく、Kerberos 認証のプロキシとして機能することができます。 Kerberos 認証が使用されている場合は、SSL で動作し、Kerberos プロトコルは ip-https 用に構成された証明書を使用します。 一部のエンタープライズシナリオ (マルチサイト展開とワンタイムパスワードクライアント認証を含む) では、Kerberos 認証ではなく、証明書認証を使用する必要があります。

-   **Ip-https サーバー**: リモートアクセスを構成すると、リモートアクセスサーバーは ip-https web リスナーとして機能するように自動的に構成されます。 IP-HTTPS サイトは Web サイト証明書を要求します。また、クライアント コンピューターは、その証明書の証明書失効リスト (CRL) サイトに接続できる必要があります。

-   **ネットワークロケーションサーバー**: ネットワークロケーションサーバーは、クライアントコンピューターが企業ネットワークに配置されているかどうかを検出するために使用される web サイトです。 ネットワーク ロケーション サーバーには、web サイトの証明書が必要です。 DirectAccess クライアントは、その証明書の CRL サイトに接続できる必要があります。

これらの各シナリオの証明機関 (CA) の要件を次の表にまとめます。

|IPsec 認証|IP-HTTPS サーバー|ネットワーク ロケーション サーバー|
|------------|----------|--------------|
|認証に Kerberos プロトコルを使用していない場合、IPsec 認証用にリモートアクセスサーバーおよびクライアントに対してコンピューター証明書を発行するには、内部 CA が必要です。|内部 CA: 内部 CA を使用して ip-https 証明書を発行できます。ただし、CRL 配布ポイントが外部で使用可能であることを確認する必要があります。|内部 CA: 内部 CA を使用して、ネットワークロケーションサーバーの web サイト証明書を発行できます。 CRL 配布ポイントが内部ネットワークからいつでも利用できることを確認してください。|
||自己署名証明書: IP-HTTPS サーバーの自己署名証明書を使用できます。 自己署名証明書はマルチサイト展開で使用できません。|自己署名証明書: ネットワークロケーションサーバーの web サイトの自己署名証明書を使用できます。ただし、マルチサイト展開では自己署名証明書を使用できません。|
||パブリック CA: IP-HTTPS 証明書を発行するためにパブリック CA を使用することをお勧めします。これにより、CRL 配布ポイントが外部で使用できるようになります。||

#### <a name="plan-computer-certificates-for-ipsec-authentication"></a>IPsec 認証にコンピューター証明書を計画する
証明書ベースの IPsec 認証を使用している場合、コンピューター証明書を取得するには、リモートアクセスサーバーとクライアントが必要です。 証明書をインストールする最も簡単な方法は、グループポリシーを使用して、コンピューター証明書の自動登録を構成することです。 こうすることによって、すべてのドメイン メンバーがエンタープライズ CA から証明書を入手します。 エンタープライズ CA を組織内の設定があるない場合は、次を参照してください。[Active Directory Certificate Services](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc770357(v=ws.10))です。

この証明書には、次の要件があります。

-   証明書には、クライアント認証拡張キー使用法 (EKU) が必要です。

-   クライアント証明書とサーバー証明書は、同じルート証明書に関連付けられている必要があります。 このルート証明書は、DirectAccess 構成設定で選択されている必要があります。

#### <a name="plan-certificates-for-ip-https"></a>IP-HTTPS の証明書を計画する
リモート アクセス サーバーは IP-HTTPS リスナーとして動作します。HTTPS Web サイト証明書をサーバーに手動でインストールする必要があります。 計画するときは、次の点を考慮してください。

-   CRL がすぐに使用できるように、パブリック CA を使用することをお勧めします。

-   [サブジェクト] フィールドで、リモートアクセスサーバーのインターネットアダプターの IPv4 アドレス、または ip-https URL (ConnectTo アドレス) の FQDN を指定します。 リモート アクセス サーバーが NAT デバイスの内側に存在する場合は、NAT デバイスのパブリック名またはアドレスを指定する必要があります。

-   証明書の共通名は、IP-HTTPS サイトの名前と一致している必要があります。

-   **拡張キー使用法** フィールドに、サーバー認証オブジェクト識別子 (OID) を使用します。

-   **[CRL 配布ポイント]** フィールドに、インターネットに接続している DirectAccess クライアントがアクセスできる CRL 配布ポイントを指定します。

    > [!NOTE]
    > これは、Windows 7 を実行しているクライアントにのみ必要です。

-   IP-HTTPS 証明書には秘密キーが必要です。

-   IP-HTTPS 証明書は、個人用ストアに直接インポートする必要があります。

-   IP-HTTPS 証明書の名前にはワイルドカードを含めることができます。

#### <a name="plan-website-certificates-for-the-network-location-server"></a>ネットワーク ロケーション サーバーの Web サイト証明書を計画する
ネットワークロケーションサーバーの web サイトを計画するときは、次の点を考慮してください。

-   **[サブジェクト]** フィールドで、ネットワーク ロケーション サーバーのイントラネット インターフェイスの IP アドレス、またはネットワーク ロケーション URL の FQDN をを指定します。

-   [**拡張キー使用法**] フィールドには、サーバー認証 OID を使用します。

-   [ **Crl 配布ポイント**] フィールドに、イントラネットに接続されている DirectAccess クライアントからアクセスできる crl 配布ポイントを使用します。 この CRL 配布ポイントは、内部ネットワークの外側からアクセスできないようにしてください。

> [!NOTE]
> Ip-https およびネットワークロケーションサーバーの証明書にサブジェクト名があることを確認します。 証明書で代替名が使用されている場合は、リモートアクセスウィザードでは受け入れられません。

#### <a name="plan-dns-requirements"></a>DNS の要件を計画する
ここでは、リモートアクセス展開におけるクライアントとサーバーの DNS 要件について説明します。

##### <a name="directaccess-client-requests"></a>DirectAccess クライアント要求
内部ネットワークに配置されていない DirectAccess クライアント コンピューターからの要求を解決するためには、DNS が使用されます。 DirectAccess クライアントは、DirectAccess ネットワークロケーションサーバーに接続して、インターネットまたは企業ネットワークのどちらに配置されているかを判断します。

-   接続に成功した場合、クライアントはイントラネット上にあると判断され、DirectAccess は使用されず、クライアントの要求は、クライアントコンピューターのネットワークアダプターで構成されている DNS サーバーを使用して解決されます。

-   接続に失敗した場合、クライアントはインターネット上にあると見なされます。 DirectAccess クライアントは名前解決ポリシー テーブル (NRPT) を使って、名前の要求を解決するときに使用する DNS サーバーを判断します。 クライアントが名前解決に DirectAccess DNS64 または代替の内部 DNS サーバーを使用するように指定することができます。

名前解決の実行時、NRPT が DirectAccess クライアントによって使用されて、要求の処理方法が特定されます。 クライアントは、などの FQDN または単一ラベル名を要求 <https://internal> します。 シングルラベル名が要求されると、DNS サフィックスが追加されて FQDN になります。 DNS クエリが NRPT と DNS4 のエントリに一致する場合、またはエントリに対してイントラネット DNS サーバーが指定されている場合、クエリは、指定されたサーバーを使用して名前解決のために送信されます。 一致するものの DNS サーバーが指定されていない場合は、除外規則と通常の名前解決が適用されます。

リモートアクセス管理コンソールで NRPT に新しいサフィックスが追加されると、[**検出**] ボタンをクリックすることで、サフィックスの既定の DNS サーバーを自動的に検出できます。 自動検出は次のように機能します。

-   企業ネットワークが IPv4 ベースの場合、または IPv4 と IPv6 を使用している場合、既定のアドレスはリモートアクセスサーバーの内部アダプターの DNS64 アドレスです。

-   企業ネットワークが IPv6 ベースである場合、既定のアドレスは、企業ネットワーク内の DNS サーバーの IPv6 アドレスです。

##### <a name="infrastructure-servers"></a>インフラストラクチャ サーバー

-   **ネットワーク ロケーション サーバー**

    DirectAccess クライアントは、内部ネットワークに配置されているかを判断するために、ネットワーク ロケーション サーバーに接続しようとします。 内部ネットワーク上のクライアントは、ネットワークロケーションサーバーの名前を解決できなければなりません。また、インターネット上に配置されている場合は、名前の解決を防ぐ必要があります。 これが確実に行われるように、既定で、ネットワーク ロケーション サーバーの FQDN が NRPT に対する除外規則として追加されます。 また、リモート アクセスを構成する場合、次の規則が自動的に作成されます。

    -   ルートドメインまたはリモートアクセスサーバーのドメイン名の DNS サフィックス規則、およびリモートアクセスサーバーで構成されているイントラネット DNS サーバーに対応する IPv6 アドレス。 たとえば、リモート アクセス サーバーが corp.contoso.com ドメインのメンバーである場合、corp.contoso.com DNS サフィックスについて規則が作成されます。

    -   ネットワーク ロケーション サーバーの FQDN の除外規則。 たとえば、ネットワークロケーションサーバーの URL がの場合、 <https://nls.corp.contoso.com> FQDN nls.corp.contoso.com に対して除外ルールが作成されます。

-   **IP-HTTPS サーバー**

    リモートアクセスサーバーは ip-https リスナーとして機能し、そのサーバー証明書を使用して ip-https クライアントを認証します。 Ip-https 名は、パブリック DNS サーバーを使用する DirectAccess クライアントによって解決できる必要があります。

##### <a name="connectivity-verifiers"></a>接続検証方法
リモート アクセスでは、DirectAccess クライアント コンピューターが内部ネットワークへの接続の検証に使用する既定の Web プローブが作成されます。 プローブを意図したとおりに機能させるには、DNS で次の名前を手動で登録する必要があります。

-   **directaccess-webprobehost**は、リモートアクセスサーバーの内部 IPv4 アドレス、または ipv6 専用環境の ipv6 アドレスに解決される必要があります。

-   **corpconnectivityhost**は、ローカルホスト (ループバック) アドレスに解決される必要があります。 レコードと AAAA レコードを作成する必要があります。 A レコードの値は127.0.0.1 で、AAAA レコードの値は、最後の32ビットが127.0.0.1 である NAT64 プレフィックスから作成されます。 NAT64 プレフィックスを取得するには、 **Get-netnattransitionconfiguration** Windows PowerShell コマンドレットを実行します。

    > [!NOTE]
    > これは、IPv4 専用環境でのみ有効です。 IPv4 プラス IPv6 または IPv6 専用環境では、ループバック IP アドレス:: 1 を持つ AAAA レコードのみを作成します。

HTTP または PING 経由で他の web アドレスを使用して、追加の接続検証方法を作成できます。 接続検証方法ごとに、DNS エントリが存在している必要があります。

##### <a name="dns-server-requirements"></a>DNS サーバーの要件

-   DirectAccess クライアントの場合、windows Server 2012、Windows Server 2008 R2、Windows Server 2008、Windows Server 2003、または IPv6 をサポートする任意の DNS サーバーを実行している DNS サーバーを使用する必要があります。

-   動的更新をサポートする DNS サーバーを使用する必要があります。 動的更新をサポートしていない DNS サーバーを使用できますが、エントリを手動で更新する必要があります。

-   CRL 配布ポイントの FQDN は、インターネット DNS サーバーを使用して解決できる必要があります。 たとえば、 <https://crl.contoso.com/crld/corp-DC1-CA.crl> リモートアクセスサーバーの ip-https 証明書の**CRL 配布ポイント**フィールドに URL が含まれている場合は、インターネット DNS サーバーを使用して FQDN crld.contoso.com が解決可能であることを確認する必要があります。

#### <a name="plan-for-local-name-resolution"></a>ローカルでの名前解決を計画する
ローカルでの名前解決を計画している場合は、次の点を考慮してください。

##### <a name="nrpt"></a>NRPT
次の状況では、追加の名前解決ポリシーテーブル (NRPT) 規則の作成が必要になる場合があります。

-   イントラネット名前空間の DNS サフィックスを追加する必要があります。

-   CRL 配布ポイントの Fqdn がイントラネット名前空間に基づいている場合は、CRL 配布ポイントの Fqdn の除外規則を追加する必要があります。

-   スプリットブレイン DNS 環境がある場合は、インターネット上に配置されている DirectAccess クライアントがイントラネットバージョンではなくインターネットバージョンにアクセスできるようにするリソースの名前に対して、除外規則を追加する必要があります。

-   イントラネット web プロキシサーバーを介して外部 web サイトにトラフィックをリダイレクトする場合、外部 web サイトはイントラネットからのみ使用できます。 Web プロキシサーバーのアドレスを使用して、受信要求を許可します。 この状況では、外部 web サイトの FQDN に除外規則を追加し、イントラネット DNS サーバーの IPv6 アドレスではなく、イントラネット web プロキシサーバーを規則が使用するように指定します。

    たとえば、test.contoso.com という名前の外部 web サイトをテストしているとします。 この名前は、インターネット DNS サーバーでは解決できませんが、Contoso web プロキシサーバーは、名前を解決する方法と、web サイトの要求を外部 web サーバーに送信する方法を認識しています。 Contoso イントラネット上にいないユーザーがサイトにアクセスするのを防ぐため、外部 Web サイトは Contoso Web プロキシの IPv4 インターネット アドレスからの要求のみを許可します。 したがって、イントラネットユーザーは Contoso web プロキシを使用しているため、web サイトにアクセスできますが、DirectAccess ユーザーは Contoso web プロキシを使用していないため、アクセスできません。 Contoso Web プロキシを使用している test.contoso.com に NRPT 除外規則を構成することで、test.contoso.com に対する Web ページ要求は IPv4 インターネットでイントラネット Web プロキシ サーバーにルーティングされます。

##### <a name="single-label-names"></a>単一ラベル名
などの単一ラベル名 <https://paycheck> は、イントラネットサーバーで使用されることがあります。 1つのラベル名が要求され、DNS サフィックス検索一覧が構成されている場合は、リスト内の DNS サフィックスが単一ラベル名に付加されます。 たとえば、web ブラウザーで corp.contoso.com ドメインタイプのメンバーであるコンピューターのユーザーの場合、 <https://paycheck> 名前として構成されている FQDN は paycheck.corp.contoso.com になります。 既定では、追加されたサフィックスは、クライアントコンピューターのプライマリ DNS サフィックスに基づいています。

> [!NOTE]
> 不整合な名前空間のシナリオ (1 つまたは複数のドメインコンピュータに、コンピュータがメンバとなっている Active Directory ドメインと一致しない DNS サフィックスがある場合)、検索リストがすべての必要なサフィックスを含むようにカスタマイズされていることを確認する必要があります。 既定では、リモートアクセスウィザードによって、Active Directory DNS 名がクライアントのプライマリ DNS サフィックスとして構成されます。 クライアントによって名前解決に使用される DNS サフィックスを追加していることを確認します。

複数のドメインと Windows インターネットネームサービス (WINS) が組織に展開されていて、リモートで接続している場合は、次のように単一の名前を解決できます。

-   DNS で WINS 前方参照ゾーンを展開する。 Computername.dns.zone1.corp.contoso.com を解決しようとすると、コンピューター名のみを使用している WINS サーバーに要求が送信されます。 クライアントは、通常の DNS A レコード要求を発行していると見なしますが、実際には NetBIOS 要求です。

    詳細については、「[前方参照ゾーンの管理](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc816891(v=ws.10))」を参照してください。

-   DNS サフィックス (dns.zone1.corp.contoso.com など) を既定のドメイン GPO に追加する。

##### <a name="split-brain-dns"></a>スプリット ブレイン DNS
スプリットブレイン DNS は、インターネットおよびイントラネットの名前解決に同じ DNS ドメインを使用することを意味します。

スプリット ブレイン DNS 展開では、Fqdn はインターネットとイントラネット上で重複され、対象のリソースを決定を一覧表示する必要があります、DirectAccess クライアントでは、リーチ、イントラネットまたはインターネット バージョンする必要があります。 DirectAccess クライアントがインターネットバージョンに接続するようにするには、対応する FQDN を各リソースの NRPT に除外規則として追加する必要があります。

スプリットブレイン DNS 環境で、両方のバージョンのリソースを使用できるようにする場合は、インターネットで使用されている名前と重複しない名前を使用してイントラネットリソースを構成します。 次に、ユーザーがイントラネット上のリソースにアクセスするときに代替名を使用するように指示します。 たとえば、www \. contoso.com の内部名として www internal.contoso.com を構成し \. ます。

スプリット ブレインではない DNS 環境で、インターネット名前空間はイントラネット名前空間と異なります。 たとえば、Contoso Corporation はインターネットで contoso.com を使用していますが、イントラネットでは corp.contoso.com を使用しています。 すべてのイントラネット リソースは、corp.contoso.com DNS サフィックスを使用しているため、corp.contoso.com の NRPT 規則は、イントラネット リソースに対するすべての DNS 名クエリをイントラネット DNS サーバーにルーティングします。 Contoso.com サフィックスが付いた名前に対する DNS クエリは、NRPT の corp.contoso.com intranet 名前空間規則と一致しないため、インターネット DNS サーバーに送信されます。 スプリット ブレインではない DNS 展開では、イントラネット リソースとインターネット リソースに対する FQDN の複製がないため、NRPT に対して追加の構成は必要ありません。 DirectAccess クライアントは、組織のインターネットリソースとイントラネットリソースの両方にアクセスできます。

##### <a name="plan-local-name-resolution-behavior-for-directaccess-clients"></a>DirectAccess クライアントのローカルの名前解決動作を計画する
DNS で名前を解決できない場合、Windows Server 2012、Windows 8、Windows Server 2008 R2、および Windows 7 の DNS クライアントサービスは、ローカルの名前解決を使用し、リンクローカルマルチキャスト名前解決 (LLMNR) と NetBIOS over TCP/IP プロトコルを使用してローカルサブネット上の名前を解決することができます。 ローカルの名前解決は、通常、コンピューターが単一サブネットのホーム ネットワークなどのプライベート ネットワークに配置されている場合、ピアツーピア接続に必要です。

DNS クライアントサービスがイントラネットサーバー名に対してローカルの名前解決を実行し、コンピューターがインターネット上の共有サブネットに接続されている場合、悪意のあるユーザーが LLMNR および NetBIOS over TCP/IP メッセージをキャプチャして、イントラネットサーバー名を特定できます。 インフラストラクチャサーバーのセットアップウィザードの [DNS] ページで、イントラネット DNS サーバーから受信した応答の種類に基づいて、ローカルの名前解決の動作を構成できます。 次のオプションを使用できます。

-   **DNS に名前が存在しない場合はローカルの名前解決を使用する**: このオプションは、DirectAccess クライアントがイントラネット DNS サーバーで解決できないサーバー名に対してのみローカルの名前解決を実行するため、最も安全です。 イントラネット DNS サーバーに到達できれば、イントラネット サーバーの名前が解決されます。 イントラネット DNS サーバーに到達できない場合や、他の種類の DNS エラーがある場合に、イントラネット サーバー名がローカルの名前解決でサブネットに漏洩することはありません。

-   **ローカルの名前解決を使用する dns に名前が存在しない場合、またはクライアントコンピューターがプライベートネットワーク上にあるときに dns サーバーに到達できない場合 (推奨)**: このオプションをお勧めします。これは、イントラネット DNS サーバーにアクセスできない場合にのみ、プライベートネットワークでローカルの名前解決を使用できるためです。

-   **任意の種類の DNS 解決エラーにローカルの名前解決を使用する (低セキュリティ)**: これは、イントラネットネットワークサーバーの名前がローカルの名前解決によってローカルサブネットに漏洩する可能性があるため、最も安全性の低いオプションです。

#### <a name="plan-the-network-location-server-configuration"></a>ネットワークロケーションサーバーの構成を計画する
ネットワーク ロケーション サーバーとは、DirectAccess クライアントが企業ネットワークに置かれているかどうかを検出するために使用する Web サイトです。 企業ネットワーク内のクライアントは、内部リソースに接続するために DirectAccess を使用しません。代わりに、直接接続します。

ネットワークロケーションサーバーの web サイトは、リモートアクセスサーバーまたは組織内の別のサーバーでホストできます。 ネットワークロケーションサーバーをリモートアクセスサーバーでホストする場合は、リモートアクセスを展開するときに web サイトが自動的に作成されます。 ネットワークロケーションサーバーを Windows オペレーティングシステムを実行している別のサーバーでホストする場合は、そのサーバーにインターネットインフォメーションサービス (IIS) がインストールされていることと、web サイトが作成されていることを確認する必要があります。 リモートアクセスでは、ネットワークロケーションサーバーの設定は構成されません。

ネットワークロケーションサーバー web サイトが次の要件を満たしていることを確認します。

-   には、HTTPS サーバー証明書があります。

-   は、内部ネットワーク上のコンピューターに高可用性を備えています。

-   は、インターネット上の DirectAccess クライアントコンピューターにはアクセスできません。

-

また、ネットワークロケーションサーバーの web サイトをセットアップするときは、次の要件を考慮してください。

-   DirectAccess クライアント コンピューターがネットワーク ロケーション サーバー Web サイトへのサーバー証明書を発行した CA を信頼している。

-   内部ネットワーク上の DirectAccess クライアント コンピューターは、ネットワーク ロケーション サーバー サイトの名前を解決できる。

##### <a name="plan-certificates-for-the-network-location-server"></a>ネットワークロケーションサーバーの証明書を計画する
ネットワークロケーションサーバーに使用する web サイト証明書を取得する場合は、次の点を考慮してください。

-   **[サブジェクト]** フィールドで、ネットワーク ロケーション サーバーのイントラネット インターフェイスの IP アドレス、またはネットワーク ロケーション URL の FQDN を指定します。

-   [**拡張キー使用法**] フィールドには、サーバー認証 OID を使用します。

-   ネットワークロケーションサーバー証明書は、証明書失効リスト (CRL) に対して確認する必要があります。 [ **Crl 配布ポイント**] フィールドに、イントラネットに接続されている DirectAccess クライアントからアクセスできる crl 配布ポイントを使用します。 この CRL 配布ポイントは、内部ネットワークの外側からアクセスできないようにしてください。

##### <a name="plan-dns-for-the-network-location-server"></a>ネットワークロケーションサーバーの DNS を計画する
DirectAccess クライアントは、内部ネットワークに配置されているかを判断するために、ネットワーク ロケーション サーバーに接続しようとします。 内部ネットワーク上のクライアントは、ネットワーク ロケーション サーバーの名前を解決できる必要がありますが、インターネットに配置されているときは名前を解決できないようにする必要があります。 このような処理が行われるように、既定では、ネットワーク ロケーション サーバーの FQDN が除外規則として NRPT に追加されます。

### <a name="plan-management-servers-configuration"></a>管理サーバーの構成を計画する
DirectAccess クライアントは、Windows Update やウイルス対策の更新などのサービスを提供する管理サーバーとの通信を開始します。 また、DirectAccess クライアントは、Kerberos プロトコルを使用して、内部ネットワークにアクセスする前にドメインコントローラーに対して認証を行います。 DirectAccess クライアントのリモート管理中、管理サーバーはクライアント コンピューターと通信して、ソフトウェアやハードウェアのインベントリ評価などの管理機能を実行します。 リモート アクセスでは、次のような一部の管理サーバーが自動的に検出されます。

-   ドメインコントローラー: ドメインコントローラーの自動検出は、クライアントコンピューターを含むドメインと、リモートアクセスサーバーと同じフォレスト内のすべてのドメインに対して実行されます。

-   Microsoft エンドポイント Configuration Manager サーバー

ドメインコントローラーと Configuration Manager サーバーは、DirectAccess の初回構成時に自動的に検出されます。 検出されたドメインコントローラーはコンソールに表示されませんが、Windows PowerShell コマンドレットを使用して設定を取得できます。 ドメインコントローラまたは Configuration Manager サーバーが変更された場合、コンソールで [ **Update Management サーバー** ] をクリックすると、管理サーバーの一覧が更新されます。

**管理サーバーの要件**

-   管理サーバーには、インフラストラクチャトンネルを介してアクセスできる必要があります。 リモート アクセスを構成するときに、管理サーバーの一覧にサーバーを追加すると自動的にこのトンネルでアクセスできるようになります。

-   DirectAccess クライアントへの接続を開始する管理サーバーは、ネイティブ IPv6 アドレスまたは ISATAP によって割り当てられたアドレスを使用して、IPv6 を完全にサポートする必要があります。

### <a name="plan-active-directory-requirements"></a>Active Directory の要件を計画する
リモートアクセスでは、次のように Active Directory を使用します。

-   **認証**: インフラストラクチャトンネルは、リモートアクセスサーバーに接続しているコンピューターアカウントに NTLMv2 認証を使用し、アカウントは Active Directory ドメインに存在する必要があります。 イントラネットトンネルは、ユーザーが Kerberos 認証を使用してイントラネットトンネルを作成します。

-   **グループポリシーオブジェクト**: リモートアクセスは、構成設定をグループポリシーオブジェクト (gpo) に収集します。 gpo は、リモートアクセスサーバー、クライアント、および内部アプリケーションサーバーに適用されます。

-   **セキュリティグループ**: リモートアクセスは、セキュリティグループを使用して、DirectAccess クライアントコンピューターを収集し、識別します。 Gpo は、必要なセキュリティグループに適用されます。

リモートアクセス展開の Active Directory 環境を計画する場合は、次の要件を考慮してください。

-   Windows server 2012、Windows Server 2008 R2、Windows Server 2008、または Windows Server 2003 オペレーティングシステムに、少なくとも1つのドメインコントローラーがインストールされている。

    ドメインコントローラが境界ネットワーク上にあり (したがって、インターネットに接続されたリモートアクセスサーバーのネットワークアダプターから到達可能である)、リモートアクセスサーバーがそれに到達できないようにします。 インターネットアダプターの IP アドレスへの接続を防ぐために、ドメインコントローラーにパケットフィルターを追加する必要があります。

-   リモート アクセス サーバーはドメイン メンバーである必要があります。

-   DirectAccess クライアントは、ドメイン メンバーである必要があります。 クライアントは次に所属することができます。

    -   リモート アクセス サーバーと同じフォレスト内の任意のドメイン。

    -   リモート アクセス サーバー ドメインと双方向の信頼関係がある任意のドメイン。

    -   リモートアクセスサーバードメインのフォレストと双方向の信頼関係があるフォレスト内の任意のドメイン。

> [!NOTE]
> -   リモート アクセス サーバーはドメイン コントローラーにできません。
> -   リモートアクセスに使用される Active Directory ドメインコントローラーは、リモートアクセスサーバーの外部インターネットアダプターからアクセスできないようにする必要があります (アダプターは Windows ファイアウォールのドメインプロファイルに含まれていてはなりません)。

#### <a name="plan-client-authentication"></a>クライアント認証を計画する
Windows Server 2012 のリモートアクセスでは、組み込みの Kerberos 認証を使用するか、ユーザー名とパスワードを使用するか、IPsec コンピューター認証に証明書を使用するかを選択できます。

**Kerberos 認証**: 認証に Active Directory 資格情報を使用することを選択した場合、DirectAccess はまずコンピューターに対して kerberos 認証を使用し、次にユーザーに kerberos 認証を使用します。 この認証モードを使用する場合、DirectAccess は、DNS サーバー、ドメインコントローラー、および内部ネットワーク上のその他のサーバーへのアクセスを提供する単一のセキュリティトンネルを使用します。

**IPsec 認証**: 2 要素認証またはネットワークアクセス保護を使用することを選択した場合、DirectAccess は2つのセキュリティトンネルを使用します。 リモートアクセスのセットアップウィザードは、セキュリティが強化された Windows ファイアウォールの接続セキュリティ規則を構成します。 これらの規則は、IPsec セキュリティをリモートアクセスサーバーにネゴシエートするときに、次の資格情報を指定します。

-   インフラストラクチャトンネルでは、2番目の認証にコンピューター証明書資格情報が使用され、最初の認証とユーザー (NTLMv2) 資格情報が使用されます。 ユーザー資格情報は、認証済みインターネットプロトコル (AuthIP) の使用を強制し、DirectAccess クライアントがイントラネットトンネルに Kerberos 資格情報を使用できるようになる前に、DNS サーバーとドメインコントローラーへのアクセスを提供します。

-   イントラネットトンネルでは、2番目の認証にコンピューター証明書資格情報が使用され、最初の認証とユーザー (Kerberos V5) 資格情報が使用されます。

#### <a name="plan-multiple-domains"></a>複数ドメインを計画する
管理サーバーの一覧には、DirectAccess クライアント コンピューターが含まれるセキュリティ グループを含むすべてのドメインのドメイン コントローラーが含まれます。 DirectAccess クライアントとして構成されたコンピューターを使用する可能性のあるユーザーアカウントを含むすべてのドメインが含まれている必要があります。 これにより、使用しているクライアント コンピューターと同じドメインに置かれていないユーザーは、ユーザー ドメインのドメイン コントローラーで認証されます。

ドメインが同じフォレスト内にある場合、この認証は自動的に行います。 異なるフォレストにあるクライアントコンピューターまたはアプリケーションサーバーを含むセキュリティグループがある場合、それらのフォレストのドメインコントローラーは自動的に検出されません。 フォレストも自動的には検出されません。 **リモートアクセス管理**でタスク**Update Management サーバー**を実行して、これらのドメインコントローラーを検出できます。

可能であれば、リモートアクセスの展開時に、共通のドメイン名サフィックスを NRPT に追加する必要があります。 たとえば、domain1.corp.contoso.com と domain2.corp.contoso.com という 2 つのドメインがある場合、2 つのエントリを NRPT に追加する代わりに、corp.contoso.com というドメイン名サフィックスに共通の DNS サフィックス エントリを追加できます。 これは、同じルート内のドメインに対して自動的に行われます。 同じルートにないドメインは、手動で追加する必要があります。

### <a name="plan-group-policy-object-creation"></a>グループポリシーオブジェクトの作成の計画
リモートアクセスを構成すると、グループポリシーオブジェクト (Gpo) に DirectAccess 設定が収集されます。 2つの Gpo には、DirectAccess 設定が設定され、次のように配布されます。

-   **DirectAccess クライアント gpo**: この gpo には、IPv6 移行テクノロジの設定、NRPT エントリ、セキュリティが強化された Windows ファイアウォールの接続セキュリティ規則を含むクライアント設定が含まれています。 GPO は、クライアント コンピューターに指定されたセキュリティ グループに適用されます。

-   **Directaccess サーバー GPO**: この gpo には、展開でリモートアクセスサーバーとして構成した任意のサーバーに適用される directaccess 構成設定が含まれています。 また、セキュリティが強化された Windows ファイアウォールの接続セキュリティ規則も含まれています。

> [!NOTE]
> アプリケーションサーバーの構成は、DirectAccess クライアントのリモート管理ではサポートされていません。これは、アプリケーションサーバーが存在する DirectAccess サーバーの内部ネットワークにクライアントがアクセスできないためです。 この種類の構成では、[リモートアクセスのセットアップの構成] 画面の手順4は使用できません。

Gpo は、自動的にまたは手動で構成できます。

**自動**: gpo が自動的に作成されるように指定すると、各 gpo に既定の名前が指定されます。

**手動**: Active Directory 管理者によって事前に定義されている gpo を使用できます。

Gpo を構成するときは、次の警告を考慮してください。

-   特定の GPO を使用するように DirectAccess が構成された後で、別の GPO を使用するように構成することはできません。

-   DirectAccess コマンドレットを実行する前に、すべてのリモートアクセスグループポリシーオブジェクトをバックアップするには、次の手順に従います。

    [Back up and Restore Remote Access Configuration (リモート アクセスの構成のバックアップと復元)](https://go.microsoft.com/fwlink/?LinkID=257928)

-   自動または手動で構成された Gpo を使用しているかどうかにかかわらず、クライアントが3G を使用する場合は、低速リンクの検出のポリシーを追加する必要があります。 **ポリシー: 構成グループポリシー低速リンクの検出**のパスは次のとおりです。

    **コンピューターの構成/ポリシー/管理用テンプレート/システム/グループ ポリシー**

-   Gpo をリンクするための適切なアクセス許可が存在しない場合は、警告が発行されます。 リモートアクセス操作は続行されますが、リンクは行われません。 この警告が発行されると、後でアクセス許可が追加された場合でも、リンクは自動的には作成されません。 代わりに、管理者がリンクを手動で作成する必要があります。

#### <a name="automatically-created-gpos"></a>自動的に作成された Gpo
自動的に作成された Gpo を使用する場合は、次の点を考慮してください。

自動的に作成された GPO は、次のように、場所とリンク先に従って適用されます。

-   DirectAccess サーバー GPO の場合、場所とリンク先は、リモートアクセスサーバーを含むドメインを指します。

-   クライアントとアプリケーションサーバーの Gpo が作成されると、場所は1つのドメインに設定されます。 各ドメインで GPO 名が検索され、ドメインが存在する場合は DirectAccess 設定が入力されます。

-   リンク先は GPO が作成されたドメインのルートに設定されます。 GPO はクライアント コンピューターまたはアプリケーション サーバーを含むドメインごとに作成され、その個々のドメインのルートにリンクされます。

自動的に作成された Gpo を使用して DirectAccess の設定を適用する場合、リモートアクセスサーバーの管理者には次のアクセス許可が必要です。

-   各ドメインの Gpo を作成するためのアクセス許可。

-   選択したすべてのクライアントドメインルートにリンクするためのアクセス許可。

-   サーバーの GPO ドメインルートにリンクするためのアクセス許可。

-   Gpo の作成、編集、削除、および変更を行うためのセキュリティアクセス許可。

-   必要な各ドメインの GPO 読み取りアクセス許可。 このアクセス許可は必須ではありませんが、Gpo の作成時に、重複する名前の Gpo が存在しないことをリモートアクセスで検証できるため、この操作をお勧めします。

#### <a name="manually-created-gpos"></a>手動で作成された Gpo
手動で作成した GPO を使用する場合、次の点を考慮してください。

-   GPO はリモート アクセス セットアップ ウィザードを実行する前に存在している必要があります。

-   DirectAccess 設定を適用するには、リモートアクセスサーバー管理者が、手動で作成した Gpo を作成、編集、削除、および変更するための完全なセキュリティアクセス許可を必要とします。

-   ドメイン全体の GPO へのリンクが検索されます。 GPO がドメインでリンクされていないと、リンクはドメインのルートで自動的に作成されます。 リンクの作成に必要なアクセス許可が使用できない場合、警告が発行されます。

#### <a name="recovering-from-a-deleted-gpo"></a>削除された GPO からの回復
リモートアクセスサーバー、クライアント、またはアプリケーションサーバーの GPO が誤って削除されている場合は、 **gpo (gpo 名) が見つからないこと**を示すエラーメッセージが表示されます。

バックアップを使用できる場合は、バックアップから GPO を復元できます。 使用できるバックアップがない場合は、構成設定を削除してから、再度構成する必要があります。

###### <a name="to-remove-configuration-settings"></a>構成設定を削除するには

1.  Windows PowerShell コマンドレット**Uninstall-RemoteAccess**を実行します。

2.  **リモートアクセス管理**を開きます。

3.  GPO が見つからないというエラー メッセージが表示されます。 **[構成設定の削除]** をクリックします。 完了後、サーバーは未構成の状態に復元され、設定を再構成することができます。

