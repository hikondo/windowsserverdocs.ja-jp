---
title: 手順 1、リモート アクセス インフラストラクチャを計画します。
description: このトピックでは、リモート Windows Server 2016 での Directaccess の管理ガイドの一部です。
manager: brianlic
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: networking-ras
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: a1ce7af5-f3fe-4fc9-82e8-926800e37bc1
ms.author: pashort
author: shortpatti
ms.openlocfilehash: f3b1837145dee5767741052c548a4b44da56659b
ms.sourcegitcommit: be243a92f09048ca80f85d71555ea6ee3751d712
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/11/2019
ms.locfileid: "67792329"
---
# <a name="step-1-plan-the-remote-access-infrastructure"></a>手順 1、リモート アクセス インフラストラクチャを計画します。

>適用対象:Windows Server (半期チャネル)、Windows Server 2016

> [!NOTE]
> Windows Server 2016 は、DirectAccess およびルーティングとリモート アクセス サービス (RRAS) を単一のリモート アクセス役割に結合します。  
  
このトピックでは、DirectAccess クライアントのリモート管理のための単一のリモート アクセス サーバーを設定するために使用できるインフラストラクチャを計画する手順について説明します。 次の表は、手順を示しますが、これらの計画タスクは、特定の順序で実行する必要はありません。  
  
|タスク|説明|  
|----|--------|  
|[ネットワーク トポロジとサーバーの設定を計画します。](#plan-network-topology-and-settings)|IP アドレス指定とルーティングを検討してください (端またはネットワーク アドレス変換 (NAT) デバイスまたはファイアウォールの背後にある)、リモート アクセス サーバーを配置する場所を決定します。|  
|[ファイアウォールの要件を計画します。](#plan-firewall-requirements)|エッジ ファイアウォール経由のリモート アクセスの許可を計画します。|  
|[証明書の要件を計画します。](#plan-certificate-requirements)|クライアントの認証に Kerberos プロトコルまたは証明書を使用し、web サイト証明書の計画はかどうかを決定します。<br/><br/>IP-HTTPS は、IPv4 ネットワーク経由で IPv6 トラフィックをトンネリングするために DirectAccess クライアントによって使用される移行プロトコルです。 または、リモート アクセス サーバーによって自動的に発行される自己署名証明書を使用して証明機関 (CA) によって発行された証明書を使用して、サーバーの IP-HTTPS を認証するかどうかを決定します。|  
|[DNS の要件を計画します。](#plan-dns-requirements)|リモート アクセス サーバー、インフラストラクチャ サーバー、ローカル名前解決オプション、およびクライアント接続のドメイン ネーム システム (DNS) 設定を計画します。| 
|[ネットワーク ロケーション サーバーの構成を計画します。](#plan-the-network-location-server-configuration)|組織 (リモート アクセス サーバーまたは代替サーバー) 上にネットワーク ロケーション サーバー web サイトを配置し、ネットワーク ロケーション サーバーがリモート アクセス サーバー上に配置する場合は、証明書の要件を計画する場所を決定します。 **注:** ネットワーク ロケーション サーバーは、内部ネットワークに配置されているかどうかを判断するために DirectAccess クライアントによって使用されます。|  
|[管理サーバーの構成を計画します。](#plan-management-servers-configuration)|リモート クライアント管理時に使用する管理サーバー (更新サーバーなど) を計画します。 **注:** 管理者は、企業ネットワークの外部にある DirectAccess クライアント コンピューターを、インターネットを使用してリモート管理できます。|  
|[Active Directory の要件を計画します。](#plan-active-directory-requirements)|ドメイン コント ローラー、Active Directory の要件、クライアント認証、および複数のドメイン構造を計画します。|  
|[計画のグループ ポリシー オブジェクトの作成](#plan-group-policy-object-creation)|必要な Gpo を決定する、組織で作成し、Gpo を編集する方法。|  
  
## <a name="plan-network-topology-and-settings"></a>ネットワークのトポロジと設定を計画する  
ネットワークを計画するときは、ネットワーク アダプター トポロジ、IP アドレスの設定と ISATAP の要件を考慮する必要があります。  
  
### <a name="plan-network-adapters-and-ip-addressing"></a>ネットワーク アダプターと IP アドレス指定を計画する  
  
1.  使用するネットワーク アダプターのトポロジを識別します。 リモート アクセスは、次のトポロジのいずれかに設定できます。  
  
    -   2 つのネットワーク アダプター。リモート アクセス サーバーは、インターネットおよび内部ネットワークに他に接続されている 1 つのネットワーク アダプターを使用したエッジにインストールされます。  
  
    -   2 つのネットワーク アダプター。リモート アクセス サーバーは、境界ネットワークと内部ネットワークに接続されている 1 つのネットワーク アダプターを使用した NAT デバイス、ファイアウォール、またはルーターの背後にインストールされます。  
  
    -   1 つのネットワーク アダプター。リモート アクセス サーバーが NAT デバイスの内側にインストールされているし、単一のネットワーク アダプターが内部ネットワークに接続されています。  
  
2.  IP アドレス指定要件を識別します。  
  
    DirectAccess は、IPv6 と IPsec を組み合わせて、DirectAccess クライアント コンピューターと企業内部ネットワークとの間にセキュリティで保護された接続を確立します。 ただし、DirectAccess は、IPv6 インターネットへの接続または内部ネットワーク上でのネイティブ IPv6 サポートを必ずしも必要とはしません。 代わりに、その自動的に構成し、IPv4 インターネット (6to4、Teredo、または IP-HTTPS) と全体で IPv4 専用イントラネット (NAT64 または ISATAP) IPv6 トラフィックをトンネリングする IPv6 移行テクノロジを使用します。 このような移行テクノロジの概要については、次のリソースを参照してください。  
  
    -   [IPv6 移行テクノロジ](https://technet.microsoft.com/library/bb726951.aspx)  
  
    -   [IP-HTTPS トンネリング プロトコルの仕様](https://msdn.microsoft.com/library/dd358571.aspx)  
  
3.  次の表に従って、必要なアダプターとアドレス指定を構成します。 1 つのネットワーク アダプターを使用してデバイスを NAT の背後にある展開のみを使用して、IP アドレスを構成する、**内部ネットワーク アダプター**列。  
  
    ||外部ネットワーク アダプター|内部ネットワーク アダプター<sup>1 上、</sup>|ルーティングの要件|  
    |-|--------------|------------------------|------------|  
    |IPv4 インターネットと IPv4 イントラネット|次を構成します。<br/><br/>(Teredo のみ必要です)、適切なサブネット マスクを使用した連続するパブリック IPv4 アドレスを 2 つの静的です。<br/>-デフォルト ゲートウェイ、インターネット ファイアウォールまたはローカルのインターネット サービス プロバイダー (ISP) ルーターの IPv4 アドレスです。 **注:** リモート アクセス サーバーでは、Teredo サーバーとして機能し、Windows ベースの Teredo クライアントでは、リモート アクセス サーバーを使用して NAT デバイスの種類を検出することができますが、2 つの連続するパブリック IPv4 アドレスが必要です。|次を構成します。<br/><br/>適切なサブネット マスクを持つ IPv4 イントラネット アドレスが。<br/>イントラネット名前空間の接続固有 DNS サフィックスが-a します。 DNS サーバーも、内部インターフェイスで構成する必要があります。 **注意:** イントラネット インターフェイスにはデフォルト ゲートウェイを構成しないでください。|内部 IPv4 ネットワーク上のすべてのサブネットに到達するリモート アクセス サーバーを構成するには、次の操作を行います。<br/><br/>イントラネット上のすべての場所の IPv4 アドレス空間を一覧表示します。<br/>-を使用して、`route add -p`または`netsh interface ipv4 add route`IPv4 を追加するコマンドではアドレス空間を静的ルートとしてリモート アクセス サーバーの IPv4 ルーティング テーブルにします。|  
    |IPv6 インターネットおよび IPv6 イントラネット|次を構成します。<br/><br/>-ISP によって提供される自動構成アドレス構成を使用します。<br/>-を使用して、 `route print` ISP ルーターを指す既定の IPv6 ルートが IPv6 ルーティング テーブルに存在することを確認するコマンド。<br/>かどうか、ISP およびイントラネットのルーターを使用している既定のルーター基本設定 RFC 4191、」の説明に従ってを特定ししている場合は、ローカル イントラネット ルーターより高い既定の基本設定を使用します。 どちらについても使用している場合は、既定のルートに他の構成は必要ありません。 ISP ルーターの高度な基本設定によって、リモート アクセス サーバーの既定の IPv6 アクティブ ルートが IPv6 インターネットを示すことが保証されます。<br/><br/>リモート アクセス サーバーは IPv6 ルーターであるため、ネィティブ IPv6 インフラストラクチャがある場合は、インターネット インターフェイスからイントラネット上のドメイン コントローラに到達することもできます。 この場合、リモート アクセス サーバーのインターネット インターフェイスの IPv6 アドレスへの接続を防ぐ境界ネットワークでドメイン コント ローラーにパケット フィルターを追加します。|次を構成します。<br/><br/>既定の優先レベルを使用していない場合を使用してイントラネット インターフェイスを構成、`netsh interface ipv6 set InterfaceIndex ignoredefaultroutes=enabled`コマンド。 このコマンドにより、イントラネット ルーターをポイントする追加の既定のルートは IPv6 ルーティング テーブルに追加されなくなります。 表示からイントラネット インターフェイスの InterfaceIndex を取得することができます、`netsh interface show interface`コマンド。|IPv6 イントラネットがある場合、IPv6 のすべての場所に到達できるようにリモート アクセス サーバーを構成するには、次のようにします。<br/><br/>IPv6 アドレス空間は、イントラネット上のすべての場所を一覧表示します。<br/>-を使用して、 `netsh interface ipv6 add route` IPv6 アドレス空間を静的ルートとしてリモート アクセス サーバーの IPv6 ルーティング テーブルに追加するコマンド。|  
    |IPv4 インターネットおよび IPv6 イントラネット|リモート アクセス サーバーは、IPv4 インターネット上の 6to4 リレーへの Microsoft 6to4 adapter インターフェイスを使用して、既定の IPv6 ルート トラフィックを転送します。 IPv4 インターネット上に Microsoft 6to4 リレーの IPv4 アドレス用のリモート アクセス サーバーを構成する次のコマンドを使用するには、企業ネットワークで、ネイティブ IPv6 が展開されていない場合:`netsh interface ipv6 6to4 set relay name=<ipaddress> state=enabled`します。|||  
  
    > [!NOTE]  
    > -   DirectAccess クライアントにパブリック IPv4 アドレスが割り当てられている場合、イントラネットに接続する、6to4 リレーのテクノロジが使用されます。 クライアントには、プライベート IPv4 アドレスが割り当てられますが、Teredo が使用されます。 DirectAccess クライアントが 6to4 または Teredo を使用して DirectAccess サーバーに接続できない場合は、IP-HTTPS が使用されます。  
    > -   Teredo を使用するには、外部ネットワーク アダプターで連続する 2 つの IP アドレスを構成する必要があります。  
    > -   リモート アクセス サーバーに 1 つだけのネットワーク アダプターがある場合、Teredo を使用することはできません。  
    > -   ネイティブ IPv6 クライアント コンピューターは、ネイティブ IPv6 経由でリモート アクセス サーバーに接続できます。移行テクノロジを必要としません。  
  
### <a name="plan-isatap-requirements"></a>ISATAP の要件を計画します。  
ISATAP は、DirectAccess 管理サーバーがインターネット上に存在する DirectAccess クライアントに接続できるように DirectAccessclients のリモート管理に必要です。 ISATAP は、企業ネットワーク上の IPv4 リソースへの DirectAccess クライアント コンピューターによって開始された接続をサポートする必要はありません。 この目的には、NAT64/DNS64 が使用されます。 デプロイには、ISATAP が必要とする場合、要件を識別するために、次の表を使用します。  
  
|ISATAP の展開シナリオ|必要条件|  
|---------------|--------|  
|既存のネイティブ IPv6 イントラネット (ISATAP は必要ありません)|既存のネイティブ IPv6 インフラストラクチャにリモート アクセスの展開中に組織のプレフィックスを指定して、リモート アクセス サーバーは構成しない自体、ISATAP ルーターとして。 次の操作を行います。<br/><br/>1. DirectAccess クライアントがイントラネットから到達可能であることを確認するには、リモート アクセス サーバーに既定のルート トラフィックが転送されるようは、IPv6 ルーティングを変更する必要があります。 イントラネットに IPv6 アドレス空間は、単一 48 ビットの IPv6 のアドレス プレフィックス以外のアドレスを使用している場合は、デプロイ時に関連する組織の IPv6 プレフィックスを指定する必要があります。<br/>2. IPv6 インターネットに現在接続されている場合をする必要があります、リモート アクセス サーバーに転送されますので、既定のルート トラフィックを構成し、適切な接続とルートで構成、リモート アクセス サーバー、既定のルートをトラフィックは、IPv6 インターネットに接続されているデバイスに転送されます。|  
|既存の ISATAP の展開|既存の ISATAP インフラストラクチャがある場合は、展開中に、組織の 48 ビット プレフィックスを求められ、リモート アクセス サーバーは構成しない自体、ISATAP ルーターとして。 DirectAccess クライアントがイントラネットから到達可能であることを確認するには、リモート アクセス サーバーに既定のルート トラフィックを転送できるように、IPv6 ルーティング インフラストラクチャを変更する必要があります。 この変更は、既存の ISATAP ルーターがするイントラネット クライアントする必要があります既に転送するデフォルトのトラフィックで実行する必要があります。|  
|既存の IPv6 接続なし|リモート アクセスのセットアップ ウィザードでは、サーバーにネイティブまたは ISATAP ベースの IPv6 接続がないことを検出すると自動的に、イントラネットの 6to4 ベースの 48 ビット プレフィックスを派生し、IPv6 を提供する ISATAP ルーターとして、リモート アクセス サーバーを構成します。イントラネットで ISATAP ホストへの接続。 (6to4 ベースのプレフィックスが、サーバーにパブリック アドレスがある場合にのみ使用される、プレフィックスが一意のローカル アドレス範囲から自動的に生成されてそれ以外の場合)。<br/><br/>使用して、ISATAP、次の操作を行います。<br/><br/>1. 有効にする ISATAP ベースの接続では、ISATAP 名がリモート アクセス サーバーの内部 IPv4 アドレスに内部 DNS サーバーによって解決できるように各ドメインの DNS サーバーで ISATAP 名を登録します。<br/>2. 既定では、Windows Server 2012、Windows Server 2008 R2、Windows Server 2008、または Windows Server 2003 を実行している DNS サーバーは、グローバル クエリ禁止リストを使用して ISATAP 名の解決をブロックします。 ISATAP を有効にするには、ブロック一覧から ISATAP 名を削除する必要があります。 詳細については、次を参照してください。 [DNS グローバル クエリ禁止リストから削除 ISATAP](https://go.microsoft.com/fwlink/p/?LinkId=168593)します。<br/><br/>ISATAP 名を自動的に解決できる Windows ベースの ISATAP ホストは、次のようにリモート アクセス サーバー アドレスを構成します。<br/><br/>1. ISATAP トンネリング インターフェイスで ISATAP ベースの IPv6 アドレス<br/>2. イントラネット上の他の ISATAP ホストへの接続を提供するルートを 64 ビット<br/>3.リモート アクセス サーバーを指す既定の IPv6 ルート。 既定のルートでは、DirectAccess クライアントのイントラネット上の ISATAP ホストに到達できることにより、します。<br/><br/>Windows ベースの ISATAP ホストは ISATAP ベースの IPv6 アドレスを取得する、通信のかどうか、変換先はまた、ISATAP ホストに ISATAP カプセル化されたトラフィックを使用する、開始します。 ISATAP は、イントラネット全体の 1 つの 64 ビットのサブネットを使用するため、通信は、IPv6 で 1 つのサブネットの通信モデルに、通信のセグメント化された IPv4 モデルから移動します。 いくつかの Active Directory Domain Services (AD DS) の動作に影響する可能性や、Active Directory サイトとサービスの構成に依存するアプリケーション。 たとえば、Active Directory サイトを使用して、サービス スナップインを使用して、サイト、サブネットの IPv4 ベース、およびサイト内のサーバーに要求を転送するためのサイト間トランスポートを構成する場合この構成は ISATAP ホストによって使用されません。<br/><br/><ol><li>Active Directory サイトとサービスを ISATAP ホストは、IPv4 サブネット オブジェクトごとに、サイト内での転送を構成するには、サブネットの IPv6 アドレス プレフィックスが同じ範囲の ISATAP ホストを表現する等価の IPv6 サブネット オブジェクト、構成する必要があります。IPv4 サブネット アドレス。 たとえば、IPv4 サブネット 192.168.99.0/24 と 64 ビットの ISATAP アドレス プレフィックス 2002:836b:1:8000::/64、IPv6 サブネット オブジェクトの同等の IPv6 アドレス プレフィックスが 2002:836b:1:8000:0:5efe:192.168.99.0/120 します。 任意 IPv4 プレフィックスの長さ (例では 24 に設定) の 96 数式から対応する IPv6 プレフィックスの長さ + IPv4PrefixLength を指定できます。</li><li>DirectAccess クライアントの IPv6 アドレスでは、次のように追加します。<br/><br/><ul><li>Teredo ベースの DirectAccess クライアントの場合。範囲 2001:0:WWXX:YYZZ の IPv6 サブネット::/64、どのというは、リモート アクセス サーバーの最初のインターネットに接続された IPv4 アドレスのコロン区切り 16 進バージョン。 .</li><li>IP-HTTPS ベースの DirectAccess クライアントの場合。範囲 2002:WWXX:YYZZ:8100 の IPv6 サブネット::/56、どのというは、リモート アクセス サーバーの最初のインターネットに接続された IPv4 アドレス (w.x.y.z) のコロン区切り 16 進バージョン。 .</li><li>DirectAccess クライアントの 6to4 ベースします。一連の 6to4 ベースの IPv6 プレフィックス 2002年で始まる: 表し、リージョン、パブリック IPv4 アドレスのプレフィックス Internet Assigned Numbers Authority (IANA) と地域のレジストリで管理されています。 パブリック IPv4 アドレスのプレフィックス w.x.y.z/n 6to4 ベースのプレフィックスは、2002: wwxx:yyzz::/[16 + n]、どのというが w.x.y.z のコロン区切り 16 進バージョン<br/><br/>        たとえば、7.0.0.0/8 範囲によって管理されます American レジストリのインターネットの数値 (ARIN) 北米の場合。 このパブリック IPv6 アドレスの範囲の 6to4 ベースの対応するプレフィックスが 2002:700::/24 です。 IPv4 のパブリック アドレス領域については、次を参照してください。 [IANA IPv4 アドレス空間レジストリ](https://www.iana.org/assignments/ipv4-address-space/ipv4-address-space.xml)します。 .</li></ul></li></ol>|  
  
> [!IMPORTANT]  
> DirectAccess サーバーの内部インターフェイスにパブリック IP アドレスがないことを確認します。 パブリック IP アドレスは内部インターフェイスにある場合は、ISATAP 経由の接続は失敗します。  
  
### <a name="plan-firewall-requirements"></a>ファイアウォールの要件を計画する  
エッジ ファイアウォールの背後に設置されたリモート アクセス サーバーが IPv4 インターネット上にあるときは、リモート アクセス トラフィックについて次の例外が必要になります。  
  
-   Ip-https:伝送制御プロトコル (TCP) 宛先ポート 443 と TCP 発信元ポート 443 が送信されます。  
  
-   Teredo トラフィックの場合。ユーザー データグラム プロトコル (UDP) 宛先ポート 3544 受信、および UDP 発信元ポート 3544 の送信。  
  
-   6to4 トラフィックの場合。IP プロトコル 41 の受信および送信します。  
  
    > [!NOTE]  
    > Teredo トラフィックと 6to4 トラフィックの場合、これらの例外は、リモート アクセス サーバー上のインターネットに接続された両方の連続するパブリック IPv4 アドレスに適用する必要があります。  
    >   
    > IP-HTTPS 用の例外は、パブリック DNS サーバーに登録されているアドレスに適用する必要があります。  
  
-   単一のネットワーク アダプターおよびネットワーク ロケーション サーバーをインストールするリモート アクセス サーバー上でリモート アクセスを展開する場合は、TCP ポート 62000 にします。  
  
    > [!NOTE]  
    > この除外は、リモート アクセス サーバーと以前の適用除外はエッジ ファイアウォールでは。  
  
次の例外は、IPv6 インターネット上のリモート アクセス サーバーがリモート アクセス トラフィックについて必要があります。  
  
-   IP プロトコル 50  
  
-   UDP 宛先ポート 500 の受信と、UDP 発信元ポート 500 の送信。  
  
-   ICMPv6 トラフィックの受信と送信の (Teredo を使用して) の場合のみです。  
  
追加のファイアウォールを使用している場合は、次の内部ネットワーク ファイアウォール例外をリモート アクセス トラフィックに適用されます。  
  
-   ISATAP:プロトコル 41 の受信と送信  
  
-   すべての IPv4 および IPv6 トラフィック。TCP と UD  
  
-   Teredo:すべての IPv4/IPv6 トラフィックに対する ICMP  
  
### <a name="plan-certificate-requirements"></a>証明書の要件を計画する  
単一のリモート アクセス サーバーを展開するときに、証明書を必要とする 3 つのシナリオがあります。  
  
-   **IPsec 認証**:IPsec の証明書の要件には、リモート アクセス サーバーとの IPsec 接続を確立するときに、DirectAccess クライアント コンピューターで使用されるコンピューター証明書およびリモート アクセス サーバーで確立するために使用されるコンピューター証明書が含まれます。DirectAccess クライアントとの IPsec 接続します。  
  
    Windows Server 2012 の DirectAccess では、これらの IPsec 証明書の使用は必須ではありません。 代わりに、リモート アクセス サーバーは、証明書を必要とせず Kerberos 認証用のプロキシとして動作できます。 Kerberos 認証を使用する場合、SSL 経由で動作し、Kerberos プロトコルは、IP-HTTPS 用に構成された証明書を使用します。 一部のエンタープライズ シナリオ (マルチサイト展開とワンタイム パスワードのクライアント認証を含む) には、証明書の認証および Kerberos 認証ではないの使用が必要です。  
  
-   **IP-HTTPS サーバー**:リモート アクセスを構成するときに、リモート アクセス サーバーは IP-HTTPS web リスナーとして機能する自動的に構成します。 IP-HTTPS サイトは Web サイト証明書を要求します。また、クライアント コンピューターは、その証明書の証明書失効リスト (CRL) サイトに接続できる必要があります。  
  
-   **ネットワーク ロケーション サーバー**:ネットワーク ロケーション サーバーとは、クライアント コンピューターが企業ネットワークに置かれているかどうかを検出するために使用する Web サイトです。 ネットワーク ロケーション サーバーには、web サイトの証明書が必要です。 DirectAccess クライアントは、その証明書の CRL サイトに接続できる必要があります。  
  
これらのシナリオの各証明機関 (CA) の要件は、次の表に示します。  
  
|IPsec 認証|IP-HTTPS サーバー|ネットワーク ロケーション サーバー|  
|------------|----------|--------------|  
|認証に Kerberos プロトコルを使用しない場合、内部 CA が、リモート アクセス サーバーとクライアントの IPsec 認証にコンピューター証明書を発行するために必要です。|内部 CA:IP-HTTPS 証明書の発行には、内部 CA を使用できます。ただし、CRL 配布ポイントが外部で使用できることを確認する必要があります。|内部 CA:内部 CA を使用して、ネットワーク ロケーション サーバー Web サイト証明書を発行できます。 CRL 配布ポイントが内部ネットワークからいつでも利用できることを確認してください。|  
||自己署名証明書:IP-HTTPS サーバーには、自己署名証明書を使用することができます。 自己署名証明書はマルチサイト展開で使用できません。|自己署名証明書:ネットワーク ロケーション サーバー web サイトで; の自己署名証明書を使用することができます。ただし、マルチサイト展開で自己署名証明書を使用することはできません。|  
||パブリック CA:IP-HTTPS 証明書を発行するパブリック CA を使用するか、これにより、CRL 配布ポイントが外部で使用可能なはお勧めします。||  
  
#### <a name="plan-computer-certificates-for-ipsec-authentication"></a>IPsec 認証にコンピューター証明書を計画する  
証明書ベースの IPsec 認証を使用している、リモート アクセス サーバーとクライアントがコンピューターの証明書を取得する必要があります。 証明書をインストールする最も簡単な方法は、グループ ポリシーを使用して、コンピューターの証明書の自動登録を構成します。 こうすることによって、すべてのドメイン メンバーがエンタープライズ CA から証明書を入手します。 エンタープライズ CA で、組織を設定しない場合は、次を参照してください。 [Active Directory Certificate Services](https://technet.microsoft.com/library/cc770357.aspx)します。  
  
この証明書には、次の要件があります。  
  
-   拡張キー使用法 (EKU) クライアント認証証明書が必要です。  
  
-   クライアントとサーバーの証明書は、同じルート証明書に関連する必要があります。 このルート証明書は、DirectAccess 構成設定で選択されている必要があります。  
  
#### <a name="plan-certificates-for-ip-https"></a>IP-HTTPS の証明書を計画する  
リモート アクセス サーバーは IP-HTTPS リスナーとして動作します。HTTPS Web サイト証明書をサーバーに手動でインストールする必要があります。 計画するときは、次の点を考慮してください。  
  
-   CRL がすぐに使用できるように、パブリック CA を使用することをお勧めします。  
  
-   [件名] フィールドでは、リモート アクセス サーバーのインターネット アダプターまたは IP-HTTPS URL (ConnectTo アドレス) の FQDN の IPv4 アドレスを指定します。 リモート アクセス サーバーが NAT デバイスの内側に存在する場合は、NAT デバイスのパブリック名またはアドレスを指定する必要があります。  
  
-   証明書の共通名は、IP-HTTPS サイトの名前と一致している必要があります。  
  
-   **拡張キー使用法** フィールドに、サーバー認証オブジェクト識別子 (OID) を使用します。  
  
-   **[CRL 配布ポイント]** フィールドに、インターネットに接続している DirectAccess クライアントがアクセスできる CRL 配布ポイントを指定します。  
  
    > [!NOTE]  
    > これは Windows 7 を実行しているクライアントに必須です。  
  
-   IP-HTTPS 証明書には秘密キーが必要です。  
  
-   IP-HTTPS 証明書は、個人用ストアに直接インポートする必要があります。  
  
-   IP-HTTPS 証明書の名前にはワイルドカードを含めることができます。  
  
#### <a name="plan-website-certificates-for-the-network-location-server"></a>ネットワーク ロケーション サーバーの Web サイト証明書を計画する  
ネットワーク ロケーション サーバー web サイトを計画する際に、次を考慮してください。  
  
-   **[サブジェクト]** フィールドで、ネットワーク ロケーション サーバーのイントラネット インターフェイスの IP アドレス、またはネットワーク ロケーション URL の FQDN をを指定します。  
  
-   **拡張キー使用法**フィールドに、サーバー認証 OID を使用します。  
  
-   **CRL 配布ポイント**フィールドに、イントラネットに接続されている DirectAccess クライアントからアクセスできる CRL 配布ポイントを使用します。 この CRL 配布ポイントは、内部ネットワークの外側からアクセスできないようにしてください。  
  
> [!NOTE]  
> IP-HTTPS およびネットワーク ロケーション サーバー用の証明書のサブジェクト名であることを確認します。 証明書は、代替名を使用している場合は、リモート アクセス ウィザードで許容されません。  
  
#### <a name="plan-dns-requirements"></a>DNS の要件を計画する  
このセクションでは、クライアントの DNS の要件とリモート アクセス展開でのサーバーについて説明します。  
  
##### <a name="directaccess-client-requests"></a>DirectAccess クライアント要求  
内部ネットワークに配置されていない DirectAccess クライアント コンピューターからの要求を解決するためには、DNS が使用されます。 DirectAccess クライアントは、インターネットまたは企業ネットワーク上に配置されているかどうかを判断するには、DirectAccess ネットワーク ロケーション サーバーに接続しようとします。  
  
-   接続が成功した場合、クライアントがイントラネット上に判断される、DirectAccess を使用しないおよびクライアント要求がクライアント コンピューターのネットワーク アダプターに構成されている DNS サーバーを使用して解決されます。  
  
-   接続に失敗した場合、クライアントはインターネット上にあると見なされます。 DirectAccess クライアントは名前解決ポリシー テーブル (NRPT) を使って、名前の要求を解決するときに使用する DNS サーバーを判断します。 クライアントが名前解決に DirectAccess DNS64 または代替の内部 DNS サーバーを使用するように指定することができます。  
  
名前解決の実行時、NRPT が DirectAccess クライアントによって使用されて、要求の処理方法が特定されます。 クライアントは、FQDN または単一ラベル名をなど要求<https://internal>します。 シングルラベル名が要求されると、DNS サフィックスが追加されて FQDN になります。 DNS クエリが nrpt のエントリと一致する DNS4 またはイントラネット DNS サーバーは、エントリに指定された場合は、名前解決のため、指定したサーバーを使用して、クエリが送信されます。 一致が存在しますが、DNS サーバーが指定されていない場合、除外規則と標準の名前解決が適用されます。  
  
リモート アクセス管理コンソールで NRPT に新しいサフィックスが追加されると、サフィックスの既定の DNS サーバーを自動的に検出をクリックして、**検出**ボタンをクリックします。 自動検出がように動作します。  
  
-   企業ネットワークが IPv4 ベースまたは IPv4 と IPv6 を使用して、既定のアドレスは、リモート アクセス サーバーの内部アダプターの DNS64 アドレスにします。  
  
-   企業ネットワークが IPv6 ベースである場合、既定のアドレスは、企業ネットワーク内の DNS サーバーの IPv6 アドレスです。  
  
##### <a name="infrastructure-servers"></a>インフラストラクチャ サーバー  
  
-   **ネットワーク ロケーション サーバー**  
  
    DirectAccess クライアントは、内部ネットワークに配置されているかを判断するために、ネットワーク ロケーション サーバーに接続しようとします。 内部ネットワーク上のクライアントは、ネットワーク ロケーション サーバーの名前を解決できる必要があり、インターネットに配置されているときに、名前の解決を防ぐ必要があるがします。 これが確実に行われるように、既定で、ネットワーク ロケーション サーバーの FQDN が NRPT に対する除外規則として追加されます。 また、リモート アクセスを構成する場合、次の規則が自動的に作成されます。  
  
    -   DNS サフィックスをルート ドメインまたはリモート アクセス サーバーとリモート アクセス サーバーで構成されているイントラネット DNS サーバーに対応する IPv6 アドレスのドメイン名のルール。 たとえば、リモート アクセス サーバーが corp.contoso.com ドメインのメンバーである場合、corp.contoso.com DNS サフィックスについて規則が作成されます。  
  
    -   ネットワーク ロケーション サーバーの FQDN の除外規則。 たとえば、ネットワーク ロケーション サーバーの URL は<https://nls.corp.contoso.com>、FQDN nls.corp.contoso.com について除外規則が作成されます。  
  
-   **IP-HTTPS サーバー**  
  
    リモート アクセス サーバーでは、IP-HTTPS リスナーとして機能し、そのサーバー証明書を使用して、IP-HTTPS クライアントを認証します。 IP-HTTPS 名は、パブリック DNS サーバーを使用して、DirectAccess クライアントによって解決する必要があります。  
  
##### <a name="connectivity-verifiers"></a>接続検証方法  
リモート アクセスでは、DirectAccess クライアント コンピューターが内部ネットワークへの接続の検証に使用する既定の Web プローブが作成されます。 プローブを意図したとおりに機能させるには、DNS で次の名前を手動で登録する必要があります。  
  
-   **directaccess webprobehost**リモート アクセス サーバーの内部 IPv4 アドレスまたは IPv6 専用環境で IPv6 アドレスに解決する必要があります。  
  
-   **directaccess corpconnectivityhost**ローカル ホスト (ループバック) アドレスに解決する必要があります。 A と AAAA レコードを作成する必要があります。 A レコードの値が 127.0.0.1、および AAAA レコードの値は、最後の 32 ビットを 127.0.0.1 として NAT64 プレフィックスから構築されます。 NAT64 プレフィックスを実行して取得できる、 **Get-netnattransitionconfiguration** Windows PowerShell コマンドレット。  
  
    > [!NOTE]  
    > これは、IPv4 専用の環境でのみ有効です。 IPv4 と IPv6、または IPv6 専用環境では、ループバック IP アドレスを AAAA レコードのみを作成:: 1。  
  
その他の接続検証方法は、HTTP または PING 経由で他の web アドレスを使用して作成できます。 接続検証方法ごとに、DNS エントリが存在している必要があります。  
  
##### <a name="dns-server-requirements"></a>DNS サーバーの要件  
  
-   DirectAccess クライアントは、Windows Server 2012、Windows Server 2008 R2、Windows Server 2008、Windows Server 2003、または IPv6 をサポートする任意の DNS サーバーを実行している DNS サーバーを使用する必要があります。  
  
-   動的更新をサポートする DNS サーバーを使用する必要があります。 動的更新をサポートしていない DNS サーバーを使用できますが、エントリを手動で更新する必要があります。  
  
-   CRL 配布ポイントの FQDN は、インターネット DNS サーバーを使用して解決する必要があります。 たとえば場合、URL<https://crl.contoso.com/crld/corp-DC1-CA.crl>では、 **CRL 配布ポイント**IP-HTTPS 証明書のフィールド、リモート アクセス サーバーの FQDN crld.contoso.com がインターネット DNS サーバーを使用して解決できることを確認する必要があります。  
  
#### <a name="plan-for-local-name-resolution"></a>ローカルの名前解決の計画  
ローカルの名前解決を計画する場合は、次を考慮してください。  
  
##### <a name="nrpt"></a>NRPT  
次の状況で追加の名前解決ポリシー テーブル (NRPT) ルールを作成する必要があります。  
  
-   イントラネット名前空間の複数の DNS サフィックスを追加する必要があります。  
  
-   CRL 配布ポイントの Fqdn は、イントラネット名前空間に基づいている場合は、CRL 配布ポイントの Fqdn の除外規則を追加する必要があります。  
  
-   スプリット ブレイン DNS 環境がある場合は、イントラネット バージョンではなく、インターネット バージョンへのアクセスにインターネットに配置されている DirectAccess クライアントの対象となるリソースの名前の除外規則を追加する必要があります。  
  
-   イントラネット web プロキシ サーバーを介して外部の web サイトにトラフィックをリダイレクトする場合、外部 web サイトがイントラネットからのみ使用できます。 要求の受信を許可するように、web プロキシ サーバーのアドレスを使用します。 このような状況で、外部の web サイトの FQDN の除外規則を追加して、規則がイントラネット DNS サーバーの IPv6 アドレスではなく、イントラネット web プロキシ サーバーを使用するように指定します。  
  
    たとえば、test.contoso.com という外部 web サイトをテストするいるとします。 この名前は、インターネット DNS サーバーを通じて解決可能ではありませんが、Contoso web プロキシ サーバー名を解決する方法と、外部の web サーバーに web サイトに対する要求を送信する方法を知っています。 Contoso イントラネット上にいないユーザーがサイトにアクセスするのを防ぐため、外部 Web サイトは Contoso Web プロキシの IPv4 インターネット アドレスからの要求のみを許可します。 したがっては Contoso web プロキシを使用している DirectAccess ユーザーは Contoso web プロキシを使ってできませんので、イントラネット ユーザーは web サイトにアクセスできます。 Contoso Web プロキシを使用している test.contoso.com に NRPT 除外規則を構成することで、test.contoso.com に対する Web ページ要求は IPv4 インターネットでイントラネット Web プロキシ サーバーにルーティングされます。  
  
##### <a name="single-label-names"></a>単一ラベル名  
単一ラベル名のなど<https://paycheck>、イントラネット サーバーに使用されることができます。 単一ラベル名が要求し、DNS サフィックス検索一覧を構成する場合は、単一ラベル名に、リストに DNS サフィックスが追加されます。 たとえば、ユーザーがコンピューターには、corp.contoso.com ドメインの種類のメンバー <https://paycheck> web ブラウザーで、名前として構成される FQDN は、paycheck.corp.contoso.com です。 既定では、追加されたサフィックスは、クライアント コンピューターのプライマリ DNS サフィックスに基づいています。  
  
> [!NOTE]  
> (1 つまたは複数のドメイン コンピューターは、コンピューターをメンバーである Active Directory ドメインに一致しない DNS サフィックスを持つ) 不整合な名前空間のシナリオで必要なすべてのサフィックスを含めるに検索一覧をカスタマイズすることを確認する必要があります。 既定では、リモート アクセス ウィザードは、クライアントのプライマリ DNS サフィックスとして、Active Directory DNS 名を構成します。 クライアントによって名前解決に使用される DNS サフィックスを追加していることを確認します。  
  
複数のドメインと Windows インターネット ネーム サービス (WINS) は、組織内に展開、リモートで接続している場合は、単一の名前には、次のように解決できます。  
  
-   によって、DNS で WINS 前方参照ゾーンを展開します。 Computername.dns.zone1.corp.contoso.com を解決しようとすると、要求は、コンピューター名のみを使用して WINS サーバーに送られます。 クライアントは、通常の DNS A レコード要求を発行しているが、これは、実際には NetBIOS 要求と認識します。  
  
    詳細については、次を参照してください。[前方参照ゾーンを管理する](https://technet.microsoft.com/library/cc816891(WS.10).aspx)します。  
  
-   既定のドメイン GPO に DNS サフィックス (dns.zone1.corp.contoso.com など) を追加します。  
  
##### <a name="split-brain-dns"></a>スプリット ブレイン DNS  
スプリット ブレイン DNS は、インターネットとイントラネットの名前解決のために同じ DNS ドメインの使用を指します。  
  
スプリット ブレイン DNS 展開では、Fqdn はインターネットとイントラネット上で重複され、対象のリソースを決定を一覧表示する必要があります、DirectAccess クライアントでは、リーチ、イントラネットまたはインターネット バージョンする必要があります。 DirectAccess クライアントがインターネット バージョンに到達する場合は、各リソースの NRPT に除外規則としての対応する FQDN を追加する必要があります。  
  
スプリット ブレイン DNS 環境で使用できるリソースの両方のバージョンを実行する場合は、インターネット上で使用される名前と重複しないように名前を持つ、イントラネット リソースを構成します。 ユーザーがイントラネット上のリソースにアクセスするときに代替名を使用するように指示します。 たとえば、内部名 www\.contoso.com に対して、代替名 www\.internal.contoso.com を構成します。  
  
スプリット ブレインではない DNS 環境で、インターネット名前空間はイントラネット名前空間と異なります。 たとえば、Contoso Corporation はインターネットで contoso.com を使用していますが、イントラネットでは corp.contoso.com を使用しています。 すべてのイントラネット リソースは、corp.contoso.com DNS サフィックスを使用しているため、corp.contoso.com の NRPT 規則は、イントラネット リソースに対するすべての DNS 名クエリをイントラネット DNS サーバーにルーティングします。 Contoso.com サフィックスの付いた名前に対する DNS クエリには、NRPT の corp.contoso.com イントラネット名前空間の規則が一致しないと、インターネット DNS サーバーに送信されます。 スプリット ブレインではない DNS 展開では、イントラネット リソースとインターネット リソースに対する FQDN の複製がないため、NRPT に対して追加の構成は必要ありません。 DirectAccess クライアントは、自分の組織のイントラネットとインターネット両方のリソースにアクセスできます。  
  
##### <a name="plan-local-name-resolution-behavior-for-directaccess-clients"></a>DirectAccess クライアントのローカル名の解決の動作を計画します。  
名前が DNS では、Windows Server 2012、Windows 8、Windows Server 2008 R2 で DNS クライアント サービスで解決することはできませんし、Windows 7 はリンク ローカル マルチキャスト名前解決 (LLMNR) と NetBIOS over TCP/IP プロトコルを解決するのには、ローカルの名前解決を使用できる場合、 ローカル サブネット上の名前。 ローカルの名前解決は、通常、コンピューターが単一サブネットのホーム ネットワークなどのプライベート ネットワークに配置されている場合、ピアツーピア接続に必要です。  
  
DNS クライアント サービスが、イントラネット サーバー名のローカルの名前解決を実行し、コンピューターがインターネット上の共有サブネットに接続されている、ときに、悪意のあるユーザーはイントラネット サーバー名を確認するメッセージを TCP/IP 経由で LLMNR と NetBIOS をキャプチャできます。 インフラストラクチャ サーバーのセットアップ ウィザードの DNS ページには、イントラネット DNS サーバーから受信した応答の種類に基づいてローカル名前解決の動作を構成できます。 次のオプションを使用できます。  
  
-   **名前が DNS に存在しない場合は、ローカルの名前解決を使用して**:このオプションは、DirectAccess クライアントがイントラネット DNS サーバーで解決できないサーバー名についてのみローカルの名前解決を実行するため、最も安全です。 イントラネット DNS サーバーに到達できれば、イントラネット サーバーの名前が解決されます。 イントラネット DNS サーバーに到達できない場合や、他の種類の DNS エラーがある場合に、イントラネット サーバー名がローカルの名前解決でサブネットに漏洩することはありません。  
  
-   **名前が DNS に存在しないか、DNS サーバーは、クライアント コンピューターが (推奨)、プライベート ネットワーク上、到達可能な場合は、ローカルの名前解決を使用して**:イントラネット DNS サーバーに到達できない場合のみ、プライベート ネットワークでローカルの名前解決の使用を許可するため、これは推奨オプションです。  
  
-   **ローカルの名前解決を使用して、任意の種類の DNS 解決エラー (低セキュリティ)** :イントラネット ネットワーク サーバーの名前がローカルの名前解決でローカル サブネットに漏洩する可能性があるため、これは低セキュリティのオプションです。  
  
#### <a name="plan-the-network-location-server-configuration"></a>ネットワーク ロケーション サーバーの構成を計画します。  
ネットワーク ロケーション サーバーとは、DirectAccess クライアントが企業ネットワークに置かれているかどうかを検出するために使用する Web サイトです。 企業ネットワーク内のクライアントは、内部リソースに到達するのに DirectAccess を使用しないでください。代わりに、直接接続します。  
  
または、組織内の別のサーバーでリモート アクセス サーバーで、ネットワーク ロケーション サーバー web サイトをホストできます。 リモート アクセス サーバーで、ネットワーク ロケーション サーバーをホストするリモート アクセスを展開するときに、web サイト自動的に作成されます。 Windows オペレーティング システムを実行して別のサーバーにネットワーク ロケーション サーバーをホストしている場合は、そのサーバーのインターネット インフォメーション サービス (IIS) がインストールされていることと、web サイトを作成することを確認しておく必要があります。 リモート アクセスでは、ネットワーク ロケーション サーバーの設定は構成しません。  
  
ネットワーク ロケーション サーバー web サイトが、次の要件を満たしていることを確認します。  
  
-   HTTPS サーバー証明書があります。  
  
-   内部ネットワーク上のコンピューターに高可用性が。  
  
-   インターネット上の DirectAccess クライアント コンピューターにアクセスできません。  
  
-  
  
さらに、ネットワーク ロケーション サーバー web サイトを設定する場合は、クライアントの次の要件を検討します。  
  
-   DirectAccess クライアント コンピューターがネットワーク ロケーション サーバー Web サイトへのサーバー証明書を発行した CA を信頼している。  
  
-   内部ネットワーク上の DirectAccess クライアント コンピューターは、ネットワーク ロケーション サーバー サイトの名前を解決できる。  
  
##### <a name="plan-certificates-for-the-network-location-server"></a>ネットワーク ロケーション サーバー用の証明書を計画します。  
ネットワーク ロケーション サーバーを使用する web サイト証明書を取得すると、次の操作を考慮してください。  
  
-   **サブジェクト** フィールドで、ネットワーク ロケーション サーバーのイントラネット インターフェイスまたはネットワーク ロケーション URL の FQDN の IP アドレスを指定します。  
  
-   **拡張キー使用法**フィールドに、サーバー認証 OID を使用します。  
  
-   ネットワーク ロケーション サーバー証明書は、証明書失効リスト (CRL) をチェックしてください。 **CRL 配布ポイント**フィールドに、イントラネットに接続されている DirectAccess クライアントからアクセスできる CRL 配布ポイントを使用します。 この CRL 配布ポイントは、内部ネットワークの外側からアクセスできないようにしてください。  
  
##### <a name="plan-dns-for-the-network-location-server"></a>DNS、ネットワーク ロケーション サーバーを計画します。  
DirectAccess クライアントは、内部ネットワークに配置されているかを判断するために、ネットワーク ロケーション サーバーに接続しようとします。 内部ネットワーク上のクライアントは、ネットワーク ロケーション サーバーの名前を解決できる必要がありますが、インターネットに配置されているときは名前を解決できないようにする必要があります。 このような処理が行われるように、既定では、ネットワーク ロケーション サーバーの FQDN が除外規則として NRPT に追加されます。  
  
### <a name="plan-management-servers-configuration"></a>管理サーバーの構成を計画します。  
DirectAccess クライアントは、Windows Update やウイルス対策の更新などのサービスを提供する管理サーバーとの通信を開始します。 DirectAccess クライアントは、内部ネットワークにアクセスする前に、ドメイン コント ローラーへの認証に Kerberos プロトコルを使用します。 DirectAccess クライアントのリモート管理中、管理サーバーはクライアント コンピューターと通信して、ソフトウェアやハードウェアのインベントリ評価などの管理機能を実行します。 リモート アクセスでは、次のような一部の管理サーバーが自動的に検出されます。  
  
-   ドメイン コント ローラー:クライアント コンピューターを含むドメインとリモート アクセス サーバーと同じフォレスト内のすべてのドメインのドメイン コント ローラーの自動検出が実行されます。  
  
-   System Center Configuration Manager サーバー  
  
ドメイン コント ローラーと System Center Configuration Manager サーバーが初めて DirectAccess を自動的に検出が構成されます。 検出されたドメイン コント ローラーは、コンソールに表示されませんが、Windows PowerShell コマンドレットを使用して設定を取得することができます。 ドメイン コント ローラーまたは System Center Configuration Manager サーバーが変更された場合にクリックすると**更新プログラムの管理サーバー**コンソールで管理サーバーの一覧を更新します。  
  
**管理サーバーの要件**  
  
-   管理サーバーは、インフラストラクチャ トンネル経由でアクセス可能である必要があります。 リモート アクセスを構成するときに、管理サーバーの一覧にサーバーを追加すると自動的にこのトンネルでアクセスできるようになります。  
  
-   ネイティブの IPv6 アドレスを使用して、または ISATAP によって割り当てられたアドレスを使用して、DirectAccess クライアントへの接続を開始する管理サーバーは、IPv6 を完全にサポートする必要があります。  
  
### <a name="plan-active-directory-requirements"></a>Active Directory の要件を計画します。  
リモート アクセスでは、次のように Active Directory を使用します。  
  
-   **認証**:インフラストラクチャ トンネルが、リモート アクセス サーバーに接続しているコンピューター アカウントに NTLMv2 認証を使用し、アカウントが Active Directory ドメインに存在する必要があります。 イントラネット トンネルは、ユーザーの Kerberos 認証を使用して、イントラネット トンネルを作成します。  
  
-   **グループ ポリシー オブジェクト**:リモート アクセスは、リモート アクセス サーバー、クライアント、および内部アプリケーション サーバーに適用されるグループ ポリシー オブジェクト (Gpo) に構成設定を収集します。  
  
-   **セキュリティ グループ**リモート アクセスは、収集し、DirectAccess クライアント コンピューターを識別するセキュリティ グループを使用します。 Gpo は、必要なセキュリティ グループに適用されます。  
  
リモート アクセス展開用の Active Directory 環境を計画するときは、次の要件を考慮してください。  
  
-   少なくとも 1 つのドメイン コント ローラーは、Windows Server 2012、Windows Server 2008 R2 Windows Server 2008、または Windows Server 2003 オペレーティング システムにインストールされます。  
  
    ドメイン コント ローラーが境界ネットワーク上 (およびリモート アクセス サーバーのインターネットに接続するネットワーク アダプターから到達可能な) の場合は、リモート アクセス サーバーが、到達することを防ぐことが。 インターネット アダプターの IP アドレスへの接続を防ぐためにドメイン コント ローラーのパケット フィルターを追加する必要があります。  
  
-   リモート アクセス サーバーはドメイン メンバーである必要があります。  
  
-   DirectAccess クライアントは、ドメイン メンバーである必要があります。 クライアントは次に所属することができます。  
  
    -   リモート アクセス サーバーと同じフォレスト内の任意のドメイン。  
  
    -   リモート アクセス サーバー ドメインと双方向の信頼関係がある任意のドメイン。  
  
    -   リモート アクセス サーバーのドメインのフォレストと双方向信頼関係があるフォレスト内の任意のドメイン  
  
> [!NOTE]  
> -   リモート アクセス サーバーはドメイン コントローラーにできません。  
> -   リモート アクセスに使用される Active Directory ドメイン コント ローラーされません (アダプターは Windows ファイアウォールのドメイン プロファイルには存在しない)、リモート アクセス サーバーの外部インターネット アダプターから到達できる必要があります。  
  
#### <a name="plan-client-authentication"></a>クライアント認証を計画する  
Windows Server 2012 リモート アクセスでは、ユーザー名とパスワードを使用して、組み込みの Kerberos 認証を使用して、IPsec コンピューター認証に証明書を使用するか選択できます。  
  
**Kerberos 認証**:認証に Active Directory の資格情報を使用することを選択すると最初に、DirectAccess は、コンピューターの Kerberos 認証を使用し、ユーザーの Kerberos 認証を使用します。 DirectAccess は内部ネットワーク上の DNS サーバー、ドメイン コント ローラー、およびその他のサーバーへのアクセスを提供する 1 つのセキュリティ トンネルを使用してこの認証モードを使用する場合  
  
**IPsec 認証**:2 要素認証またはネットワーク アクセス保護を使用することを選択すると、DirectAccess は、2 つのセキュリティ トンネルを使用します。 リモート アクセスのセットアップ ウィザードでは、セキュリティが強化された Windows ファイアウォールの接続セキュリティ規則を構成します。 これらの規則は、リモート アクセス サーバーへの IPsec のセキュリティをネゴシエートするときに、次の資格情報を指定します。  
  
-   インフラストラクチャ トンネルは、1 番目の認証と 2 番目の認証のユーザー (NTLMv2) 資格情報をコンピューター証明書の資格情報を使用します。 ユーザーの資格情報が認証済みインターネット プロトコル (AuthIP) の使用を強制し、DirectAccess クライアントは、Kerberos の資格情報を使用して、イントラネット トンネルの前に、DNS サーバーとドメイン コント ローラーへのアクセスを提供します。  
  
-   イントラネット トンネルは、1 番目の認証と 2 番目の認証のユーザー (Kerberos V5) 資格情報をコンピューター証明書の資格情報を使用します。  
  
#### <a name="plan-multiple-domains"></a>複数ドメインを計画する  
管理サーバーの一覧には、DirectAccess クライアント コンピューターが含まれるセキュリティ グループを含むすべてのドメインのドメイン コントローラーが含まれます。 DirectAccess クライアントとして構成されているコンピューターを使用するユーザー アカウントが含まれているすべてのドメインを含めることが必要があります。 これにより、使用しているクライアント コンピューターと同じドメインに置かれていないユーザーは、ユーザー ドメインのドメイン コントローラーで認証されます。  
  
この認証は、ドメインが同じフォレストがある場合は自動です。 クライアント コンピューターまたは別のフォレスト内にあるアプリケーション サーバーを持つセキュリティ グループは、それらのフォレストのドメイン コント ローラーは自動的に検出されません。 フォレストもない自動的に検出されます。 タスクを実行することができます**更新プログラムの管理サーバー**で、**リモート アクセス管理**をこれらのドメイン コント ローラーを検出します。  
  
可能であれば、リモート アクセスの展開中に、一般的なドメイン名サフィックスを NRPT に追加する必要があります。 たとえば、domain1.corp.contoso.com と domain2.corp.contoso.com という 2 つのドメインがある場合、2 つのエントリを NRPT に追加する代わりに、corp.contoso.com というドメイン名サフィックスに共通の DNS サフィックス エントリを追加できます。 これは、同じルート ドメインに対して自動的に発生します。 同じルートではありません。 ドメインを手動で追加する必要があります。  
  
### <a name="plan-group-policy-object-creation"></a>計画のグループ ポリシー オブジェクトの作成  
リモート アクセスを構成するときに、DirectAccess の設定は、グループ ポリシー オブジェクト (Gpo) に収集されます。 2 つの Gpo が DirectAccess の設定で設定され、次のように配布されます。  
  
-   **DirectAccess クライアント GPO**:この GPO には、セキュリティが強化された Windows ファイアウォールの IPv6 移行テクノロジ設定、NRPT エントリ、および接続セキュリティ規則を含む、クライアント設定が含まれています。 GPO は、クライアント コンピューターに指定されたセキュリティ グループに適用されます。  
  
-   **DirectAccess サーバー GPO**:この GPO には、展開でリモート アクセス サーバーとして構成した任意のサーバーに適用される DirectAccess 構成設定が含まれています。 セキュリティが強化された Windows ファイアウォールの接続セキュリティ規則も含まれています。  
  
> [!NOTE]  
> アプリケーション サーバーの構成は、クライアントがアプリケーション サーバーが存在する DirectAccess サーバーの内部ネットワークにアクセスできないため、DirectAccess クライアントのリモート管理ではサポートされません。 手順 4、リモート アクセスのセットアップの構成画面では、この種類の構成をご利用いただけません。  
  
自動または手動で Gpo を構成することができます。  
  
**自動的に**:Gpo が自動的に作成されたことを指定すると、各 GPO の既定の名前が指定されます。  
  
**手動で**:Active Directory 管理者によって事前に定義されている Gpo を使用することができます。  
  
Gpo を構成するときに、次の警告を検討してください。  
  
-   特定の GPO を使用するように DirectAccess が構成された後で、別の GPO を使用するように構成することはできません。  
  
-   DirectAccess のコマンドレットを実行する前に、すべてのリモート アクセス グループ ポリシー オブジェクトをバックアップするには、次の手順を使用します。  
  
    [バックアップおよびリモート アクセスの構成を復元する](https://go.microsoft.com/fwlink/?LinkID=257928)します。  
  
-   使用するか自動的にまたは手動で構成されている Gpo、クライアントが 3 G を使用する場合、低速リンク検出のポリシーを追加する必要があります。 パス**ポリシー。グループ ポリシーの低速リンクの検出を構成する**は。  
  
    **コンピューターの構成/ポリシー/管理用テンプレート/システム/グループ ポリシー**  
  
-   Gpo をリンクするための適切なアクセス許可が存在しない場合、警告が発行されます。 リモート アクセス操作は続行されますが、リンクは行われません。 この警告が発行されている場合のリンクは作成されません、自動的に場合でも、後で、アクセス許可を追加します。 代わりに、管理者がリンクを手動で作成する必要があります。  
  
#### <a name="automatically-created-gpos"></a>自動的に作成された Gpo  
作成された Gpo を自動的に使用すると、次を考慮してください。  
  
自動的に作成 GPO に従って適用されます、場所とリンク先では、次のように。  
  
-   DirectAccess サーバー GPO のリンク先と保存場所は、リモート アクセス サーバーを含むドメインをポイントします。  
  
-   クライアントとアプリケーション サーバー Gpo が作成されると、場所は、1 つのドメインに設定されます。 各ドメインで GPO 名が検索され、存在する場合、DirectAccess の設定、ドメインが入力されます。  
  
-   リンク先は GPO が作成されたドメインのルートに設定されます。 GPO はクライアント コンピューターまたはアプリケーション サーバーを含むドメインごとに作成され、その個々のドメインのルートにリンクされます。  
  
DirectAccess の設定を適用する Gpo を使用して自動的に作成されると、リモート アクセス サーバーの管理者には、次のアクセス許可が必要です。  
  
-   各ドメインに Gpo を作成するアクセス許可。  
  
-   選択したクライアント ドメインのすべてのルートにリンクするアクセス許可。  
  
-   サーバー GPO ドメイン ルートにリンクするアクセス許可。  
  
-   セキュリティのアクセス許可を作成するには、編集、削除、および、Gpo を変更します。  
  
-   GPO は、必要なドメインごとのアクセス許可を読み取る。 このアクセス許可は必要ありませんが、Gpo が作成されているときに重複した名前の Gpo が存在しないことを確認するリモート アクセスを有効になるのでお勧めします。  
  
#### <a name="manually-created-gpos"></a>手動で作成された Gpo  
手動で作成した GPO を使用する場合、次の点を考慮してください。  
  
-   GPO はリモート アクセス セットアップ ウィザードを実行する前に存在している必要があります。  
  
-   DirectAccess の設定を適用するには、リモート アクセス サーバーの管理者には、作成、編集、削除、および手動で作成した Gpo を変更する完全なセキュリティ アクセス許可が必要です。  
  
-   検索は、ドメイン全体で、GPO へのリンクが可能です。 GPO がドメインでリンクされていないと、リンクはドメインのルートで自動的に作成されます。 リンクの作成に必要なアクセス許可が使用できない場合、警告が発行されます。  
  
#### <a name="recovering-from-a-deleted-gpo"></a>削除された GPO からの回復  
リモート アクセス サーバー、クライアント、またはアプリケーション サーバーの GPO が誤って削除された場合は、次のエラー メッセージが表示されます。**GPO (GPO 名) が見つかりません**します。  
  
バックアップを使用できる場合は、バックアップから GPO を復元できます。 バックアップがない場合、は、構成設定を削除し、もう一度よう構成する必要があります。  
  
###### <a name="to-remove-configuration-settings"></a>構成設定を削除するには  
  
1.  Windows PowerShell コマンドレットを実行**Uninstall-remoteaccess**します。  
  
2.  開いている**リモート アクセス管理**します。  
  
3.  GPO が見つからないというエラー メッセージが表示されます。 **[構成設定の削除]** をクリックします。 完了した後、サーバーは、未構成の状態に復元され、設定を再構成することができます。  
  


