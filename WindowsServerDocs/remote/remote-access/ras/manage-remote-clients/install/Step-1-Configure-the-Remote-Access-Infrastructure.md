---
title: 手順 1 は、リモート アクセス インフラストラクチャを構成します。
description: このトピックは、「Windows Server 2016 で DirectAccess クライアントをリモート管理する」ガイドの一部です。
manager: brianlic
ms.prod: windows-server
ms.technology: networking-ras
ms.topic: article
ms.assetid: 0e7d1f5b-c939-47ca-892f-5bb285027fbc
ms.author: lizross
author: eross-msft
ms.openlocfilehash: 075d34a80abef25136f272ec530d693694e04799
ms.sourcegitcommit: d5e27c1f2f168a71ae272bebf8f50e1b3ccbcca3
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/23/2020
ms.locfileid: "86965464"
---
# <a name="step-1-configure-the-remote-access-infrastructure"></a>手順 1 は、リモート アクセス インフラストラクチャを構成します。

>適用先:Windows Server (半期チャネル)、Windows Server 2016

**注:** Windows Server 2012 では、DirectAccess およびルーティングとリモート アクセス サービス (RRAS) は単一のリモート アクセスの役割に統合されています。  
  
このトピックでは、IPv4 と IPv6 の混在環境で単一のリモートアクセスサーバーを使用して、高度なリモートアクセスの展開に必要なインフラストラクチャを構成する方法について説明します。 展開の手順を開始する前に、計画で説明した手順を完了していることを確認します [手順 1: リモート アクセス インフラストラクチャを計画](../plan/Step-1-Plan-the-Remote-Access-Infrastructure.md)します。  
  
|タスク|説明|  
|----|--------|  
|サーバーのネットワーク設定を構成する|リモート アクセス サーバーでサーバーのネットワーク設定を構成します。|  
|企業ネットワークでルーティングを構成する|企業ネットワークで、トラフィックが適切にルーティングされるようにルーティングを構成します。|  
|ファイアウォールの構成|必要に応じて、追加のファイアウォールを構成します。|  
|CA および証明書を構成する|必要に応じて、証明機関 (CA) を構成し、展開に必要なその他の証明書テンプレートを構成します。|  
|DNS サーバーを構成する|リモート アクセス サーバーの DNS 設定を構成します。|  
|Active Directory を構成する|クライアントコンピューターとリモートアクセスサーバーを Active Directory ドメインに参加させます。|  
|GPO を構成する|必要に応じて、展開用のグループポリシーオブジェクト (Gpo) を構成します。|  
|セキュリティ グループを構成する|DirectAccess クライアント コンピューターを含むセキュリティ グループと、展開に必要なその他のセキュリティ グループを構成します。|  
|ネットワーク ロケーション サーバーを構成する|ネットワーク ロケーション サーバー Web サイト証明書を含めて、ネットワーク ロケーション サーバーを構成します。|  
  
> [!NOTE]  
> このトピックでは、説明した手順の一部を自動化するのに使用できる Windows PowerShell コマンドレットのサンプルを示します。 詳細については、「[コマンドレットの使用](https://go.microsoft.com/fwlink/p/?linkid=230693)」を参照してください。  
  
## <a name="configure-server-network-settings"></a><a name="BKMK_ConfigNetworkSettings"></a>サーバーのネットワーク設定を構成する  
リモートアクセスサーバーをエッジまたはネットワークアドレス変換 (NAT) デバイスの内側に配置するかどうかによって、IPv4 と IPv6 を使用する環境で1台のサーバーを展開するために、次のネットワークインターフェイスのアドレス設定が必要になります。 すべての IP アドレスは、Windows の **[ネットワークと共有センター]** の **[アダプターの設定の変更**] を使用して構成されます。  
  
**エッジ トポロジ**:  
  
次のものが必要です。  
  
-   2つのインターネットに接続された連続するパブリック静的 IPv4 または IPv6 アドレス。  
  
    > [!NOTE]  
    > Teredo には、連続する 2 つのパブリック IPv4 アドレスが必要です。 Teredo を使用していない場合は、単一の静的パブリック IPv4 アドレスを構成できます。  
  
-   単一の内部静的 IPv4 または IPv6 アドレス。  
  
**NAT デバイス (2 つのネットワーク アダプター) の内側に**:  
  
1つの内部ネットワークに接続された静的な IPv4 または IPv6 アドレスが必要です。  
  
**NAT デバイスの内側 (1 つのネットワークアダプター)**:  
  
1つの静的な IPv4 または IPv6 アドレスが必要です。  
  
リモートアクセスサーバーに2つのネットワークアダプター (一方はドメインプロファイル用、もう1つはパブリックまたはプライベートプロファイル用) があるが、1つのネットワークアダプタートポロジを使用している場合は、次のような推奨事項があります。  
  
1.  2番目のネットワークアダプターがドメインプロファイルにも分類されていることを確認します。  
  
2.  何らかの理由でドメインプロファイル用に2番目のネットワークアダプターを構成できない場合は、次の Windows PowerShell コマンドを使用して、DirectAccess IPsec ポリシーのスコープをすべてのプロファイルに手動で設定する必要があります。  
  
    ```  
    $gposession = Open-NetGPO -PolicyStore <Name of the server GPO>  
    Set-NetIPsecRule -DisplayName <Name of the IPsec policy> -GPOSession $gposession -Profile Any  
    Save-NetGPO -GPOSession $gposession  
    ```  
  
    このコマンドで使用する IPsec ポリシーの名前は **DirectAccess DaServerToInfra** と **DirectAccess DaServerToCorp**します。  
  
## <a name="configure-routing-in-the-corporate-network"></a><a name="BKMK_ConfigRouting"></a>企業ネットワークでルーティングを構成する  
次のように、企業ネットワークでルーティングを構成します。  
  
-   組織でネィティブ IPv6 が展開されている場合、内部ネットワーク上のルーターがリモート アクセス サーバー経由で IPv6 トラフィックをルーティングするようにルートを追加します。  
  
-   リモート アクセス サーバー上で組織の IPv4 および IPv6 ルートを手動で構成します。 (/48) IPv6 プレフィックスを持つすべてのトラフィックが内部ネットワークに転送されるように、公開されたルートを追加します。 さらに、IPv4 トラフィックの場合、IPv4 トラフィックが内部ネットワークに転送されるように、明示的なルートを追加します。  
  
## <a name="configure-firewalls"></a><a name="BKMK_ConfigFirewalls"></a>ファイアウォールの構成  
選択したネットワーク設定に応じて、展開で追加のファイアウォールを使用する場合は、リモートアクセストラフィックに対して次のファイアウォール例外を適用します。  
  
### <a name="remote-access-server-on-ipv4-internet"></a>IPv4 インターネット上のリモートアクセスサーバー  
リモートアクセスサーバーが IPv4 インターネット上にある場合は、次のインターネットに接続するファイアウォール例外をリモートアクセストラフィックに適用します。  
  
-   **Teredo トラフィック**  
  
    ユーザーデータグラムプロトコル (UDP) 宛先ポート3544受信と、UDP 発信元ポート3544の送信。 この除外対象は、インターネットに接続された連続するリモートアクセスサーバーのパブリック IPv4 アドレスの両方に適用されます。  
  
-   **6to4 トラフィック**  
  
    IP プロトコル41の受信と送信。 この除外対象は、インターネットに接続された連続するリモートアクセスサーバーのパブリック IPv4 アドレスの両方に適用されます。  
  
-   **Ip-https トラフィック**  
  
    伝送制御プロトコル (TCP) 宛先ポート443、および TCP 発信元ポート443送信。 リモート アクセス サーバーに単一のネットワーク アダプターがあり、ネットワーク ロケーション サーバーがリモート アクセス サーバー上にある場合は、TCP ポート 62000 も必要です。 これらの除外対象は、サーバーの外部名が解決されるアドレスに対してのみ適用されます。  
  
    > [!NOTE]  
    > この除外は、リモートアクセスサーバーで構成されます。 その他のすべての除外はエッジファイアウォールで構成されます。  
  
### <a name="remote-access-server-on-ipv6-internet"></a>IPv6 インターネット上のリモートアクセスサーバー  
リモートアクセスサーバーが IPv6 インターネット上にある場合は、次のインターネットに接続するファイアウォール例外をリモートアクセストラフィックに適用します。  
  
-   IP プロトコル 50  
  
-   UDP 宛先ポート 500 の受信と、UDP 発信元ポート 500 の送信。  
  
-   IPv6 のインターネット制御メッセージ プロトコル (ICMPv6) トラフィックの受信と送信 - Teredo の実装だけです。  
  
### <a name="remote-access-traffic"></a>リモートアクセストラフィック  
次の内部ネットワークファイアウォール例外をリモートアクセストラフィックに適用します。  
  
-   ISATAP: プロトコル 41 の受信と送信  
  
-   すべての IPv4 または IPv6 トラフィックに対する TCP/UDP  
  
-   すべての IPv4 または IPv6 トラフィックの ICMP  
  
## <a name="configure-cas-and-certificates"></a><a name="BKMK_ConfigCAs"></a>CA および証明書を構成する  
コンピューターの認証に証明書を使用して、ユーザー名とパスワードを使用する組み込みの Kerberos 認証を使用するかを選択する [Windows Server 2012 を使用すると、リモート アクセスをします。 また、リモートアクセスサーバーで ip-https 証明書を構成する必要があります。 このセクションでは、これらの証明書を構成する方法について説明します。  
  
公開キー基盤 (PKI) の設定の詳細については、次を参照してください。 [Active Directory Certificate Services](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc770357(v=ws.10))します。  
  
### <a name="configure-ipsec-authentication"></a><a name="BKMK_ConfigIPsec"></a>IPsec 認証を構成する  
リモートアクセスサーバーとすべての DirectAccess クライアントで、IPsec 認証を使用できるように証明書が必要です。 証明書は、内部証明機関 (CA) によって発行されている必要があります。 リモートアクセスサーバーと DirectAccess クライアントは、ルート証明書と中間証明書を発行する CA を信頼する必要があります。  
  
##### <a name="to-configure-ipsec-authentication"></a>IPsec 認証を構成するには  
  
1.  内部 CA で既定のコンピューターの証明書テンプレートを使用する場合、または」の説明に従って、新しい証明書テンプレートを作成する場合を決定 [証明書テンプレートの作成](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc731705(v=ws.10))します。  
  
    > [!NOTE]  
    > 新しいテンプレートを作成する場合は、クライアント認証用に構成する必要があります。  
  
2.  必要に応じて、証明書テンプレートを展開します。 詳細については、次を参照してください。 [証明書テンプレートを展開する](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc770794(v=ws.10))です。  
  
3.  必要に応じて、自動登録用のテンプレートを構成します。  
  
4.  必要に応じて、証明書の自動登録を構成します。 詳細については、次を参照してください。 [Configure Certificate Autoenrollment](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc731522(v=ws.11))します。  
  
### <a name="configure-certificate-templates"></a><a name="BKMK_ConfigCertTemp"></a>証明書テンプレートを構成する  
内部 CA を使用して証明書を発行する場合は、IP-HTTPS 証明書とネットワークロケーションサーバーの web サイト証明書の証明書テンプレートを構成する必要があります。  
  
##### <a name="to-configure-a-certificate-template"></a>証明書テンプレートを構成するには  
  
1.  内部 CA の証明書テンプレートの説明に従って作成 [証明書テンプレートの作成](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc731705(v=ws.10))します。  
  
2.  [証明書テンプレートの展開に関するページ](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc770794(v=ws.10))の説明に従って証明書テンプレートを展開します。  
  
テンプレートを準備したら、テンプレートを使用して証明書を構成できます。 詳細については、次の手順を参照してください。  
  
-   [IP-HTTPS 証明書を構成する](#BKMK_IPHTTPS)  
  
-   [ネットワーク ロケーション サーバーを構成する](#BKMK_ConfigNLS)  
  
### <a name="configure-the-ip-https-certificate"></a><a name="BKMK_IPHTTPS"></a>IP-HTTPS 証明書を構成する  
リモート アクセスでは、リモート アクセス サーバーへの IP-HTTPS 接続を認証するために IP-HTTPS 証明書が必要です。 IP-HTTPS 証明書には 3 つの証明書オプションがあります。  
  
-   **パブリック**  
  
    サードパーティによって提供されます。  
  
-   **プライベート**  
  
    証明書が証明書テンプレートで作成したに基づいて [証明書テンプレートを構成する](assetId:///6a5ec5c1-d653-47b1-a567-cc485004e7bc#ConfigCertTemp)です。 これには、パブリックに解決可能な FQDN から到達可能な証明書失効リスト (CRL) 配布ポイントが必要です。  
  
-   **自己署名**  
  
    この証明書には、パブリックに解決可能な FQDN から到達可能な CRL 配布ポイントが必要です。  
  
    > [!NOTE]  
    > 自己署名証明書はマルチサイト展開では使用できません。  
  
IP-HTTPS 認証に使用する Web サイトの証明書が次の要件を満たしていることを確認します。  
  
-   証明書のサブジェクト名は、リモートアクセスサーバーの ip-https 接続にのみ使用される IP-HTTPS URL (ConnectTo アドレス) の外部で解決可能な完全修飾ドメイン名 (FQDN) である必要があります。  
  
-   証明書の共通名は、IP-HTTPS サイトの名前と一致している必要があります。  
  
-   [サブジェクト] フィールドで、リモートアクセスサーバーの外部アダプターの IPv4 アドレスまたは ip-https URL の FQDN を指定します。  
  
-   **拡張キー使用法** フィールドに、サーバー認証オブジェクト識別子 (OID) を使用します。  
  
-   **[CRL 配布ポイント]** フィールドに、インターネットに接続している DirectAccess クライアントがアクセスできる CRL 配布ポイントを指定します。  
  
-   IP-HTTPS 証明書には秘密キーが必要です。  
  
-   IP-HTTPS 証明書は、個人用ストアに直接インポートする必要があります。  
  
-   IP-HTTPS 証明書の名前にはワイルドカードを含めることができます。  
  
##### <a name="to-install-the-ip-https-certificate-from-an-internal-ca"></a>内部 CA から IP-HTTPS 証明書をインストールするには  
  
1.  リモート アクセス サーバー上: で、 **開始** 画面で「**mmc.exe**, 、ENTER キーを押します。  
  
2.  MMC コンソールの **[ファイル]** メニューで、 **[スナップインの追加と削除]** をクリックします。  
  
3.  **[スナップインの追加と削除]** ダイアログ ボックスで、**[証明書]**、**[追加]**、**[コンピューター アカウント]**、**[次へ]**、**[ローカル コンピューター]**、**[完了]** の順にクリックし、**[OK]** をクリックします。  
  
4.  証明書スナップインのコンソール ツリーで、**[証明書 (ローカル コンピューター)]、[個人用]、[証明書]** の順に開きます。  
  
5.  [**証明書**] を右クリックして [**すべてのタスク**] をポイントし、[**新しい証明書の要求**] をクリックして、[**次へ**] を2回クリックします。  
  
6.  **証明書の要求** ページで、証明書テンプレートの構成で作成した証明書テンプレートのチェック ボックスをオンにし、必要な場合はクリックして **の詳細については、この証明書を登録するために必要な**です。  
  
7.  **[証明書のプロパティ]** ダイアログ ボックスの **[サブジェクト]** タブで、**[サブジェクト名]** 領域の **[種類]** から **[共通名]** を選択します。  
  
8.  **値**, 、リモート アクセス サーバーの外部アダプターまたは IP-HTTPS URL の FQDN の IPv4 アドレスを指定し、クリックして **追加**します。  
  
9. **[別名]** 領域の **[種類]** で、**[DNS]** を選択します。  
  
10. **値**, 、リモート アクセス サーバーの外部アダプターまたは IP-HTTPS URL の FQDN の IPv4 アドレスを指定し、クリックして **追加**します。  
  
11. [**全般**] タブの [**フレンドリ名**] に証明書の識別に役立つ名前を入力できます。  
  
12. [**拡張機能**] タブで、[**拡張キー使用法**] の横の矢印をクリックして、[**選択されているオプション**] リストに [サーバー認証] が含まれていることを確認します。  
  
13. [**OK**] をクリックし、[**登録**] をクリックして、[**完了**] をクリックします。  
  
14. 証明書スナップインの詳細ウィンドウで、新しい証明書がサーバー認証の目的で登録されていることを確認します。  
  
## <a name="configure-the-dns-server"></a><a name="BKMK_ConfigDNS"></a>DNS サーバーを構成する  
展開内の内部ネットワークのネットワーク ロケーション サーバー Web サイトの DNS エントリを手動で構成する必要があります。  
  
### <a name="to-add-the-network-location-server-and-web-probe"></a><a name="NLS_DNS"></a>ネットワークロケーションサーバーと web プローブを追加するには  
  
1.  内部ネットワーク DNS サーバー上: で、 **開始** 画面で「**dnsmgmt.msc**, 、ENTER キーを押します。  
  
2.  [**DNS マネージャー**] コンソールの左側のウィンドウで、ドメインの前方参照ゾーンを展開します。 ドメインを右クリックし、をクリックして **新しいホスト (A または AAAA)** します。  
  
3.  **新しいホスト** ダイアログ ボックスで、 **名 (使用して親ドメイン名空白の場合)** (これは DirectAccess クライアントがネットワーク ロケーション サーバーへの接続に使用する名前です)、ネットワーク ロケーション サーバー web サイトの DNS 名を入力します。 **IP アドレス** ボックスで、ネットワーク ロケーション サーバーの IPv4 アドレスを入力してをクリックして **ホストの追加**, 、] をクリックし、 **OK**します。  
  
4.  **新しいホスト** ダイアログ ボックスで、 **名 (使用して親ドメイン名空白の場合)** ] (既定の web プローブの名前は directaccess webprobehost) の web プローブの DNS 名を入力します。 [**IP アドレス**] ボックスに Web プローブの IPv4 アドレスを入力して、[**ホストの追加**] をクリックします。  
  
5.  directaccess-corpconnectivityhost および手動で作成した接続検証ツールに対し、このプロセスを繰り返します。 **DNS** ダイアログ ボックスで、をクリックして **OK**します。  
  
6.  **[Done]** をクリックします。  
  
![Windows PowerShell](../../../../media/Step-1-Configure-the-Remote-Access-Infrastructure/PowerShellLogoSmall.gif)***<em>windows powershell の同等のコマンド</em>***  
  
次の Windows PowerShell コマンドレットは、前の手順と同じ機能を実行します。 各コマンドレットを単一行に入力します。ただし、ここでは、書式上の制約があるために、複数行に改行されて表示される場合があります。  
  
```  
Add-DnsServerResourceRecordA -Name <network_location_server_name> -ZoneName <DNS_zone_name> -IPv4Address <network_location_server_IPv4_address>  
Add-DnsServerResourceRecordAAAA -Name <network_location_server_name> -ZoneName <DNS_zone_name> -IPv6Address <network_location_server_IPv6_address>  
```  
  
次の DNS エントリも構成する必要があります。  
  
-   **IP-HTTPS サーバー**  
  
    DirectAccess クライアントは、インターネットからリモートアクセスサーバーの DNS 名を解決できる必要があります。  
  
-   **CRL 失効確認**  
  
    Directaccess は、DirectAccess クライアントとリモートアクセスサーバー間の ip-https 接続、および DirectAccess クライアントとネットワークロケーションサーバー間の HTTPS ベースの接続に対して、証明書失効確認を使用します。 どちらの場合も、DirectAccess クライアントは、CRL 配布ポイントの場所の解決とアクセスができる必要があります。  
  
-   **ISATAP**  
  
    サイト内の自動トンネルアドレッシングプロトコル (ISATAP) は、トンネルを使用して、DirectAccess クライアントが IPv4 インターネット経由でリモートアクセスサーバーに接続できるようにし、IPv4 ヘッダー内に IPv6 パケットをカプセル化します。 イントラネットで、ISATAP ホストへの IPv6 接続を提供するため、リモート アクセスによって使用されます。 ネイティブではない IPv6 ネットワーク環境では、リモートアクセスサーバーは自動的に ISATAP ルーターとして構成します。 ISATAP 名の解決のサポートが必要です。  
  
## <a name="configure-active-directory"></a><a name="BKMK_ConfigAD"></a>Active Directory を構成する  
リモート アクセス サーバーとすべての DirectAccess クライアント コンピューターは Active Directory ドメインに参加している必要があります。 DirectAccess クライアント コンピューターは、次のいずれかのドメインの種類のメンバーである必要があります。  
  
-   リモート アクセス サーバーと同じフォレストに属するドメイン。  
  
-   リモート アクセス サーバー フォレストと双方向の信頼を持つフォレストに属するドメイン。  
  
-   リモート アクセス サーバー ドメインへの双方向の信頼を持つドメイン。  
  
#### <a name="to-join-the-remote-access-server-to-a-domain"></a>リモート アクセス サーバーをドメインに追加するには  
  
1.  サーバー マネージャーで **[ローカル サーバー]** をクリックします。 詳細ウィンドウで、**[コンピューター名]** の横にあるリンクをクリックします。  
  
2.  [**システムのプロパティ**] ダイアログ ボックスで [**コンピューター名**] タブをクリックし、[**変更**] をクリックします。  
  
3.  **コンピューター名** ボックスに、サーバーをドメインに参加する際にも、コンピューター名を変更する場合は、コンピューターの名前を入力します。 [ **のメンバー**, 、] をクリックして **ドメイン**, 、クリックしてサーバー (corp.contoso.com など) に参加するドメインの名前を入力し、 **[ok]** します。  
  
4.  ユーザー名とパスワードを求められたら、ユーザー名とコンピューターをドメインに参加し、アクセス許可を持つユーザーのパスワードを入力してください。 **OK**します。  
  
5.  ドメインへの参加を知らせるダイアログ ボックスが表示されたら、[**OK**] をクリックします。  
  
6.  コンピューターを再起動するよう求めるメッセージが表示されたら、**[OK]** をクリックします。  
  
7.  **[システムのプロパティ]** ダイアログ ボックスで、**[閉じる]** をクリックします。  
  
8.  コンピューターを再起動するよう求めるメッセージが表示されたら、**[今すぐ再起動する]** をクリックします。  
  
#### <a name="to-join-client-computers-to-the-domain"></a>クライアント コンピューターをドメインに参加させるには  
  
1.  **開始** 画面で「**explorer.exe**, 、ENTER キーを押します。  
  
2.  [コンピューター] アイコンを右クリックし、[**プロパティ**] をクリックします。  
  
3.  [**システム**] ページで、[**システムの詳細設定**] をクリックします。  
  
4.  **[システムのプロパティ]** ダイアログ ボックスの **[コンピューター名]** タブで **[変更]** をクリックします。  
  
5.  サーバーをドメインに参加させるときにコンピューター名も変更する場合は、[**コンピューター名**] ボックスにコンピューターの名前を入力します。 **[次のメンバー]** で **[ドメイン]** をクリックし、サーバーの追加先のドメイン名 (corp.contoso.com など) を入力し、**[OK]** をクリックします。  
  
6.  ユーザー名とパスワードを求められたら、ユーザー名とコンピューターをドメインに参加し、アクセス許可を持つユーザーのパスワードを入力してください。 **OK**します。  
  
7.  ドメインへの参加を知らせるダイアログ ボックスが表示されたら、[**OK**] をクリックします。  
  
8.  コンピューターを再起動するよう求めるメッセージが表示されたら、**[OK]** をクリックします。  
  
9. **システム プロパティ** ] ダイアログ ボックスを閉じる] をクリックします。  
  
10. 指示に従い、[**今すぐ再起動する**] をクリックします。  
  
![Windows PowerShell](../../../../media/Step-1-Configure-the-Remote-Access-Infrastructure/PowerShellLogoSmall.gif)***<em>windows powershell の同等のコマンド</em>***  
  
次の Windows PowerShell コマンドレットは、前の手順と同じ機能を実行します。 各コマンドレットを単一行に入力します。ただし、ここでは、書式上の制約があるために、複数行に改行されて表示される場合があります。  
  
> [!NOTE]  
> 次のコマンドを入力した後で、ドメイン資格情報を指定する必要があります。  
  
```  
Add-Computer -DomainName <domain_name>  
Restart-Computer  
```  
  
## <a name="configure-gpos"></a><a name="BKMK_ConfigGPOs"></a>GPO を構成する  
リモート アクセスを展開するには、2 つのグループ ポリシー オブジェクトの最小値が必要です。 1 つのグループ ポリシー オブジェクトには、リモート アクセス サーバーの設定が含まれていて、DirectAccess クライアント コンピューターの設定が含まれています。 リモート アクセスを構成するときに、ウィザードは自動的に必要なグループ ポリシー オブジェクトを作成します。 ただし、名前付け規則を実施する組織、またはグループ ポリシー オブジェクトを作成または更新に必要なアクセス許可がないは、リモート アクセスを構成する前に、作成する必要があります。  
  
グループ ポリシー オブジェクトを作成するを参照してください。 [を作成し、グループ ポリシー オブジェクトを編集](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc754740(v=ws.11))します。  
  
管理者は、組織単位 (OU) に、DirectAccess グループ ポリシー オブジェクトを手動でリンクできます。 以下、具体例に沿って説明します。  
  
1.  DirectAccess を構成する前に、作成した Gpo をそれぞれの Ou にリンクします。  
  
2.  DirectAccess を構成する場合は、クライアント コンピューターにセキュリティ グループを指定します。  
  
3.  Gpo は、管理者が Gpo をドメインにリンクするアクセス許可を持っているかどうかに関係なく、自動的に構成されます。  
  
4.  Gpo が既に OU にリンクされている場合、リンクは削除されませんが、ドメインにリンクされません。  
  
5.  サーバー Gpo、OU は、サーバーのコンピューター オブジェクトのそれ以外の場合に含める必要があります、GPO がドメインのルートにリンクされます。  
  
6.  DirectAccess セットアップウィザードを実行して OU が以前にリンクされていない場合、構成が完了すると、管理者は DirectAccess Gpo を必要な Ou にリンクして、ドメインへのリンクを削除できます。  
  
    詳細については、次を参照してください。 [グループ ポリシー オブジェクト リンク](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc732979(v=ws.11))します。  
  
> [!NOTE]  
> グループ ポリシー オブジェクトは、手動で作成されている場合は、グループ ポリシー オブジェクトが使用できないこと、DirectAccess 構成中に考えられるです。 グループ ポリシー オブジェクトは、管理コンピューターに最も近いドメイン コント ローラーにレプリケートするされていない可能性があります。 管理者はレプリケーションが完了するまで待つか、レプリケーションを強制することができます。  
  
## <a name="configure-security-groups"></a><a name="BKMK_ConfigSGs"></a>セキュリティ グループを構成する  
クライアント コンピューターのグループ ポリシー オブジェクトに含まれる DirectAccess 設定は、リモート アクセスを構成するときに指定したセキュリティ グループのメンバーであるコンピューターにのみ適用されます。  
  
### <a name="to-create-a-security-group-for-directaccess-clients"></a><a name="Sec_Group"></a>DirectAccess クライアントのセキュリティ グループを作成するには  
  
1.  **開始** 画面で「**dsa.msc**, 、ENTER キーを押します。  
  
2.  [**Active Directory ユーザーとコンピュータ**] コンソールの左側のウィンドウで、セキュリティ グループを含むドメインを展開し、[**Users**] を右クリックし、[**新規作成**] をクリックして、[**グループ**] をクリックします。  
  
3.  **[新しいオブジェクト - グループ]** ダイアログ ボックスの **[グループ名]** の下に、セキュリティ グループの名前を入力します。  
  
4.  **[グループのスコープ]** の下で **[グローバル]** をクリックし、**[グループの種類]** の下で **[セキュリティ]** をクリックし、**[OK]** をクリックします。  
  
5.  DirectAccess クライアント コンピューターのセキュリティ グループをダブルクリックし、[、 **プロパティ** ダイアログ ボックスで、をクリックして、 **メンバー** ] タブをクリックします。  
  
6.  [**メンバー**] タブで [**追加**] をクリックします。  
  
7.  [**ユーザー、連絡先、コンピューター、サービス アカウントまたはグループの選択**] ダイアログ ボックスで、DirectAccess 用に有効にするクライアント コンピューターを選択し、[**OK**] をクリックします。  
  
![Windows PowerShell](../../../../media/Step-1-Configure-the-Remote-Access-Infrastructure/PowerShellLogoSmall.gif)**Windows powershell の同等のコマンド**  
  
次の Windows PowerShell コマンドレットは、前の手順と同じ機能を実行します。 各コマンドレットを単一行に入力します。ただし、ここでは、書式上の制約があるために、複数行に改行されて表示される場合があります。  
  
```  
New-ADGroup -GroupScope global -Name <DirectAccess_clients_group_name>  
Add-ADGroupMember -Identity DirectAccess_clients_group_name -Members <computer_name>  
```  
  
## <a name="configure-the-network-location-server"></a><a name="BKMK_ConfigNLS"></a>ネットワーク ロケーション サーバーを構成する  
ネットワークロケーションサーバーは、高可用性を備えたサーバー上に配置する必要があります。また、DirectAccess クライアントによって信頼されている有効な Secure Sockets Layer (SSL) 証明書が必要です。  
  
> [!NOTE]  
> ネットワークロケーションサーバーの web サイトがリモートアクセスサーバーにある場合は、リモートアクセスを構成すると web サイトが自動的に作成され、指定したサーバー証明書にバインドされます。  
  
ネットワーク ロケーション サーバー証明書には、次の 2 つの証明書オプションがあります。  
  
-   **プライベート**  
  
    > [!NOTE]  
    > 証明書が証明書テンプレートで作成したに基づいて [証明書テンプレートを構成する](assetId:///6a5ec5c1-d653-47b1-a567-cc485004e7bc#ConfigCertTemp)です。  
  
-   **自己署名**  
  
    > [!NOTE]  
    > 自己署名証明書はマルチサイト展開では使用できません。  
  
プライベート証明書と自己署名証明書のどちらを使用する場合でも、次のものが必要です。  
  
-   ネットワーク ロケーション サーバーに使用する Web サイト証明書。 証明書のサブジェクトは、ネットワーク ロケーション サーバーの URL である必要があります。  
  
-   内部ネットワーク上の高可用性を備えた CRL 配布ポイント。  
  
#### <a name="to-install-the-network-location-server-certificate-from-an-internal-ca"></a>内部 CA からネットワーク ロケーション サーバー証明書をインストールするには  
  
1.  ネットワーク ロケーション サーバー web サイトをホストするサーバー上: で、 **開始** 画面で「**mmc.exe**, 、ENTER キーを押します。  
  
2.  MMC コンソールの **[ファイル]** メニューで、 **[スナップインの追加と削除]** をクリックします。  
  
3.  **[スナップインの追加と削除]** ダイアログ ボックスで、**[証明書]**、**[追加]**、**[コンピューター アカウント]**、**[次へ]**、**[ローカル コンピューター]**、**[完了]** の順にクリックし、**[OK]** をクリックします。  
  
4.  証明書スナップインのコンソール ツリーで、**[証明書 (ローカル コンピューター)]、[個人用]、[証明書]** の順に開きます。  
  
5.  右クリック **証明書**, 、] をポイント **すべてのタスク**, 、] をクリックして **新しい証明書の要求**, 、] をクリックし、 **次** 2 回クリックします。  
  
6.  **証明書の要求** ページで、証明書テンプレートの構成で作成した証明書テンプレートのチェック ボックスをオンにし、必要な場合はクリックして **の詳細については、この証明書を登録するために必要な**です。  
  
7.  **[証明書のプロパティ]** ダイアログ ボックスの **[サブジェクト]** タブで、**[サブジェクト名]** 領域の **[種類]** から **[共通名]** を選択します。  
  
8.  **[値]** にネットワーク ロケーション サーバー Web サイトの FQDN を入力して、**[追加]** をクリックします。  
  
9. **[別名]** 領域の **[種類]** で、**[DNS]** を選択します。  
  
10. **[値]** にネットワーク ロケーション サーバー Web サイトの FQDN を入力して、**[追加]** をクリックします。  
  
11. [**全般**] タブの [**フレンドリ名**] に証明書の識別に役立つ名前を入力できます。  
  
12. [**OK**] をクリックし、[**登録**] をクリックして、[**完了**] をクリックします。  
  
13. 証明書スナップインの詳細ウィンドウで、新しい証明書がサーバー認証の目的で登録されていることを確認します。  
  
#### <a name="to-configure-the-network-location-server"></a>ネットワーク ロケーション サーバーを構成するには  
  
1.  高可用性サーバーに Web サイトを設定します。 Web サイトにコンテンツは必要ありませんが、テストする際は、クライアントが接続したときにメッセージを表示する既定のページを定義できます。  
  
    ネットワークロケーションサーバーの web サイトがリモートアクセスサーバーでホストされている場合、この手順は必要ありません。  
  
2.  HTTPS サーバー証明書を Web サイトにバインドします。 証明書の共通名は、ネットワーク ロケーション サーバー サイトの名前と一致している必要があります。 DirectAccess クライアントが発行元 CA を信頼していることを確認します。  
  
    ネットワークロケーションサーバーの web サイトがリモートアクセスサーバーでホストされている場合、この手順は必要ありません。  
  
3.  内部ネットワークで高可用性を実現する CRL サイトを設定します。  
  
    CRL 配布ポイントは、次の方法でアクセスできます。  
  
    -   HTTP ベースの URL を使用する Web サーバー。次に例を示します。https://crl.corp.contoso.com/crld/corp-APP1-CA.crl  
  
    -   ファイル サーバーなど、汎用名前付け規則 (UNC) パスを介してアクセスされる \\\crl.corp.contoso.com\crld\corp-APP1-CA.crl  
  
    内部 CRL 配布ポイントが IPv6 経由でのみ到達可能な場合は、セキュリティが強化された Windows ファイアウォールの接続セキュリティ規則を構成する必要があります。 これにより、イントラネットの IPv6 アドレス空間から CRL 配布ポイントの IPv6 アドレスへの IPsec 保護が除外さされます。  
  
4.  内部ネットワーク上の DirectAccess クライアントがネットワークロケーションサーバーの名前を解決できること、およびインターネット上の DirectAccess クライアントが名前を解決できないことを確認します。  
  
## <a name="see-also"></a><a name="BKMK_Links"></a>関連項目  
  
-   [手順 2:リモート アクセス サーバーを構成する](Step-2-Configure-the-Remote-Access-Server.md)
