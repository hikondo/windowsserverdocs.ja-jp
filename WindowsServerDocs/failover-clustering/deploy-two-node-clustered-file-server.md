---
title: 2ノードのクラスター化されたファイルサーバーの展開
description: この記事では、2ノードのファイルサーバークラスターの作成について説明します。
manager: eldenc
ms.topic: article
author: johnmarlin-msft
ms.author: johnmar
ms.date: 02/01/2019
ms.openlocfilehash: 56130833ca2c3de8752fb79f5acdf30a1fafae2f
ms.sourcegitcommit: 67a486b4fb3937a457eb00d21a2e33b753489fd8
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/12/2020
ms.locfileid: "88149556"
---
# <a name="deploying-a-two-node-clustered-file-server"></a>2ノードのクラスター化されたファイルサーバーの展開

> 適用先:Windows Server 2019、Windows Server 2016

フェールオーバー クラスターとは、アプリケーションやサービスの可用性を向上するために、互いに連携する独立したコンピューターで構成されるグループを指します。 クラスター サーバー (ノード) は、物理ケーブルとソフトウェアにより接続されます。 クラスター ノードの 1 つに障害が発生すると、他のノードがサービスの提供を開始します (フェールオーバーと呼ばれる処理)。 ユーザーはサービスの中断を最小限に抑えます。

このガイドでは、2つのノードを持つ汎用ファイルサーバーフェールオーバークラスターをインストールして構成する手順について説明します。 このガイドで構成を作成することによって、フェールオーバークラスターについて学習し、Windows Server 2019 または Windows Server 2016 のフェールオーバークラスター管理スナップインインターフェイスを理解することができます。

## <a name="overview-for-a-two-node-file-server-cluster"></a>2ノードファイルサーバークラスターの概要

フェールオーバークラスター内のサーバーは、ファイルサーバー、Hyper-v サーバー、またはデータベースサーバーの役割を含むさまざまな役割で機能し、他のさまざまなサービスやアプリケーションに対して高可用性を提供できます。 このガイドでは、2ノードのファイルサーバークラスターを構成する方法について説明します。

通常、フェールオーバークラスターには、クラスター内のすべてのサーバーに物理的に接続されている記憶域ユニットが含まれます。ただし、記憶域の特定のボリュームは一度に1台のサーバーによってのみアクセスされます。 次の図は、記憶域ユニットに接続されている2ノードフェールオーバークラスターを示しています。

![2ノードクラスター](media/Cluster-File-Server/Cluster-FS-Overview.png)

クラスター内のノードに公開されている記憶域ボリュームまたは論理ユニット番号 (Lun) を他のサーバー (別のクラスター内のサーバーを含む) に公開することはできません。 次の図はこれを示しています。

![ストレージ内の Lun](media/Cluster-File-Server/Cluster-FS-LUNs.png)

サーバーの最大可用性を確保するには、サーバー管理のベストプラクティスに従うことが重要です。たとえば、サーバーの物理環境を慎重に管理したり、ソフトウェアの変更を完全に実装する前にテストしたり、すべてのクラスター化されたサーバーでソフトウェアの更新と構成の変更を慎重に追跡したりすることが重要です。

次のシナリオでは、ファイルサーバーのフェールオーバークラスターを構成する方法について説明します。 共有されるファイルはクラスター記憶域上にあり、いずれかのクラスター化されたサーバーはそれらを共有するファイルサーバーとして機能できます。

## <a name="shared-folders-in-a-failover-cluster"></a>フェールオーバークラスター内の共有フォルダー

次の一覧では、フェールオーバークラスタリングに統合されている共有フォルダーの構成機能について説明します。

- 表示のスコープは、クラスター化された共有フォルダーのみです (非クラスター化共有フォルダーと混在させることはできません)。クラスター化されたファイルサーバーのパスを指定してユーザーが共有フォルダーを表示する場合、表示には、特定のファイルサーバーの役割の一部である共有フォルダーのみが表示されます。 クラスター化されていない共有フォルダーを除外し、クラスターのノード上に存在する別のファイルサーバーの役割の一部を共有します。

- アクセスベースの列挙型: アクセスベースの列挙を使用して、指定したフォルダーをユーザーのビューから非表示にすることができます。 ユーザーがフォルダーを閲覧することはできますが、そのフォルダー上の何にもアクセスできないようにするには、フォルダーがまったく表示されないようにします。 クラスター化された共有フォルダーのアクセスベースの列挙は、クラスター化されていない共有フォルダーの場合と同じように構成できます。

- オフラインアクセス: クラスター化された共有フォルダーのオフラインアクセス (キャッシュ) は、非クラスター化共有フォルダーの場合と同じように構成できます。

- クラスター化されたディスクは、常にクラスターの一部として認識されます。フェールオーバークラスターインターフェイス、Windows エクスプローラー、または共有と記憶域の管理スナップインを使用するかどうかにかかわらず、Windows は、ディスクがクラスター記憶域として指定されているかどうかを認識します。 クラスター化されたファイルサーバーの一部として、フェールオーバークラスター管理でこのようなディスクが既に構成されている場合は、前述のいずれかのインターフェイスを使用して、ディスク上に共有を作成できます。 このようなディスクがクラスター化されたファイルサーバーの一部として構成されていない場合は、誤って共有を作成することはできません。 代わりに、ディスクを共有する前に、クラスター化されたファイルサーバーの一部としてディスクを構成する必要があることを示すエラーが表示されます。

- ネットワークファイルシステム用のサービスの統合: Windows Server のファイルサーバーの役割には、Network File System (NFS) 用のサービスと呼ばれるオプションの役割サービスが含まれています。 役割サービスをインストールし、NFS 用サービスを使用して共有フォルダーを構成することにより、UNIX ベースのクライアントをサポートするクラスター化されたファイルサーバーを作成できます。

## <a name="requirements-for-a-two-node-failover-cluster"></a>2ノードフェールオーバークラスターの要件

Windows Server 2016 または Windows Server 2019 のフェールオーバークラスターが Microsoft によって正式にサポートされているソリューションと見なされるためには、次の条件を満たす必要があります。

- すべてのハードウェアおよびソフトウェア コンポーネントが、適切なロゴの要件を満たしている。 Windows Server 2016 の場合、これは "Windows Server 2016 認定済み" ロゴです。 Windows Server 2019 の場合、これは "Windows Server 2019 認定済み" ロゴです。 認定されているハードウェアおよびソフトウェアシステムの詳細については、Microsoft [Windows Server Catalog](https://www.windowsservercatalog.com/default.aspx) サイトを参照してください。

- 完全に構成されたソリューション (サーバー、ネットワーク、および記憶域) は、フェールオーバークラスタースナップインの一部である検証ウィザードのすべてのテストに合格する必要があります。

2ノードフェールオーバークラスターの場合、次のものが必要になります。

- **サーバー:** 同一または類似したコンポーネントで一致するコンピューターを使用することをお勧めします。  2ノードフェールオーバークラスターのサーバーでは、同じバージョンの Windows Server が実行されている必要があります。 また、同じソフトウェア更新プログラム (修正プログラム) が必要です。

- **ネットワークアダプターとケーブル:** フェールオーバークラスターソリューションの他のコンポーネントと同様に、ネットワークハードウェアは、Windows Server 2016 または Windows Server 2019 と互換性がある必要があります。 ISCSI を使用する場合、ネットワークアダプターはネットワーク通信と iSCSI の両方ではなく、どちらか専用である必要があります。 クラスター ノードを接続するネットワーク インフラストラクチャでは、単一障害点を回避する必要があります。 これを実現するには、いくつかの方法があります。 複数の個別のネットワークを使用してクラスター ノードを接続する方法があります。 また、チーム化されたネットワーク アダプター、冗長なスイッチ、冗長なルーターなど、単一障害点を取り除くためのハードウェアが導入された単一のネットワークにクラスター ノードを接続する方法もあります。

   > [!NOTE]
   > クラスターノードが1つのネットワークに接続されている場合、ネットワークは構成の検証ウィザードの冗長性の要件を満たします。  ただし、レポートには、ネットワークに単一障害点がないことを示す警告が含まれます。

- **ストレージ用のデバイスコントローラーまたは適切なアダプター:**
    - **シリアル接続 SCSI またはファイバーチャネル:** シリアル接続 SCSI またはファイバーチャネルを使用している場合は、すべてのクラスター化されたサーバーで、記憶域スタックのすべてのコンポーネントが同一である必要があります。 マルチパス i/o (MPIO) ソフトウェアおよびデバイス固有モジュール (DSM) ソフトウェアコンポーネントが同一である必要があります。  また、クラスター記憶域に接続する大容量記憶装置コントローラー (つまり、ホスト バス アダプター (HBA)、HBA ドライバー、および HBA ファームウェア) も同じものを使用することをお勧めします。 異なる HBA を使用する場合は、サポートされる構成または推奨される構成に従っていることを記憶域の製造元に確認する必要があります。
    - **iSCSI:** ISCSI を使用している場合、各クラスターサーバーには、ISCSI 記憶域専用のネットワークアダプターまたはホストバスアダプターが1つ以上必要です。 iSCSI に使用するネットワークは、ネットワーク通信には使用できません。 クラスター化されたすべてのサーバーで、iSCSI 記憶域ターゲットへの接続に同一のネットワーク アダプターを使用する必要があります。ギガビット イーサネット以上の通信規格を使用することをお勧めします。

- **ストレージ:** Windows Server 2016 または Windows Server 2019 用に認定されている共有記憶域を使用する必要があります。

    2ノードフェールオーバークラスターの場合、クォーラムとして監視ディスクを使用する場合は、記憶域に2つ以上の個別のボリューム (Lun) が含まれている必要があります。 監視ディスクは、クラスター構成データベースのコピーを保持するように指定されているクラスター記憶域のディスクです。 この2ノードクラスターの例では、クォーラム構成はノードおよびディスクマジョリティになります。 ノードとディスクマジョリティは、ノードと監視ディスクにそれぞれクラスター構成のコピーが含まれており、これらのコピーの過半数 (2 つのうち2つ) が使用可能である限り、クラスターにクォーラムがあることを意味します。 もう一方のボリューム (LUN) には、ユーザーに共有されているファイルが含まれます。

    記憶域の要件を次に示します。

    - フェールオーバー クラスタリングに含まれるネイティブのディスク サポートを利用するには、ダイナミック ディスクではなくベーシック ディスクを使用してください。
    - NTFS でパーティションをフォーマットしておくことをお勧めします。監視ディスクでは、パーティションが NTFS である必要があります。
    - ディスクのパーティション スタイルとして、マスター ブート レコード (MBR) と GUID パーティション テーブル (GPT) のいずれかを使用できます。
    - 記憶域は特定の SCSI コマンドに正しく応答する必要があります。記憶域は、SCSI プライマリコマンド 3 (SPC 3) と呼ばれる標準に従っている必要があります。 特に、ストレージは、SPC-3 標準で指定されている永続的な予約をサポートしている必要があります。
    -  記憶域に使用するミニポート ドライバーを、Microsoft Storport 記憶域ドライバーと共に使用できる必要があります。

## <a name="deploying-storage-area-networks-with-failover-clusters"></a>フェールオーバー クラスターを備えた記憶域ネットワークの展開

フェールオーバークラスターを使用して記憶域ネットワーク (SAN) を展開する場合は、次のガイドラインに従う必要があります。

- **ストレージの証明書を確認します。**[Windows Server Catalog](https://www.windowsservercatalog.com/default.aspx)サイトを使用して、ベンダーの記憶域 (ドライバー、ファームウェア、ソフトウェアなど) が windows server 2016 または windows server 2019 に対して認定されていることを確認します。

- **デバイスごとに1つのクラスターで、記憶装置を分離します。** 異なるクラスターのサーバーは、同じ記憶装置にアクセスできないようにする必要があります。 ほとんどの場合、1つのクラスターサーバーセットに使用される LUN は、LUN マスキングまたはゾーニングによって、他のすべてのサーバーから分離する必要があります。

- **マルチパス i/o ソフトウェアを使用することを検討し** てください。高可用性の記憶域ファブリックでは、マルチパス i/o ソフトウェアを使用して、複数のホストバスアダプターを含むフェールオーバークラスターを展開できます。 これによって、冗長性と可用性を最大限に引き出すことができます。 マルチパスソリューションは、Microsoft マルチパス i/o (MPIO) をベースにしている必要があります。 Windows Server 2016 と Windows Server 2019 には、オペレーティングシステムの一部として1つまたは複数の Dsm が組み込まれていますが、記憶域ハードウェアの製造元は、ハードウェアに対して MPIO デバイス固有モジュール (DSM) を提供できます。

## <a name="network-infrastructure-and-domain-account-requirements"></a>ネットワーク インフラストラクチャとドメイン アカウントの要件

2ノードのフェールオーバークラスターと、次のドメインアクセス許可を持つ管理アカウントには、次のネットワークインフラストラクチャが必要です。

- **ネットワーク設定と IP アドレス:** ネットワークに同一のネットワークアダプターを使用する場合は、これらのアダプターでも同じ通信設定を使用します (速度、二重モード、フロー制御、メディアの種類など)。 また、ネットワーク アダプターとその接続先のスイッチ間で設定を比較して、設定に競合がないことを確認します。

    ネットワーク インフラストラクチャの残りの部分にルーティングされないプライベート ネットワークを使用する場合、それらのプライベート ネットワークが固有のサブネットを使用することを確認します。 これは、各ネットワーク アダプターに固有の IP アドレスを割り当てる場合であっても必要です。 たとえば、1 つの物理ネットワークを使用する本社にクラスター ノードがあり、別個の物理ネットワークを使用する支社に別のノードがある場合、各アダプターに固有の IP アドレスを割り当てる場合であっても、両方のネットワークに対して 10.0.0.0/24 を指定しないでください。

    ネットワークアダプターの詳細については、このガイドの「2ノードフェールオーバークラスターのハードウェア要件」を参照してください。

- **DNS:** クラスター内のサーバーは、名前解決にドメインネームシステム (DNS) を使用している必要があります。 DNS 動的更新プロトコルを使用できます。

- **ドメインの役割:** クラスター内のすべてのサーバーは、同じ Active Directory ドメイン内に存在する必要があります。 ベスト プラクティスとして、クラスター化されたサーバーはすべて同じドメインの役割 (メンバー サーバーまたはドメイン コントローラー) を持つ必要があります。 推奨される役割は、メンバー サーバーです。

- **ドメインコントローラー:** クラスター化されたサーバーをメンバーサーバーにすることをお勧めします。 そのような場合は、フェールオーバークラスターを含むドメインのドメインコントローラーとして機能する追加のサーバーが必要です。

- **クライアント:** テストに必要な場合は、1つまたは複数のネットワークに接続されたクライアントを、作成したフェールオーバークラスターに接続し、クラスター化されたファイルサーバーをクラスターノード間で移動またはフェールオーバーするときに、クライアントへの影響を観察します。

- **クラスターを管理するためのアカウント:** クラスターを初めて作成するとき、またはクラスターにサーバーを追加するときは、そのクラスター内のすべてのサーバーに対する管理者権限とアクセス許可を持つアカウントでドメインにログオンする必要があります。 このアカウントは Domain Admins アカウントである必要はなく、クラスター化された各サーバーの Administrators グループに属するドメイン ユーザー アカウントでもかまいません。 また、アカウントが Domain Admins アカウントでない場合は、に存在するドメイン組織単位 (OU) の [ **コンピューターオブジェクトの作成** ] アクセス許可と [ **すべてのプロパティの読み取り** ] アクセス許可を付与する必要があります。

## <a name="steps-for-installing-a-two-node-file-server-cluster"></a>2ノードのファイルサーバークラスターをインストールする手順

2ノードのファイルサーバーフェールオーバークラスターをインストールするには、次の手順を完了する必要があります。

手順 1: クラスターサーバーをネットワークと記憶域に接続する

手順 2: フェールオーバークラスター機能をインストールする

手順 3: クラスター構成を検証する

手順 4:クラスターを作成する

クラスターノードが既にインストールされており、ファイルサーバーのフェールオーバークラスターを構成する場合は、このガイドの「2ノードのファイルサーバークラスターを構成するための手順」を参照してください。

### <a name="step-1-connect-the-cluster-servers-to-the-networks-and-storage"></a>手順 1: クラスターサーバーをネットワークと記憶域に接続する

フェールオーバークラスターネットワークの場合、単一障害点は避けてください。 これを実現するには、いくつかの方法があります。 複数の個別のネットワークを使用してクラスター ノードを接続する方法があります。 または、チーム化されたネットワークアダプター、冗長スイッチ、冗長なルーター、または単一障害点を解消する同様のハードウェア (iSCSI 用のネットワークを使用する場合は、他のネットワークに加えてこのネットワークを作成する必要があります) を使用して構築された1つのネットワークにクラスターノードを接続することもできます。

2ノードのファイルサーバークラスターの場合は、サーバーをクラスター記憶域に接続するときに、少なくとも2つのボリューム (Lun) を公開する必要があります。 構成を徹底的にテストするために、必要に応じて追加のボリュームを公開できます。 クラスター化されていないボリュームは、クラスターに存在しないサーバーに公開しないでください。

#### <a name="to-connect-the-cluster-servers-to-the-networks-and-storage"></a>クラスターサーバーをネットワークと記憶域に接続するには

1. 2ノードのフェールオーバークラスターのハードウェア要件に関するネットワークの詳細と、2ノードのフェールオーバークラスターのネットワークインフラストラクチャおよびドメインアカウントの要件については、このガイドの前半で説明しています。

2. クラスター内のサーバーが使用するネットワークを接続および構成します。

3. テスト構成にクライアントまたは非クラスター化ドメインコントローラーが含まれている場合は、これらのコンピューターが少なくとも1つのネットワークを介してクラスター化されたサーバーに接続できることを確認してください。

4. 製造元の指示に従って、サーバーを記憶域に物理的に接続します。

5. クラスターで使用するディスク (LUN) がクラスター化するサーバーに (およびそれらのサーバーにのみ) 公開されていることを確認します。 次のインターフェイスのいずれかを使用して、ディスクまたは LUN を公開します。

    - 記憶域の製造元によって提供されたインターフェイス

    - iSCSI を使用している場合は、適切な iSCSI インターフェイス。

6. ディスクの形式または機能を制御するソフトウェアを購入した場合は、ベンダーの指示に従って、そのソフトウェアを Windows Server と共に使用する方法を確認してください。

7. クラスター化するいずれかのサーバーで、[スタート]、[管理ツール]、[コンピューターの管理] の順にクリックし、[ディスクの管理] をクリックします。 ([ユーザーアカウント制御] ダイアログボックスが表示されたら、表示された操作が正しいことを確認し、[続行] をクリックします)。[ディスクの管理] で、クラスターディスクが表示されていることを確認します。

8. 2 テラバイトを超える記憶域ボリュームを使用し、Windows インターフェイスを使用してディスクの形式を制御する場合は、そのディスクを GUID パーティション テーブル (GPT) と呼ばれるパーティション スタイルに変換します。 これを行うには、ディスク上のすべてのデータをバックアップし、ディスク上のすべてのボリュームを削除します。次に、[ディスクの管理] で、(パーティションではなく) ディスクを右クリックし、[GPT ディスクに変換] をクリックします。  ボリュームが 2 テラバイト未満の場合は、GPT を使用する代わりに、マスター ブート レコード (MBR) と呼ばれるパーティション スタイルを使用できます。

9. 公開するボリュームまたは LUN の形式を確認します。 NTFS 形式を使用することをお勧めします。また、監視ディスクには NTFS を使用する必要があります。

### <a name="step-2-install-the-file-server-role-and-failover-cluster-feature"></a>手順 2: ファイルサーバーの役割とフェールオーバークラスター機能をインストールする

この手順では、ファイルサーバーの役割とフェールオーバークラスター機能がインストールされます。 どちらのサーバーも、Windows Server 2016 または Windows Server 2019 を実行している必要があります。

#### <a name="using-server-manager"></a>サーバーマネージャーの使用

1. **サーバーマネージャー**を開き、[**管理**] ドロップダウンで [**役割と機能の追加**] を選択します。

   ![機能の追加](media/Cluster-File-Server/Cluster-FS-Add-Feature.png)

2. [ **開始する前に** ] ウィンドウが開いたら、[ **次へ**] をクリックします。

3. [ **インストールの種類**] で、[ **役割ベースまたは機能ベースのインストール** ] を選択し、[ **次へ**] をクリックします。

4. **[サーバープールからサーバーを選択]** が選択されていることを確認し、コンピューターの名前を強調表示して、[**次へ**] をクリックします。

5. サーバーロールの場合は、ロールの一覧から [ **ファイルサービス**] を開き、[ **ファイルサーバー**]、[ **次へ**] を選択します。

   ![ロールの追加](media/Cluster-File-Server/Cluster-FS-Add-FS-Role-1.png)

6. 機能については、機能の一覧から [ **フェールオーバークラスタリング**] を選択します。  ポップアップダイアログには、インストールされている管理ツールも一覧表示されます。  選択したものをすべて保持し、[ **機能の追加** ]、[ **次へ**] を選択します。

   ![機能の追加](media/Cluster-File-Server/Cluster-FS-Add-WSFC-1.png)

7. [確認] ページで [インストール] を選択します。

8. インストールが完了したら、コンピューターを再起動します。

9. 2番目のコンピューターでも同じ手順を繰り返します。

#### <a name="using-powershell"></a>PowerShell の使用

1. [スタート] ボタンを右クリックし、[ **Windows powershell (管理者)**] を選択して、管理 PowerShell セッションを開きます。
2. ファイルサーバーの役割をインストールするには、次のコマンドを実行します。

    ```PowerShell
    Install-WindowsFeature -Name FS-FileServer
    ```

3. フェールオーバークラスタリング機能とその管理ツールをインストールするには、次のコマンドを実行します。

    ```PowerShell
    Install-WindowsFeature -Name Failover-Clustering -IncludeManagementTools
    ```

4. 完了したら、次のコマンドを使用してインストールされていることを確認できます。

    ```PowerShell
    Get-WindowsFeature -Name FS-FileServer
    Get-WindowsFeature -Name Failover-Clustering
    ```

5. これらがインストールされたことを確認したら、次のコマンドを使用してコンピューターを再起動します。

    ```PowerShell
    Restart-Computer
    ```

6. 2番目のサーバーでも同じ手順を繰り返します。

### <a name="step-3-validate-the-cluster-configuration"></a>手順 3: クラスター構成を検証する

クラスターを作成する前に、構成を検証することを強くお勧めします。 検証は、サーバー、ネットワーク、および記憶域の構成が、フェールオーバークラスターに関する特定の要件を満たしているかどうかを確認するのに役立ちます。

#### <a name="using-failover-cluster-manager"></a>フェールオーバー クラスター マネージャーの使用

1. **サーバーマネージャー**から、[**ツール**] ドロップダウンを選択し、[**フェールオーバークラスターマネージャー**] を選択します。

2. **フェールオーバークラスターマネージャー**で、[**管理**] の下の中央の列にアクセスし、[**構成の検証**] を選択します。

3. [ **開始する前に** ] ウィンドウが開いたら、[ **次へ**] をクリックします。

4. **[サーバーまたはクラスターの選択**] ウィンドウで、クラスターのノードとなる2台のコンピューターの名前をに追加します。  たとえば、名前が NODE1 および NODE2 の場合は、名前を入力し、[ **追加**] を選択します。  また、[ **参照** ] ボタンをクリックして、名前の Active Directory を検索することもできます。  両方が [ **選択したサーバー**] の下に一覧表示されたら、[ **次へ**] を選択します

5. [ **テストオプション** ] ウィンドウで、[ **すべてのテストを実行する (推奨)**] を選択し、[ **次へ**] をクリックします。

6. **確認ページに**は、確認するすべてのテストの一覧が表示されます。  [ **次へ** ] をクリックすると、テストが開始されます。

7. 完了すると、テストの実行後に [ **概要** ] ページが表示されます。 結果の解釈に役立つヘルプトピックを表示するには、[ **クラスター検証テストの詳細**] をクリックします。

8. [概要] ページに留まったままで [レポートの表示] をクリックし、テスト結果を確認します。 構成に必要な変更を加え、テストを再実行します。 <br>ウィザードを閉じた後でテストの結果を表示するには、「 *SystemRoot\Cluster\Reports\Validation Report date and time.html*」を参照してください。

9. ウィザードを閉じた後、クラスターの検証に関するヘルプトピックを表示するには、フェールオーバークラスター管理で [ヘルプ] をクリックし、[ヘルプトピック] をクリックして、[コンテンツ] タブをクリックし、フェールオーバークラスターヘルプの内容を展開して、[フェールオーバークラスター構成の検証] をクリックします。

#### <a name="using-powershell"></a>PowerShell の使用

1. [スタート] ボタンを右クリックし、[ **Windows powershell (管理者)**] を選択して、管理 PowerShell セッションを開きます。

2. フェールオーバークラスタリング用にコンピューター名 (たとえば、NODE1 と NODE2) を検証するには、次のコマンドを実行します。

    ```PowerShell
    Test-Cluster -Node "NODE1","NODE2"
    ```
4. ウィザードを閉じた後でテストの結果を表示するには、指定されたファイル (SystemRoot\Cluster\Reports) を参照し、 \) 構成に必要な変更を加えて、テストを再実行します。

詳細については、「 [フェールオーバークラスター構成の検証](/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj134244(v=ws.11))」を参照してください。

### <a name="step-4-create-the-cluster"></a>手順 4: クラスターを作成する

次の例では、使用しているマシンと構成からクラスターを作成します。

#### <a name="using-failover-cluster-manager"></a>フェールオーバー クラスター マネージャーの使用

1. **サーバーマネージャー**から、[**ツール**] ドロップダウンを選択し、[**フェールオーバークラスターマネージャー**] を選択します。

2. **フェールオーバークラスターマネージャー**で、[**管理**] の下の中央の列にアクセスし、[**クラスターの作成**] を選択します。

3. [ **開始する前に** ] ウィンドウが開いたら、[ **次へ**] をクリックします。

4. **[サーバーの選択**] ウィンドウで、クラスターのノードとなる2台のコンピューターの名前をに追加します。  たとえば、名前が NODE1 および NODE2 の場合は、名前を入力し、[ **追加**] を選択します。  また、[ **参照** ] ボタンをクリックして、名前の Active Directory を検索することもできます。  両方が [ **選択したサーバー**] の下に一覧表示されたら、[ **次へ**] を選択します

5. [ **クラスター管理用のアクセスポイント** ] ウィンドウで、使用するクラスターの名前を入力します。  これは、ファイル共有への接続に使用する名前ではないことに注意してください。  これは、単純にクラスターを管理するためのものです。

   > [!NOTE]
   > 静的 IP アドレスを使用している場合は、使用するネットワークを選択し、クラスター名に使用する IP アドレスを入力する必要があります。  IP アドレスに DHCP を使用している場合は、IP アドレスが自動的に構成されます。

6. **[次へ]** をクリックします。

7. [ **確認** ] ページで、構成した内容を確認し、[ **次へ** ] を選択してクラスターを作成します。

8. [ **概要** ] ページには、作成した構成が表示されます。  [レポートの表示] を選択すると、作成したレポートが表示されます。

#### <a name="using-powershell"></a>PowerShell の使用

1. [スタート] ボタンを右クリックし、[ **Windows powershell (管理者)**] を選択して、管理 PowerShell セッションを開きます。

2. 静的 IP アドレスを使用している場合は、次のコマンドを実行してクラスターを作成します。  たとえば、コンピューター名は NODE1 と NODE2 で、クラスターの名前はクラスターになり、IP アドレスは1.1.1.1 になります。

   ```PowerShell
    New-Cluster -Name CLUSTER -Node "NODE1","NODE2" -StaticAddress 1.1.1.1
   ```

3. IP アドレスに DHCP を使用している場合は、次のコマンドを実行してクラスターを作成します。  たとえば、コンピューター名は NODE1 と NODE2 で、クラスターの名前は CLUSTER になります。

   ```PowerShell
   New-Cluster -Name CLUSTER -Node "NODE1","NODE2"
   ```

### <a name="steps-for-configuring-a-file-server-failover-cluster"></a>ファイルサーバーのフェールオーバークラスターを構成する手順

ファイルサーバーのフェールオーバークラスターを構成するには、次の手順に従います。

1. **サーバーマネージャー**から、[**ツール**] ドロップダウンを選択し、[**フェールオーバークラスターマネージャー**] を選択します。

2. フェールオーバークラスターマネージャーを開くと、作成したクラスターの名前が自動的に表示されます。  表示されていない場合は、[ **管理** ] の下の中央の列にアクセスし、[ **クラスターに接続**] を選択します。  作成したクラスターの名前を入力し、 **[OK] をクリック**します。

3. コンソールツリーで、作成したクラスターの横にある ">" の記号をクリックして、その下の項目を展開します。

4. [ **ロール** ] を右クリックし、[ **ロールの構成**] を選択します。

5. [ **開始する前に** ] ウィンドウが開いたら、[ **次へ**] をクリックします。

6. ロールの一覧で、[ **ファイルサーバー** ]、[ **次へ**] の順に選択します。

7. ファイルサーバーの種類として、[汎用] と [**次へ**]**の [ファイルサーバー** ] を選択します。<br>スケールアウトファイルサーバーの詳細については、「 [スケールアウトファイルサーバーの概要](sofs-overview.md)」を参照してください。

   ![ファイルサーバーの種類](media/Cluster-File-Server/Cluster-FS-File-Server-Type.png)

8. [ **クライアントアクセスポイント** ] ウィンドウで、使用するファイルサーバーの名前を入力します。  これはクラスターの名前ではないことに注意してください。  これは、ファイル共有の接続用です。  たとえば、サーバーに接続する場合、 \\ 入力という名前がサーバーになります。

   > [!NOTE]
   > 静的 IP アドレスを使用している場合は、使用するネットワークを選択し、クラスター名に使用する IP アドレスを入力する必要があります。  IP アドレスに DHCP を使用している場合は、IP アドレスが自動的に構成されます。

9. **[次へ]** をクリックします。

10. **[記憶域の選択**] ウィンドウで、共有を保持する追加のドライブ (ミラーリング監視サーバーではない) を選択し、[**次へ**] をクリックします。

11. [ **確認** ] ページで、構成を確認し、[ **次へ**] を選択します。

12. [ **概要** ] ページには、作成した構成が表示されます。  [レポートの表示] を選択すると、ファイルサーバーロールの作成に関するレポートが表示されます。

   > [!NOTE]
   > ロールが正しく追加または開始されない場合、CNO (クラスター名オブジェクト) には Active Directory でオブジェクトを作成するためのアクセス許可がない可能性があります。 ファイルサーバーの役割には、手順8で指定した "クライアントアクセスポイント" と同じ名前のコンピューターオブジェクトが必要です。

13. コンソールツリーの [ **ロール** ] で、作成した新しいロールが、作成した名前として表示されます。  強調表示された状態で、右側の [ **操作** ] ウィンドウで [ **共有の追加**] を選択します。

14. 次のように、共有ウィザードを使用してを実行します。

    - 共有の種類
    - フォルダーが共有される場所/パス
    - 接続先となる共有ユーザーの名前
    - アクセスベースの列挙、キャッシュ、暗号化などの追加の設定
    - ファイルレベルのアクセス許可が既定値以外の場合

15. [ **確認** ] ページで、構成した内容を確認し、[ **作成** ] を選択してファイルサーバー共有を作成します。

16. [ **結果** ] ページで、共有を作成した場合は [閉じる] を選択します。  共有を作成できなかった場合は、発生したエラーが表示されます。

17. **[閉じる]** を選択します。

18. 追加の共有については、この手順を繰り返します。
