---
title: KMS ライセンス認証の既知の問題
description: KMS ライセンス認証プロセス中に発生する可能性のある一般的な問題について説明し、解決策とガイダンスを示します。
ms.topic: article
ms.date: 10/3/2019
ms.technology: server-general
author: Teresa-Motiv
ms.author: v-tea
manager: dcscontentpm
ms.localizationpriority: medium
ms.openlocfilehash: 3446ad0954510d8c96e9a2d361f24c90d325b782
ms.sourcegitcommit: 3a3d62f938322849f81ee9ec01186b3e7ab90fe0
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2020
ms.locfileid: "80826255"
---
# <a name="kms-activation-known-issues"></a>KMS ライセンス認証: 既知の問題

この記事では、キー管理サービス (KMS) のライセンス認証中に生じる可能性のある一般的な質問と問題について説明し、問題に対処するためのガイダンスを示します。

> [!NOTE]
> 問題が DNS に関連していると思われる場合は、「[KMS と DNS に関する問題の一般的なトラブルシューティング手順](common-troubleshooting-procedures-kms-dns.md)」を参照してください。

## <a name="should-i-back-up-kms-host-information"></a>KMS ホスト情報のバックアップの必要性

KMS ホストのバックアップは必要ありません。 ただし、ツールを使用して定期的にイベント ログをクリーンアップすると、ログに格納されているライセンス認証の履歴が失われる可能性があります。 イベント ログを使用して KMS ライセンス認証を追跡またはドキュメント化する場合は、イベント ビューアーの [アプリケーションとサービス ログ] フォルダーからキー管理サービスのイベント ログを定期的にエクスポートします。

System Center Operations Manager を使用する場合、System Center データ ウェアハウス データベースにレポート作成用のイベント ログ データが格納されるため、イベント ログを別途バックアップする必要はありません。

## <a name="is-the-kms-client-computer-activated"></a>KMS クライアント コンピューターがライセンス認証されているかどうかを確認する方法

KMS クライアント コンピューターで、 **[システム]** コントロール パネルを開き、"**Windows はライセンス認証されています**" というメッセージを探します。 または、Slmgr.vbs を実行し、 **/dli** コマンド ライン オプションを使用します。

## <a name="the-kms-client-computer-does-not-activate"></a>KMS クライアント コンピューターがライセンス認証されない

KMS ライセンス認証のしきい値が満たされていることを確認します。 KMS ホスト コンピューターで、Slmgr.vbs を実行し、 **/dli** コマンド ライン オプションを使用してホストの現在のカウント ("現在の数") を確認します。 KMS ホストに示されたカウントが 25 になるまで、Windows 7 クライアント コンピューターをライセンス認証することはできません。 Windows Server 2008 R2 KMS クライアントでは、ライセンス認証に必要な KMS カウントは 5 です。 KMS の要件の詳細については、「[ボリューム ライセンス認証の計画ガイド](https://go.microsoft.com/fwlink/?linkid=155926)」を参照してください。 

KMS クライアント コンピューター上のアプリケーション イベント ログで、イベント ID 12289 を調べます。 このイベントの次の情報を確認します。

- 結果コードは **0** ですか? それ以外はすべてエラーです。
- イベントの KMS ホスト名は正しいですか?
- KMS ポートは正しいですか?
- KMS ホストにアクセスできますか?
- クライアントで Microsoft 以外のファイアウォールが実行されている場合、送信ポートを構成する必要がありますか?

KMS ホスト コンピューター上の KMS イベント ログで、イベント ID 12290 を調べます。 このイベントの次の情報を確認します。

- KMS ホストのログに、クライアント コンピューターからの要求が記録されていますか? KMS クライアント コンピューターの名前が示されていることを確認します。 クライアントと KMS ホストが通信できることを確認します。 クライアントで応答が受信されましたか?
- KMS クライアントからのイベントがログに記録されていない場合は、要求が KMS ホストに届かなかったか、KMS ホストが要求を処理できなかったということです。 TCP ポート 1688 (既定のポートを使用している場合) を使用したトラフィックがルーターでブロックされていないこと、および KMS クライアントへのステートフル トラフィックが許可されていることを確認します。

## <a name="what-does-this-error-code-mean"></a>エラー コードの意味

イベント ID 12290 の KMS イベントを除き、すべてのライセンス認証イベントが、Windows によってアプリケーション イベント ログに記録されます。イベント プロバイダー名は、Microsoft-Windows-Security-SPP です。 Windows では、[アプリケーションとサービス] フォルダーのキー管理サービス ログに KMS イベントが記録されます。 IT 担当者は、Slui.exe を実行して、ライセンス認証に最も関連性が深いエラー コードの説明を表示できます。 このコマンドの一般的な構文は次のとおりです。

```cmd
slui.exe 0x2a ErrorCode
```

たとえば、イベント ID 12293 にエラー コード 0x8007267C が含まれている場合、次のコマンドを実行すると、そのエラーの説明を表示できます。

```cmd
slui.exe 0x2a 0x8007267C
```

具体的なエラー コードとその対処方法の詳細については、[一般的なライセンス認証エラー コードの解決](activation-error-codes.md)に関するページを参照してください。

## <a name="clients-are-not-adding-to-the-kms-count"></a>クライアントが KMS カウントに追加されない

クライアント コンピューター ID (CMID) およびその他の製品ライセンス認証情報をリセットするために、**sysprep /generalize** または **slmgr /rearm** を実行します。 そうしないと、各クライアント コンピューターが同一と見なされ、KMS ホストによって個別の KMS クライアントとしてカウントされません。

## <a name="kms-hosts-are-unable-to-create-srv-records"></a>KMS ホストで SRV レコードを作成できない

ドメイン ネーム システム (DNS) によって書き込みアクセスが制限されているか、動的 DNS (DDNS) がサポートされていない可能性があります。 この場合は、KMS ホストに DNS データベースへの書き込みアクセスを許可するか、サービス (SRV) リソース レコード (RR) を手動で作成します。 KMS と DNS に関する問題の詳細については、「[KMS と DNS の問題に関する一般的なトラブルシューティング手順](common-troubleshooting-procedures-kms-dns.md)」を参照してください。

## <a name="only-the-first-kms-host-is-able-to-create-srv-records"></a>1 台目の KMS ホストでしか SRV レコードを作成できない

組織に複数の KMS ホストがある場合は、SRV の既定のアクセス許可を変更しないと、他のホストで SRV RR を更新できない可能性があります。 KMS と DNS に関する問題の詳細については、「[KMS と DNS の問題に関する一般的なトラブルシューティング手順](common-troubleshooting-procedures-kms-dns.md)」を参照してください。

## <a name="i-installed-a-kms-key-on-the-kms-client"></a>KMS クライアントに KMS キーをインストールした

KMS キーは、KMS ホストにのみインストールする必要があります。KMS クライアントにはインストールしません。 **slmgr.vbs -ipk &lt;セットアップ キー&gt;** を実行します。 KMS クライアントとしてコンピューターを構成するために使用できるキーの一覧表については、「[KMS クライアント セットアップ キー](KMSclientkeys.md)」を参照してください。 これらのキーは公開されており、エディションによって異なります。 不要な SRV RR を DNS から削除し、コンピューターを再起動することを忘れないでください。

## <a name="a-kms-host-failed"></a>KMS ホストに障害が発生した

KMS ホストに障害が発生した場合は、新しいホストに KMS ホスト キーをインストールし、そのホストをライセンス認証する必要があります。 新しい KMS ホストの SRV RR が DNS データベースにあることを確認します。 障害が発生した KMS ホストと同じコンピューター名と IP アドレスを使用して新しい KMS ホストをインストールすると、障害が発生したホストの DNS SRV レコードを新しい KMS ホストで使用できます。 新しいホストのコンピューター名が異なる場合は、障害が発生したホストの DNS SRV RR を手動で削除するか、(DNS で清掃が有効になっている場合は) DNS によって自動的に削除されるようにすることができます。 ネットワークで DDNS を使用している場合は、新しい KMS ホストによって DNS サーバー上に新しい SRV RR が自動的に作成されます。 その後、新しい KMS ホストによるクライアント更新要求の収集が開始され、KMS ライセンス認証のしきい値が満たされるとすぐにクライアントのライセンス認証が始まります。

KMS クライアントで自動検出を使用していれば、元の KMS ホストが更新要求に応答しない場合、別の KMS ホストが自動的に選択されます。 クライアントで自動検出を使用していない場合は、**slmgr.vbs /skms** を実行して、障害が発生した KMS ホストに割り当てられていた KMS クライアント コンピューターを手動で更新する必要があります。 このシナリオを回避するには、自動検出を使用するように KMS クライアントを構成します。 詳細については、「[ボリューム ライセンス認証の展開ガイド](https://go.microsoft.com/fwlink/?linkid=150083)」を参照してください。
