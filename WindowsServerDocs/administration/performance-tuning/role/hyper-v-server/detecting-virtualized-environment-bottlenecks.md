---
title: 仮想化環境でのボトルネックの検出
description: Hyper-v のパフォーマンスに関する潜在的なボトルネックを検出して解決する方法
ms.prod: windows-server-threshold
ms.technology: performance-tuning-guide
ms.topic: article
ms.author: Asmahi; SandySp; JoPoulso
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: cdad5f0cc3b0e49ae46e975e3acc2c48a18e5f70
ms.sourcegitcommit: af80963a1d16c0b836da31efd9c5caaaf6708133
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/31/2019
ms.locfileid: "63722883"
---
# <a name="detecting-bottlenecks-in-a-virtualized-environment"></a>仮想化環境でのボトルネックの検出

ここでは、パフォーマンスモニターを使用して監視する内容に関するヒントと、ホストまたは一部の仮想マシンが予期したとおりに動作しない場合に問題が発生する可能性がある場所を特定する方法について説明します。

## <a name="processor-bottlenecks"></a>プロセッサのボトルネック

ここでは、プロセッサのボトルネックを引き起こす可能性がある一般的なシナリオをいくつか紹介します。

-   1つ以上の論理プロセッサが読み込まれています

-   1つ以上の仮想プロセッサが読み込まれています

ホストから次のパフォーマンスカウンターを使用できます。

-   論理プロセッサ使用率\\-hyper-v ハイパーバイザー論理プロセッサ (\*)\\% 合計実行時間

-   仮想プロセッサ使用率\\-hyper-v ハイパーバイザー仮想プロセッサ (\*)\\% 合計実行時間

-   ルート仮想プロセッサ使用率\\-hyper-v ハイパーバイザールート仮想プロセッサ (\*)\\% 合計実行時間

**Hyper-v ハイパーバイザー論理プロセッサ (\_total)\\% total Runtime**カウンターが 90% を超えている場合、ホストは過負荷になります。 より多くの処理能力を追加するか、一部の仮想マシンを別のホストに移動する必要があります。

**Hyper-v ハイパーバイザー仮想プロセッサ (VM Name: VP x)\\% Total Runtime**カウンタがすべての仮想プロセッサで 90% を超えている場合は、次の操作を行う必要があります。

-   ホストが過負荷になっていないことを確認する

-   ワークロードがより多くの仮想プロセッサを利用できるかどうかを確認する

-   仮想マシンにさらに仮想プロセッサを割り当てる

**Hyper-v ハイパーバイザー仮想プロセッサ (VM Name: VP x)\\% Total Runtime**カウンターがすべてではなく、一部の仮想プロセッサに対して 90% を超えている場合は、次の操作を行う必要があります。

-   ワークロードがネットワークを集中的に使用する場合は、vRSS の使用を検討する必要があります。

-   仮想マシンで Windows Server 2012 R2 が実行されていない場合は、さらにネットワークアダプターを追加する必要があります。

-   ワークロードが記憶域を集中的に使用する場合は、仮想 NUMA を有効にし、さらに仮想ディスクを追加する必要があります。

すべてで **\\** はなく、一部の仮想プロセッサと**プロセッサ\\(x)% Interrupt time と processor (x)\\% DPC time について、hyper-v ハイパーバイザールート仮想プロセッサ (ルート VP x)% Total Runtime counter が 90% を超えている場合**カウンタは、**平方根仮想プロセッサ (ルート VP x)\\% Total Runtime**カウンターの値に加算されます。ネットワークアダプターで VMQ を有効にする必要があります。

## <a name="memory-bottlenecks"></a>メモリのボトルネック

次に、メモリのボトルネックの原因となる可能性がある一般的なシナリオをいくつか示します。

-   ホストが応答していません。

-   仮想マシンを起動できません。

-   仮想マシンのメモリが不足しています。

ホストから次のパフォーマンスカウンターを使用できます。

-   使用\\可能なメモリ (mb)

-   Hyper-v 動的メモリバランサー (\*)\\の使用可能なメモリ

仮想マシンから次のパフォーマンスカウンターを使用できます。

-   使用\\可能なメモリ (mb)

使用可能なメモリ (mb **) と hyper-v 動的メモリバランサー (\*)\\の使用可能なメモリ**カウンターがホストで低い場合は、重要ではないサービスを停止し、1つまたは複数の仮想を移行する必要があります。 **\\** マシンを別のホストに対して行います。

仮想マシン**で\\使用可能なメモリ (mb** ) カウンターが不足している場合は、仮想マシンにより多くのメモリを割り当てる必要があります。 動的メモリを使用する場合は、[最大メモリ] 設定を増やす必要があります。

## <a name="network-bottlenecks"></a>ネットワークのボトルネック

ネットワークのボトルネックを引き起こす可能性がある一般的なシナリオを次に示します。

-   ホストはネットワークにバインドされています。

-   仮想マシンはネットワークにバインドされています。

ホストから次のパフォーマンスカウンターを使用できます。

-   ネットワークインターフェイス (*ネットワークアダプター名*)\\バイト数/秒

仮想マシンから次のパフォーマンスカウンターを使用できます。

-   Hyper-v Virtual Network アダプター (*仮想マシン名&lt;名 GUID&gt;* )\\バイト/秒

**PHYSICAL NIC Bytes/sec**カウンタの容量が 90% 以上の場合は、追加のネットワークアダプターを追加し、バーチャルマシンを別のホストに移行して、ネットワーク QoS を構成する必要があります。

**Hyper-v Virtual Network Adapter Bytes/sec**カウンターが 250 MBps 以上の場合は、追加のチーム化されたネットワークアダプターを仮想マシンに追加し、vRSS を有効にし、sr-iov を使用する必要があります。

ワークロードがネットワーク待機時間を満たせない場合は、SR-IOV を有効にして仮想マシンに物理ネットワークアダプターリソースを提示します。

## <a name="storage-bottlenecks"></a>記憶域のボトルネック

記憶域のボトルネックの原因となる一般的なシナリオをいくつか次に示します。

-   ホストおよびバーチャルマシンの操作が低速またはタイムアウトになっています。

-   仮想マシンの遅延が遅い。

ホストから次のパフォーマンスカウンターを使用できます。

-   物理ディスク (*ディスク文字*)\\の平均ディスク読み取り秒数

-   物理ディスク (*ディスク文字*)\\の平均ディスク書き込み秒数

-   物理ディスク (*ディスク文字*)\\の平均ディスク読み取りキューの長さ

-   物理ディスク (*ディスク文字*)\\のディスク書き込みキューの長さの平均

待機時間が常に50ミリ秒を超える場合は、次の操作を行う必要があります。

-   追加のストレージに仮想マシンを分散

-   高速ストレージの購入を検討する

-   Windows Server 2012 R2 で導入された Tiered Storage のスペースを検討してください。

-   Windows Server 2012 R2 で導入された記憶域 QoS の使用を検討してください。

-   VHDX を使用する

## <a name="see-also"></a>関連項目

-   [Hyper-V の用語](terminology.md)

-   [Hyper-V のアーキテクチャ](architecture.md)

-   [Hyper-V サーバーの構成](configuration.md)

-   [Hyper-V プロセッサのパフォーマンス](processor-performance.md)

-   [Hyper-V メモリのパフォーマンス](memory-performance.md)

-   [Hyper-V 記憶域の I/O のパフォーマンス](storage-io-performance.md)

-   [Hyper-V ネットワークの I/O のパフォーマンス](network-io-performance.md)

-   [Linux 仮想マシン](linux-virtual-machine-considerations.md)
